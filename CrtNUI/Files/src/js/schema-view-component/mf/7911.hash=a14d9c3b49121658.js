(self.webpackChunkapp_studio_enterprise_schema_view=self.webpackChunkapp_studio_enterprise_schema_view||[]).push([[7911],{67911:(O,W,r)=>{r.r(W),r.d(W,{CrtDashboardsComponent:()=>c,CrtDashboardsModule:()=>P,createDashboardsListDataAttributeName:()=>le,createDashboardsSelectedDashboardAttributeName:()=>de,generateDashboardsName:()=>ie,getDashboardsListDataAttributeName:()=>Qe});var u=r(73308),i=r(5960),a=r(59131),f=r(52989),k=r(71252),y=r(77592),T=r(34760),he=r(1034),me=r(96677),pe=r(60776),ue=r(75456),be=r(10098),Q=r(81220),ge=r(17679),De=r(68712),G=r(25409),J=r(70372),z=r(23092),Ce=r(73723),h=r(62278),p=r(36486),_=r(40297),E=r(31555),ve=r(62115),fe=r(16212),ye=r(52170),_e=r(47458),Se=r(82869),Ie=r(55711),Me=r(22817),b=r(79772);const Oe=["list"],Ee=["schemaContainer"];function xe(o,e){if(o&1&&(a.\u0275\u0275element(0,"crt-button",12),a.\u0275\u0275pipe(1,"translate"),a.\u0275\u0275pipe(2,"translate")),o&2){const t=a.\u0275\u0275nextContext();a.\u0275\u0275property("iconPosition","only-icon")("icon","actions-button-icon")("clickMode","menu")("menuItems",t.headerToolbarItems)("title",a.\u0275\u0275pipeBind1(1,6,"Dashboards.ActionsToolbar.Title"))("ariaLabel",a.\u0275\u0275pipeBind1(2,8,"Dashboards.ActionsToolbar.Title"))}}function Pe(o,e){if(o&1&&(a.\u0275\u0275elementStart(0,"crt-select-list-item",15),a.\u0275\u0275element(1,"mat-icon",16),a.\u0275\u0275elementStart(2,"span",17),a.\u0275\u0275text(3),a.\u0275\u0275elementEnd()()),o&2){const t=e.$implicit;a.\u0275\u0275property("crtListboxOption",t.Code),a.\u0275\u0275advance(2),a.\u0275\u0275property("title",t.Name),a.\u0275\u0275advance(),a.\u0275\u0275textInterpolate1(" ",t.Name,"")}}function Te(o,e){if(o&1){const t=a.\u0275\u0275getCurrentView();a.\u0275\u0275elementStart(0,"div",13),a.\u0275\u0275listener("selectedChange",function(s){a.\u0275\u0275restoreView(t);const d=a.\u0275\u0275nextContext();return a.\u0275\u0275resetView(d.onSelectedDashboardChanged(s.value[0]))}),a.\u0275\u0275template(1,Pe,4,3,"crt-select-list-item",14),a.\u0275\u0275elementEnd()}if(o&2){const t=a.\u0275\u0275nextContext();a.\u0275\u0275advance(),a.\u0275\u0275property("ngForOf",t.filteredDashboards)}}function $e(o,e){if(o&1){const t=a.\u0275\u0275getCurrentView();a.\u0275\u0275elementContainerStart(0,18),a.\u0275\u0275elementStart(1,"div",19),a.\u0275\u0275listener("selectedChange",function(){a.\u0275\u0275restoreView(t);const s=a.\u0275\u0275nextContext();return a.\u0275\u0275resetView(s.onCreateItemButtonClick())}),a.\u0275\u0275elementStart(2,"crt-select-list-footer-item",20),a.\u0275\u0275element(3,"mat-icon",21),a.\u0275\u0275elementStart(4,"span",17),a.\u0275\u0275pipe(5,"translate"),a.\u0275\u0275text(6),a.\u0275\u0275pipe(7,"translate"),a.\u0275\u0275elementEnd()()(),a.\u0275\u0275elementContainerEnd()}o&2&&(a.\u0275\u0275advance(),a.\u0275\u0275property("role","none"),a.\u0275\u0275advance(),a.\u0275\u0275property("role","button"),a.\u0275\u0275advance(2),a.\u0275\u0275property("title",a.\u0275\u0275pipeBind1(5,4,"Dashboards.CreateNewDashboardButton")),a.\u0275\u0275advance(2),a.\u0275\u0275textInterpolate1(" ",a.\u0275\u0275pipeBind1(7,6,"Dashboards.CreateNewDashboardButton")," "))}function Ne(o,e){if(o&1){const t=a.\u0275\u0275getCurrentView();a.\u0275\u0275elementStart(0,"crt-button",24),a.\u0275\u0275pipe(1,"translate"),a.\u0275\u0275pipe(2,"translate"),a.\u0275\u0275listener("clicked",function(){a.\u0275\u0275restoreView(t);const s=a.\u0275\u0275nextContext(2);return a.\u0275\u0275resetView(s.onCreateItemButtonClick())}),a.\u0275\u0275elementEnd()}o&2&&(a.\u0275\u0275propertyInterpolate("title",a.\u0275\u0275pipeBind1(1,2,"Dashboards.CreateNewDashboardButton")),a.\u0275\u0275propertyInterpolate("caption",a.\u0275\u0275pipeBind1(2,4,"Dashboards.CreateNewDashboardButton")))}function Fe(o,e){if(o&1&&(a.\u0275\u0275elementContainerStart(0),a.\u0275\u0275elementStart(1,"crt-placeholder",22),a.\u0275\u0275pipe(2,"translate"),a.\u0275\u0275pipe(3,"translate"),a.\u0275\u0275template(4,Ne,3,6,"crt-button",23),a.\u0275\u0275elementEnd(),a.\u0275\u0275elementContainerEnd()),o&2){const t=a.\u0275\u0275nextContext();a.\u0275\u0275advance(),a.\u0275\u0275propertyInterpolate("title",a.\u0275\u0275pipeBind1(2,5,"Dashboards.NoData")),a.\u0275\u0275propertyInterpolate("subhead",a.\u0275\u0275pipeBind1(3,7,"Dashboards.NoData2")),a.\u0275\u0275property("hidden",t.loading)("image",t.placeholderImage),a.\u0275\u0275advance(3),a.\u0275\u0275property("ngIf",t.canManage)}}let c=class B extends De.K{set dashboards(e){e instanceof Ce.A&&(this._dashboards$Subscriptions$?.unsubscribe(),this._dashboards$Subscriptions$=new h.Subscription,this._dashboards$Subscriptions$.add(e.changed.subscribe(()=>{this._updateDashboards(e)}))),this._updateDashboards(e)}set filter(e){this._parameters={Filter:e},this._schemaOutletComponentInstance&&(this._schemaOutletComponentInstance.parameters=this._parameters)}constructor(e,t,n,s,d,l,m){super(e),this._schemaOutletComponent=t,this._changeDetectorRef=n,this._schemaChangeListenerService=s,this._userInfo=d,this._schemaOutletComponentHidden=!1,this.displayedDashboard="",this.dashboards$=new h.BehaviorSubject([]),this.filteredDashboards=[],this.placeholderImage={type:"animation",name:"dashboard",width:"100px",height:"100px"},this.selectedDashboardChange=new a.EventEmitter,this.dashboardsOutdated=new a.EventEmitter,this.createDashboard=new a.EventEmitter,this.headerToolbarItems=[],l.addSvgIconLiteral("placeholder",m.bypassSecurityTrustHtml(r(24381))),this._subscribeToSchemaNotifications()}_subscribeToSchemaNotifications(){var e=this;(0,h.merge)(this._schemaChangeListenerService.schemaChanged$,this._schemaChangeListenerService.schemaRemoved$,this._schemaChangeListenerService.rightsChanged$).pipe((0,p.filter)(t=>t.schemaType===G.L.ClientUnitSchema),(0,p.tap)(t=>{t.isNew&&!t.extendParent&&t.userId===this._userInfo.id&&(this._addedDashboard=t.name)}),(0,p.filter)(t=>!t.isNew||t.isNew&&t.extendParent),(0,p.tap)(t=>this.dashboardsOutdated.emit(t.name)),(0,p.takeUntil)(this.destroyed$)).subscribe(),this._schemaChangeListenerService.requireJsChanged$.pipe((0,p.filter)(t=>t.schemaType===G.L.ClientUnitSchema),(0,p.tap)(function(){var t=(0,u.A)(function*(n){n.name===e.selectedDashboard&&n.userId===e._userInfo.id&&(yield(0,h.firstValueFrom)(e._schemaOutletComponentInstance.reloadSchema()))});return function(n){return t.apply(this,arguments)}}()),(0,p.takeUntil)(this.destroyed$)).subscribe()}_setSchemaOutletSchemaName(e){e&&this._schemaOutletComponentInstance&&(this._schemaOutletComponentInstance.schemaName!==e||this._schemaOutletComponentHidden)?(this._schemaOutletComponentInstance.schemaName=e,this._schemaOutletComponentHidden=!1):!e&&this._schemaOutletComponentInstance&&(this._schemaOutletComponentInstance.hide(),this._schemaOutletComponentHidden=!0)}_updateDisplayedDashboard(){let e=this.selectedDashboard;const t=this.dashboards$.value.find(n=>n.Code===e);if(this._addedDashboard){this.onSelectedDashboardChanged(this._addedDashboard),this._addedDashboard=null;return}if((!e||!t)&&(e=this.dashboards$.value?.[0]?.Code,e)){this.onSelectedDashboardChanged(e);return}this.displayedDashboard=t?.Name||t?.Code,this._setSchemaOutletSchemaName(t?.Code)}_updateDashboards(e){Promise.all((e??[]).map(function(){var t=(0,u.A)(function*(n){return{Id:yield n.Id,Name:yield n.Name,Code:yield n.Code,UserLevelSchema:yield n.UserLevelSchema}});return function(n){return t.apply(this,arguments)}}())).then(t=>{this.dashboards$.next(t||[]),this._updateDisplayedDashboard(),this._changeDetectorRef.markForCheck()})}onSelectedDashboardChanged(e){e&&this.selectedDashboard!==e&&this.selectedDashboardChange.emit(e),this.listComponent.isOpen=!1}ngOnChanges(e){"selectedDashboard"in e&&this._updateDisplayedDashboard()}ngAfterViewInit(){const e=this.schemaContainerRef.createComponent(this._schemaOutletComponent);this._schemaOutletComponentInstance=e.instance,this.schemaContainerRef.insert(e.hostView),this._schemaOutletComponentInstance.parameters=this._parameters}onDashboardsFiltering(e){this.filteredDashboards=this.dashboards$.value.filter(t=>t.Name.toLowerCase().includes(e.toLowerCase()))}onSearchDashboardsPanelStateChange(){this.filteredDashboards=this.dashboards$.value}onCreateItemButtonClick(){this.listComponent.isOpen=!1,this.createDashboard.emit()}static{this.\u0275fac=function(t){return new(t||B)(a.\u0275\u0275directiveInject(a.Injector),a.\u0275\u0275directiveInject(ge.O),a.\u0275\u0275directiveInject(a.ChangeDetectorRef),a.\u0275\u0275directiveInject(J.l2),a.\u0275\u0275directiveInject(z.oq),a.\u0275\u0275directiveInject(f.MatIconRegistry),a.\u0275\u0275directiveInject(k.DomSanitizer))}}static{this.\u0275cmp=a.\u0275\u0275defineComponent({type:B,selectors:[["crt-dashboards"]],viewQuery:function(t,n){if(t&1&&(a.\u0275\u0275viewQuery(Oe,7,Q.j),a.\u0275\u0275viewQuery(Ee,7,a.ViewContainerRef)),t&2){let s;a.\u0275\u0275queryRefresh(s=a.\u0275\u0275loadQuery())&&(n.listComponent=s.first),a.\u0275\u0275queryRefresh(s=a.\u0275\u0275loadQuery())&&(n.schemaContainerRef=s.first)}},inputs:{dashboards:"dashboards",selectedDashboard:"selectedDashboard",filter:"filter",canManage:"canManage",headerToolbarItems:"headerToolbarItems"},outputs:{selectedDashboardChange:"selectedDashboardChange",dashboardsOutdated:"dashboardsOutdated",createDashboard:"createDashboard"},features:[a.\u0275\u0275InheritDefinitionFeature,a.\u0275\u0275NgOnChangesFeature],decls:15,vars:14,consts:[["overlayOrigin","cdkOverlayOrigin"],["list",""],["schemaContainer",""],[1,"crt-dashboard-header"],["cdkOverlayOrigin","","iconPosition","right-icon","displayType","text","size","extra-large","icon","menu-arrow",1,"crt-dashboards-selected-dashboard-button",3,"clicked","caption","title"],[1,"crt-dashboard-header-spacer"],["class","crt-dashboard-actions-menu-button",3,"iconPosition","icon","clickMode","menuItems","title","ariaLabel",4,"ngIf"],[3,"filtering","isOpenChange","trigger","overlayWidth"],["crtListboxViewport","","optionValueKeyPropertyName","Code",3,"selectedChange",4,"ngIf"],["crt-select-list-footer-items","",4,"ngIf"],[1,"content-container"],[4,"ngIf"],[1,"crt-dashboard-actions-menu-button",3,"iconPosition","icon","clickMode","menuItems","title","ariaLabel"],["crtListboxViewport","","optionValueKeyPropertyName","Code",3,"selectedChange"],[3,"crtListboxOption",4,"ngFor","ngForOf"],[3,"crtListboxOption"],["crtSelectListItemIcon","","svgIcon","bars-button-icon",1,"crt-dashboards-list-item-icon"],[1,"crt-dashboards-select-item-name",3,"title"],["crt-select-list-footer-items",""],["crtListboxViewport","",3,"selectedChange","role"],["crtListboxOption","",3,"role"],["crtSelectListItemIcon","","svgIcon","add-button-icon",1,"crt-dashboards-list-item-icon"],[1,"crt-dashboards-no-data-placeholder",3,"hidden","title","subhead","image"],["class","crt-dashboards-no-data-placeholder-add-button","iconSize","large","icon","add-button-icon","iconPosition","left-icon",3,"title","caption","clicked",4,"ngIf"],["iconSize","large","icon","add-button-icon","iconPosition","left-icon",1,"crt-dashboards-no-data-placeholder-add-button",3,"clicked","title","caption"]],template:function(t,n){if(t&1){const s=a.\u0275\u0275getCurrentView();a.\u0275\u0275elementStart(0,"div",3)(1,"crt-button",4,0),a.\u0275\u0275pipe(3,"translate"),a.\u0275\u0275listener("clicked",function(){a.\u0275\u0275restoreView(s);const l=a.\u0275\u0275reference(7);return a.\u0275\u0275resetView(l.isOpen=!0)}),a.\u0275\u0275elementEnd(),a.\u0275\u0275element(4,"div",5),a.\u0275\u0275template(5,xe,3,10,"crt-button",6),a.\u0275\u0275elementEnd(),a.\u0275\u0275elementStart(6,"crt-select-list",7,1),a.\u0275\u0275listener("filtering",function(l){return a.\u0275\u0275restoreView(s),a.\u0275\u0275resetView(n.onDashboardsFiltering(l))})("isOpenChange",function(){return a.\u0275\u0275restoreView(s),a.\u0275\u0275resetView(n.onSearchDashboardsPanelStateChange())}),a.\u0275\u0275template(8,Te,2,1,"div",8)(9,$e,8,8,"ng-container",9),a.\u0275\u0275elementEnd(),a.\u0275\u0275elementStart(10,"div",10),a.\u0275\u0275elementContainer(11,null,2),a.\u0275\u0275elementEnd(),a.\u0275\u0275template(13,Fe,5,9,"ng-container",11),a.\u0275\u0275pipe(14,"async")}if(t&2){const s=a.\u0275\u0275reference(2),d=a.\u0275\u0275reference(7);a.\u0275\u0275advance(),a.\u0275\u0275classProp("crt-dashboard-select-menu-opened",d.isOpen),a.\u0275\u0275property("caption",n.displayedDashboard||a.\u0275\u0275pipeBind1(3,10,"Dashboards.SelectDashboard"))("title",n.displayedDashboard),a.\u0275\u0275advance(4),a.\u0275\u0275property("ngIf",n.selectedDashboard&&(n.headerToolbarItems==null?null:n.headerToolbarItems.length)),a.\u0275\u0275advance(),a.\u0275\u0275property("trigger",s)("overlayWidth",400),a.\u0275\u0275advance(2),a.\u0275\u0275property("ngIf",d.isOpen),a.\u0275\u0275advance(),a.\u0275\u0275property("ngIf",n.canManage),a.\u0275\u0275advance(4),a.\u0275\u0275property("ngIf",!a.\u0275\u0275pipeBind1(14,12,n.dashboards$).length)}},dependencies:[_.NgForOf,_.NgIf,f.MatIcon,E.CdkOverlayOrigin,ve.B,Q.j,fe.Z,ye.O,_e.$,Se.y,Ie.X,Me.Q,_.AsyncPipe,b.TranslatePipe],styles:["body[_ngcontent-%COMP%]{--focus-outline-outer-color: var(--crt-palette-secondary-500);--focus-outline-inner-color: white}[_nghost-%COMP%]{display:table;table-layout:fixed;position:relative;height:100%;width:100%}[_nghost-%COMP%]   .crt-dashboards-no-data-placeholder[_ngcontent-%COMP%]{position:absolute;top:max(25%,44px);left:50%;transform:translate(-50%);overflow-y:hidden}[_nghost-%COMP%]   .crt-dashboards-no-data-placeholder-add-button[_ngcontent-%COMP%]{margin-top:16px}[_nghost-%COMP%]   .crt-dashboard-header[_ngcontent-%COMP%]{display:flex;align-items:center;position:relative;width:100%}[_nghost-%COMP%]   .crt-dashboards-selected-dashboard-button[_ngcontent-%COMP%]{max-width:400px}[_nghost-%COMP%]   .crt-dashboard-header-spacer[_ngcontent-%COMP%]{flex:1}[_nghost-%COMP%]   .crt-dashboard-actions-menu-button[_ngcontent-%COMP%]{flex-shrink:0}.crt-dashboards-list-item-icon[_ngcontent-%COMP%]{min-width:16px;min-height:16px}.content-container[_ngcontent-%COMP%]{margin-top:5px}.crt-dashboards-select-item-name[_ngcontent-%COMP%]{white-space:nowrap;text-overflow:ellipsis;overflow:hidden;padding-inline-start:4px}"],changeDetection:0})}};(0,i.__decorate)([(0,y.k)(),(0,i.__metadata)("design:type",Object),(0,i.__metadata)("design:paramtypes",[Object])],c.prototype,"dashboards",null),(0,i.__decorate)([(0,y.k)(),(0,i.__metadata)("design:type",String)],c.prototype,"selectedDashboard",void 0),(0,i.__decorate)([(0,y.k)({reuseStrategy:{resetValue:!0}}),(0,i.__metadata)("design:type",Object),(0,i.__metadata)("design:paramtypes",[Object])],c.prototype,"filter",null),(0,i.__decorate)([(0,T.j)(),(0,i.__metadata)("design:type",Object)],c.prototype,"selectedDashboardChange",void 0),(0,i.__decorate)([(0,T.j)(),(0,i.__metadata)("design:type",Object)],c.prototype,"dashboardsOutdated",void 0),(0,i.__decorate)([(0,T.j)(),(0,i.__metadata)("design:type",Object)],c.prototype,"createDashboard",void 0),(0,i.__decorate)([(0,y.k)(),(0,i.__metadata)("design:type",Boolean)],c.prototype,"canManage",void 0),(0,i.__decorate)([(0,y.k)(),(0,i.__metadata)("design:type",Array)],c.prototype,"headerToolbarItems",void 0),c=(0,i.__decorate)([(0,he.v)({type:"crt.Dashboards",reuseStrategy:me.B.Reuse,compatibleAPIs:{[pe.I.Filtration]:{enable:!0,aggregation:!0}}}),(0,ue.f)({toolbarConfig:{hint:"Components.Dashboards.Hint",position:300,requiredFeatures:{FreedomUIDashboardsEnabled:!0},icon:r(95141)},propertiesPanelComponentTypeName:"crt.DashboardsPropertiesPanel",typeCaption:"Components.Dashboards.Caption",viewElementGroupType:be.J.Components,designViewItemCommands:{copy:"crt.CopyDataGridItemCommand",delete:"crt.RemoveDashboardsCommand"}}),(0,i.__metadata)("design:paramtypes",[a.Injector,Object,a.ChangeDetectorRef,J.l2,z.oq,f.MatIconRegistry,k.DomSanitizer])],c);var Ae=r(85613),Re=r(55642),K=r(59275),X=r(28627),Y=r(31149),q=r(24091),$=r(8936),ee=r(44267),te=r(96176),Ve=r(84600),He=r(12841),x=r(81517),g=r(41287),D=r(844),N=r(40968),S=r(59969),F=r(90983);function A(o,e){if(!e||Object.keys(e).length===0)return o;const t=o.includes("?")?"&":"?",n=Object.entries(e).map(([d,l])=>`${encodeURIComponent(d)}=${encodeURIComponent(l)}`).join("&");let s=`${o}${t}${n}`;return s=s.replace("?&","?"),s}class Ke extends x.S{constructor(){super(...arguments),this.type="crt.CreateDashboardRequest"}}let R=class extends g.l{constructor(e){super(),this._window=e}_getOptionalParameters(e){const t={DashboardsClientUnitSchemaUId:e.clientUnitSchemaUId,DashboardsElementName:e.elementName};return e.entitySchemaName&&(t.DashboardsEntitySchemaName=e.entitySchemaName),t}_openUrl(e){const t=(0,F.cI)()+"ClientApp/#/DashboardPageDesigner?",n=A(t,e);this._window.open(n).focus()}_openDashboardDesigner(e){const t=this._getOptionalParameters(e),n={optional:JSON.stringify(t),userLevelSchema:"true"};this._openUrl(n)}handle(e){return this._openDashboardDesigner(e),this.next?.handle(e)}};R=(0,i.__decorate)([(0,D.l)({type:"crt.CreateDashboardHandler",requestType:"crt.CreateDashboardRequest"}),(0,i.__param)(0,(0,N.j)(S.ZP)),(0,i.__metadata)("design:paramtypes",[Window])],R);var I=r(72113),ae=r(31774),Le=r(18175);class Xe extends x.S{constructor(){super(...arguments),this.type="crt.CopyDashboardRequest"}}let V=class extends g.l{constructor(e,t,n){super(),this._messageDialogProvider=e,this._translateService=t,this._userLevelSchemaService=n,this._deleteDialogPrefix="Dashboards.DialogWindow.DeleteDashboard",this._confirmMessage=this._translateService.instant(`${this._deleteDialogPrefix}.ConfirmationMessage`),this._failDeleteMessage=this._translateService.instant(`${this._deleteDialogPrefix}.FailMessage`)}_deleteDashboard(e){return this._userLevelSchemaService.deleteUserLevelSchema(e).catch(t=>t.error?.errorInfo?(0,h.lastValueFrom)(this._openInfoDialog(t.error.errorInfo.message)):(0,h.lastValueFrom)(this._openInfoDialog(t?.message)))}_openInfoDialog(e){return this._messageDialogProvider.open({data:{message:e,actions:[I.N.OK]}})}handle(e){var t=this;return(0,u.A)(function*(){if(!e.UserLevelSchema||e.ExtendParent)return(0,h.lastValueFrom)(t._openInfoDialog(t._failDeleteMessage));(yield(0,h.lastValueFrom)(t._messageDialogProvider.open({data:{message:t._confirmMessage,actions:[I.N.YES,I.N.NO]}})))===I.N.YES.key&&(yield t._deleteDashboard(e.primaryColumnValue),yield t.next?.handle(e))})()}};V=(0,i.__decorate)([(0,D.l)({type:"crt.DeleteDashboardHandler",requestType:"crt.DeleteDashboardRequest"}),(0,i.__metadata)("design:paramtypes",[ae.r,b.TranslateService,Le.w])],V);var ne=r(50485);class Ye extends x.S{constructor(){super(...arguments),this.type="crt.EditDashboardRequest"}}let H=class extends g.l{constructor(e,t,n,s){super(),this._window=e,this._rightsService=t,this._translateService=n,this._messageDialogProvider=s}_openUrl(e,t){const n=(0,F.cI)()+`ClientApp/#/InterfaceDesigner/${e}?`,s=A(n,t);this._window.open(s).focus()}_openDashboardDesigner(e){const t={userLevelSchema:"true"};this._openUrl(e.schemaName,t)}handle(e){var t=this;return(0,u.A)(function*(){return(yield(0,h.lastValueFrom)(t._rightsService.getCanEdit({isNew:!1,schemaName:e.entitySchemaName,primaryColumnValue:e.primaryColumnValue}))).result?(t._openDashboardDesigner(e),t.next?.handle(e)):t._messageDialogProvider.open({data:{message:t._translateService.instant("Dashboards.AccessDenied"),actions:[I.N.OK]}})})()}};H=(0,i.__decorate)([(0,D.l)({type:"crt.EditDashboardHandler",requestType:"crt.EditDashboardRequest"}),(0,i.__param)(0,(0,N.j)(S.ZP)),(0,i.__metadata)("design:paramtypes",[Window,ne.f,b.TranslateService,ae.r])],H);class qe extends x.S{constructor(){super(...arguments),this.type="crt.CopyDashboardRequest"}}let L=class extends g.l{constructor(e){super(),this._window=e}_openUrl(e,t){const n=(0,F.cI)()+`ClientApp/#/InterfaceDesigner/copy/${e}`,s=A(n,t);this._window.open(s).focus()}_openDashboardDesigner(e){const t={userLevelSchema:"true"};this._openUrl(e.schemaName,t)}handle(e){return this._openDashboardDesigner(e),this.next?.handle(e)}};L=(0,i.__decorate)([(0,D.l)({type:"crt.CopyDashboardHandler",requestType:"crt.CopyDashboardRequest"}),(0,i.__param)(0,(0,N.j)(S.ZP)),(0,i.__metadata)("design:paramtypes",[Window])],L);let j=class extends g.l{handle(e){var t=this;return(0,u.A)(function*(){e.$context.recordRightsWereChangedSubscription?.unsubscribe(),yield t.next?.handle(e)})()}};j=(0,i.__decorate)([(0,D.l)({requestType:"crt.HandleViewModelPauseRequest",type:"crt.DashboardPageViewModelPauseHandler",scopes:["BaseDashboardTemplate"]})],j);var je=r(82863),we=r(5240);let w=class extends g.l{constructor(e,t){super(),this._messageChannelService=e,this._broadcastChannelFactory=t}_subscribeOnRecordRightsWereChanged(e){const t=e.$context,n=this._broadcastChannelFactory.createInstance("record-rights-were-changed");t.recordRightsWereChangedSubscription=n.messages$.pipe((0,h.filter)(s=>s?.record?.entitySchemaName==="SysSchemaAdminUnit"),(0,h.map)(s=>s?.record?.primaryColumnValue),(0,h.switchMap)(s=>this._messageChannelService.sendMessage("SchemaManagerItemRightsChangedNotifier",{UId:s,Name:t._scopeName,ManagerName:"ClientUnitSchemaManager"},je.G.BROADCAST))).subscribe()}handle(e){var t=this;return(0,u.A)(function*(){t._subscribeOnRecordRightsWereChanged(e),yield t.next?.handle(e)})()}};w=(0,i.__decorate)([(0,D.l)({requestType:"crt.HandleViewModelResumeRequest",type:"crt.DashboardPageViewModelResumeHandler",scopes:["BaseDashboardTemplate"]}),(0,i.__metadata)("design:paramtypes",[we.A,S.Vx])],w);var C=r(74604),Ue=r(82517),Be=r(41108),U=r(58504),Ze=r(56267),We=r(86710),re=r(74368),v=r(28399);const ke="crt.Dashboards",se="_ListData";function oe(o){return o?.name?.replace(/[^\w]/g,"")||ie()}function ie(){return S.$A.generateUnique("Dashboards")}function de(o){return`${oe(o)}_SelectedDashboard`}function le(o){return`${oe(o)}${se}`}function Qe(o){return`${o}${se}`}var Ge=r(71281);class M{constructor(e,t,n,s){this._profileAttributeService=e,this._rightsService=t,this._licenseOperationValues=n,this._translationService=s}_getDashboardsViewConfigs(e){return re.u.getViewConfigInfoByProperty("type",ke,e).map(t=>t?.viewConfig).filter(Boolean)}_setSelectedDashboardAttribute(e,t){if(!(0,v.isEmpty)(t.selectedDashboard))return;const n=de(t);this._profileAttributeService.createOrUpdateAttributeWithChangeRequest(e,t,"selectedDashboard",n)}_setSubscriptionOnDashboardsOutdated(e,t){(0,v.isEmpty)(e.dashboardsOutdated)&&(e.dashboardsOutdated={request:"crt.LoadDataRequest",params:{dataSourceName:`${t}_DS`,config:{loadType:Ue.I.Reload}}})}_setDashboardsAttribute(e,t,n){t.dashboards="$"+n;let s=e.viewModelConfig.attributes;s||(s=e.viewModelConfig.attributes={}),s[n]={isCollection:!0,viewModelConfig:{attributes:{Id:{modelConfig:{path:`${n}_DS.Id`}},UId:{modelConfig:{path:`${n}_DS.UId`}},Name:{modelConfig:{path:`${n}_DS.Name`}},Code:{modelConfig:{path:`${n}_DS.Code`}},UserLevelSchema:{modelConfig:{path:`${n}_DS.UserLevelSchema`}},ExtendParent:{modelConfig:{path:`${n}_DS.ExtendParent`}}}},modelConfig:{path:`${n}_DS`,sortingConfig:{default:[{direction:"asc",columnName:"Name"}]},filterAttributes:[{name:`${n}_Filter`,loadOnChange:!0}]},embeddedModel:{config:{type:"crt.EntityDataSource",config:{entitySchemaName:"SysFreedomDashboard",adminUnitRoleSources:[C.v[C.v.Self],C.v[C.v.ExplicitEntry],C.v[C.v.Delegated]]}},name:`${n}_DS`}}}_setDashboardsFilterAttribute(e,t,n){let s=e.viewModelConfig.attributes;s||(s=e.viewModelConfig.attributes={});const d=new Be.X;d.addSchemaColumnFilterWithParameter(U.H.Equal,"DashboardsClientUnitSchemaUId",e.uId),d.addSchemaColumnFilterWithParameter(U.H.Equal,"DashboardsElementName",t.name),d.addSchemaColumnFilterWithParameter(U.H.Equal,"UserLevelSchema",!0),s[`${n}_Filter`]={value:d.toJson()}}_pushFilterInRootFilter(e,t,n){e.viewModelConfig.attributes[t.name+"_Filter"].from.push(n)}_addFilterByDependencyAttribute(e,t,n,s){const d=`${t.name}_Dependency_${s}`;e.viewModelConfig.attributes[d]={value:n};const l=`${t.name}_InternalFilterByDependency_${s}`,m=n.relationPath.split(".")[0],Je=t._designOptions.entitySchemaName;e.viewModelConfig.attributes[l]={from:"crt.HandleBeforeModelLoadRequest",filter:`crt.ToObjectProp : 'model' | crt.ToObjectProp : 'name' | crt.IsEqual : '${m}'`,converter:`crt.CreateFilterByDependency: $${d} : '${Je}'`};const ce=`${t.name}_FilterByDependency_${s}`,ze=re.u.findAllAttributesByDataSourceAttributePath(e,m)[0];e.viewModelConfig.attributes[ce]={from:(0,v.compact)([l,ze]),converter:"crt.ToObjectProp: 0"},this._pushFilterInRootFilter(e,t,ce)}_addFiltersByDependenciesAttribute(e,t){t._designOptions.dependencies?.forEach((n,s)=>{this._addFilterByDependencyAttribute(e,t,n,s)})}_addPreconfiguredFilterAttribute(e,t){t._designOptions.filters?.forEach(n=>{this._pushFilterInRootFilter(e,t,n.attribute)})}_addFilterAttribute(e,t){const n=t._designOptions?.entitySchemaName;if(!n)return;const s=t.name+"_Filter";e.viewModelConfig.attributes[s]={from:[],converter:`crt.Compact | crt.ToFilterGroup: ${Ze.H.And} : '${n}'`},this._addFiltersByDependenciesAttribute(e,t),this._addPreconfiguredFilterAttribute(e,t),t.filter="$"+s}_bindCreateDashboardRequest(e,t){t.createDashboard={request:"crt.CreateDashboardRequest",params:{entitySchemaName:t._designOptions?.entitySchemaName,clientUnitSchemaUId:e.uId,elementName:t.name}}}_initCanManageAnalytics(){return this._licenseOperationValues.CanManageAnalytics?(0,h.firstValueFrom)(this._rightsService.getCanExecuteOperation("CanManageAnalytics")):Promise.resolve(!1)}_getDefaultHeaderToolbarItems(e,t,n){const s=[];if(t){const d={schemaName:e.selectedDashboard,entitySchemaName:"SysSchemaAdminUnit",primaryColumnValue:`${e.selectedDashboard} | crt.FindInCollection:'${n}':'Code' | crt.ToObjectProp:'UId'`};s.push({type:"crt.MenuItem",caption:this._translationService.instant("Dashboards.ActionsToolbar.Edit"),icon:"edit-icon",visible:`${e.selectedDashboard} | crt.ToBoolean`,clicked:{request:"crt.EditDashboardRequest",params:d}});const l={schemaName:e.selectedDashboard};s.push({type:"crt.MenuItem",caption:this._translationService.instant("Dashboards.ActionsToolbar.Copy"),icon:"copy-icon",visible:`${e.selectedDashboard} | crt.ToBoolean`,clicked:{request:"crt.CopyDashboardRequest",params:l}});const m={schemaName:e.selectedDashboard,entitySchemaName:"SysSchemaAdminUnit",primaryColumnValue:`${e.selectedDashboard} | crt.FindInCollection:'${n}':'Code' | crt.ToObjectProp:'UId'`,UserLevelSchema:`${e.selectedDashboard} | crt.FindInCollection:'${n}':'Code' | crt.ToObjectProp:'UserLevelSchema'`,ExtendParent:`${e.selectedDashboard} | crt.FindInCollection:'${n}':'Code' | crt.ToObjectProp:'ExtendParent'`};s.push({type:"crt.MenuItem",caption:this._translationService.instant("Dashboards.ActionsToolbar.Delete"),icon:"delete-button-icon",visible:`${e.selectedDashboard} | crt.ToBoolean`,clicked:{request:"crt.DeleteDashboardRequest",params:m}}),s.push({type:"crt.MenuItem",caption:this._translationService.instant("Dashboards.ActionsToolbar.Rights"),icon:"lock-button-icon",visible:`${e.selectedDashboard} | crt.ToBoolean`,clicked:{request:"crt.LoadRightsModuleRequest",params:{payload:{primaryColumnValue:`${e.selectedDashboard} | crt.FindInCollection:'${n}':'Code' | crt.ToObjectProp:'UId'`,primaryDisplayColumnValue:`${e.selectedDashboard} | crt.FindInCollection:'${n}':'Code' | crt.ToObjectProp:'Name'`,entitySchemaName:"SysSchemaAdminUnit"}}}})}return s}_setHeaderToolbarItems(e,t,n){(0,v.isEmpty)(e.headerToolbarItems)&&(e.headerToolbarItems=this._getDefaultHeaderToolbarItems(e,t,n))}_setCanManage(e,t){(0,v.isEmpty)(e.canManage)&&(e.canManage=t)}crtOnMetaDataInit(e){var t=this;return(0,u.A)(function*(){const n=e,s=t._getDashboardsViewConfigs(n.viewConfig);if(s?.length){const d=yield t._initCanManageAnalytics();for(const l of s)if(t._setSelectedDashboardAttribute(n,l),t._setCanManage(l,d),t._addFilterAttribute(n,l),(0,v.isEmpty)(l.dashboards)){const m=le(l);t._setHeaderToolbarItems(l,d,m),t._setDashboardsAttribute(n,l,m),t._setDashboardsFilterAttribute(n,l,m),t._setSubscriptionOnDashboardsOutdated(l,m),t._bindCreateDashboardRequest(n,l)}}return Promise.resolve(e)})()}static{this.\u0275fac=function(t){return new(t||M)(a.\u0275\u0275inject(Ge.H),a.\u0275\u0275inject(ne.f),a.\u0275\u0275inject(We.W),a.\u0275\u0275inject(b.TranslateService))}}static{this.\u0275prov=a.\u0275\u0275defineInjectable({token:M,factory:M.\u0275fac})}}let P=class Z{static{this.\u0275fac=function(t){return new(t||Z)}}static{this.\u0275mod=a.\u0275\u0275defineNgModule({type:Z})}static{this.\u0275inj=a.\u0275\u0275defineInjector({providers:[{provide:He.m,useClass:M,multi:!0}],imports:[_.CommonModule,b.TranslateModule,te.c,f.MatIconModule,E.OverlayModule,Y.q,q.S,$.S,K.V,X.f,ee.D]})}};P=(0,i.__decorate)([(0,Re.g)({viewElements:[c],includes:[$.S],requestHandlers:[R,V,H,L,j,w]})],P),function(){(typeof ngJitMode>"u"||ngJitMode)&&a.\u0275\u0275setNgModuleScope(P,{declarations:[c],imports:[_.CommonModule,b.TranslateModule,te.c,f.MatIconModule,Ae.CdkOption,E.CdkOverlayOrigin,E.OverlayModule,Y.q,q.S,$.S,K.V,X.f,Ve.N,ee.D],exports:[c]})}()},95141:O=>{O.exports=`<svg width="72" height="64" viewBox="0 0 72 64" fill="none" xmlns="http://www.w3.org/2000/svg">
<rect x="8.5" y="12.5" width="55" height="39" rx="2.5" fill="white" stroke="#70ACEE"/>
<path d="M44 34H39V44H44V34Z" fill="#20C964"/>
<path d="M51 20H46V44H51V20Z" fill="#0091EA"/>
<path d="M58 25H53V44H58V25Z" fill="#8E4AC7"/>
<path fill-rule="evenodd" clip-rule="evenodd" d="M28.6581 20.9409C30.631 21.7719 32.3457 23.1155 33.6243 24.8324L30.4166 27.2214C28.9581 25.2661 26.6269 24 24 24C23.6393 24 23.2842 24.0239 22.9361 24.0701L22.4043 20.1066C24.526 19.8219 26.6853 20.11 28.6581 20.9409Z" fill="#32C966"/>
<path fill-rule="evenodd" clip-rule="evenodd" d="M17.1529 22.1453C18.7239 21.0537 20.5331 20.3536 22.4297 20.1033L22.953 24.0679C19.0295 24.5808 16 27.9366 16 32C16 33.2885 16.3046 34.5058 16.8458 35.5839L13.2709 37.3747C12.4141 35.6643 11.9786 33.7739 12.0008 31.861C12.023 29.9482 12.5021 28.0683 13.3984 26.3782C14.2946 24.6882 15.5819 23.2368 17.1529 22.1453Z" fill="#0091EA"/>
<path fill-rule="evenodd" clip-rule="evenodd" d="M23.9999 40C28.4182 40 31.9999 36.4183 31.9999 32C31.9999 30.0762 31.3209 28.311 30.1894 26.931L33.2834 24.3974C34.7871 26.2337 35.7124 28.4747 35.9425 30.8369C36.1725 33.1991 35.6969 35.5764 34.5758 37.6683C33.4547 39.7602 31.7385 41.4727 29.6441 42.5892C27.557 43.7019 25.1878 44.1729 22.8342 43.9433L22.8097 43.9409C20.7917 43.7399 18.8573 43.0307 17.1875 41.8794C15.5108 40.7235 14.156 39.1598 13.2505 37.3357L16.8325 35.5576C18.142 38.1906 20.8597 40 23.9999 40Z" fill="#8E4AC7"/>
</svg>
`},24381:O=>{O.exports=`<svg width="100" height="101" viewBox="0 0 100 101" fill="none" xmlns="http://www.w3.org/2000/svg">
	<path d="M85.5 25.75C86.3284 25.75 87 25.0784 87 24.25C87 23.4216 86.3284 22.75 85.5 22.75C84.6716 22.75 84 23.4216 84 24.25C84 25.0784 84.6716 25.75 85.5 25.75Z" fill="#0D2E4E" stroke="#0D2E4E" stroke-width="2"/>
	<path d="M63.5 42.75C64.3284 42.75 65 42.0784 65 41.25C65 40.4216 64.3284 39.75 63.5 39.75C62.6716 39.75 62 40.4216 62 41.25C62 42.0784 62.6716 42.75 63.5 42.75Z" fill="#0D2E4E" stroke="#0D2E4E" stroke-width="2"/>
	<path d="M38.5 39.75C39.3284 39.75 40 39.0784 40 38.25C40 37.4216 39.3284 36.75 38.5 36.75C37.6716 36.75 37 37.4216 37 38.25C37 39.0784 37.6716 39.75 38.5 39.75Z" fill="#0D2E4E" stroke="#0D2E4E" stroke-width="2"/>
	<path d="M12.5 47H88.5" stroke="#0D2E4E" stroke-width="2"/>
	<path d="M25.537 46.8161L38.5 38.2491L63.5 41.2491L85.813 24.2871" stroke="#0D2E4E"/>
	<path d="M39 47H31V59H39V47Z" stroke="#0D2E4E" stroke-width="2"/>
	<path d="M39 48.5H31V52.5H39V48.5Z" fill="#0D2E4E" stroke="#0D2E4E" stroke-width="2"/>
	<path d="M54 48.5H46V59.5H54V48.5Z" fill="#0D2E4E" stroke="#0D2E4E" stroke-width="2"/>
	<path d="M69 48.5H61V52.5H69V48.5Z" fill="#0D2E4E" stroke="#0D2E4E" stroke-width="2"/>
	<path d="M54 47H46V79H54V47Z" stroke="#0D2E4E" stroke-width="2"/>
	<path d="M69 47H61V73H69V47Z" stroke="#0D2E4E" stroke-width="2"/>
	<path d="M69 16.5V7.5H61V16.5" stroke="#0D2E4E" stroke-width="2"/>
	<path d="M53 16.5V12.5H45V16.5" stroke="#0D2E4E" stroke-width="2"/>
	<path d="M74.778 28H26.199L22.999 20H77.178L74.778 28Z" stroke="#0D2E4E" stroke-width="2"/>
	<path d="M31.299 41.129L27.967 33H70.867" stroke="#0D2E4E" stroke-width="2"/>
</svg>
`}}]);
