(self.webpackChunkapp_studio_enterprise_schema_view=self.webpackChunkapp_studio_enterprise_schema_view||[]).push([[1188],{41188:($,Ae,d)=>{d.r(Ae),d.d(Ae,{CrtFolderTreeActionsComponent:()=>N,CrtFolderTreeComponent:()=>p,CrtFolderTreeModule:()=>q,CrtFolderTreeSelectFolderComponent:()=>V,CrtSetupFolderTreeFilterComponent:()=>K,DEFAULT_FOLDER_TREE_FAVORITE_SCHEMA_NAME:()=>m.J8,DEFAULT_FOLDER_TREE_SOURCE_SCHEMA_NAME:()=>m.uE,DYNAMIC_FOLDER_TYPE_ID:()=>m.Ss,EMPTY_FOLDER_FILTER:()=>at,FOCUSED_NODE_ELEMENT_CLASS:()=>Qt,FolderManagerService:()=>b,FolderTreeAccessRightsAuditor:()=>fr.Q,FolderTreeAdminUnitRoleSourcesService:()=>ht.R,FolderTreeDataProvider:()=>G,FolderTreeFilterOptionsBackwardCompatibilityModifier:()=>pt.j,FolderTreeIdResolver:()=>_t.W,FolderTreeModelRequestHandlerService:()=>T,FolderTreeNodeSortingOrder:()=>R,FolderTreeUseStaticFolderService:()=>Z,FolderTreeUserProfileService:()=>x,OLD_FOLDER_TREE_FAVORITE_SCHEMA_NAME:()=>m.hc,SECURED_DEFAULT_FOLDER_TREE_FAVORITE_SCHEMA_NAME:()=>m.HT,SECURED_OLD_FOLDER_TREE_FAVORITE_SCHEMA_NAME:()=>m.HD,STATIC_FOLDER_COLUMN_NAME:()=>m.lb,STATIC_FOLDER_TYPE_ID:()=>m.Xi,SelectFolderDialogCloseState:()=>H,SetupFolderTreeFilterDialogCloseState:()=>B,StaticFolderService:()=>E,TreeBuilderService:()=>D,VIRTUAL_FAVORITE_ROOT_NODE_ID:()=>m.NQ,VIRTUAL_ROOT_NODE_ID:()=>m.EM,createStaticFolderFilter:()=>f.po,getActiveFolderIdAttributeName:()=>f.tt,getFolderFilterColumnName:()=>f.ic,getOldFolderEntitySchemaName:()=>f.dn,getOldInFolderEntitySchemaName:()=>f.sh,getOldInFolderReferenceColumnName:()=>f.d8,isOldSourceSchema:()=>f.SK,isStaticFolder:()=>f.$K});var m=d(7477),a=d(5960),A=d(40297),W=d(52989),Ee=d(23023),ft=d(55642),P=d(79772),Ve=d(5476),Re=d(79877),De=d(28627),ke=d(50663),$e=d(11475),je=d(76260),He=d(31149),Be=d(43981),Ke=d(44267),Le=d(57274),Ue=d(82294),Ze=d(28635),Ge=d(80953),ze=d(12841),u=d(73308),r=d(59131),gt=d(56711),j=d(6530),F=d(77592),vt=d(66823),C=d(34760),Qe=d(1034),Je=d(96677),We=d(75456),Xe=d(10098),Ye=d(7471),qe=d(50485),z=d(65001),Ft=d(31774),et=d(19344),tt=d(91244),rt=d(68712),Ct=d(8525),ie=d(73723),g=d(28399),s=d(62278),S=d(89422),O=d(29957),X=d(76923),It=d(7622),H;(function(l){l.Cancelled="cancelled",l.Selected="selected"})(H||(H={}));class V extends It.c{constructor(e,t,n){super(t,e),this._dialogRef=t,this._changeDetectorRef=n,this.selectFolderParameters=e}_getFolderId(e){return e.isFavorite?e.folderTreeId:e.id}onSelectButtonClick(){const e={status:H.Selected,selectedFolderId:this.selectedFolderId};this._dialogRef.close(e)}onCloseButtonClick(){const e={status:H.Cancelled};this._dialogRef.close(e)}onFolderSelected(e){const t=this._getFolderId(e);this.selectedFolderId=t||m.EM,this._changeDetectorRef.detectChanges()}static{this.\u0275fac=function(t){return new(t||V)(r.\u0275\u0275directiveInject(X.MAT_LEGACY_DIALOG_DATA),r.\u0275\u0275directiveInject(X.MatLegacyDialogRef),r.\u0275\u0275directiveInject(r.ChangeDetectorRef))}}static{this.\u0275cmp=r.\u0275\u0275defineComponent({type:V,selectors:[["crt-folder-tree-select-folder"]],features:[r.\u0275\u0275InheritDefinitionFeature],decls:12,vars:15,consts:[[3,"title","displayCloseButton"],["content",""],[1,"folder-tree-select-folder-content"],[3,"activeFolderChanged","items","favoriteItems","rootSchemaName","readonly"],["actions",""],[3,"clicked"],["color","primary",3,"clicked","disabled"]],template:function(t,n){t&1&&(r.\u0275\u0275elementStart(0,"crt-dialog",0),r.\u0275\u0275pipe(1,"translate"),r.\u0275\u0275elementContainerStart(2,1),r.\u0275\u0275elementStart(3,"div",2)(4,"crt-folder-tree",3),r.\u0275\u0275listener("activeFolderChanged",function(i){return n.onFolderSelected(i)}),r.\u0275\u0275elementEnd()(),r.\u0275\u0275elementContainerEnd(),r.\u0275\u0275elementContainerStart(5,4),r.\u0275\u0275elementStart(6,"crt-button",5),r.\u0275\u0275listener("clicked",function(){return n.onCloseButtonClick()}),r.\u0275\u0275text(7),r.\u0275\u0275pipe(8,"translate"),r.\u0275\u0275elementEnd(),r.\u0275\u0275elementStart(9,"crt-button",6),r.\u0275\u0275listener("clicked",function(){return n.onSelectButtonClick()}),r.\u0275\u0275text(10),r.\u0275\u0275pipe(11,"translate"),r.\u0275\u0275elementEnd(),r.\u0275\u0275elementContainerEnd(),r.\u0275\u0275elementEnd()),t&2&&(r.\u0275\u0275property("title",r.\u0275\u0275pipeBind1(1,9,"FolderTreeSelectFolder.SelectFolderCaption"))("displayCloseButton",!0),r.\u0275\u0275advance(4),r.\u0275\u0275property("items",n.selectFolderParameters.folderTreeItems)("favoriteItems",n.selectFolderParameters.favoriteTreeItems)("rootSchemaName",n.selectFolderParameters.rootSchemaName)("readonly",!0),r.\u0275\u0275advance(3),r.\u0275\u0275textInterpolate1(" ",r.\u0275\u0275pipeBind1(8,11,"FolderTreeSelectFolder.CancelButton")," "),r.\u0275\u0275advance(2),r.\u0275\u0275property("disabled",!n.selectedFolderId),r.\u0275\u0275advance(),r.\u0275\u0275textInterpolate1(" ",r.\u0275\u0275pipeBind1(11,13,"FolderTreeSelectFolder.SelectFolderButtonCaption")," "))},styles:["[_nghost-%COMP%]{width:100%;height:100%}crt-dialog[_ngcontent-%COMP%]{height:inherit;width:inherit}crt-dialog[_ngcontent-%COMP%]     [mat-dialog-actions].crt-dialog-actions{margin-top:auto}crt-dialog[_ngcontent-%COMP%]   .folder-tree-select-folder-content[_ngcontent-%COMP%]{height:100%;width:100%}crt-dialog[_ngcontent-%COMP%]   .folder-tree-select-folder-content[_ngcontent-%COMP%]     crt-folder-tree .folder-tree-container .folder-tree-header crt-search-filter{max-width:none}crt-dialog[_ngcontent-%COMP%]   .folder-tree-select-folder-content[_ngcontent-%COMP%]     crt-folder-tree .folder-tree-container .folder-tree-header button.close-tree-btn{display:none}"]})}}var yt=d(86561),nt=d(62115),ot=d(4872),Mt=d(83181);function Nt(l,e){l&1&&r.\u0275\u0275element(0,"ts-mask",9)}var B;(function(l){l.Cancelled="cancelled",l.Saved="saved"})(B||(B={}));class K{constructor(e,t,n,o){this._dialogRef=t,this._extResourceFrameWindowMessenger=n,this._changeDetectorRef=o,this._subscription=new s.Subscription,this.loading=!0,this.filtersModalOpened=!1,this.filterParams=e}ngOnInit(){this._subscription.add(this._extResourceFrameWindowMessenger.designerLoaded$.subscribe(()=>{this.loading=!1,this._changeDetectorRef.detectChanges()})),this._subscription.add(this._extResourceFrameWindowMessenger.modalOpening$.subscribe(()=>{this.filtersModalOpened=!0,this._changeDetectorRef.detectChanges()})),this._subscription.add(this._extResourceFrameWindowMessenger.modalClosing$.subscribe(()=>{this.filtersModalOpened=!1,this._changeDetectorRef.detectChanges()}))}getClasses(){return{"folder-tree-filters-panel":!0,"folder-tree-filters-panel-cover":this.filtersModalOpened}}onFiltersParamsChanged(e){this.filterParams=e}onSaveButtonClick(){const e={status:B.Saved,filterParams:this.filterParams};this._dialogRef.close(e)}onCloseButtonClick(){const e={status:B.Cancelled};this._dialogRef.close(e)}ngOnDestroy(){this._subscription.unsubscribe()}static{this.\u0275fac=function(t){return new(t||K)(r.\u0275\u0275directiveInject(X.MAT_LEGACY_DIALOG_DATA),r.\u0275\u0275directiveInject(X.MatLegacyDialogRef),r.\u0275\u0275directiveInject(yt.b),r.\u0275\u0275directiveInject(r.ChangeDetectorRef))}}static{this.\u0275cmp=r.\u0275\u0275defineComponent({type:K,selectors:[["crt-setup-filter"]],decls:15,vars:14,consts:[[3,"ngClass"],[1,"folder-tree-filters-panel-header"],[1,"folder-tree-filters-panel-caption"],[1,"folder-tree-filters-panel-buttons"],["color","primary",1,"action-button",3,"clicked","disabled"],[1,"action-button",3,"clicked","disabled"],[1,"folder-tree-filters-panel-content"],["class","folder-tree-filters-panel-mask",4,"ngIf"],[3,"filterParamsChange","filterParams"],[1,"folder-tree-filters-panel-mask"]],template:function(t,n){t&1&&(r.\u0275\u0275elementStart(0,"div",0)(1,"div",1)(2,"div",2),r.\u0275\u0275text(3),r.\u0275\u0275pipe(4,"translate"),r.\u0275\u0275elementEnd(),r.\u0275\u0275elementStart(5,"div",3)(6,"crt-button",4),r.\u0275\u0275listener("clicked",function(){return n.onSaveButtonClick()}),r.\u0275\u0275text(7),r.\u0275\u0275pipe(8,"translate"),r.\u0275\u0275elementEnd(),r.\u0275\u0275elementStart(9,"crt-button",5),r.\u0275\u0275listener("clicked",function(){return n.onCloseButtonClick()}),r.\u0275\u0275text(10),r.\u0275\u0275pipe(11,"translate"),r.\u0275\u0275elementEnd()()(),r.\u0275\u0275elementStart(12,"div",6),r.\u0275\u0275template(13,Nt,1,0,"ts-mask",7),r.\u0275\u0275elementStart(14,"crt-filters",8),r.\u0275\u0275listener("filterParamsChange",function(i){return n.onFiltersParamsChanged(i)}),r.\u0275\u0275elementEnd()()()),t&2&&(r.\u0275\u0275property("ngClass",n.getClasses()),r.\u0275\u0275advance(3),r.\u0275\u0275textInterpolate(r.\u0275\u0275pipeBind1(4,8,"FolderTreeFilters.DialogTitle")),r.\u0275\u0275advance(3),r.\u0275\u0275property("disabled",n.loading||n.filtersModalOpened),r.\u0275\u0275advance(),r.\u0275\u0275textInterpolate(r.\u0275\u0275pipeBind1(8,10,"FolderTreeFilters.SaveButton")),r.\u0275\u0275advance(2),r.\u0275\u0275property("disabled",n.filtersModalOpened),r.\u0275\u0275advance(),r.\u0275\u0275textInterpolate(r.\u0275\u0275pipeBind1(11,12,"FolderTreeFilters.CancelButton")),r.\u0275\u0275advance(3),r.\u0275\u0275property("ngIf",n.loading),r.\u0275\u0275advance(),r.\u0275\u0275property("filterParams",n.filterParams))},dependencies:[A.NgClass,A.NgIf,nt.B,ot.I,Mt.E,P.TranslatePipe],styles:["[_nghost-%COMP%]{width:100%}.folder-tree-filters-panel[_ngcontent-%COMP%]{flex-direction:column;display:flex;height:100%}.folder-tree-filters-panel-header[_ngcontent-%COMP%]{display:flex;flex-direction:column;margin-inline:40px}.folder-tree-filters-panel-header[_ngcontent-%COMP%]   .folder-tree-filters-panel-caption[_ngcontent-%COMP%]{margin:8px 0}.folder-tree-filters-panel-header[_ngcontent-%COMP%]   .folder-tree-filters-panel-buttons[_ngcontent-%COMP%]{display:flex;justify-items:flex-start;align-items:flex-start;flex-flow:row nowrap;margin-bottom:32px;gap:16px}.folder-tree-filters-panel-content[_ngcontent-%COMP%]{position:relative;height:100%}.folder-tree-filters-panel-content[_ngcontent-%COMP%]   .folder-tree-filters-panel-mask[_ngcontent-%COMP%]{position:absolute;height:100%;width:100%}"]})}}var R;(function(l){l.ORIG="ORIG",l.ASC="ASC",l.DESC="DESC"})(R||(R={}));class D{_getSortedItems(e,t){return t===R.ORIG?e:[...e].sort((n,o)=>n.name.localeCompare(o.name)*(t===R.ASC?1:-1))}_createTreeFromItems(e){const t=[],n=[];if(!e)return t;const o=e.map((i,c)=>(n[i.id]=c,this.createNode(i)),this);return e.forEach(i=>{const c=o[n[i.id]];if((0,j.gZ)(i.parentId))t.push(c);else{const _=o[n[i.parentId]];if(!_)return;_.children.push(c)}}),t}createNode(e){return{id:e.id,name:e.name,filterData:e.filterData,editable:e.editable,isNew:e.isNew,folderTreeId:e.folderTreeId,folderTypeId:e.folderTypeId,hasFavorite:e.hasFavorite,isFavorite:e.isFavorite,favoriteId:e.favoriteId,children:[]}}build(e,t=R.ORIG){return e?this._createTreeFromItems(this._getSortedItems(e,t)):[]}filterTreeBySearchText(e,t,n){if(!t||t==="")return e;if(!e||e.length===0)return[];const o=t.toLowerCase(),i=[];for(const c of e){const _=this.filterTreeBySearchText(c.children,t,n),v=_.length>0;c.children=_,(v||c.name.toLowerCase().includes(o)&&n.findIndex(y=>y===c.id)<0||c.isNew||c.isCopy)&&i.push(c)}return i}static{this.\u0275fac=function(t){return new(t||D)}}static{this.\u0275prov=r.\u0275\u0275defineInjectable({token:D,factory:D.\u0275fac})}}var f=d(21747),St=d(58433),Tt=d(22817),it=d(4227),ae=d(54653),wt=d(66675),Pt=d(46558);const Ot=l=>({"folder-tree":!0,"crt-folder-tree-search-applied":l}),xt=l=>({"node-text":!0,"node-name-input":l}),bt=l=>({$implicit:l});function At(l,e){l&1&&r.\u0275\u0275element(0,"crt-skeleton-loader")}function Et(l,e){l&1&&r.\u0275\u0275element(0,"ts-mask",16)}function Vt(l,e){if(l&1){const t=r.\u0275\u0275getCurrentView();r.\u0275\u0275elementContainerStart(0),r.\u0275\u0275elementStart(1,"button",17),r.\u0275\u0275pipe(2,"translate"),r.\u0275\u0275listener("click",function(){r.\u0275\u0275restoreView(t);const o=r.\u0275\u0275nextContext(3);return r.\u0275\u0275resetView(o.addNewItem(null))}),r.\u0275\u0275element(3,"mat-icon",18),r.\u0275\u0275text(4),r.\u0275\u0275pipe(5,"translate"),r.\u0275\u0275elementEnd(),r.\u0275\u0275elementContainerEnd()}l&2&&(r.\u0275\u0275advance(),r.\u0275\u0275property("title",r.\u0275\u0275pipeBind1(2,2,"FolderTree.AddFilterHint")),r.\u0275\u0275advance(3),r.\u0275\u0275textInterpolate1(" ",r.\u0275\u0275pipeBind1(5,4,"FolderTree.AddFilter")," "))}function Rt(l,e){if(l&1&&(r.\u0275\u0275elementContainerStart(0),r.\u0275\u0275elementStart(1,"button",19),r.\u0275\u0275pipe(2,"translate"),r.\u0275\u0275element(3,"mat-icon",18),r.\u0275\u0275text(4),r.\u0275\u0275pipe(5,"translate"),r.\u0275\u0275elementEnd(),r.\u0275\u0275element(6,"crt-menu",20,2),r.\u0275\u0275elementContainerEnd()),l&2){const t=r.\u0275\u0275reference(7),n=r.\u0275\u0275nextContext(3);r.\u0275\u0275advance(),r.\u0275\u0275property("crtMenuTriggerFor",t)("title",r.\u0275\u0275pipeBind1(2,4,"FolderTree.AddFilterHint")),r.\u0275\u0275advance(3),r.\u0275\u0275textInterpolate1(" ",r.\u0275\u0275pipeBind1(5,6,"FolderTree.AddFilter")," "),r.\u0275\u0275advance(2),r.\u0275\u0275property("menuItems",n.getAddMenuItems())}}function Dt(l,e){l&1&&(r.\u0275\u0275elementStart(0,"div",21)(1,"div",22),r.\u0275\u0275text(2),r.\u0275\u0275pipe(3,"translate"),r.\u0275\u0275elementEnd()()),l&2&&(r.\u0275\u0275advance(2),r.\u0275\u0275textInterpolate(r.\u0275\u0275pipeBind1(3,1,"FolderTree.BlankslateMessage")))}function kt(l,e){if(l&1&&(r.\u0275\u0275elementContainerStart(0),r.\u0275\u0275elementStart(1,"div",24),r.\u0275\u0275element(2,"mat-icon",25),r.\u0275\u0275elementEnd(),r.\u0275\u0275elementStart(3,"div",26),r.\u0275\u0275elementContainerStart(4),r.\u0275\u0275text(5),r.\u0275\u0275elementContainerEnd(),r.\u0275\u0275elementEnd(),r.\u0275\u0275elementContainerEnd()),l&2){const t=r.\u0275\u0275nextContext().node;r.\u0275\u0275advance(5),r.\u0275\u0275textInterpolate(t.name)}}function $t(l,e){if(l&1){const t=r.\u0275\u0275getCurrentView();r.\u0275\u0275elementContainerStart(0),r.\u0275\u0275elementStart(1,"crt-input",29),r.\u0275\u0275listener("blurred",function(){r.\u0275\u0275restoreView(t);const o=r.\u0275\u0275nextContext(2).node,i=r.\u0275\u0275nextContext(3);return r.\u0275\u0275resetView(i.onNameEnter(o))})("keyDown",function(o){r.\u0275\u0275restoreView(t);const i=r.\u0275\u0275nextContext(2).node,c=r.\u0275\u0275nextContext(3);return r.\u0275\u0275resetView(c.onNameKeydown(o,i))})("focusin",function(o){return r.\u0275\u0275restoreView(t),r.\u0275\u0275resetView(o.cancelBubble=!0)})("focusout",function(o){return r.\u0275\u0275restoreView(t),r.\u0275\u0275resetView(o.cancelBubble=!0)}),r.\u0275\u0275elementEnd(),r.\u0275\u0275elementContainerEnd()}if(l&2){const t=r.\u0275\u0275nextContext(5);r.\u0275\u0275advance(),r.\u0275\u0275property("control",t.folderNameControl)}}function jt(l,e){if(l&1&&(r.\u0275\u0275elementContainerStart(0),r.\u0275\u0275text(1),r.\u0275\u0275elementContainerEnd()),l&2){const t=r.\u0275\u0275nextContext(2).node;r.\u0275\u0275advance(),r.\u0275\u0275textInterpolate(t.name)}}function Ht(l,e){if(l&1){const t=r.\u0275\u0275getCurrentView();r.\u0275\u0275elementStart(0,"button",38),r.\u0275\u0275pipe(1,"translate"),r.\u0275\u0275listener("click",function(){r.\u0275\u0275restoreView(t);const o=r.\u0275\u0275nextContext(4).node,i=r.\u0275\u0275nextContext(3);return r.\u0275\u0275resetView(i.createOrEditFolderFilters(o))}),r.\u0275\u0275element(2,"mat-icon",39),r.\u0275\u0275elementEnd()}if(l&2){const t=r.\u0275\u0275nextContext(4).node;r.\u0275\u0275property("id","filter-btn--"+t.id)("title",r.\u0275\u0275pipeBind1(1,2,"FolderTree.SetUpFilter"))}}function Bt(l,e){if(l&1){const t=r.\u0275\u0275getCurrentView();r.\u0275\u0275elementStart(0,"div",32)(1,"button",33),r.\u0275\u0275pipe(2,"translate"),r.\u0275\u0275listener("click",function(o){r.\u0275\u0275restoreView(t);const i=r.\u0275\u0275nextContext(3).node,c=r.\u0275\u0275nextContext(3);return r.\u0275\u0275resetView(c.onToggleFolderFavorite(o,i))}),r.\u0275\u0275element(3,"mat-icon",34),r.\u0275\u0275elementEnd(),r.\u0275\u0275template(4,Ht,3,4,"button",35),r.\u0275\u0275elementStart(5,"button",36),r.\u0275\u0275pipe(6,"translate"),r.\u0275\u0275listener("click",function(o){r.\u0275\u0275restoreView(t);const i=r.\u0275\u0275nextContext(6);return r.\u0275\u0275resetView(i.onMenuActionsClick(o))})("menuClosed",function(){r.\u0275\u0275restoreView(t);const o=r.\u0275\u0275nextContext(6);return r.\u0275\u0275resetView(o.onCloseMenu())})("menuOpened",function(){r.\u0275\u0275restoreView(t);const o=r.\u0275\u0275nextContext(6);return r.\u0275\u0275resetView(o.onOpenMenu())}),r.\u0275\u0275element(7,"mat-icon",37),r.\u0275\u0275elementEnd(),r.\u0275\u0275element(8,"crt-menu",20,3),r.\u0275\u0275elementEnd()}if(l&2){const t=r.\u0275\u0275reference(9),n=r.\u0275\u0275nextContext(3).node,o=r.\u0275\u0275nextContext(3);r.\u0275\u0275advance(),r.\u0275\u0275property("id","toggle-favorite-btn--"+n.id)("title",r.\u0275\u0275pipeBind1(2,12,"FolderTree.MenuActions."+(n.hasFavorite||n.isFavorite?"RemoveFromFavorite":"AddToFavorite")))("disabled",n.isFavoriteToggleInProgress),r.\u0275\u0275advance(2),r.\u0275\u0275classProp("in-favorite",n.hasFavorite||n.isFavorite),r.\u0275\u0275property("svgIcon",n.hasFavorite||n.isFavorite?"star-filled-icon":"star-icon"),r.\u0275\u0275advance(),r.\u0275\u0275property("ngIf",!o.isStaticNode(n)),r.\u0275\u0275advance(),r.\u0275\u0275property("id","node-menu-btn--"+n.id)("crtMenuTriggerFor",t)("crtMenuTriggerData",r.\u0275\u0275pureFunction1(16,bt,n))("title",r.\u0275\u0275pipeBind1(6,14,"FolderTree.ShowMenuActions")),r.\u0275\u0275advance(3),r.\u0275\u0275property("menuItems",o.getNodeMenuItems(n))}}function Kt(l,e){if(l&1&&(r.\u0275\u0275elementStart(0,"div",30),r.\u0275\u0275template(1,Bt,10,18,"div",31),r.\u0275\u0275elementEnd()),l&2){const t=r.\u0275\u0275nextContext(2).node,n=r.\u0275\u0275nextContext(3);r.\u0275\u0275advance(),r.\u0275\u0275property("ngIf",!t.editable&&!n.readonly)}}function Lt(l,e){if(l&1&&(r.\u0275\u0275elementContainerStart(0),r.\u0275\u0275elementStart(1,"div",24),r.\u0275\u0275element(2,"mat-icon",27),r.\u0275\u0275elementEnd(),r.\u0275\u0275elementStart(3,"div",12),r.\u0275\u0275template(4,$t,2,1,"ng-container",9)(5,jt,2,1,"ng-container",9),r.\u0275\u0275elementEnd(),r.\u0275\u0275template(6,Kt,2,1,"div",28),r.\u0275\u0275elementContainerEnd()),l&2){const t=r.\u0275\u0275nextContext().node,n=r.\u0275\u0275nextContext(3);r.\u0275\u0275advance(2),r.\u0275\u0275property("svgIcon",n.isStaticNode(t)?"folder-static-icon":"folder-icon"),r.\u0275\u0275advance(),r.\u0275\u0275property("ngClass",r.\u0275\u0275pureFunction1(5,xt,t.editable)),r.\u0275\u0275advance(),r.\u0275\u0275property("ngIf",t.editable),r.\u0275\u0275advance(),r.\u0275\u0275property("ngIf",!t.editable),r.\u0275\u0275advance(),r.\u0275\u0275property("ngIf",!n.isRootNode(t))}}function Ut(l,e){if(l&1&&(r.\u0275\u0275elementStart(0,"div",23),r.\u0275\u0275template(1,kt,6,1,"ng-container",9)(2,Lt,7,7,"ng-container",9),r.\u0275\u0275elementEnd()),l&2){const t=e.node,n=r.\u0275\u0275nextContext(3);r.\u0275\u0275advance(),r.\u0275\u0275property("ngIf",n.isFavoriteRoot(0,t)),r.\u0275\u0275advance(),r.\u0275\u0275property("ngIf",n.isFolderNode(0,t))}}function Zt(l,e){if(l&1){const t=r.\u0275\u0275getCurrentView();r.\u0275\u0275elementContainerStart(0),r.\u0275\u0275elementStart(1,"div",5),r.\u0275\u0275template(2,Et,1,0,"ts-mask",6),r.\u0275\u0275elementStart(3,"div",7)(4,"crt-search-filter",8),r.\u0275\u0275listener("valueChange",function(o){r.\u0275\u0275restoreView(t);const i=r.\u0275\u0275nextContext(2);return r.\u0275\u0275resetView(i.onSearchFilterChanged(o))}),r.\u0275\u0275elementEnd(),r.\u0275\u0275template(5,Vt,6,6,"ng-container",9)(6,Rt,8,8,"ng-container",9),r.\u0275\u0275elementStart(7,"button",10),r.\u0275\u0275pipe(8,"translate"),r.\u0275\u0275listener("click",function(){r.\u0275\u0275restoreView(t);const o=r.\u0275\u0275nextContext(2);return r.\u0275\u0275resetView(o.onFolderTreeHideClick())})("keydown.enter",function(){r.\u0275\u0275restoreView(t);const o=r.\u0275\u0275nextContext(2);return r.\u0275\u0275resetView(o.onFolderTreeHideClick())}),r.\u0275\u0275element(9,"mat-icon",11),r.\u0275\u0275elementEnd()(),r.\u0275\u0275elementStart(10,"div",12),r.\u0275\u0275template(11,Dt,4,3,"div",13),r.\u0275\u0275elementStart(12,"crt-virtual-scroll-tree-view",14),r.\u0275\u0275listener("expandedItemsChanged",function(o){r.\u0275\u0275restoreView(t);const i=r.\u0275\u0275nextContext(2);return r.\u0275\u0275resetView(i.onExpandedItemsChanged(o))})("selectedItemKeyChange",function(o){r.\u0275\u0275restoreView(t);const i=r.\u0275\u0275nextContext(2);return r.\u0275\u0275resetView(i.onSelectedItemKeyChange(o))}),r.\u0275\u0275template(13,Ut,3,2,"ng-template",15),r.\u0275\u0275elementEnd()()(),r.\u0275\u0275elementContainerEnd()}if(l&2){const t=r.\u0275\u0275nextContext(2);r.\u0275\u0275advance(),r.\u0275\u0275property("ngClass",t.classes),r.\u0275\u0275advance(),r.\u0275\u0275property("ngIf",t.showMask||t.loadingView),r.\u0275\u0275advance(3),r.\u0275\u0275property("ngIf",!t.useStaticFolders&&!t.readonly),r.\u0275\u0275advance(),r.\u0275\u0275property("ngIf",t.useStaticFolders&&!t.readonly),r.\u0275\u0275advance(),r.\u0275\u0275property("crtAccessibleAttributes",r.\u0275\u0275pipeBind1(8,17,"FolderTree.CloseFolderTree")),r.\u0275\u0275advance(3),r.\u0275\u0275property("ngClass",r.\u0275\u0275pureFunction1(19,Ot,t.isSearchApplied)),r.\u0275\u0275advance(),r.\u0275\u0275property("ngIf",t.flatItems.length===0&&!t.loadingView),r.\u0275\u0275advance(),r.\u0275\u0275property("items",t.flatItems)("expandedItems",t.expandedItems)("selectedItemKey",t.selectedItemKey)("minVisibleItemsCount",t.minVisibleItemsCount)("treeNodeTrackerFn",t.treeNodeTrackerFn)("processOnViewItemActionFn",t.processOnViewItemActionFn)("isStrictCheckElementInViewportFn",t.isStrictCheckElementInViewportFn)("getFocusElementFn",t.getFocusElementFn)("getFocusActionFn",t.getFocusActionFn)("onToggleNodeSelectedItemChangeFn",t.onToggleNodeSelectedItemChangeFn)}}function Gt(l,e){if(l&1&&r.\u0275\u0275element(0,"crt-placeholder",40),l&2){const t=r.\u0275\u0275nextContext(2);r.\u0275\u0275property("image",t.placeholder)}}function zt(l,e){if(l&1&&r.\u0275\u0275template(0,Zt,14,21,"ng-container",4)(1,Gt,1,1,"ng-template",null,1,r.\u0275\u0275templateRefExtractor),l&2){const t=r.\u0275\u0275reference(2),n=r.\u0275\u0275nextContext();r.\u0275\u0275property("ngIf",n.rootSchemaName)("ngIfElse",t)}}const at="{}",Qt="node-element-in-focus";let p=class te extends rt.K{constructor(){super(...arguments),this._dialogService=(0,r.inject)(Ye.o),this._messageDialogProvider=(0,r.inject)(Ft.r),this._rightsService=(0,r.inject)(qe.f),this._translateService=(0,r.inject)(P.TranslateService),this._treeBuilder=(0,r.inject)(D),this._translatePrefix="FolderTree",this._reloadTreeDelay=50,this._processOnNameEnterDelay=100,this._changeSelectedNodeDelay=50,this._focusNodeNameInputDelay=10,this._resetExpandedItemsIfNeedDelay=20,this._setFocusItemDelay=100,this._setFocusItemAfterAddEditableItemDelay=20,this._items$=new s.BehaviorSubject([]),this._favoriteItems$=new s.BehaviorSubject([]),this._hierarchicalItems=[],this._flatItems=[],this._itemsSubscriptions$=new s.Subscription,this._favoriteItemsSubscriptions$=new s.Subscription,this._expandedItems=[m.EM,m.NQ],this._folderNameEntering=!1,this._nodeMenuOpened=!1,this._searchTextValue="",this._canAddNewRecord=!0,this._isConvertFolderAction=!1,this._selectedNodeHasChangesOnSearchMode=!1,this._showMask=!1,this._reloadTreeDebounce=(0,g.debounce)(()=>this._reloadTree(),this._reloadTreeDelay),this._processOnNameEnterDebounce=(0,g.debounce)(e=>this._processOnNameEnter(e),this._processOnNameEnterDelay),this._changeSelectedNodeDebounce=(0,g.debounce)(e=>this._changeSelectedNode(e),this._changeSelectedNodeDelay),this._focusNodeNameInputDebounce=(0,g.debounce)(()=>this._focusNodeNameInput(),this._focusNodeNameInputDelay),this._resetExpandedItemsIfNeedDebounce=(0,g.debounce)(()=>this._resetExpandedItemsIfNeed(),this._resetExpandedItemsIfNeedDelay),this.loadingView=!1,this.placeholder={type:"icon",icon:"folder_tree",width:null,height:null,padding:null},this.folderNameControl=new gt.FormControl(null),this.isViewInitializing=!0,this.processOnViewItemActionFn=this._processOnViewItemAction.bind(this),this.isStrictCheckElementInViewportFn=this._isStrictCheckElementInViewport.bind(this),this.getFocusElementFn=this._getFocusElement.bind(this),this.getFocusActionFn=this._getFocusAction.bind(this),this.onToggleNodeSelectedItemChangeFn=()=>{},this.hostBorderRadius=null,this.minVisibleItemsCount=5,this.useStaticFolders=!1,this.sortingOrder=R.ASC,this.readonly=!1,this.activeFolderChanged=new r.EventEmitter,this.folderTreeVisibleChanged=new r.EventEmitter,this.addFolder=new r.EventEmitter,this.copyFolder=new r.EventEmitter,this.deleteFolder=new r.EventEmitter,this.moveFolder=new r.EventEmitter,this.folderRenamed=new r.EventEmitter,this.folderFiltersUpdated=new r.EventEmitter,this.toggleFolderFavorite=new r.EventEmitter,this.folderTreeExpandedItemsChanged=new r.EventEmitter,this.folderChangeRights=new r.EventEmitter,this.convertToStaticFolder=new r.EventEmitter,this._isFavoriteRootNode=e=>this._isFavoriteRootNodeId(e?.id),this._isFavoriteRootNodeId=e=>e===m.NQ,this._isRootNode=e=>this._isRootNodeId(e?.id),this._isRootNodeId=e=>e===m.EM,this.isFavoriteRoot=(e,t)=>this._isFavoriteRootNode(t),this.isFolderNode=(e,t)=>!this._isFavoriteRootNode(t),this.isStaticNode=e=>(0,f.$K)(e.folderTypeId),this.hasChildren=e=>e.expandable,this.isRootNode=e=>this._isRootNode(e)}set selectedNode(e){this._isNotNeedChangeSelectedNode(e)||this._changeSelectedNodeDebounce(e)}get selectedNode(){return this._selectedNode}get selectedItemKey(){return this.selectedNode?.id}get flatItems(){return this._flatItems}get isSearchApplied(){return!(0,g.isEmpty)(this._searchTextValue)}set sourceSchemaName(e){this._sourceSchemaName!==e&&(this._sourceSchemaName=e,this._initializeCanAddNewRecord())}get sourceSchemaName(){return this._sourceSchemaName}set rootSchemaName(e){this._rootSchemaName=e,this.detectChanges()}get rootSchemaName(){return this._rootSchemaName}set showMask(e){setTimeout(()=>{this._showMask=e,this.detectChanges()},e?0:50)}get showMask(){return this._showMask}set items(e){e instanceof ie.A&&(this._itemsSubscriptions$.unsubscribe(),this._itemsSubscriptions$=new s.Subscription,this._itemsSubscriptions$.add(e.changed.subscribe(()=>{this._updateItems(e)}))),this._updateItems(e)}set favoriteItems(e){e instanceof ie.A&&(this._favoriteItemsSubscriptions$.unsubscribe(),this._favoriteItemsSubscriptions$=new s.Subscription,this._favoriteItemsSubscriptions$.add(e.changed.subscribe(()=>{this._updateFavoriteItems(e)}))),this._updateFavoriteItems(e)}set activeFolderId(e){this._isNotNeedChangeActiveFolderId(e)||(this._activeFolderId=e,!this._isUnsavedFolder(e)&&this._initSelectedNode(e))}set expandedItems(e){Array.isArray(e)&&this._hasExpandedItemsChanges(e)&&(this._expandedItems=e)}get expandedItems(){return this._expandedItems}set borderRadius(e){this._initializeHostBorderRadius(e)}_initSelectedNode(e){this.selectedNode=this._flatItems.find(t=>t.id===e)}_changeSelectedNode(e){if(this.isSearchApplied&&(this._selectedNodeHasChangesOnSearchMode=!0),this._isNeedChangeSelectedNodeToRootNode(e)){this._changeSelectedNodeToRootNode();return}this._selectedNode=e,this._emitActiveFolderChanged(this._isRootNode(e)?null:e),this._expandParentsIfNeed(e)}_changeSelectedNodeToRootNode(){this._selectedNode=this._flatItems.find(e=>this._isRootNode(e)),this._emitActiveFolderChanged(null)}_isNeedChangeSelectedNodeToRootNode(e){return!e&&!this._isRootNode(this._selectedNode)||!!e&&!this._flatItems.some(t=>t.id===e.id)}_isNotNeedChangeSelectedNode(e){return this._selectedNode===e||!e&&this._isRootNode(this._selectedNode)}_isNotNeedChangeActiveFolderId(e){return this._activeFolderId===e||(0,j.gZ)(this._activeFolderId)&&(0,j.gZ)(e)}_updateItems(e){Promise.all((e??[]).map(function(){var t=(0,u.A)(function*(n){return{id:yield n.Id,name:yield n.Name,parentId:yield n.ParentId,filterData:yield n.FilterData,isFavorite:!1,folderTreeId:yield n.Id,folderTypeId:yield n.FolderTypeId,isFavoriteToggleInProgress:!1}});return function(n){return t.apply(this,arguments)}}())).then(t=>{this._items$.next(t||[]),this._setLoadingView(!0),this._reloadTreeDebounce()})}_updateFavoriteItems(e){Promise.all((e??[]).map(function(){var t=(0,u.A)(function*(n){return{id:yield n.Id,name:yield n.Name,parentId:null,folderTreeId:yield n.FolderTreeId,folderTypeId:yield n.FolderTypeId,filterData:yield n.FilterData,isFavorite:!0,isFavoriteToggleInProgress:!1}});return function(n){return t.apply(this,arguments)}}())).then(t=>{this._favoriteItems$.next(t||[]),this._setLoadingView(!0),this._reloadTreeDebounce()})}_reloadTree(){this._mapHasFavoriteItems(),this._updateTreeData(),(0,j.gZ)(this._activeFolderId)||this._initSelectedNode(this._activeFolderId)}_mapHasFavoriteItems(){this._items$.value.forEach(e=>{const t=this._favoriteItems$.value.find(n=>n.folderTreeId===e.id);e.hasFavorite=!!t,e.favoriteId=t?.id})}_updateTreeData(){this._hierarchicalItems=this._getFolderTreeHierarchicalNodes(),this._flatItems=this._getFlatNodesFromHierarchicalItems(),this._resetExpandedItemsIfNeedDebounce(),this._setLoadingView(!1)}_getFolderTreeHierarchicalNodes(){const e=[this._getVirtualNode(this._createVirtualFavoriteRootNodeItem(),this._favoriteItems$.value),this._getVirtualNode(this._createVirtualRootNodeItem(),this._items$.value)].filter(Boolean),t=this._treeBuilder.filterTreeBySearchText(e,this._searchTextValue,[m.EM,m.NQ]);return this._verifyAvailableFavoriteChildNodes(t),t}_getVirtualNode(e,t){if(!e)return null;const n=this._treeBuilder.createNode(e);return n.children=this._treeBuilder.build(t,this.sortingOrder),n}_createVirtualFavoriteRootNodeItem(){return(0,g.isEmpty)(this._items$.value)||(0,g.isEmpty)(this._favoriteItems$.value)?null:{id:m.NQ,name:this._translate("FavoritesNodeCaption"),isFavorite:!0}}_createVirtualRootNodeItem(){return{id:m.EM,name:this._translate("RootNodeCaption")}}_verifyAvailableFavoriteChildNodes(e){const t=e.find(o=>this._isFavoriteRootNode(o)),n=e.find(o=>this._isRootNode(o));!t&&!n||!t||(t.children=t.children.filter(o=>this._hasParentHierarchicalNode(this._items$.value,o)))}_hasParentHierarchicalNode(e,t){const n=e.find(o=>o.folderTreeId===t.folderTreeId);return this._hasParentNode(e,n)}_hasParentNode(e,t){if(!t)return!1;if(!t.parentId)return!0;const n=e.find(o=>o.folderTreeId===t.parentId);return this._hasParentNode(e,n)}_getFlatNodesFromHierarchicalItems(){const e=[];return this._addFlatNodesToArray(e,this._hierarchicalItems,null,0),e}_addFlatNodesToArray(e,t,n,o){t?.forEach(i=>{e.push(this._castHierarchicalNodeToFlat(i,n,o)),i.children?.length>0&&this._addFlatNodesToArray(e,i.children,i.id,o+1)})}_castHierarchicalNodeToFlat(e,t,n){return{id:e.id,name:e.name,folderTreeId:e.folderTreeId,folderTypeId:e.folderTypeId,parentId:t,favoriteId:e.favoriteId,filterData:e.filterData,isNew:e.isNew,isCopy:e.isCopy,isMove:e.isMove,sourceId:e.sourceId,editable:e.editable,hasFavorite:e.hasFavorite,isFavorite:e.isFavorite,isFavoriteToggleInProgress:e.isFavoriteToggleInProgress,expandable:e.children?.length>0,level:n}}_resetExpandedItemsIfNeed(){let e=[];if(this.isSearchApplied){this.virtualScrollTreeView.expandAll();return}this._activeFolderId&&!this.isSearchApplied&&this._selectedNodeHasChangesOnSearchMode&&(e=this._getParentIdsForExpand(this._flatItems.find(t=>t.id===this._activeFolderId))),e=(0,g.uniq)([...e,...this._getParentIdsForExpand(this._flatItems.find(t=>t.isNew||t.isCopy||t.isMove))]),e.length&&this._updateExpandedItems([...this._expandedItems,...e])}_expandParentsIfNeed(e,t=!1){if(!e)return;if(this.isSearchApplied){this.virtualScrollTreeView.expandAll();return}const n=this._getParentIdsForExpand(e);!n.length&&!t||this._updateExpandedItems([...this._expandedItems,...n])}_getParentIdsForExpand(e){if(!e)return[];const t=this._getHierarchicalParentIds(e),n=[];return t.forEach(o=>{this._expandedItems.includes(o)||n.push(o)}),n}_getHierarchicalParentIds(e){return!e||(0,g.isEmpty)(e.parentId)?[]:[e.parentId,...this._getHierarchicalParentIds(this._flatItems.find(t=>t.id===e.parentId))].filter(Boolean)}_updateSearchFilterValue(e){this._searchTextValue=e||"",this._updateTreeData(),this.isSearchApplied||(this._selectedNodeHasChangesOnSearchMode?this._expandParentsIfNeed(this._selectedNode,!0):this._expandedItems=[...this._expandedItems]),!this.isSearchApplied&&this._selectedNodeHasChangesOnSearchMode&&(this._selectedNodeHasChangesOnSearchMode=!1,this.virtualScrollTreeView.virtualScrollViewport.scrollToItem(this._activeFolderId))}_initializeHostBorderRadius(e){let t;switch(e){case z.Z.Small:t="4px";break;case z.Z.Medium:t="8px";break;case z.Z.Large:t="16px";break;case z.Z.Default:case z.Z.None:t=null;break;default:t=null;break}this.hostBorderRadius=t}_initializeCanAddNewRecord(){var e=this;return(0,u.A)(function*(){if(!e.sourceSchemaName)return;const t=yield(0,s.firstValueFrom)(e._rightsService.getCanEdit({schemaName:e.sourceSchemaName,isNew:!0}));e._canAddNewRecord=t.result})()}_getAddFolderMenuItems(e){const t=[{type:"action",icon:"folder-icon",caption:this._translate("MenuActions.AddFolder"),code:"addFolder",handler:this._addNewItem.bind(this,e,m.Ss)}];return this.useStaticFolders&&t.push({type:"action",icon:"folder-static-icon",caption:this._translate("MenuActions.AddStaticFolder"),code:"addStaticFolder",handler:this._addNewItem.bind(this,e,m.Xi)}),t}_addNewItem(e,t){if(this._folderNameEntering)return;if(!this._canAddNewRecord){this._showHasNotPermissionDialog();return}this._setFolderNameControlValue(this._translate("DefaultFolderName"));const n=this._getSelectedNodeForNewItem(e),o=n?this._getFolderId(n):null;this._addNewEditableItemAndFocusOnIt({name:"",parentId:o,isCopy:!1,folderTypeId:t})}_moveItemNode(e){var t=this;return(0,u.A)(function*(){if(!(yield t._isCanEditFolder(e))){t._showHasNotPermissionDialog();return}const o=yield t._openSelectFolderDialog(e);t._processFolderTreeSelectFolderDialogResponse(o,e)})()}_openSelectFolderDialog(e){const t=this._getFolderId(e);return(0,s.lastValueFrom)(this._dialogService.open(V,{data:{folderTreeItems:this._getFolderDataItems(this._items$.value,t),favoriteTreeItems:this._getFolderDataItems(this._favoriteItems$.value,t),rootSchemaName:this.rootSchemaName},width:"600px",height:"700px",panelClass:"crt-folder-tree-select-folder-dialog"}))}_getFolderDataItems(e,t){return e.filter(n=>n.folderTreeId!==t).map(n=>this._convertFolderTreeNodeDataToDataItem(n))}_convertFolderTreeNodeDataToDataItem(e){return{Id:e.id,Name:e.name,ParentId:e.parentId,FolderTreeId:e.folderTreeId,FilterData:e.filterData,FolderTypeId:e.folderTypeId,IsFavorite:e.isFavorite}}_processFolderTreeSelectFolderDialogResponse(e,t){e.status!==H.Selected||!e?.selectedFolderId||(this._updateNodePropertyValue(t,"parentId",e.selectedFolderId),this._updateNodePropertyValue(t,"isMove",!0),this._resetExpandedItemsIfNeed(),this._updateTreeData(),this.activeFolderId=t.id,this._emitMoveFolder(t,e.selectedFolderId),setTimeout(()=>{this.virtualScrollTreeView.focusedItemKey=t.id,this.virtualScrollTreeView.virtualScrollViewport.setFocusItem(null,t.id)},this._setFocusItemDelay))}_emitMoveFolder(e,t){const n=this._getFolderId(e);this.moveFolder.emit({folderId:n,sourceSchemaName:this.sourceSchemaName,reloadFavorites:e.isFavorite||e.hasFavorite,parentId:this._getCorrectParentIdForMoveFolder(t)})}_getCorrectParentIdForMoveFolder(e){return e===m.EM?null:e}_renameItemNode(e){var t=this;return(0,u.A)(function*(){if(!(yield t._isCanEditFolder(e))){t._showHasNotPermissionDialog();return}t._setFolderNameControlValue(e.name),t._setEditableMode(e,!0),t._focusNodeNameInputDebounce()})()}_copyItemNode(e){if(!this._canAddNewRecord){this._showHasNotPermissionDialog();return}const t=this._flatItems.find(i=>i.id===this._getFolderId(e)),n=`${t.name} - ${this._translate("CopyFolderSuffix")}`;this._setFolderNameControlValue(n);const o=this._findDirectParentId(t.id);this._addNewEditableItemAndFocusOnIt({name:n,parentId:o,isCopy:!0,sourceId:t.id,filterData:t.filterData,folderTypeId:t.folderTypeId})}_removeItemNode(e){var t=this;return(0,u.A)(function*(){if(!(yield t._isCanRemoveFolder(e))){t._showHasNotPermissionDialog();return}if(yield(0,s.lastValueFrom)(t._messageDialogProvider.confirmation(t._translate("DeleteConfirmation")))){if(t._emitDeleteFolder(t._getFolderId(e)),e.id===t.selectedNode?.id){t.selectedNode=null,t.virtualScrollTreeView.virtualScrollViewport.setFocusItem(null,m.EM,!1);return}t.virtualScrollTreeView.virtualScrollViewport.setFocusItem(null,t.selectedNode?.id,!1);return}t.virtualScrollTreeView.virtualScrollViewport.setFocusItem(null,e.id)})()}_loadRightsModule(e){this._emitFolderChangeRights(e)}_convertToStaticFolder(e){this._isConvertFolderAction=!0,this._addNewItem(e,m.Xi)}_processSetupFolderDialogResponse(e,t){if(e.status!==B.Saved)return;let n=e.filterParams.filters;(0,f.SK)(this.sourceSchemaName)&&(n=(0,Ct.s)(n));const o=JSON.stringify(n);this._emitFolderFiltersUpdated(t,o),this._updateNodePropertyValue(t,"filterData",o)}_processOnNameEnter(e){try{this._processingFolderNameEnter(e)}finally{this._updateTreeData(),setTimeout(()=>{this.virtualScrollTreeView.virtualScrollViewport.setFocusItem(null,e.id),this._folderNameEntering=!1},this._setFocusItemDelay)}}_processingFolderNameEnter(e){this._findNewItem()?this._emitInsertFolder()||this._removeNewItemNode():this._emitRenameFolder(e)}_removeNewItemNode(){this._items$.next(this._items$.value.filter(e=>!e.editable))}_emitInsertFolder(){const e=this.folderNameControl.value;if(!e)return!1;const t=this._findNewItem(),n=this._flatItems.find(o=>o.id===t.id);return t.isCopy?this._emitCopyFolder(t,t.sourceId,e):this._isConvertFolderAction?this._emitConvertToStaticFolder(t,e):this._emitAddFolder(t,e),this.activeFolderId=t.id,this._setupDefaultValuesForNewItem(t,e),this._setupDefaultValuesForNewItem(n,e),!0}_emitRenameFolder(e){const t=this.folderNameControl.value;if(!t){this._setEditableMode(e,!1);return}this._emitFolderRenamed(e,t),this._updateNodePropertyValue(e,"name",t),this._setEditableMode(e,!1)}_setupDefaultValuesForNewItem(e,t){e.name=t,e.editable=!1,e.isNew=!1,e.isCopy=!1,e.sourceId=void 0}_setEditableMode(e,t){const n=(e.isFavorite?this._favoriteItems$.value:this._items$.value).find(o=>o.id===e.id);n.editable=t,e.editable=t,this.detectChanges()}_updateNodePropertyValue(e,t,n){const o=this._getFolderId(e),i=this._items$.value.find(_=>_.id===o);i[t]=n;const c=this._flatItems.find(_=>_.id===o);if(c[t]=n,e.isFavorite){const _=this._favoriteItems$.value.find(y=>y.id===e.id);_[t]=n;const v=this._flatItems.find(y=>y.id===e.id);v[t]=n}}_getSelectedNodeForNewItem(e){return e||(this.selectedNode&&this._flatItems.some(t=>t.id===this.selectedNode.id)&&this.selectedNode.id!==m.EM?this.selectedNode:null)}_setFolderNameControlValue(e){this.folderNameControl.setValue(e)}_addNewEditableItemAndFocusOnIt(e){const t=this._addNewEditableItem(e);this._updateTreeData(),setTimeout(()=>{this.virtualScrollTreeView.focusedItemKey=t,this.virtualScrollTreeView.virtualScrollViewport.setFocusItem(null,t)},this._setFocusItemAfterAddEditableItemDelay)}_addNewEditableItem(e){const t=(0,j.qv)();return this._items$.value.push({name:e.name,id:t,editable:!0,isNew:!0,isCopy:e.isCopy,sourceId:e.sourceId,parentId:e.parentId??null,filterData:e.filterData,folderTreeId:t,folderTypeId:e.folderTypeId}),t}_isCanEditFolder(e){var t=this;return(0,u.A)(function*(){if(!t.sourceSchemaName||!e)return!0;const n=t._getFolderId(e);return(yield(0,s.firstValueFrom)(t._rightsService.getCanEdit({schemaName:t.sourceSchemaName,isNew:!1,primaryColumnValue:n}))).result})()}_isCanRemoveFolder(e){var t=this;return(0,u.A)(function*(){if(!t.sourceSchemaName||!e)return!0;const n=t._getFolderId(e);return(yield(0,s.firstValueFrom)(t._rightsService.getCanDelete({schemaName:t.sourceSchemaName,primaryColumnValue:n}))).result})()}_showHasNotPermissionDialog(){var e=this;return(0,u.A)(function*(){yield(0,s.lastValueFrom)(e._messageDialogProvider.error(e._translate("HasNotPermission")))})()}_emitActiveFolderChanged(e){this._activeFolderId=e?.id,this.activeFolderChanged.emit({id:e?.id??"",filterData:e?.filterData??at,folderTreeId:e?.folderTreeId??"",folderTypeId:e?.folderTypeId,rootSchemaName:this.rootSchemaName,name:e?.name??"",isFavorite:e?.isFavorite??!1})}_emitFolderTreeVisibleChanged(){this.folderTreeVisibleChanged.emit({visible:!1})}_emitAddFolder(e,t){this.addFolder.emit(this._getAddFolderEmitParameters(e,t))}_emitCopyFolder(e,t,n){const o=this._flatItems.find(i=>i.id===e.sourceId).name;this._messageDialogProvider.confirmation(O.String.format(this._translate("CopyRightsQuestion"),o)).subscribe(i=>this.copyFolder.emit({folderId:e.id,folderName:n,rootSchemaName:this.rootSchemaName,sourceSchemaName:this.sourceSchemaName,sourceId:t,filterData:e.filterData,parentId:e.parentId,reloadFavorites:!1,copyRights:i}))}_emitDeleteFolder(e){this.deleteFolder.emit({folderId:e,reloadFavorites:this._hasAnyFavoriteChildrenNodes(this._searchNode(this._hierarchicalItems,e)),sourceSchemaName:this.sourceSchemaName})}_emitFolderRenamed(e,t){this.folderRenamed.emit({folderId:this._getFolderId(e),folderName:t,sourceSchemaName:this.sourceSchemaName,reloadFavorites:e.isFavorite||e.hasFavorite})}_emitFolderFiltersUpdated(e,t){this.folderFiltersUpdated.emit({folderId:this._getFolderId(e),sourceSchemaName:this.sourceSchemaName,filterData:t,reloadFavorites:e.isFavorite||e.hasFavorite})}_emitToggleFolderFavorite(e){this.toggleFolderFavorite.emit({id:e.id,favoriteId:e.isFavorite?e.id:e.favoriteId,rootSchemaName:this.rootSchemaName,sourceSchemaName:this.sourceSchemaName,status:!(e.hasFavorite||e.isFavorite)})}_emitFolderTreeExpandedItemsChanged(){this.folderTreeExpandedItemsChanged.emit({expandedItems:this._expandedItems})}_emitFolderChangeRights(e){this.folderChangeRights.emit({entitySchemaName:this.sourceSchemaName,primaryColumnValue:this._getFolderId(e),primaryDisplayColumnValue:e.name})}_emitConvertToStaticFolder(e,t){this._isConvertFolderAction=!1,this.convertToStaticFolder.emit(this._getAddFolderEmitParameters(e,t))}_getAddFolderEmitParameters(e,t){return{folderId:e.id,folderName:t,rootSchemaName:this.rootSchemaName,sourceSchemaName:this.sourceSchemaName,folderTypeId:e.folderTypeId,filterData:e.filterData,parentId:e.parentId,reloadFavorites:!1}}_hasAnyFavoriteChildrenNodes(e){if(e.isFavorite||e.hasFavorite)return!0;if(e.children)for(const t of e.children){const n=this._hasAnyFavoriteChildrenNodes(t);if(n)return n}return!1}_searchNode(e,t){for(const n of e){const o=this._hierarchicalSearchNode(n,t);if(o)return o}}_hierarchicalSearchNode(e,t){if(e&&e.id===t)return e;if(e.children)for(const n of e.children){const o=this._hierarchicalSearchNode(n,t);if(o)return o}return null}_preventEventDefault(e){e?.preventDefault(),e?.stopPropagation()}_translate(e){return this._translateService.instant(`${this._translatePrefix}.${e}`)}_isUnsavedFolder(e){const t=this._items$.value.find(n=>n.id===e);return!!(t?.isCopy||t?.isNew||t?.isMove)}_hasExpandedItemsChanges(e){return(0,g.difference)(e,this._expandedItems).length>0||(0,g.difference)(this._expandedItems,e).length>0}_focusNodeNameInput(){this.folderNameInput.focus(),this.folderNameInput.select()}_findDirectParentId(e){return this._items$.value.find(t=>t.id===e)?.parentId}_findNewItem(){return this._items$.value.find(e=>e.isNew)}_getFolderId(e){return e.isFavorite?e.folderTreeId:e.id}_updateExpandedItems(e){this._expandedItems=(0,g.uniq)([...e].filter(Boolean)),this._emitFolderTreeExpandedItemsChanged()}_createOrEditFolderFilters(e){var t=this;return(0,u.A)(function*(){if(!(yield t._isCanEditFolder(e))){t._showHasNotPermissionDialog();return}const o=e?.filterData,i=yield(0,s.lastValueFrom)(t._dialogService.open(K,{data:{entitySchemaName:t.rootSchemaName,filters:o?JSON.parse(o):void 0},panelClass:"folder-tree-filters-dialog",disableClose:!0}));t._processSetupFolderDialogResponse(i,e)})()}_getEditableNode(){return this._flatItems.find(e=>e.editable)}_setLoadingView(e){setTimeout(()=>{this.loadingView=e,this.detectChanges()},e?0:50)}_processOnViewItemAction(e,t,n,o){switch(e){case"viewItemElementClick":this._processViewItemElementClick(t,n,o);break;case"viewItemElementKeyDown":this._processViewItemElementKeydown(t,n,o);break;case"viewTreeItemElementExpand":case"viewTreeItemElementCollapse":this._processTreeViewItemElemendToggle(o);break;case"viewItemElementFocusIn":this._processViewItemElementFocusIn(t,n,o);break;case"viewItemElementFocusOut":this._processViewItemElementFocusOut(t,n,o);break;case"resetFocusState":this._processResetFocusState(o);break;default:o();break}}_processViewItemElementClick(e,t,n){this._isNotAllowProcessViewItemElementClick(e,t)||n()}_isNotAllowProcessViewItemElementClick(e,t){return t.target.tagName==="INPUT"||this._isFavoriteRootNodeId(e)}_processViewItemElementKeydown(e,t,n){const o=this._getEditableNode();o&&this._processViewItemElementKeydownOnEditableNode(o,t)||!o&&this._processViewItemElementKeydownOnNonEditableNode(e,t)||n()}_processViewItemElementKeydownOnEditableNode(e,t){return this.virtualScrollTreeView.virtualScrollViewport.isVirtualFocusItemInFocus?this._processViewItemElementKeydownOnVirtualEditableNode(e,t):this._processViewItemElementKeydownOnNonVirtualEditableNode(e,t)}_processViewItemElementKeydownOnVirtualEditableNode(e,t){if(this._isNavigationKeydownEvent(t))return!0;if(t.key===S.Key.Enter)return this.virtualScrollTreeView.virtualScrollViewport.isVirtualFocusItemInFocus=!1,this._preventEventDefault(t),this.onNameEnter(e),!0;if(t.key.length!==1)return!1;this._preventEventDefault(t);const n=this.folderNameControl.value||"";return this.folderNameControl.setValue(n+t.key),this.virtualScrollTreeView.virtualScrollViewport.setFocusItem(null,e.id),!0}_isNavigationKeydownEvent(e){return e.key===S.Key.ArrowDown||e.key===S.Key.ArrowUp||this._isHorizontalNavigationKeydownEvent(e)}_isHorizontalNavigationKeydownEvent(e){return e.key===S.Key.ArrowLeft||e.key===S.Key.ArrowRight}_processViewItemElementKeydownOnNonVirtualEditableNode(e,t){return t.key===S.Key.Enter||this._isHorizontalNavigationKeydownEvent(t)?!0:t.key!==S.Key.Escape?!1:(this.folderNameControl.setValue("",{emitEvent:!1}),this._preventEventDefault(t),this.onNameEnter(e),!0)}_processViewItemElementKeydownOnNonEditableNode(e,t){return this._isNotAllowProcessViewItemElementSelectKeydownEvent(e,t)||this._isNotAllowProcessViewItemElementCollapseExpandKeydownEvent(t)}_isNotAllowProcessViewItemElementSelectKeydownEvent(e,t){return(t.key===S.Key.Enter||t.key===" ")&&(this._isFavoriteRootNodeId(e)||!this._isKeyboardEventOnSameTargetElement(t))}_isNotAllowProcessViewItemElementCollapseExpandKeydownEvent(e){return(e.key===S.Key.ArrowLeft||e.key===S.Key.ArrowRight)&&(this.isSearchApplied||!this._isKeyboardEventOnSameTargetElement(e))}_processTreeViewItemElemendToggle(e){this.isSearchApplied||e()}_processViewItemElementFocusIn(e,t,n){this._nodeMenuOpened=!1,n()}_processViewItemElementFocusOut(e,t,n){if(this._nodeMenuOpened||this.virtualScrollTreeView.viewItems.find(c=>c.itemKey===e)?.nativeElement.contains(t.relatedTarget||t.target))return;const i=this._getEditableNode();if(i){this._preventEventDefault(t),this.onNameEnter(i);return}!i&&this._flatItems.find(_=>_.id===e)?.isFavoriteToggleInProgress||n()}_processResetFocusState(e){const t=this._getEditableNode();t&&this.virtualScrollTreeView.focusedItemKey!==t.id&&(this.virtualScrollTreeView.focusedItemKey=t.id),e()}_isStrictCheckElementInViewport(e){return!this._getEditableNode()}_getFocusElement(e,t,n){const o=this._getEditableNode();return o?t.find(i=>i.itemKey===o.id)?.nativeElement:n()}_getFocusAction(e,t,n){return this._getEditableNode()?this._focusNodeNameInputDebounce.bind(this):n}_isKeyboardEventOnSameTargetElement(e){return e.target===e.currentTarget&&e.currentTarget instanceof HTMLElement}getClasses(){const e=super.getClasses()||[];return this.readonly&&e.push("crt-folder-tree-readonly"),e}getAddMenuItems(){return this._getAddFolderMenuItems(null)}getNodeMenuItems(e){const t=this._getAddFolderMenuItems(e),n={type:"action",icon:"edit-icon",caption:this._translate("MenuActions.RenameFolder"),code:"renameFolder",handler:this._renameItemNode.bind(this)},o={type:"action",icon:"copy-icon",caption:this._translate("MenuActions.CopyFolder"),code:"copyFolder",handler:this._copyItemNode.bind(this)},i={type:"action",icon:"move-folder",caption:this._translate("MenuActions.MoveFolder"),code:"moveFolder",handler:this._moveItemNode.bind(this)},c={type:"action",icon:"trash-icon",caption:this._translate("MenuActions.DeleteFolder"),code:"deleteFolder",handler:this._removeItemNode.bind(this)},_={type:"action",icon:"contact-lock-icon",caption:this._translate("MenuActions.ChangeFolderRights"),code:"changeFolderRights",handler:this._loadRightsModule.bind(this)},v={type:"action",icon:"convert-to-static-icon",caption:this._translate("MenuActions.ConvertToStaticFolder"),code:"convertToStaticFolder",visible:this.useStaticFolders,handler:this._convertToStaticFolder.bind(this)},y=this.isStaticNode(e)?[...t,n,i,c,_]:[...t,v,n,o,i,c,_],Oe=[n,c,_];return e.isFavorite?Oe:y}createOrEditFolderFilters(e){this._createOrEditFolderFilters(e)}onFolderTreeHideClick(){this._emitFolderTreeVisibleChanged()}onNameKeydown(e,t){e.key===S.Key.Enter&&this.onNameEnter(t)}addNewItem(e,t){this._addNewItem(e,t)}onNameEnter(e){this.virtualScrollTreeView.virtualScrollViewport.isVirtualFocusItemInFocus||this._folderNameEntering||(this._folderNameEntering=!0,this._processOnNameEnterDebounce(e))}onToggleFolderFavorite(e,t){const n=!(t.hasFavorite||t.isFavorite);t.isFavorite&&!n&&this._preventEventDefault(e),this._updateNodePropertyValue(t,"isFavoriteToggleInProgress",!0),n&&!this._expandedItems.includes(m.NQ)&&this._expandedItems.push(m.NQ),this._emitToggleFolderFavorite(t)}ngAfterViewInit(){this.isViewInitializing=!1}ngOnDestroy(){this._itemsSubscriptions$.unsubscribe(),this._favoriteItemsSubscriptions$.unsubscribe()}onMenuActionsClick(e){this._preventEventDefault(e)}treeNodeTrackerFn(e,t){return{id:t.key,name:t.item.name,parentId:t.parentKey,level:t.level,hasFavorite:t.item.hasFavorite,expandable:t.expandable,editable:t.item.editable,isCopy:t.item.isCopy,isMove:t.item.isMove}}onCloseMenu(){this._nodeMenuOpened=!1}onOpenMenu(){this._nodeMenuOpened=!0}onSearchFilterChanged(e){this._updateSearchFilterValue(e?.value)}onExpandedItemsChanged(e){this.isSearchApplied||this._updateExpandedItems(e)}onSelectedItemKeyChange(e){this._initSelectedNode(e)}static{this.\u0275fac=(()=>{let e;return function(n){return(e||(e=r.\u0275\u0275getInheritedFactory(te)))(n||te)}})()}static{this.\u0275cmp=r.\u0275\u0275defineComponent({type:te,selectors:[["crt-folder-tree"]],viewQuery:function(t,n){if(t&1&&(r.\u0275\u0275viewQuery(tt.o,5),r.\u0275\u0275viewQuery(et.j,5)),t&2){let o;r.\u0275\u0275queryRefresh(o=r.\u0275\u0275loadQuery())&&(n.virtualScrollTreeView=o.first),r.\u0275\u0275queryRefresh(o=r.\u0275\u0275loadQuery())&&(n.folderNameInput=o.first)}},hostVars:2,hostBindings:function(t,n){t&2&&r.\u0275\u0275styleProp("border-radius",n.hostBorderRadius)},inputs:{sourceSchemaName:"sourceSchemaName",rootSchemaName:"rootSchemaName",showMask:"showMask",minVisibleItemsCount:"minVisibleItemsCount",useStaticFolders:"useStaticFolders",sortingOrder:"sortingOrder",readonly:"readonly",items:"items",favoriteItems:"favoriteItems",activeFolderId:"activeFolderId",expandedItems:"expandedItems",borderRadius:"borderRadius"},outputs:{activeFolderChanged:"activeFolderChanged",folderTreeVisibleChanged:"folderTreeVisibleChanged",addFolder:"addFolder",copyFolder:"copyFolder",deleteFolder:"deleteFolder",moveFolder:"moveFolder",folderRenamed:"folderRenamed",folderFiltersUpdated:"folderFiltersUpdated",toggleFolderFavorite:"toggleFolderFavorite",folderTreeExpandedItemsChanged:"folderTreeExpandedItemsChanged",folderChangeRights:"folderChangeRights",convertToStaticFolder:"convertToStaticFolder"},features:[r.\u0275\u0275ProvidersFeature([D]),r.\u0275\u0275InheritDefinitionFeature],decls:3,vars:2,consts:[["folder_tree_template",""],["no_schema_root",""],["addMenu",""],["nodeMenu",""],[4,"ngIf","ngIfElse"],[1,"folder-tree-container",3,"ngClass"],["class","component-mask",4,"ngIf"],[1,"folder-tree-header"],["data-item-marker","folderTreeSearch",3,"valueChange"],[4,"ngIf"],[1,"close-tree-btn",3,"click","keydown.enter","crtAccessibleAttributes"],["svgIcon","close-icon"],[3,"ngClass"],["class","folder-tree-blankslate",4,"ngIf"],["itemKeyPropertyName","id","itemParentKeyPropertyName","parentId","itemExpandablePropertyName","expandable","itemLevelPropertyName","level",3,"expandedItemsChanged","selectedItemKeyChange","items","expandedItems","selectedItemKey","minVisibleItemsCount","treeNodeTrackerFn","processOnViewItemActionFn","isStrictCheckElementInViewportFn","getFocusElementFn","getFocusActionFn","onToggleNodeSelectedItemChangeFn"],["crtVirtualScrollTreeViewItemOutlet",""],[1,"component-mask"],[1,"new-folder-btn",3,"click","title"],["svgIcon","folder-add-icon"],[1,"new-folder-btn",3,"crtMenuTriggerFor","title"],[3,"menuItems"],[1,"folder-tree-blankslate"],[1,"blankslate-message"],[1,"crt-folder-tree-view-node"],[1,"prefix-node"],["svgIcon","star-filled-icon"],[1,"node-text"],[3,"svgIcon"],["class","suffix-node-sticky-container",4,"ngIf"],["labelPosition","hidden",1,"node-name-input",3,"blurred","keyDown","focusin","focusout","control"],[1,"suffix-node-sticky-container"],["class","suffix-node",4,"ngIf"],[1,"suffix-node"],[1,"node-menu-button","add-to-favorite",3,"click","id","title","disabled"],[1,"node-menu-icon",3,"svgIcon"],["class","node-menu-button",3,"id","title","click",4,"ngIf"],[1,"node-menu-button",3,"click","menuClosed","menuOpened","id","crtMenuTriggerFor","crtMenuTriggerData","title"],["svgIcon","more-vertical-button-icon",1,"node-menu-icon"],[1,"node-menu-button",3,"click","id","title"],["svgIcon","filter-column-icon",1,"node-menu-icon"],["title","","subhead","",3,"image"]],template:function(t,n){if(t&1&&r.\u0275\u0275template(0,At,1,0,"crt-skeleton-loader",4)(1,zt,3,2,"ng-template",null,0,r.\u0275\u0275templateRefExtractor),t&2){const o=r.\u0275\u0275reference(2);r.\u0275\u0275property("ngIf",n.isViewInitializing)("ngIfElse",o)}},dependencies:[A.NgClass,A.NgIf,St.W,W.MatIcon,ot.I,Tt.Q,it.IK,ae.O,et.j,wt.d,tt.o,Pt.c,je.X,P.TranslatePipe],styles:["[_nghost-%COMP%]{display:block;height:100%;background-color:unset;overflow:auto;transform:translateZ(0)}[_nghost-%COMP%]   .folder-tree-container[_ngcontent-%COMP%]{position:relative;display:inherit;width:inherit;height:inherit}[_nghost-%COMP%]   .folder-tree-container.crt-folder-tree-readonly[_ngcontent-%COMP%]   .folder-tree-header[_ngcontent-%COMP%]   button.close-tree-btn[_ngcontent-%COMP%]{margin-inline-start:auto}[_nghost-%COMP%]   .folder-tree-container[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{height:16px;width:16px;font-size:16px;line-height:16px}[_nghost-%COMP%]   .folder-tree-container[_ngcontent-%COMP%]   .folder-tree-header[_ngcontent-%COMP%]{height:40px;display:flex;justify-content:flex-start;align-items:center;padding-inline-start:24px;box-sizing:border-box}[_nghost-%COMP%]   .folder-tree-container[_ngcontent-%COMP%]   .folder-tree-header[_ngcontent-%COMP%]   crt-search-filter[_ngcontent-%COMP%]{padding:0}[_nghost-%COMP%]   .folder-tree-container[_ngcontent-%COMP%]   .folder-tree-header[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{border:none;background-color:inherit;display:flex;align-items:center;cursor:pointer;padding:0}[_nghost-%COMP%]   .folder-tree-container[_ngcontent-%COMP%]   .folder-tree-header[_ngcontent-%COMP%]   button.new-folder-btn[_ngcontent-%COMP%]{margin-inline-start:auto;margin-inline-end:8px}[_nghost-%COMP%]   .folder-tree-container[_ngcontent-%COMP%]   .folder-tree-header[_ngcontent-%COMP%]   button.new-folder-btn[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{margin-inline-end:4px}[_nghost-%COMP%]   .folder-tree-container[_ngcontent-%COMP%]   .folder-tree-header[_ngcontent-%COMP%]   button.close-tree-btn[_ngcontent-%COMP%]{margin:8px}[_nghost-%COMP%]   .folder-tree-container[_ngcontent-%COMP%]   .folder-tree[_ngcontent-%COMP%]{width:100%;height:calc(100% - 40px)}[_nghost-%COMP%]   .folder-tree-container[_ngcontent-%COMP%]   .folder-tree[_ngcontent-%COMP%]   .folder-tree-blankslate[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center}[_nghost-%COMP%]   .folder-tree-container[_ngcontent-%COMP%]   .folder-tree[_ngcontent-%COMP%]   .folder-tree-blankslate[_ngcontent-%COMP%]   .blankslate-message[_ngcontent-%COMP%]{padding:20px 0}[_nghost-%COMP%]   .folder-tree-container[_ngcontent-%COMP%]   .folder-tree[_ngcontent-%COMP%]   crt-virtual-scroll-tree-view[_ngcontent-%COMP%]   .crt-folder-tree-view-node[_ngcontent-%COMP%]{display:flex;flex-direction:row;width:100%;min-height:40px;white-space:nowrap;outline:none;align-items:center;flex:1;word-wrap:break-word}[_nghost-%COMP%]   .folder-tree-container[_ngcontent-%COMP%]   .folder-tree[_ngcontent-%COMP%]   crt-virtual-scroll-tree-view[_ngcontent-%COMP%]   .crt-folder-tree-view-node[_ngcontent-%COMP%]   .suffix-node-sticky-container[_ngcontent-%COMP%]{display:flex;flex-direction:row-reverse;width:100%}[_nghost-%COMP%]   .folder-tree-container[_ngcontent-%COMP%]   .folder-tree[_ngcontent-%COMP%]   crt-virtual-scroll-tree-view[_ngcontent-%COMP%]   .crt-folder-tree-view-node[_ngcontent-%COMP%]   .suffix-node-sticky-container[_ngcontent-%COMP%]   .suffix-node[_ngcontent-%COMP%]{display:flex;position:sticky;right:8px;left:8px}[_nghost-%COMP%]   .folder-tree-container[_ngcontent-%COMP%]   .folder-tree[_ngcontent-%COMP%]   crt-virtual-scroll-tree-view[_ngcontent-%COMP%]   .crt-folder-tree-view-node[_ngcontent-%COMP%]   .suffix-node-sticky-container[_ngcontent-%COMP%]   .suffix-node[_ngcontent-%COMP%]   .node-menu-button[_ngcontent-%COMP%]{padding:0;border:none;background-color:transparent;display:flex;align-items:center;justify-content:center;width:16px;height:16px;cursor:pointer;margin-inline-start:8px}[_nghost-%COMP%]   .folder-tree-container[_ngcontent-%COMP%]   .folder-tree[_ngcontent-%COMP%]   crt-virtual-scroll-tree-view[_ngcontent-%COMP%]   .crt-folder-tree-view-node[_ngcontent-%COMP%]   .suffix-node-sticky-container[_ngcontent-%COMP%]   .suffix-node[_ngcontent-%COMP%]   .node-menu-button[_ngcontent-%COMP%]:focus   .node-menu-icon[_ngcontent-%COMP%]{visibility:inherit}[_nghost-%COMP%]   .folder-tree-container[_ngcontent-%COMP%]   .folder-tree[_ngcontent-%COMP%]   crt-virtual-scroll-tree-view[_ngcontent-%COMP%]   .crt-folder-tree-view-node[_ngcontent-%COMP%]   .prefix-node[_ngcontent-%COMP%]{display:flex}[_nghost-%COMP%]   .folder-tree-container[_ngcontent-%COMP%]   .folder-tree[_ngcontent-%COMP%]   crt-virtual-scroll-tree-view[_ngcontent-%COMP%]   .crt-folder-tree-view-node[_ngcontent-%COMP%]   .node-text[_ngcontent-%COMP%]{width:-moz-fit-content;width:fit-content;padding-inline-start:8px}[_nghost-%COMP%]   .folder-tree-container[_ngcontent-%COMP%]   .folder-tree[_ngcontent-%COMP%]   crt-virtual-scroll-tree-view[_ngcontent-%COMP%]   .crt-folder-tree-view-node[_ngcontent-%COMP%]   .node-name-input[_ngcontent-%COMP%]{padding-top:6px}[_nghost-%COMP%]   .folder-tree-container[_ngcontent-%COMP%]   .folder-tree[_ngcontent-%COMP%]   crt-virtual-scroll-tree-view[_ngcontent-%COMP%]   .crt-folder-tree-view-node[_ngcontent-%COMP%]   .node-menu-icon[_ngcontent-%COMP%]{visibility:hidden}[_nghost-%COMP%]   .folder-tree-container[_ngcontent-%COMP%]   .folder-tree[_ngcontent-%COMP%]   crt-virtual-scroll-tree-view[_ngcontent-%COMP%]     .crt-tree-view-node{gap:unset}[_nghost-%COMP%]   .folder-tree-container[_ngcontent-%COMP%]   .folder-tree[_ngcontent-%COMP%]   crt-virtual-scroll-tree-view[_ngcontent-%COMP%]     .crt-tree-view-node.root-level-node{padding-inline-start:24px}[_nghost-%COMP%]   .folder-tree-container[_ngcontent-%COMP%]   .folder-tree[_ngcontent-%COMP%]   crt-virtual-scroll-tree-view[_ngcontent-%COMP%]     .crt-tree-view-node.dynamic-1-level-node{padding-inline-start:40px!important}[_nghost-%COMP%]   .folder-tree-container[_ngcontent-%COMP%]   .folder-tree[_ngcontent-%COMP%]   crt-virtual-scroll-tree-view[_ngcontent-%COMP%]     .crt-tree-view-node.dynamic-2-level-node{padding-inline-start:56px!important}[_nghost-%COMP%]   .folder-tree-container[_ngcontent-%COMP%]   .folder-tree[_ngcontent-%COMP%]   crt-virtual-scroll-tree-view[_ngcontent-%COMP%]     .crt-tree-view-node.dynamic-3-level-node{padding-inline-start:72px!important}[_nghost-%COMP%]   .folder-tree-container[_ngcontent-%COMP%]   .folder-tree[_ngcontent-%COMP%]   crt-virtual-scroll-tree-view[_ngcontent-%COMP%]     .crt-tree-view-node.dynamic-4-level-node{padding-inline-start:88px!important}[_nghost-%COMP%]   .folder-tree-container[_ngcontent-%COMP%]   .folder-tree[_ngcontent-%COMP%]   crt-virtual-scroll-tree-view[_ngcontent-%COMP%]     .crt-tree-view-node.dynamic-5-level-node{padding-inline-start:104px!important}[_nghost-%COMP%]   .folder-tree-container[_ngcontent-%COMP%]   .folder-tree[_ngcontent-%COMP%]   crt-virtual-scroll-tree-view[_ngcontent-%COMP%]     .crt-tree-view-node.dynamic-6-level-node{padding-inline-start:120px!important}[_nghost-%COMP%]   .folder-tree-container[_ngcontent-%COMP%]   .folder-tree[_ngcontent-%COMP%]   crt-virtual-scroll-tree-view[_ngcontent-%COMP%]     .crt-tree-view-node.dynamic-7-level-node{padding-inline-start:136px!important}[_nghost-%COMP%]   .folder-tree-container[_ngcontent-%COMP%]   .folder-tree[_ngcontent-%COMP%]   crt-virtual-scroll-tree-view[_ngcontent-%COMP%]     .crt-tree-view-node.dynamic-8-level-node{padding-inline-start:152px!important}[_nghost-%COMP%]   .folder-tree-container[_ngcontent-%COMP%]   .folder-tree[_ngcontent-%COMP%]   crt-virtual-scroll-tree-view[_ngcontent-%COMP%]     .crt-tree-view-node.dynamic-9-level-node{padding-inline-start:168px!important}[_nghost-%COMP%]   .folder-tree-container[_ngcontent-%COMP%]   .folder-tree[_ngcontent-%COMP%]   crt-virtual-scroll-tree-view[_ngcontent-%COMP%]     .crt-tree-view-node.dynamic-10-level-node{padding-inline-start:184px!important}[_nghost-%COMP%]   .folder-tree-container[_ngcontent-%COMP%]   .folder-tree[_ngcontent-%COMP%]   crt-virtual-scroll-tree-view[_ngcontent-%COMP%]     .crt-tree-view-node.dynamic-11-level-node{padding-inline-start:200px!important}[_nghost-%COMP%]   .folder-tree-container[_ngcontent-%COMP%]   .folder-tree[_ngcontent-%COMP%]   crt-virtual-scroll-tree-view[_ngcontent-%COMP%]     .crt-tree-view-node.dynamic-12-level-node{padding-inline-start:216px!important}[_nghost-%COMP%]   .folder-tree-container[_ngcontent-%COMP%]   .folder-tree[_ngcontent-%COMP%]   crt-virtual-scroll-tree-view[_ngcontent-%COMP%]     .crt-tree-view-node.dynamic-13-level-node{padding-inline-start:232px!important}[_nghost-%COMP%]   .folder-tree-container[_ngcontent-%COMP%]   .folder-tree[_ngcontent-%COMP%]   crt-virtual-scroll-tree-view[_ngcontent-%COMP%]     .crt-tree-view-node.dynamic-14-level-node{padding-inline-start:248px!important}[_nghost-%COMP%]   .folder-tree-container[_ngcontent-%COMP%]   .folder-tree[_ngcontent-%COMP%]   crt-virtual-scroll-tree-view[_ngcontent-%COMP%]     .crt-tree-view-node.dynamic-15-level-node{padding-inline-start:264px!important}[_nghost-%COMP%]   .folder-tree-container[_ngcontent-%COMP%]   .folder-tree[_ngcontent-%COMP%]   crt-virtual-scroll-tree-view[_ngcontent-%COMP%]     .crt-tree-view-node.dynamic-16-level-node{padding-inline-start:280px!important}[_nghost-%COMP%]   .folder-tree-container[_ngcontent-%COMP%]   .folder-tree[_ngcontent-%COMP%]   crt-virtual-scroll-tree-view[_ngcontent-%COMP%]     .crt-tree-view-node.dynamic-17-level-node{padding-inline-start:296px!important}[_nghost-%COMP%]   .folder-tree-container[_ngcontent-%COMP%]   .folder-tree[_ngcontent-%COMP%]   crt-virtual-scroll-tree-view[_ngcontent-%COMP%]     .crt-tree-view-node.dynamic-18-level-node{padding-inline-start:312px!important}[_nghost-%COMP%]   .folder-tree-container[_ngcontent-%COMP%]   .folder-tree[_ngcontent-%COMP%]   crt-virtual-scroll-tree-view[_ngcontent-%COMP%]     .crt-tree-view-node.dynamic-19-level-node{padding-inline-start:328px!important}[_nghost-%COMP%]   .folder-tree-container[_ngcontent-%COMP%]   .folder-tree[_ngcontent-%COMP%]   crt-virtual-scroll-tree-view[_ngcontent-%COMP%]     .crt-tree-view-node.dynamic-20-level-node{padding-inline-start:344px!important}[_nghost-%COMP%]   .folder-tree-container[_ngcontent-%COMP%]   .folder-tree[_ngcontent-%COMP%]   crt-virtual-scroll-tree-view[_ngcontent-%COMP%]     .crt-tree-view-node.dynamic-21-level-node{padding-inline-start:360px!important}[_nghost-%COMP%]   .folder-tree-container[_ngcontent-%COMP%]   .folder-tree[_ngcontent-%COMP%]   crt-virtual-scroll-tree-view[_ngcontent-%COMP%]     .crt-tree-view-node.dynamic-22-level-node{padding-inline-start:376px!important}[_nghost-%COMP%]   .folder-tree-container[_ngcontent-%COMP%]   .folder-tree[_ngcontent-%COMP%]   crt-virtual-scroll-tree-view[_ngcontent-%COMP%]     .crt-tree-view-node.dynamic-23-level-node{padding-inline-start:392px!important}[_nghost-%COMP%]   .folder-tree-container[_ngcontent-%COMP%]   .folder-tree[_ngcontent-%COMP%]   crt-virtual-scroll-tree-view[_ngcontent-%COMP%]     .crt-tree-view-node.dynamic-24-level-node{padding-inline-start:408px!important}[_nghost-%COMP%]   .folder-tree-container[_ngcontent-%COMP%]   .folder-tree[_ngcontent-%COMP%]   crt-virtual-scroll-tree-view[_ngcontent-%COMP%]     .crt-tree-view-node.dynamic-25-level-node{padding-inline-start:424px!important}[_nghost-%COMP%]   .folder-tree-container[_ngcontent-%COMP%]   .folder-tree[_ngcontent-%COMP%]   crt-virtual-scroll-tree-view[_ngcontent-%COMP%]     .crt-tree-view-node.dynamic-26-level-node{padding-inline-start:440px!important}[_nghost-%COMP%]   .folder-tree-container[_ngcontent-%COMP%]   .folder-tree[_ngcontent-%COMP%]   crt-virtual-scroll-tree-view[_ngcontent-%COMP%]     .crt-tree-view-node.dynamic-27-level-node{padding-inline-start:456px!important}[_nghost-%COMP%]   .folder-tree-container[_ngcontent-%COMP%]   .folder-tree[_ngcontent-%COMP%]   crt-virtual-scroll-tree-view[_ngcontent-%COMP%]     .crt-tree-view-node.dynamic-28-level-node{padding-inline-start:472px!important}[_nghost-%COMP%]   .folder-tree-container[_ngcontent-%COMP%]   .folder-tree[_ngcontent-%COMP%]   crt-virtual-scroll-tree-view[_ngcontent-%COMP%]     .crt-tree-view-node.dynamic-29-level-node{padding-inline-start:488px!important}[_nghost-%COMP%]   .folder-tree-container[_ngcontent-%COMP%]   .folder-tree[_ngcontent-%COMP%]   crt-virtual-scroll-tree-view[_ngcontent-%COMP%]     .crt-tree-view-node.dynamic-30-level-node{padding-inline-start:504px!important}[_nghost-%COMP%]   .folder-tree-container[_ngcontent-%COMP%]   .folder-tree[_ngcontent-%COMP%]   crt-virtual-scroll-tree-view[_ngcontent-%COMP%]     .crt-tree-view-node.child-node .prefix-node{margin-inline-start:16px}[_nghost-%COMP%]   .folder-tree-container[_ngcontent-%COMP%]   .folder-tree[_ngcontent-%COMP%]   crt-virtual-scroll-tree-view[_ngcontent-%COMP%]     .crt-tree-view-node:hover .crt-folder-tree-view-node .node-menu-icon, [_nghost-%COMP%]   .folder-tree-container[_ngcontent-%COMP%]   .folder-tree[_ngcontent-%COMP%]   crt-virtual-scroll-tree-view[_ngcontent-%COMP%]     .crt-tree-view-node.crt-virtual-scroll-view-item-focused .crt-folder-tree-view-node .node-menu-icon{visibility:unset}[_nghost-%COMP%]   .folder-tree-container[_ngcontent-%COMP%]   .folder-tree.crt-folder-tree-search-applied[_ngcontent-%COMP%]   crt-virtual-scroll-tree-view[_ngcontent-%COMP%]     .crt-tree-view-node .node-toggle-icon{cursor:default;pointer-events:none}"],changeDetection:0})}};(0,a.__decorate)([(0,F.k)(),(0,a.__metadata)("design:type",O.String),(0,a.__metadata)("design:paramtypes",[O.String])],p.prototype,"sourceSchemaName",null),(0,a.__decorate)([(0,F.k)(),(0,a.__metadata)("design:type",O.String),(0,a.__metadata)("design:paramtypes",[O.String])],p.prototype,"rootSchemaName",null),(0,a.__decorate)([(0,F.k)(),(0,a.__metadata)("design:type",Boolean),(0,a.__metadata)("design:paramtypes",[Boolean])],p.prototype,"showMask",null),(0,a.__decorate)([(0,F.k)(),(0,a.__metadata)("design:type",Object)],p.prototype,"minVisibleItemsCount",void 0),(0,a.__decorate)([(0,F.k)(),(0,a.__metadata)("design:type",Object)],p.prototype,"useStaticFolders",void 0),(0,a.__decorate)([(0,F.k)(),(0,a.__metadata)("design:type",Object)],p.prototype,"sortingOrder",void 0),(0,a.__decorate)([(0,F.k)({propertyBindable:!0,defaultValue:!1,propertyName:vt.R.Readonly}),(0,a.__metadata)("design:type",Object)],p.prototype,"readonly",void 0),(0,a.__decorate)([(0,F.k)(),(0,a.__metadata)("design:type",Object),(0,a.__metadata)("design:paramtypes",[Object])],p.prototype,"items",null),(0,a.__decorate)([(0,F.k)(),(0,a.__metadata)("design:type",Object),(0,a.__metadata)("design:paramtypes",[Object])],p.prototype,"favoriteItems",null),(0,a.__decorate)([(0,F.k)(),(0,a.__metadata)("design:type",O.String),(0,a.__metadata)("design:paramtypes",[O.String])],p.prototype,"activeFolderId",null),(0,a.__decorate)([(0,F.k)(),(0,a.__metadata)("design:type",Array),(0,a.__metadata)("design:paramtypes",[Array])],p.prototype,"expandedItems",null),(0,a.__decorate)([(0,F.k)(),(0,a.__metadata)("design:type",O.String),(0,a.__metadata)("design:paramtypes",[O.String])],p.prototype,"borderRadius",null),(0,a.__decorate)([(0,C.j)(),(0,a.__metadata)("design:type",Object)],p.prototype,"activeFolderChanged",void 0),(0,a.__decorate)([(0,C.j)(),(0,a.__metadata)("design:type",Object)],p.prototype,"folderTreeVisibleChanged",void 0),(0,a.__decorate)([(0,C.j)(),(0,a.__metadata)("design:type",Object)],p.prototype,"addFolder",void 0),(0,a.__decorate)([(0,C.j)(),(0,a.__metadata)("design:type",Object)],p.prototype,"copyFolder",void 0),(0,a.__decorate)([(0,C.j)(),(0,a.__metadata)("design:type",Object)],p.prototype,"deleteFolder",void 0),(0,a.__decorate)([(0,C.j)(),(0,a.__metadata)("design:type",Object)],p.prototype,"moveFolder",void 0),(0,a.__decorate)([(0,C.j)(),(0,a.__metadata)("design:type",Object)],p.prototype,"folderRenamed",void 0),(0,a.__decorate)([(0,C.j)(),(0,a.__metadata)("design:type",Object)],p.prototype,"folderFiltersUpdated",void 0),(0,a.__decorate)([(0,C.j)(),(0,a.__metadata)("design:type",Object)],p.prototype,"toggleFolderFavorite",void 0),(0,a.__decorate)([(0,C.j)(),(0,a.__metadata)("design:type",Object)],p.prototype,"folderTreeExpandedItemsChanged",void 0),(0,a.__decorate)([(0,C.j)(),(0,a.__metadata)("design:type",Object)],p.prototype,"folderChangeRights",void 0),(0,a.__decorate)([(0,C.j)(),(0,a.__metadata)("design:type",Object)],p.prototype,"convertToStaticFolder",void 0),p=(0,a.__decorate)([(0,Qe.v)({type:"crt.FolderTree",reuseStrategy:Je.B.Rerender}),(0,We.f)({toolbarConfig:{position:60,hint:"Components.FolderTree.Hint",icon:d(19010),defaultPropertyValues:{sourceSchemaName:m.uE}},designViewItemCommands:{create:"crt.AddFilterViewItemCommand",update:"crt.ChangeFolderTreeViewItemCommand",delete:"crt.RemoveFolderTreeViewItemCommand",copy:"crt.CopyFolderTreeViewItemCommand"},propertiesPanelComponentTypeName:"crt.FolderTreePropertiesPanel",typeCaption:"Components.FolderTree.Caption",viewElementGroupType:Xe.J.Components,placeholderSize:{height:"49px"}})],p);const Jt=["menuTrigger"],Wt=(l,e)=>({"crt-folder-tree-actions-container-disabled":l,"crt-folder-tree-actions-container-loading":e}),Xt=l=>({$implicit:l});function Yt(l,e){l&1&&(r.\u0275\u0275elementStart(0,"div",12),r.\u0275\u0275element(1,"div",13),r.\u0275\u0275elementEnd())}function qt(l,e){l&1&&r.\u0275\u0275element(0,"mat-icon",14)}function er(l,e){if(l&1){const t=r.\u0275\u0275getCurrentView();r.\u0275\u0275elementStart(0,"div",15),r.\u0275\u0275pipe(1,"translate"),r.\u0275\u0275pipe(2,"translate"),r.\u0275\u0275listener("click",function(){r.\u0275\u0275restoreView(t);const o=r.\u0275\u0275nextContext();return r.\u0275\u0275resetView(o.onClearFolderButtonClicked())})("keydown.enter",function(){r.\u0275\u0275restoreView(t);const o=r.\u0275\u0275nextContext();return r.\u0275\u0275resetView(o.onClearFolderButtonClicked())})("keydown.space",function(){r.\u0275\u0275restoreView(t);const o=r.\u0275\u0275nextContext();return r.\u0275\u0275resetView(o.onClearFolderButtonClicked())}),r.\u0275\u0275element(3,"mat-icon",16),r.\u0275\u0275elementEnd()}if(l&2){const t=r.\u0275\u0275nextContext();r.\u0275\u0275property("tabindex",t.getTabIndex())("title",r.\u0275\u0275pipeBind1(1,3,"FolderTreeActions.ClearButtonCaption")),r.\u0275\u0275attribute("aria-label",r.\u0275\u0275pipeBind1(2,5,"FolderTreeActions.ClearButtonCaption"))}}function tr(l,e){l&1&&r.\u0275\u0275element(0,"div",17)}function rr(l,e){if(l&1){const t=r.\u0275\u0275getCurrentView();r.\u0275\u0275elementStart(0,"div",18,1),r.\u0275\u0275pipe(2,"translate"),r.\u0275\u0275listener("keydown.enter",function(){r.\u0275\u0275restoreView(t);const o=r.\u0275\u0275nextContext();return r.\u0275\u0275resetView(o.onArrowButtonEnterPressed())})("keydown.space",function(){r.\u0275\u0275restoreView(t);const o=r.\u0275\u0275nextContext();return r.\u0275\u0275resetView(o.onArrowButtonEnterPressed())}),r.\u0275\u0275element(3,"mat-icon",19),r.\u0275\u0275elementEnd()}if(l&2){const t=r.\u0275\u0275nextContext(),n=r.\u0275\u0275reference(13);r.\u0275\u0275property("tabindex",t.getTabIndex())("crtMenuTriggerFor",n)("crtMenuTriggerData",r.\u0275\u0275pureFunction1(6,Xt,t.data)),r.\u0275\u0275attribute("aria-label",r.\u0275\u0275pipeBind1(2,4,"FolderTreeActions.FavoriteItemsMenuButtonAriaLabel"))}}let N=class xe extends rt.K{get _favoriteFolderTreeMenuItems(){return this._favoriteItems.map(e=>({type:"action",caption:e.name,icon:"star-filled-icon",code:e.id,handler:()=>this.activeFolderChanged.emit({id:e.id,name:e.name,filterData:e.filterData,folderTreeId:e.folderTreeId,folderTypeId:e.folderTypeId,isFavorite:!0})}))}set favoriteItems(e){e instanceof ie.A&&(this._favoriteItemsSubscriptions$.unsubscribe(),this._favoriteItemsSubscriptions$=new s.Subscription,this._favoriteItemsSubscriptions$.add(e.changed.subscribe(()=>{this._updateFavoriteItems(e)}))),this._updateFavoriteItems(e)}constructor(e){super(e),this._itemsSubscriptions$=new s.Subscription,this._favoriteItemsSubscriptions$=new s.Subscription,this._folderButtonCaption="",this._favoriteItems=[],this.skeletonStyles={height:"20px"},this.activeFolderChanged=new r.EventEmitter,this.folderTreeVisibleChanged=new r.EventEmitter,this.isFolderTreeDefined=()=>!!this.folderTree&&this.folderTree.length>0,this.isHasActiveFolder=()=>!!this.activeFolderId&&!!this.activeFolderName,this._initDependencies(e),this._folderButtonCaption=this._translate.instant("FolderTreeActions.MenuButton")}_initDependencies(e){this._translate=e.get(P.TranslateService)}_updateFavoriteItems(e){Promise.all((e??[]).map(function(){var t=(0,u.A)(function*(n){return{id:yield n.Id,name:yield n.Name,folderTreeId:yield n.FolderTreeId,filterData:yield n.FilterData,folderTypeId:yield n.FolderTypeId}});return function(n){return t.apply(this,arguments)}}())).then(t=>{this._favoriteItems=t,this.detectChanges()})}getFolderButtonCaption(){return this.isHasActiveFolder()?this.activeFolderName:this._folderButtonCaption}onFolderButtonClick(){this.folderTreeVisibleChanged.emit({togglePanel:!0})}getMenuItems(){return this._favoriteFolderTreeMenuItems}isFavoriteItemsEmpty(){return!this._favoriteItems||this._favoriteItems.length===0}onClearFolderButtonClicked(){this.activeFolderChanged.emit({id:"",name:"",folderTreeId:"",filterData:"{}",isFavorite:!1})}onArrowButtonEnterPressed(){this.menuTrigger.toggleMenu()}getTabIndex(){return this.isFolderTreeDefined()&&!this.loading?0:-1}ngOnDestroy(){this._itemsSubscriptions$.unsubscribe(),this._favoriteItemsSubscriptions$.unsubscribe()}static{this.\u0275fac=function(t){return new(t||xe)(r.\u0275\u0275directiveInject(r.Injector))}}static{this.\u0275cmp=r.\u0275\u0275defineComponent({type:xe,selectors:[["crt-folder-tree-actions"]],viewQuery:function(t,n){if(t&1&&r.\u0275\u0275viewQuery(Jt,5,ae.O),t&2){let o;r.\u0275\u0275queryRefresh(o=r.\u0275\u0275loadQuery())&&(n.menuTrigger=o.first)}},inputs:{folderTree:"folderTree",activeFolderId:"activeFolderId",activeFolderName:"activeFolderName",favoriteItems:"favoriteItems"},outputs:{activeFolderChanged:"activeFolderChanged",folderTreeVisibleChanged:"folderTreeVisibleChanged"},features:[r.\u0275\u0275InheritDefinitionFeature],decls:14,vars:18,consts:[["rowMenu",""],["menuTrigger",""],[1,"crt-folder-tree-actions-container",3,"ngClass"],[1,"crt-folder-tree-actions-folder-wrapper"],["role","button",1,"crt-folder-tree-actions-folder-button",3,"click","keydown.enter","keydown.space","tabindex","title"],["class","crt-folder-tree-actions-folder-button-loading-icon-wrap",4,"ngIf"],["svgIcon","folder-icon",4,"ngIf"],[1,"crt-folder-tree-actions-folder-button-caption"],["class","crt-folder-tree-actions-folder-clear-button","role","button",3,"tabindex","title","click","keydown.enter","keydown.space",4,"ngIf"],["class","crt-folder-tree-actions-divider",4,"ngIf"],["class","crt-folder-tree-actions-menu-trigger","role","button",3,"tabindex","crtMenuTriggerFor","crtMenuTriggerData","keydown.enter","keydown.space",4,"ngIf"],[3,"menuItems"],[1,"crt-folder-tree-actions-folder-button-loading-icon-wrap"],[1,"crt-folder-tree-actions-folder-button-loading-icon"],["svgIcon","folder-icon"],["role","button",1,"crt-folder-tree-actions-folder-clear-button",3,"click","keydown.enter","keydown.space","tabindex","title"],["svgIcon","small-close"],[1,"crt-folder-tree-actions-divider"],["role","button",1,"crt-folder-tree-actions-menu-trigger",3,"keydown.enter","keydown.space","tabindex","crtMenuTriggerFor","crtMenuTriggerData"],["svgIcon","caret-arrow"]],template:function(t,n){if(t&1){const o=r.\u0275\u0275getCurrentView();r.\u0275\u0275elementStart(0,"div",2)(1,"div",3)(2,"div",4),r.\u0275\u0275pipe(3,"translate"),r.\u0275\u0275pipe(4,"translate"),r.\u0275\u0275listener("click",function(){return r.\u0275\u0275restoreView(o),r.\u0275\u0275resetView(n.onFolderButtonClick())})("keydown.enter",function(){return r.\u0275\u0275restoreView(o),r.\u0275\u0275resetView(n.onFolderButtonClick())})("keydown.space",function(){return r.\u0275\u0275restoreView(o),r.\u0275\u0275resetView(n.onFolderButtonClick())}),r.\u0275\u0275template(5,Yt,2,0,"div",5)(6,qt,1,0,"mat-icon",6),r.\u0275\u0275elementStart(7,"span",7),r.\u0275\u0275text(8),r.\u0275\u0275elementEnd()(),r.\u0275\u0275template(9,er,4,7,"div",8),r.\u0275\u0275elementEnd(),r.\u0275\u0275template(10,tr,1,0,"div",9)(11,rr,4,8,"div",10),r.\u0275\u0275element(12,"crt-menu",11,0),r.\u0275\u0275elementEnd()}t&2&&(r.\u0275\u0275property("ngClass",r.\u0275\u0275pureFunction2(15,Wt,!n.isFolderTreeDefined(),n.loading)),r.\u0275\u0275advance(2),r.\u0275\u0275property("tabindex",n.getTabIndex())("title",r.\u0275\u0275pipeBind1(3,11,"FolderTreeActions.FolderButtonAriaLabel")),r.\u0275\u0275attribute("aria-label",r.\u0275\u0275pipeBind1(4,13,"FolderTreeActions.FolderButtonAriaLabel")),r.\u0275\u0275advance(3),r.\u0275\u0275property("ngIf",n.loading),r.\u0275\u0275advance(),r.\u0275\u0275property("ngIf",!n.loading),r.\u0275\u0275advance(2),r.\u0275\u0275textInterpolate(n.getFolderButtonCaption()),r.\u0275\u0275advance(),r.\u0275\u0275property("ngIf",n.isHasActiveFolder()),r.\u0275\u0275advance(),r.\u0275\u0275property("ngIf",!n.isFavoriteItemsEmpty()),r.\u0275\u0275advance(),r.\u0275\u0275property("ngIf",!n.isFavoriteItemsEmpty()),r.\u0275\u0275advance(),r.\u0275\u0275property("menuItems",n.getMenuItems()))},dependencies:[A.NgClass,A.NgIf,W.MatIcon,it.IK,ae.O,P.TranslatePipe],styles:[".crt-folder-tree-actions-container[_ngcontent-%COMP%]{display:flex;flex-wrap:nowrap;align-items:center;gap:4px;flex-direction:row;align-content:center;overflow:hidden;padding:1px}.crt-folder-tree-actions-container.crt-folder-tree-actions-container-disabled[_ngcontent-%COMP%]   .crt-folder-tree-actions-folder-wrapper[_ngcontent-%COMP%]   .crt-folder-tree-actions-folder-button[_ngcontent-%COMP%], .crt-folder-tree-actions-container.crt-folder-tree-actions-container-loading[_ngcontent-%COMP%]   .crt-folder-tree-actions-folder-wrapper[_ngcontent-%COMP%]   .crt-folder-tree-actions-folder-button[_ngcontent-%COMP%], .crt-folder-tree-actions-container.crt-folder-tree-actions-container-disabled[_ngcontent-%COMP%]   .crt-folder-tree-actions-folder-wrapper[_ngcontent-%COMP%]   .crt-folder-tree-actions-folder-clear-button[_ngcontent-%COMP%], .crt-folder-tree-actions-container.crt-folder-tree-actions-container-loading[_ngcontent-%COMP%]   .crt-folder-tree-actions-folder-wrapper[_ngcontent-%COMP%]   .crt-folder-tree-actions-folder-clear-button[_ngcontent-%COMP%], .crt-folder-tree-actions-container.crt-folder-tree-actions-container-disabled[_ngcontent-%COMP%]   .crt-folder-tree-actions-menu-trigger[_ngcontent-%COMP%], .crt-folder-tree-actions-container.crt-folder-tree-actions-container-loading[_ngcontent-%COMP%]   .crt-folder-tree-actions-menu-trigger[_ngcontent-%COMP%]{pointer-events:none}.crt-folder-tree-actions-container[_ngcontent-%COMP%]   .crt-folder-tree-actions-folder-wrapper[_ngcontent-%COMP%]{display:flex;flex-wrap:nowrap;align-items:center;gap:4px}.crt-folder-tree-actions-container[_ngcontent-%COMP%]   .crt-folder-tree-actions-folder-wrapper[_ngcontent-%COMP%]   .crt-folder-tree-actions-folder-button-loading-icon-wrap[_ngcontent-%COMP%]{display:flex;flex-wrap:nowrap;align-items:center;gap:4px;height:16px;width:16px;padding-inline-start:2px}.crt-folder-tree-actions-container[_ngcontent-%COMP%]   .crt-folder-tree-actions-folder-wrapper[_ngcontent-%COMP%]   .crt-folder-tree-actions-folder-button-loading-icon-wrap[_ngcontent-%COMP%]   .crt-folder-tree-actions-folder-button-loading-icon[_ngcontent-%COMP%]{height:8px;width:8px;border-width:2px;border-style:solid;border-left-color:transparent;border-right-color:transparent;border-bottom-color:transparent;border-radius:50%;animation:_ngcontent-%COMP%_loadingIconLoop .5s linear infinite}.crt-folder-tree-actions-container[_ngcontent-%COMP%]   .crt-folder-tree-actions-folder-wrapper[_ngcontent-%COMP%]   .crt-folder-tree-actions-folder-button[_ngcontent-%COMP%]{display:flex;flex-wrap:nowrap;align-items:center;gap:4px}.crt-folder-tree-actions-container[_ngcontent-%COMP%]   .crt-folder-tree-actions-folder-wrapper[_ngcontent-%COMP%]   .crt-folder-tree-actions-folder-button[_ngcontent-%COMP%]   .mat-icon[_ngcontent-%COMP%]{height:16px;width:16px}.crt-folder-tree-actions-container[_ngcontent-%COMP%]   .crt-folder-tree-actions-folder-wrapper[_ngcontent-%COMP%]   .crt-folder-tree-actions-folder-button[_ngcontent-%COMP%]:hover{cursor:pointer}.crt-folder-tree-actions-container[_ngcontent-%COMP%]   .crt-folder-tree-actions-folder-wrapper[_ngcontent-%COMP%]   .crt-folder-tree-actions-folder-button[_ngcontent-%COMP%]   .crt-folder-tree-actions-folder-button-caption[_ngcontent-%COMP%]{max-width:160px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.crt-folder-tree-actions-container[_ngcontent-%COMP%]   .crt-folder-tree-actions-folder-wrapper[_ngcontent-%COMP%]   .crt-folder-tree-actions-folder-clear-button[_ngcontent-%COMP%], .crt-folder-tree-actions-container[_ngcontent-%COMP%]   .crt-folder-tree-actions-folder-wrapper[_ngcontent-%COMP%]   .crt-folder-tree-actions-folder-clear-button[_ngcontent-%COMP%]   .mat-icon[_ngcontent-%COMP%]{height:16px;width:16px}.crt-folder-tree-actions-container[_ngcontent-%COMP%]   .crt-folder-tree-actions-folder-wrapper[_ngcontent-%COMP%]   .crt-folder-tree-actions-folder-clear-button[_ngcontent-%COMP%]:hover{cursor:pointer}.crt-folder-tree-actions-container[_ngcontent-%COMP%]   .crt-folder-tree-actions-divider[_ngcontent-%COMP%]{height:11px;width:0;border-left-width:1px;border-left-style:solid}.crt-folder-tree-actions-container[_ngcontent-%COMP%]   .crt-folder-tree-actions-menu-trigger[_ngcontent-%COMP%], .crt-folder-tree-actions-container[_ngcontent-%COMP%]   .crt-folder-tree-actions-menu-trigger[_ngcontent-%COMP%]   .mat-icon[_ngcontent-%COMP%]{height:16px;width:16px}.crt-folder-tree-actions-container[_ngcontent-%COMP%]   .crt-folder-tree-actions-menu-trigger[_ngcontent-%COMP%]:hover{cursor:pointer}@keyframes _ngcontent-%COMP%_loadingIconLoop{0%{transform:rotate(0)}to{transform:rotate(360deg)}}"],changeDetection:0})}};(0,a.__decorate)([(0,F.k)(),(0,a.__metadata)("design:type",String)],N.prototype,"folderTree",void 0),(0,a.__decorate)([(0,F.k)(),(0,a.__metadata)("design:type",String)],N.prototype,"activeFolderId",void 0),(0,a.__decorate)([(0,F.k)(),(0,a.__metadata)("design:type",String)],N.prototype,"activeFolderName",void 0),(0,a.__decorate)([(0,C.j)(),(0,a.__metadata)("design:type",Object)],N.prototype,"activeFolderChanged",void 0),(0,a.__decorate)([(0,C.j)(),(0,a.__metadata)("design:type",Object)],N.prototype,"folderTreeVisibleChanged",void 0),(0,a.__decorate)([(0,F.k)(),(0,a.__metadata)("design:type",Object),(0,a.__metadata)("design:paramtypes",[Object])],N.prototype,"favoriteItems",null),N=(0,a.__decorate)([(0,Qe.v)({type:"crt.FolderTreeActions",reuseStrategy:Je.B.Reuse}),(0,We.f)({toolbarConfig:{position:50,hint:"Components.FolderTreeActions.Hint",icon:d(41456),defaultPropertyValues:{folderTree:null}},propertiesPanelComponentTypeName:"crt.FolderTreeActionsPropertiesPanel",viewElementGroupType:Xe.J.Components,typeCaption:"Components.FolderTreeActions.Caption",placeholderSize:{height:"18px"}}),(0,a.__metadata)("design:paramtypes",[r.Injector])],N);var nr=d(4164);let de=class{convert([e,t]){return(0,j.gZ)(e)?null:Promise.resolve(t)}};de=(0,a.__decorate)([(0,nr.a)({type:"crt.FolderTreeActiveFilterAttributeConverter"})],de);var w=d(41287),M=d(844),or=d(97229),h=d(7240),ir=d(13111);class x{constructor(e){this._schemaPartsService=e}_saveToProfile(e,t){var n=this;return(0,u.A)(function*(){yield n._schemaPartsService.apply(function(){var o=(0,u.A)(function*([i]){i.setViewModelAttribute(e,t)});return function(i){return o.apply(this,arguments)}}()),yield n._schemaPartsService.commit()})()}setFolderTreeExpandedItems(e,t){var n=this;return(0,u.A)(function*(){const{expandedItemsAttrName:o}=(0,h.Z)(e),i={value:t};yield n._saveToProfile(o,i)})()}setFolderTreeVisibleState(e,t){var n=this;return(0,u.A)(function*(){const{visibleAttrName:o}=(0,h.Z)(e),i={value:t};yield n._saveToProfile(o,i)})()}setFolderTreeSelectedNode(e){var t=this;return(0,u.A)(function*(){const{folderTreeName:n,id:o,activeFolderFolderTreeId:i,isFavorite:c}=e,{activeFolderIdAttrName:_,activeFolderFavoriteStateAttrName:v,activeFolderFolderTreeIdAttrName:y}=(0,h.Z)(n);yield t._schemaPartsService.apply(function(){var Oe=(0,u.A)(function*([ee]){ee.setViewModelAttribute(_,{value:o}),ee.setViewModelAttribute(y,{value:i}),ee.setViewModelAttribute(v,{value:c})});return function(ee){return Oe.apply(this,arguments)}}()),yield t._schemaPartsService.commit()})()}static{this.\u0275fac=function(t){return new(t||x)(r.\u0275\u0275inject(ir.N))}}static{this.\u0275prov=r.\u0275\u0275defineInjectable({token:x,factory:x.\u0275fac,providedIn:"root"})}}let le=class extends w.l{constructor(e,t){super(),this._folderTreeUserProfileService=e,this._dataGridActiveFolderDesignSettingsApplier=t}_isNeedSaveToProfile(e){const t=e.$context,{activeFolderIdAttrName:n}=(0,h.Z)(e.folderTreeName),o=this._prepareFolderId(t.attributes[n]),i=this._prepareFolderId(e.id);return o!==i}_prepareFolderId(e){return e||""}_updateViewModel(e){var t=this;return(0,u.A)(function*(){const n=e.$context,o=(0,h.Z)(e.folderTreeName),i=yield t._getFolderFilter(e);return(0,s.lastValueFrom)(n.setValue({[e.activeFolderIdAttrName??o.activeFolderIdAttrName]:e.id,[o.activeFolderFolderTreeIdAttrName]:e.folderTreeId,[e.activeFolderNameAttrName??o.activeFolderNameAttrName]:e.name,[o.activeFolderFilterDataAttrName]:i,[e.activeFolderFavoriteStateAttrName??o.activeFolderFavoriteStateAttrName]:e.isFavorite}),{defaultValue:null})})()}_getFolderFilter(e){return(0,f.$K)(e.folderTypeId)?(0,f.po)(e.folderTreeId,e.rootSchemaName):Promise.resolve(e.filterData)}handle(e){var t=this;return(0,u.A)(function*(){return t._isNeedSaveToProfile(e)&&(yield t._folderTreeUserProfileService.setFolderTreeSelectedNode({folderTreeName:e.folderTreeName,id:e.id,activeFolderFolderTreeId:e.folderTreeId,isFavorite:e.isFavorite})),yield t._dataGridActiveFolderDesignSettingsApplier.apply(e),t._updateViewModel(e)})()}};le=(0,a.__decorate)([(0,M.l)({type:"crt.FolderTreeActiveFolderChangedHandler",requestType:"crt.FolderTreeActiveFolderChangedRequest"}),(0,a.__metadata)("design:paramtypes",[x,or.T])],le);var k=d(51406),dt=d(82517),I=d(36486);class T{constructor(e,t){this._ngZone=e,this._dialogService=t}_handleError(e,t,n){const o=n.process({type:"crt.FolderTreeActiveFolderChangedRequest",folderTreeName:t.folderTreeName,$context:t.$context});return this._ngZone.run(()=>this._dialogService.openInfoDialog(e.message)).pipe((0,I.switchMap)(()=>o),(0,I.switchMap)(()=>this._setShowMask(!1,t)),(0,I.switchMap)(()=>(0,s.of)({success:!1})))}_setShowMask(e,t){const n=t.$context,{showMaskAttrName:o}=(0,h.Z)(t.folderTreeName);return n.setValue({[o]:e})}_getErrorMessage(e){const t=e.errorInfo;return e.message||((0,g.isString)(t)?t:t.message)}_reloadFavoritesDataSource(e){if(!e.reloadFavorites)return(0,s.of)({});const t=e.$context,{favoriteItemsAttrName:n}=(0,h.Z)(e.folderTreeName),o=t.getBoundDataSourceNameByAttributePath(n);return t.load(o,[],{loadType:dt.I.Reload})}handle(e,t,n){return(0,s.lastValueFrom)(this._setShowMask(!0,t).pipe((0,I.switchMap)(()=>e),(0,I.switchMap)(o=>this._reloadFavoritesDataSource(t).pipe((0,I.map)(()=>o))),(0,I.switchMap)(o=>o.success?this._setShowMask(!1,t):(0,s.throwError)(()=>new Error(this._getErrorMessage(o)))),(0,I.switchMap)(()=>(0,s.of)({success:!0})),(0,I.catchError)(o=>this._handleError(o,t,n))))}static{this.\u0275fac=function(t){return new(t||T)(r.\u0275\u0275inject(r.NgZone),r.\u0275\u0275inject(Ye.o))}}static{this.\u0275prov=r.\u0275\u0275defineInjectable({token:T,factory:T.\u0275fac,providedIn:"any"})}}class lt extends w.l{constructor(e){super(),this.folderTreeModelRequestService=e.get(T)}insertModel(e){return k.K.create(e.sourceSchemaName).pipe((0,s.switchMap)(t=>{let n={Id:e.folderId,Name:e.folderName,Parent:e.parentId};return(0,f.SK)(e.sourceSchemaName)?n={...n,FolderType:e.folderTypeId||m.Ss,SearchData:e.filterData}:n={...n,EntitySchemaName:e.rootSchemaName,FilterData:e.filterData},t.insert(n)}))}}let se=class re extends lt{constructor(e){super(e)}handle(e){return this.folderTreeModelRequestService.handle(this.insertModel(e),e,this.handlerChain)}static{this.\u0275fac=function(t){return new(t||re)(r.\u0275\u0275inject(r.Injector))}}static{this.\u0275prov=r.\u0275\u0275defineInjectable({token:re,factory:re.\u0275fac,providedIn:"any"})}};se=(0,a.__decorate)([(0,M.l)({type:"crt.FolderTreeAddFolderDataHandler",requestType:"crt.AddFolderDataRequest"}),(0,a.__metadata)("design:paramtypes",[r.Injector])],se);var L=d(65288),ar=d(63721),st=d(23092),ce=d(26594);class b{constructor(){this._userInfo=(0,r.inject)(st.oq),this._featureValues=(0,r.inject)(ce.G),this._httpClient=(0,r.inject)(ar.HttpClient),this._translateService=(0,r.inject)(P.TranslateService),this._serviceEndpoint=(this._userInfo.isSSP?"ssp/":"")+"rest/FolderManagerService/"}_asyncConvert(e){return this._callService("ConvertToStaticFolder",{newFolderId:e.newFolderId,parentFolderId:e.parentFolderId,entitySchemaName:e.rootSchemaName}).pipe((0,s.map)(t=>(t?.success&&(t.additionalNotification=this._translateService.instant("StaticFolderConvertor.AsyncConvertMessage")),t)))}_convert(e){return this._callService("ConvertFolder",{newFolderId:e.newFolderId,parentFolderId:e.parentFolderId,entitySchemaName:e.rootSchemaName}).pipe((0,s.map)(t=>((0,g.isEmpty)(t)&&(t={success:!0}),t)))}_deleteFolders(e){return this._callService("DeleteFolder",{sourceSchemaName:e.sourceSchemaName,records:e.folderIds})}_callService(e,t){const n=`${this._serviceEndpoint}${e}`,o=`${e}Result`;return this._httpClient.post(n,t).pipe((0,s.map)(i=>this._getServiceResultFromResponse(i,o)),(0,s.catchError)(i=>this._catchHttpErrorResponse(i)))}_getServiceResultFromResponse(e,t){return t in(e||{})?e[t]:e}_catchHttpErrorResponse(e){return(0,s.of)({success:!1,errorInfo:{message:e.error?.errorInfo?.message??e.message}})}convertToStatic(e){return this._featureValues.ConvertDynamicToStaticFolderByChunk?this._asyncConvert(e):this._convert(e)}deleteFolders(e){return this._deleteFolders(e)}static{this.\u0275fac=function(t){return new(t||b)}}static{this.\u0275prov=r.\u0275\u0275defineInjectable({token:b,factory:b.\u0275fac})}}let me=class extends w.l{constructor(e){super(),this._folderTreeModelRequestService=e.get(T),this._folderManagerService=e.get(b)}_createDeleteFolderRequest(e){return(0,f.SK)(e.sourceSchemaName)?this._createDeleteOldFolderRequest(e):this._createDeleteNewFolderRequest(e)}_createDeleteOldFolderRequest(e){return this._folderManagerService.deleteFolders({sourceSchemaName:e.sourceSchemaName,folderIds:[e.folderId]}).pipe((0,s.map)(t=>({success:t.success,errorInfo:t.errorInfo?.message,rowsAffected:t.success?1:0})))}_createDeleteNewFolderRequest(e){return e.$context.delete(e.dataSourceName,[{type:L.E.PrimaryColumnValue,value:e.folderId}])}_removeFolderFromItemViewModel(e){return(0,u.A)(function*(){if(!e.folderId)return Promise.resolve();const t=e.$context,{itemsAttrName:n}=(0,h.Z)(e.folderTreeName),o=yield t[n],i=yield o.findByPrimaryAttribute(e.folderId);return i?o.remove(i):Promise.resolve()})()}_createDeleteFolderRequestWithUpdateViewModel(e){return this._createDeleteFolderRequest(e).pipe((0,s.switchMap)(t=>t.success?(0,s.from)(this._removeFolderFromItemViewModel(e)).pipe((0,s.map)(()=>t)):(0,s.of)(t)))}handle(e){return this._folderTreeModelRequestService.handle(this._createDeleteFolderRequestWithUpdateViewModel(e),e,this.handlerChain)}};me=(0,a.__decorate)([(0,M.l)({type:"crt.FolderTreeDeleteFolderDataHandler",requestType:"crt.DeleteFolderDataRequest"}),(0,a.__metadata)("design:paramtypes",[r.Injector])],me);let ue=class extends w.l{constructor(e){super(),this._folderTreeUserProfileService=e,this._systemFolderIds=[m.EM,m.NQ]}_isNeedSaveToProfile(e){const t=e.$context,{expandedItemsAttrName:n}=(0,h.Z)(e.folderTreeName);let o=t.attributes[n];o=this._prepareExpandedItems(o);const i=this._prepareExpandedItems(e.expandedItems);return!(0,g.isEqual)(o,i)}_saveToProfile(e){const t=[...this._systemFolderIds,...this._prepareExpandedItems(e.expandedItems)];return this._folderTreeUserProfileService.setFolderTreeExpandedItems(e.folderTreeName,t)}_prepareExpandedItems(e){return(0,g.uniq)(e?.filter(t=>!this._systemFolderIds.includes(t))||[])}handle(e){var t=this;return(0,u.A)(function*(){t._isNeedSaveToProfile(e)&&(yield t._saveToProfile(e));const n=(0,h.Z)(e.folderTreeName),o=e.$context;return(0,s.firstValueFrom)(o.setValue({[n.expandedItemsAttrName]:e.expandedItems}))})()}};ue=(0,a.__decorate)([(0,M.l)({type:"crt.FolderTreeExpandedItemsHandler",requestType:"crt.FolderTreeExpandedItemsRequest"}),(0,a.__metadata)("design:paramtypes",[x])],ue);let _e=class extends w.l{constructor(e){super(),this._folderTreeModelRequestService=e.get(T)}_createMoveFolderRequest(e){return k.K.create(e.sourceSchemaName).pipe((0,s.switchMap)(t=>t.update({Parent:e.parentId},[{type:L.E.PrimaryColumnValue,value:e.folderId}])))}handle(e){return this._folderTreeModelRequestService.handle(this._createMoveFolderRequest(e),e,this.handlerChain)}};_e=(0,a.__decorate)([(0,M.l)({type:"crt.FolderTreeMoveRequest",requestType:"crt.FolderTreeMoveRequest"}),(0,a.__metadata)("design:paramtypes",[r.Injector])],_e);let he=class extends w.l{constructor(e){super(),this._folderTreeModelRequestService=e.get(T)}_createUpdateRequest(e){return this._createUpdateFolderModelRequest(e).pipe((0,s.switchMap)(t=>t.success?this._updateActiveFolderNameIfNeed(e).pipe((0,s.map)(()=>t)):(0,s.of)(t)))}_createUpdateFolderModelRequest(e){return k.K.create(e.sourceSchemaName).pipe((0,s.switchMap)(t=>t.update({Name:e.folderName},[{type:L.E.PrimaryColumnValue,value:e.folderId}])))}_updateActiveFolderNameIfNeed(e){const t=(0,h.Z)(e.folderTreeName),n=e.$context;return(0,s.from)(n[t.activeFolderFolderTreeIdAttrName]).pipe((0,s.switchMap)(o=>o!==e.folderId?(0,s.of)(null):n.setValue({[t.activeFolderNameAttrName]:e.folderName})))}handle(e){return this._folderTreeModelRequestService.handle(this._createUpdateRequest(e),e,this.handlerChain)}};he=(0,a.__decorate)([(0,M.l)({type:"crt.FolderTreeRenameHandler",requestType:"crt.FolderTreeRenameRequest"}),(0,a.__metadata)("design:paramtypes",[r.Injector])],he);var dr=d(48899);let pe=class extends w.l{_getEntitySchemaUId(e){return this._entitySchemaService.getEntitySchemaByName(e).pipe((0,I.map)(t=>t.entitySchema.uId))}_insertFolder(e,t){return this._getDtoForInsert(e).pipe((0,s.switchMap)(n=>t.insert(n)))}_getDtoForInsert(e){return(0,f.SK)(e.sourceSchemaName)?this._getEntitySchemaUId(e.sourceSchemaName).pipe((0,I.map)(t=>({FolderId:e.id,FolderEntitySchemaUId:t}))):(0,s.of)({FolderTree:e.id,EntitySchemaName:e.rootSchemaName})}_deleteFolder(e,t){return t.delete([{type:L.E.PrimaryColumnValue,value:e.favoriteId}])}constructor(e){super(),this._injector=e,this._entitySchemaService=this._injector.get(dr.e),this._folderTreeModelRequestService=this._injector.get(T)}_createToggleFavoriteFolderModelRequest(e){const t=(0,f.SK)(e.sourceSchemaName)?m.hc:m.J8;return k.K.create(t).pipe((0,s.switchMap)(n=>e.status?this._insertFolder(e,n):this._deleteFolder(e,n)))}handle(e){return this._folderTreeModelRequestService.handle(this._createToggleFavoriteFolderModelRequest(e),e,this.handlerChain)}};pe=(0,a.__decorate)([(0,M.l)({type:"crt.ToggleFolderFavoriteHandler",requestType:"crt.ToggleFolderFavoriteRequest"}),(0,a.__metadata)("design:paramtypes",[r.Injector])],pe);let fe=class extends w.l{constructor(e){super(),this._folderTreeModelRequestService=e.get(T)}_createUpdateFolderTreeModelRequest(e){let t={};return(0,f.SK)(e.sourceSchemaName)?t={SearchData:e.filterData}:t={FilterData:e.filterData},k.K.create(e.sourceSchemaName).pipe((0,s.switchMap)(n=>n.update(t,[{type:L.E.PrimaryColumnValue,value:e.folderId}])),(0,s.mergeMap)(n=>n?.success?(0,s.from)(this._updateFilterData(e).then(()=>n)):(0,s.of)(n)))}_updateFilterData(e){return(0,u.A)(function*(){const t=e.$context,n=(0,h.Z)(e.folderTreeName);yield(0,s.lastValueFrom)(t.setValue({[n.activeFolderFilterDataAttrName]:e.filterData}),{defaultValue:null})})()}handle(e){return this._folderTreeModelRequestService.handle(this._createUpdateFolderTreeModelRequest(e),e,this.handlerChain)}};fe=(0,a.__decorate)([(0,M.l)({type:"crt.FolderTreeUpdateFiltersHandler",requestType:"crt.FolderTreeUpdateFiltersRequest"}),(0,a.__metadata)("design:paramtypes",[r.Injector])],fe);let ge=class extends w.l{constructor(e){super(),this._folderTreeUserProfileService=e}_getIsIsFolderTreeVisible(e,t){return(0,u.A)(function*(){const n=e.$context;let o=e.visible;if(e.togglePanel){let i=yield n[t];i=(0,g.isNil)(i)?!1:i,o=!i}return o})()}_setFolderTreeVisible(e,t,n,o){var i=this;return(0,u.A)(function*(){return yield i._folderTreeUserProfileService.setFolderTreeVisibleState(o,t),e.set(n,t)})()}handle(e){var t=this;return(0,u.A)(function*(){const n=e.$context,{visibleAttrName:o}=(0,h.Z)(e.folderTreeName),i=yield t._getIsIsFolderTreeVisible(e,o);return t._setFolderTreeVisible(n,i,o,e.folderTreeName)})()}};ge=(0,a.__decorate)([(0,M.l)({type:"crt.FolderTreeVisibleHandler",requestType:"crt.FolderTreeVisibleRequest"}),(0,a.__metadata)("design:paramtypes",[x])],ge);var lr=d(63438);let ve=class ne extends lt{constructor(e){super(e),this._rightsService=e.get(qe.f),this._folderTreeRelatedElementConfigsRepository=e.get(lr.x),this._featureValues=e.get(ce.G)}_copyRelatedElementConfigs(e,t){return!t||this._featureValues.DisableDataGridSettingsByFolders?(0,s.of)({success:!1}):this._folderTreeRelatedElementConfigsRepository.copy(e,t)}_copyRights(e){return!e.copyRights||!e.folderId?(0,s.of)({}):this._rightsService.copyRights({schemaName:e.sourceSchemaName,sourceId:e.sourceId,targetId:e.folderId,options:{overwrite:!1}})}_revertRelatedElementConfigs(e){return(0,s.lastValueFrom)(this._folderTreeRelatedElementConfigsRepository.delete({folderId:e.folderId}))}_createCopyFolderModelRequest(e){return this._copyRelatedElementConfigs(e.sourceId,e.folderId).pipe((0,I.switchMap)(()=>this.insertModel(e)),(0,I.switchMap)(t=>this._copyRights(e).pipe((0,I.map)(()=>t))))}handle(e){var t=this;return(0,u.A)(function*(){const n=yield t.folderTreeModelRequestService.handle(t._createCopyFolderModelRequest(e),e,t.handlerChain);return n.success||(yield t._revertRelatedElementConfigs(e)),Promise.resolve(n)})()}static{this.\u0275fac=function(t){return new(t||ne)(r.\u0275\u0275inject(r.Injector))}}static{this.\u0275prov=r.\u0275\u0275defineInjectable({token:ne,factory:ne.\u0275fac})}};ve=(0,a.__decorate)([(0,M.l)({type:"crt.FolderTreeCopyFolderDataHandler",requestType:"crt.CopyFolderDataRequest"}),(0,a.__metadata)("design:paramtypes",[r.Injector])],ve);var sr=d(40968),ct=d(22592),mt=d(6503),cr=d(99298);let Fe=class oe extends w.l{constructor(e,t,n){super(),this._folderManagerService=e,this._notifyService=t,this._maskService=n}_addNewFolder(e){return this.handlerChain.process({...e,type:"crt.AddFolderDataRequest"})}_convert(e){return this._showLoadingMask(e),(0,s.lastValueFrom)(this._folderManagerService.convertToStatic({newFolderId:e.folderId,parentFolderId:e.parentId,rootSchemaName:e.rootSchemaName}).pipe((0,s.tap)(()=>this._hideLoadingMask(e))))}_showLoadingMask(e){this._maskService.showMask(this._getTaskName(e.rootSchemaName),e.$context)}_hideLoadingMask(e){this._maskService.hideMask(this._getTaskName(e.rootSchemaName),e.$context)}_getTaskName(e){return`ConvertToStaticFolder_${e}`}_notify(e){let t="";if(e.success&&e.additionalNotification)t=e.additionalNotification;else if(!e.success)t=e.errorInfo?.message;else return;this._notifyService.show({message:t})}handle(e){var t=this;return(0,u.A)(function*(){if(!(yield t._addNewFolder(e)).success)return;const o=yield t._convert(e);return t._notify(o),o})()}static{this.\u0275fac=function(t){return new(t||oe)(r.\u0275\u0275inject(b),r.\u0275\u0275inject(mt.F),r.\u0275\u0275inject(ct.s))}}static{this.\u0275prov=r.\u0275\u0275defineInjectable({token:oe,factory:oe.\u0275fac})}};Fe=(0,a.__decorate)([(0,M.l)({type:"crt.FolderTreeConvertToStaticFolderHandler",requestType:"crt.ConvertToStaticFolderRequest"}),(0,a.__param)(2,(0,sr.j)(cr.V)),(0,a.__metadata)("design:paramtypes",[b,mt.F,ct.s])],Fe);var Y=d(41108),U=d(58504),mr=d(10278),Ce=d(81159);class E extends Ce.W{constructor(){super(...arguments),this.relatedInMainRecordsServiceName="StaticFolderService",this.relatedRecordsActionsNames=new Map([[Ce.m.AddRelatedRecords,"AddRecords"],[Ce.m.RemoveRelatedRecords,"RemoveRecords"]])}createRequest(e,t,n){return{recordsEsqSerialized:JSON.stringify(e.getMetadata()),foldersEsqSerialized:JSON.stringify(t.getMetadata()),recordInFolderRecordsSchemaName:n.relatedInMainRecordsSchemaName,recordColumnName:n.relatedRecordColumnName,folderColumnName:n.mainRecordColumnName,defaultValues:n.defaultValues?JSON.stringify(n.defaultValues):null}}static{this.\u0275fac=(()=>{let e;return function(n){return(e||(e=r.\u0275\u0275getInheritedFactory(E)))(n||E)}})()}static{this.\u0275prov=r.\u0275\u0275defineInjectable({token:E,factory:E.\u0275fac})}}class ut extends mr.l{get invalidErrorMessageForSelectRecordsValidator(){return`InfoDialog.RecordsInStaticFolders.SelectRecordsTo${this.openLookupPageMode}Message`}constructor(e){super(e),this.injector=e,this.baseRelatedInMainRecordsService=e.get(E)}_updateStaticFolderDataSource(e){var t=this;if(!e.$context.isDataSourceForCollection(e.dataSourceName))return;const o={type:"crt.LoadDataRequest",$context:e.$context,dataSourceName:e.dataSourceName,config:{loadType:dt.I.Reload}};setTimeout((0,u.A)(function*(){yield t.handlerChain.process(o)}))}showSuccessNotification(e,t){super.showSuccessNotification(e,t),this._updateStaticFolderDataSource(e)}createServiceData(e,t){const n=this.getRelatedRecordsSchemaName(e);return{relatedRecordsSchemaName:n,relatedRecordColumnName:this._oldInFolderColumnSchemaName,relatedRecordsFilters:e.filters,relatedInMainRecordsSchemaName:(0,f.sh)(n),mainRecordsSchemaName:(0,f.dn)(n),mainRecordColumnName:m.lb,mainRecordsFilters:t}}getLookupPageEntitySchemaName(e){const t=e.$context.dataSchemas[e.dataSourceName]?.name;return(0,f.dn)(t)}getLookupPageCaption(e){}getLookupPageFilter(e){const t=new Y.X;return t.addSchemaColumnFilterWithParameter(U.H.Equal,"FolderType",m.Xi,"StaticFolderTypeFilter"),t}getMaskTaskName(e){return`RecordsInStaticFolders_${this.getRelatedRecordsSchemaName(e)}`}initializeData(e){var t=this;return(0,u.A)(function*(){const n=t.getRelatedRecordsSchemaName(e);t._oldInFolderColumnSchemaName=yield(0,f.d8)(n)})()}}let Ie=class extends ut{constructor(e){super(e),this._injector=e,this.openLookupPageMode="AddRecords"}};Ie=(0,a.__decorate)([(0,M.l)({requestType:"crt.AddRecordsInStaticFoldersRequest",type:"crt.AddRecordsInStaticFoldersHandler"}),(0,a.__metadata)("design:paramtypes",[r.Injector])],Ie);let ye=class extends ut{constructor(e){super(e),this._injector=e,this.openLookupPageMode="RemoveRecords"}};ye=(0,a.__decorate)([(0,M.l)({requestType:"crt.RemoveRecordsInStaticFoldersRequest",type:"crt.RemoveRecordsInStaticFoldersHandler"}),(0,a.__metadata)("design:paramtypes",[r.Injector])],ye);var Me=d(56267),Ne=d(73335),Se=d(5704),Te=d(29025),we=d(53163),ur=d(86464),Pe=d(74368),_r=d(16319),hr=d(65967);class Z{getAllowedEntitySchemaNames(){return this._dataLoading$?this._dataLoading$:this._dataLoading$=k.K.create("FolderTreeStaticFolderSchemas").pipe((0,s.switchMap)(e=>e.load({attributes:["EntitySchemaName"]})),(0,s.map)(e=>e.map(t=>t.EntitySchemaName)),(0,s.shareReplay)({bufferSize:1,refCount:!1}))}isEnabled(e){return this.getAllowedEntitySchemaNames().pipe((0,s.map)(t=>t.includes(e)))}static{this.\u0275fac=function(t){return new(t||Z)}}static{this.\u0275prov=r.\u0275\u0275defineInjectable({token:Z,factory:Z.\u0275fac,providedIn:"root"})}}var _t=d(25096);class G{_getColumns(e){const t=["Id","Name"],n=(0,f.ic)(e);return t.push(n),(0,f.SK)(e)&&t.push("FolderType.Id"),t}_getParameters(e){return[{type:L.E.PrimaryColumnValue,value:e}]}_createItem(e,t){const n=(0,f.ic)(t);return{id:e.Id,name:e.Name,filter:e[n],folderTypeId:e["FolderType.Id"]}}getFolderData(e,t=m.uE){return(0,s.lastValueFrom)(k.K.create(t).pipe((0,s.switchMap)(n=>n.load({attributes:this._getColumns(t),parameters:this._getParameters(e)})),(0,s.map)(n=>n?.map(o=>this._createItem(o,t))),(0,s.map)(n=>(0,g.isEmpty)(n)?null:n[0])))}static{this.\u0275fac=function(t){return new(t||G)}}static{this.\u0275prov=r.\u0275\u0275defineInjectable({token:G,factory:G.\u0275fac,providedIn:"root"})}}var ht=d(93534);class Q{constructor(){this._folderTreeItemsFilterName="folderTreeItemsFilter",this._featureValues=(0,r.inject)(ce.G),this._userInfo=(0,r.inject)(st.oq),this._folderTreeUseStaticFolderService=(0,r.inject)(Z),this._dataSchemaRepository=(0,r.inject)(_r.J),this._folderTreeIdResolver=(0,r.inject)(_t.W),this._folderTreeDataProvider=(0,r.inject)(G),this._folderTreeAdminUnitRoleSourcesService=(0,r.inject)(ht.R)}_initializeAdminUnitRoleSources(){var e=this;return(0,u.A)(function*(){e._adminUnitRoleSources=yield e._folderTreeAdminUnitRoleSourcesService.getAsArray()})()}_getFolderTreeViewConfigs(e){return Pe.u.getViewConfigInfoByProperty("type","crt.FolderTree",e.viewConfig).map(t=>t?.viewConfig).filter(Boolean)}_processFolderTree(e,t){var n=this;return(0,u.A)(function*(){if(!t.rootSchemaName){n._resetActiveFolderIdAttributesValue(e,t);return}yield n._prepareActiveFolderIdAttributeValue(e,t),yield n._setUseStaticFoldersAttributeValue(t),yield n._setItemsConfig(e,t),n._setFolderTreeInputs(e,t),n._setFolderTreeOutputs(e,t),n._setFavoriteItemsConfig(e,t)})()}_setFolderTreeInputs(e,t){this._setExpandedItemsAttrValue(e,t),this._setVisibleAttrValue(e,t),this._setActiveFolderAttributes(e,t),this._setShowMaskAttrValue(e,t)}_setFolderTreeOutputs(e,t){this._setActiveFolderChanged(t),this._setFolderTreeVisibleChanged(t),this._setAddFolderRequest(t),this._setCopyFolderRequest(t),this._setFolderRenameRequest(t),this._setMoveFolderRequest(t),this._setFolderFiltersUpdatedRequest(t),this._setDeleteFolderRequest(e,t),this._setFolderTreeExpandedItemsChanged(t),this._setConvertToStaticFolder(t),this._setFolderChangeRights(t),this._setToggleFolderFavoriteRequest(t)}_isOldSourceSchema(e){return(0,f.SK)(e.sourceSchemaName)}_getFolderFilterColumnName(e){return(0,f.ic)(e.sourceSchemaName)}_setActiveFolderChanged(e){e.activeFolderChanged||(e.activeFolderChanged={request:"crt.FolderTreeActiveFolderChangedRequest",params:{folderTreeName:e.name,id:"@event.id",name:"@event.name",folderTreeId:"@event.folderTreeId",filterData:"@event.filterData",folderTypeId:"@event.folderTypeId",rootSchemaName:"@event.rootSchemaName",isFavorite:"@event.isFavorite"}})}_setFolderTreeVisibleChanged(e){e.folderTreeVisibleChanged||(e.folderTreeVisibleChanged={request:"crt.FolderTreeVisibleRequest",params:{folderTreeName:e.name,visible:"@event.visible"}})}_setAddFolderRequest(e){e.addFolder||(e.addFolder={request:"crt.AddFolderDataRequest",params:this._getAddFolderRequestParameters(e)})}_getAddFolderRequestParameters(e){return{folderTreeName:e.name,folderId:"@event.folderId",folderName:"@event.folderName",rootSchemaName:"@event.rootSchemaName",sourceSchemaName:"@event.sourceSchemaName",parentId:"@event.parentId",filterData:"@event.filterData",folderTypeId:"@event.folderTypeId"}}_setCopyFolderRequest(e){e.copyFolder||(e.copyFolder={request:"crt.CopyFolderDataRequest",params:{folderTreeName:e.name,folderId:"@event.folderId",sourceId:"@event.sourceId",copyRights:"@event.copyRights",folderName:"@event.folderName",rootSchemaName:"@event.rootSchemaName",sourceSchemaName:"@event.sourceSchemaName",parentId:"@event.parentId",filterData:"@event.filterData"}})}_setFolderRenameRequest(e){e.folderRenamed||(e.folderRenamed={request:"crt.FolderTreeRenameRequest",params:{folderTreeName:e.name,folderId:"@event.folderId",folderName:"@event.folderName",sourceSchemaName:"@event.sourceSchemaName",reloadFavorites:"@event.reloadFavorites"}})}_setMoveFolderRequest(e){e.moveFolder||(e.moveFolder={request:"crt.FolderTreeMoveRequest",params:{folderTreeName:e.name,folderId:"@event.folderId",parentId:"@event.parentId",sourceSchemaName:"@event.sourceSchemaName",reloadFavorites:"@event.reloadFavorites"}})}_setToggleFolderFavoriteRequest(e){e.toggleFolderFavorite||(e.toggleFolderFavorite={request:"crt.ToggleFolderFavoriteRequest",params:{folderTreeName:e.name,id:"@event.id",favoriteId:"@event.favoriteId",rootSchemaName:"@event.rootSchemaName",sourceSchemaName:"@event.sourceSchemaName",status:"@event.status",reloadFavorites:!0}})}_setFolderFiltersUpdatedRequest(e){e.folderFiltersUpdated||(e.folderFiltersUpdated={request:"crt.FolderTreeUpdateFiltersRequest",params:{folderTreeName:e.name,filterData:"@event.filterData",sourceSchemaName:"@event.sourceSchemaName",folderId:"@event.folderId",reloadFavorites:"@event.reloadFavorites"}})}_setDeleteFolderRequest(e,t){if(t.deleteFolder)return;const{itemsAttrName:n}=(0,h.Z)(t.name);t.deleteFolder={request:"crt.DeleteFolderDataRequest",params:{dataSourceName:this._getDataSourceNameByItems(e,n),sourceSchemaName:"@event.sourceSchemaName",folderTreeName:t.name,folderId:"@event.folderId",reloadFavorites:"@event.reloadFavorites"}}}_getDataSourceNameByItems(e,t){const n=this._getViewModelConfigAttribute(e,t)??{};return"embeddedModel"in n?n?.embeddedModel?.name??"":""}_setItemsConfig(e,t){var n=this;return(0,u.A)(function*(){n._setItemsAttrValue(t),yield n._addItemsViewModelAttribute(e,t),n._setItemsFilterAttrValue(e,t)})()}_setItemsAttrValue(e){if(e.items)return;const{itemsAttrName:t}=(0,h.Z)(e.name);e.items=`$${t}`}_updateItemsViewModelAttributeViewModelConfig(e,t){const{itemsModelName:n}=(0,h.Z)(t.name),o=this._getFolderFilterColumnName(t);if(!this._isOldSourceSchema(t)){e.attributes.FilterData={modelConfig:{path:`${n}.${o}`}};return}e.attributes.FolderTypeId={modelConfig:{path:`${n}.FolderType.Id`}},e.attributes.FilterData={modelConfig:{path:`${n}.${o}`}}}_addItemsViewModelAttribute(e,t){var n=this;return(0,u.A)(function*(){const{itemsAttrName:o,itemsModelName:i,itemsFilterAttrName:c}=(0,h.Z)(t.name),_=t.sourceSchemaName,v=yield n._getDataSchema(_),y={isCollection:!0,viewModelConfig:n._createItemsViewModelAttributeViewModelConfig(t,v),modelConfig:n._createItemsViewModelAttributeModelConfig(i,c),embeddedModel:n._createItemsViewModelAttributeEmbeddedModel(i,_)};n._isOldItemsCollectionViewModelAttribute(e,t)&&n._addViewModelConfigAttribute(e,o,y,!0),n._mergeViewModelConfigAttribute(e,o,y)})()}_getDataSchema(e){return(0,s.lastValueFrom)(this._dataSchemaRepository.get(e))}_createItemsViewModelAttributeViewModelConfig(e,t){const{itemsModelName:n}=(0,h.Z)(e.name),o=this._getFolderFilterColumnName(e),i={attributes:{Id:{modelConfig:{path:`${n}.${t.primaryAttributeName}`}},Name:{modelConfig:{path:`${n}.${t.primaryDisplayAttributeName}`}},ParentId:{modelConfig:{path:`${n}.${t.hierarchyAttributeName}.${t.primaryAttributeName}`}},FilterData:{modelConfig:{path:`${n}.${o}`}}}};return this._updateItemsViewModelAttributeViewModelConfig(i,e),i}_createItemsViewModelAttributeModelConfig(e,t){return{path:e,filterAttributes:[{name:t,loadOnChange:!0}]}}_createItemsViewModelAttributeEmbeddedModel(e,t){return{name:e,config:{type:"crt.EntityDataSource",config:{entitySchemaName:t,adminUnitRoleSources:this._adminUnitRoleSources}}}}_isOldItemsCollectionViewModelAttribute(e,t){const{itemsAttrName:n}=(0,h.Z)(t.name),o=this._getViewModelConfigAttribute(e,n);return this._isOldCollectionViewModelAttribute(o)}_isOldCollectionViewModelAttribute(e){return!!e&&!!e.isCollection&&!!e.viewModelConfig&&!!e.embeddedModel&&!!e.modelConfig}_setItemsFilterAttrValue(e,t){if(!this._getViewModelConfigAttributes(e))return;const{itemsFilterAttrName:n}=(0,h.Z)(t.name),o=this._createItemsFilterGroup(t);this._addViewModelConfigAttribute(e,n,{value:o},!0)}_createItemsFilterGroup(e){return this._isOldSourceSchema(e)?this._createOldStructureItemsFilterGroup(e):this._createNewStructureItemsFilterGroup(e)}_createOldStructureItemsFilterGroup(e){const t=new Y.X(Me.H.Or),n=[m.Ss];return e.useStaticFolders&&n.push(m.Xi),t.addSchemaColumnInFilterWithParameters(U.H.Equal,"FolderType",n,this._folderTreeItemsFilterName),t}_createNewStructureItemsFilterGroup(e){const t=new Y.X(Me.H.Or);return t.addSchemaColumnFilterWithParameter(U.H.Equal,"EntitySchemaName",e.rootSchemaName,this._folderTreeItemsFilterName),t}_isAllowUseStaticFolders(e){var t=this;return(0,u.A)(function*(){return t._featureValues.IsAllowUseStaticFolders&&(yield(0,s.lastValueFrom)(t._folderTreeUseStaticFolderService.isEnabled(e.rootSchemaName)))})()}_setVisibleAttrValue(e,t){if(t.visible)return;const{visibleAttrName:n}=(0,h.Z)(t.name);t.visible=`$${n}`,this._addViewModelConfigAttribute(e,n,{value:!0})}_setShowMaskAttrValue(e,t){if(t.showMask)return;const{showMaskAttrName:n}=(0,h.Z)(t.name);t.showMask=`$${n}`,this._addViewModelConfigAttribute(e,n,{value:!1})}_setActiveFolderAttributes(e,t){t.activeFolderId||(this._setActiveFolderIdAttribute(t),this._setActiveFolderFilterAttribute(e,t),this._addActiveFolderNameAttribute(e,t))}_setActiveFolderIdAttribute(e){const{activeFolderIdAttrName:t}=(0,h.Z)(e.name);e.activeFolderId=`$${t}`}_addActiveFolderNameAttribute(e,t){const{activeFolderNameAttrName:n}=(0,h.Z)(t.name);this._addViewModelConfigAttribute(e,n,{})}_setActiveFolderFilterAttribute(e,t){if(!this._isNeedToSetFolderFilterAttribute(e,t))return;const{activeFolderFolderTreeIdAttrName:n,activeFolderFilterAttrName:o,activeFolderFilterDataAttrName:i}=(0,h.Z)(t.name);this._addViewModelConfigAttribute(e,o,{from:[n,i],converter:"crt.FolderTreeActiveFilterAttributeConverter"},!0)}_isNeedToSetFolderFilterAttribute(e,t){const{activeFolderFilterAttrName:n}=(0,h.Z)(t.name),o=this._getViewModelConfigAttribute(e,n);return!(o&&(0,hr.t)(o))}_setFavoriteItemsConfig(e,t){const{favoriteItemsAttrName:n}=(0,h.Z)(t.name);t.favoriteItems=`$${n}`;const o=`${n}_DS`,i=`${o}_filter`;this._setFavoriteItemsFilterAttr(i,e,t);const c={isCollection:!0,modelConfig:{path:o,filterAttributes:[{name:i,loadOnChange:!0}]}};this._addFavoriteItemsViewModelConfig(c,t,o),this._addFavoriteItemsEmbeddedModel(c,t,o),this._isOldFavoriteItemsCollectionViewModelAttribute(e,t)&&this._addViewModelConfigAttribute(e,n,c,!0),this._mergeViewModelConfigAttribute(e,n,c)}_addFavoriteItemsViewModelConfig(e,t,n){const o=this._isOldSourceSchema(t),i=o?"":".FolderTree",c=o?"FolderId":"Id",_={Id:{modelConfig:{path:`${n}.Id`}},Name:{modelConfig:{path:`${n}${i}.Name`}},FolderTreeId:{modelConfig:{path:`${n}${i}.${c}`}},FilterData:{modelConfig:{path:`${n}${i}.FilterData`}}};o&&(_.FolderTypeId={modelConfig:{path:`${n}${i}.FolderTypeId`}}),e.viewModelConfig={attributes:_}}_addFavoriteItemsEmbeddedModel(e,t,n){const o=this._isOldSourceSchema(t),i=o?m.HD:m.HT,c={name:n,config:{type:"crt.EntityDataSource",config:{entitySchemaName:i,adminUnitRoleSources:this._adminUnitRoleSources},hiddenInPageDesigner:!1}};if(o){const _=t.sourceSchemaName,v=this._getFolderFilterColumnName(t);c.config.config.attributes={Name:{path:`[${_}:Id:FolderId].Name`,type:Ne.D.ForwardReferenceAttribute},FilterData:{path:`[${_}:Id:FolderId].${v}`,type:Ne.D.ForwardReferenceAttribute},FolderTypeId:{path:`[${_}:Id:FolderId].FolderType.Id`,type:Ne.D.ForwardReferenceAttribute}}}e.embeddedModel=c}_isOldFavoriteItemsCollectionViewModelAttribute(e,t){const{favoriteItemsAttrName:n}=(0,h.Z)(t.name),o=this._getViewModelConfigAttribute(e,n);return this._isOldCollectionViewModelAttribute(o)}_setFavoriteItemsFilterAttr(e,t,n){const o=this._getViewModelConfigAttributes(t);if(o?.[e]||!o)return;const i=this._isOldSourceSchema(n),c=new Y.X(Me.H.And),_=new Se.x(U.H.Equal,new Te.g({columnPath:"SysAdminUnit"}),new we.J({value:this._userInfo?.id,dataValueType:ur.r.Guid}));if(c.add(_,"adminUnitFilter"),i){const v=n.sourceSchemaName,y=new Se.x(U.H.Equal,new Te.g({columnPath:"FolderEntitySchemaName"}),new we.J({value:v}));c.add(y,"folderEntitySchemaNameFilter")}else{const v=new Se.x(U.H.Equal,new Te.g({columnPath:"EntitySchemaName"}),new we.J({value:n.rootSchemaName}));c.add(v,"schemaFilter")}o[e]={value:c}}_setExpandedItemsAttrValue(e,t){if(t.expandedItems)return;const{expandedItemsAttrName:n}=(0,h.Z)(t.name);t.expandedItems=`$${n}`,this._addViewModelConfigAttribute(e,n,{})}_getViewModelConfigAttribute(e,t){return(this._getViewModelConfigAttributes(e)||{})[t]}_getViewModelConfigAttributes(e){return e?.viewModelConfig?.attributes}_mergeViewModelConfigAttribute(e,t,n){const o=this._getViewModelConfigAttribute(e,t);o&&(n=(0,g.mergeWith)(n,o,(i,c)=>(0,g.isArray)(c)?c:void 0)),this._addViewModelConfigAttribute(e,t,n,!0)}_addViewModelConfigAttribute(e,t,n,o=!1){const i=this._getViewModelConfigAttribute(e,t);if(!o&&i)return;const c=this._getViewModelConfigAttributes(e)||{};c[t]=n}_setFolderTreeExpandedItemsChanged(e){e.folderTreeExpandedItemsChanged||(e.folderTreeExpandedItemsChanged={request:"crt.FolderTreeExpandedItemsRequest",params:{folderTreeName:e.name,expandedItems:"@event.expandedItems"}})}_setFolderChangeRights(e){e.folderChangeRights||(e.folderChangeRights={request:"crt.LoadRightsModuleRequest",params:{payload:{entitySchemaName:"@event.entitySchemaName",entitySchemaCaption:"@event.entitySchemaCaption",primaryColumnValue:"@event.primaryColumnValue",primaryDisplayColumnValue:"@event.primaryDisplayColumnValue",hideAdditionalLookupButtons:!0}}})}_setConvertToStaticFolder(e){e.convertToStaticFolder||!this._isOldSourceSchema(e)||(e.convertToStaticFolder={request:"crt.ConvertToStaticFolderRequest",params:this._getAddFolderRequestParameters(e)})}_prepareActiveFolderIdAttributeValue(e,t){var n=this;return(0,u.A)(function*(){const o=yield n._folderTreeIdResolver.getActiveFolderFolderTreeId(t,e);if((0,g.isEmpty)(o)){n._resetActiveFolderIdAttributesValue(e,t);return}yield n._updateActiveFolderIdAttributesValue(o,e,t)})()}_resetActiveFolderIdAttributesValue(e,t){const{activeFolderFolderTreeIdAttrName:n,activeFolderIdAttrName:o,activeFolderNameAttrName:i,activeFolderFilterDataAttrName:c}=(0,h.Z)(t.name);[n,o,i,c].forEach(v=>{this._addViewModelConfigAttribute(e,v,{value:null},!0)})}_updateActiveFolderIdAttributesValue(e,t,n){var o=this;return(0,u.A)(function*(){const i=yield o._folderTreeDataProvider.getFolderData(e,n.sourceSchemaName);if(!i)return;const{activeFolderNameAttrName:c,activeFolderFilterDataAttrName:_}=(0,h.Z)(n.name),v=yield o._getFolderFilterFromFolderData(i,n);o._addViewModelConfigAttribute(t,c,{value:i.name},!0),o._addViewModelConfigAttribute(t,_,{value:v},!0)})()}_getFolderFilterFromFolderData(e,t){return(0,f.$K)(e.folderTypeId)?(0,f.po)(e.id,t.rootSchemaName):Promise.resolve(e.filter)}_setUseStaticFoldersAttributeValue(e){var t=this;return(0,u.A)(function*(){t._isOldSourceSchema(e)&&(e.useStaticFolders=yield t._isAllowUseStaticFolders(e))})()}crtOnMetaDataInit(e){var t=this;return(0,u.A)(function*(){const n=e,o=t._getFolderTreeViewConfigs(n);return(0,g.isEmpty)(o)?e:(yield t._initializeAdminUnitRoleSources(),yield Promise.all(o.map(i=>t._processFolderTree(n,i))),n)})()}static{this.\u0275fac=function(t){return new(t||Q)}}static{this.\u0275prov=r.\u0275\u0275defineInjectable({token:Q,factory:Q.\u0275fac})}}class J{_getFolderTreeActionViewConfigs(e){return Pe.u.getViewConfigInfoByProperty("type","crt.FolderTreeActions",e.viewConfig).map(t=>t?.viewConfig).filter(Boolean)}_setProperties(e){const t=e.folderTree,{activeFolderIdAttrName:n,activeFolderNameAttrName:o,activeFolderFavoriteStateAttrName:i,favoriteItemsAttrName:c}=(0,h.Z)(t);e.activeFolderId||(e.activeFolderId=t?`$${n}`:null),e.activeFolderName||(e.activeFolderName=t?`$${o}`:null),e.activeFolderFavoriteState||(e.activeFolderFavoriteState=t?`$${i}`:null),e.favoriteItems||(e.favoriteItems=t?`$${c}`:null)}_setActiveFolderChangedRequest(e,t){if(t.activeFolderChanged)return;const n=t.folderTree??null;if(!n)return;const o=this._getFolderTreeRootSchemaName(e,n);t.activeFolderChanged={request:"crt.FolderTreeActiveFolderChangedRequest",params:{folderTreeName:n,id:"@event.id",name:"@event.name",folderTreeId:"@event.folderTreeId",filterData:"@event.filterData",folderTypeId:"@event.folderTypeId",rootSchemaName:o,isFavorite:"@event.isFavorite"}}}_setFolderTreeVisibleChangedRequest(e){e.folderTreeVisibleChanged||(e.folderTreeVisibleChanged={request:"crt.FolderTreeVisibleRequest",params:{folderTreeName:e.folderTree??null,togglePanel:"@event.togglePanel"}})}_getFolderTreeRootSchemaName(e,t){return Pe.u.getViewConfigInfoByName(e,t)?.viewConfig?.rootSchemaName}crtOnMetaDataInit(e){const t=e,n=this._getFolderTreeActionViewConfigs(t);for(const o of n)this._setProperties(o),this._setActiveFolderChangedRequest(t,o),this._setFolderTreeVisibleChangedRequest(o);return Promise.resolve(e)}static{this.\u0275fac=function(t){return new(t||J)}}static{this.\u0275prov=r.\u0275\u0275defineInjectable({token:J,factory:J.\u0275fac})}}var pt=d(41012),pr=d(15112);let q=class be{constructor(e){this._materialIconsRegistrator=e,this._iconRegistration()}_iconRegistration(){this._materialIconsRegistrator.addIcons([{name:"folder_tree",icon:d(19010)},{name:"move-folder",icon:d(61137)}])}static{this.\u0275fac=function(t){return new(t||be)(r.\u0275\u0275inject(ke.K))}}static{this.\u0275mod=r.\u0275\u0275defineNgModule({type:be})}static{this.\u0275inj=r.\u0275\u0275defineInjector({providers:[{provide:ze.m,useClass:Q,multi:!0},{provide:ze.m,useClass:J,multi:!0},pt.j,b,x,E],imports:[A.CommonModule,Ve.q,He.q,Be.k,$e.V,W.MatIconModule,Re.R,Ee.MatLegacyButtonModule,De.f,Ke.D,Le.u,Ue.n,Ze.E,Ge.x,P.TranslateModule]})}};q=(0,a.__decorate)([(0,ft.g)({viewElements:[p,N],converters:[de],requestHandlers:[le,se,me,ue,_e,he,pe,fe,ge,ve,Fe,Ie,ye]}),(0,a.__metadata)("design:paramtypes",[ke.K])],q),function(){(typeof ngJitMode>"u"||ngJitMode)&&r.\u0275\u0275setNgModuleScope(q,{declarations:[p,K,V,N],imports:[A.CommonModule,Ve.q,He.q,Be.k,$e.V,W.MatIconModule,Re.R,Ee.MatLegacyButtonModule,De.f,Ke.D,Le.u,Ue.n,Ze.E,Ge.x,je.X,P.TranslateModule],exports:[p,N]})}(),r.\u0275\u0275setComponentScope(V,[nt.B,pr.H,p],[P.TranslatePipe]);var fr=d(81331)},41456:$=>{$.exports=`
<svg xmlns="http://www.w3.org/2000/svg" width="72" height="64" viewBox="0 0 72 64">
	<g id="Group_12169" data-name="Group 12169" transform="translate(-464 -425)">
		<g id="Group_9771" data-name="Group 9771" transform="translate(399 129)">
			<rect id="Rectangle_21438" data-name="Rectangle 21438" width="56" height="24" rx="3" transform="translate(73 316)" fill="#004fd6"/>
			<path id="Path_9868" data-name="Path 9868" d="M788.408-567v3.36a4.876,4.876,0,0,0-2.112,1.056l-2.592-2.592-2.88,2.976,2.592,2.592a4.051,4.051,0,0,0-1.056,2.016H779v5.184h3.36c.192,0,.576,1.248,1.056,2.016l-2.592,2.5,2.976,2.976,2.5-2.592a4.8,4.8,0,0,0,2.112.96V-543H791v-23.792ZM791-551.64a3.4,3.4,0,0,1-3.36-3.36,3.4,3.4,0,0,1,3.36-3.36C792.847-558.339,792.847-551.661,791-551.64Z" transform="translate(-662 883)" fill="#fff" opacity="0.2"/>
			<g id="Group_16211" data-name="Group 16211" transform="translate(-1167 -209)">
				<path id="Path_11757" data-name="Path 11757" d="M7,7.885V12.5H7V7.885l4.5-3.846V2.5h-9V4.038Z" transform="translate(1255.5 533.5)" fill="none" stroke="#fff" stroke-width="2"/>
				<path id="Path_11756" data-name="Path 11756" d="M-450.8,601.4h-6v-9h3.3l2.2,2h5.5v1.5" transform="translate(1706.798 -62.401)" fill="none" stroke="#fff" stroke-width="2"/>
			</g>
		</g>
		<rect id="Rectangle_24800" data-name="Rectangle 24800" width="72" height="64" rx="6" transform="translate(464 425)" fill="none"/>
	</g>
</svg>
`},61137:$=>{$.exports=`<svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
<path fill-rule="evenodd" clip-rule="evenodd" d="M12.4403 8.54175L13.6957 9.30902C13.829 9.39048 14 9.29456 14 9.13837V5.83333C14 5.47971 13.8595 5.14057 13.6095 4.89052C13.3594 4.64048 13.0203 4.5 12.6667 4.5H8.10704C8.04017 4.5 7.97772 4.46658 7.94063 4.41094L6.72604 2.58906C6.68895 2.53342 6.6265 2.5 6.55963 2.5H3.33333C2.97971 2.5 2.64057 2.64048 2.39052 2.89052C2.14048 3.14057 2 3.47971 2 3.83333V12.1667C2 12.5203 2.14048 12.8594 2.39052 13.1095C2.64057 13.3595 2.97971 13.5 3.33333 13.5H7.45659C7.58153 13.5 7.9162 12.9166 7.9162 12.7916V10.8952C7.9162 9.98898 8.65045 9.25435 9.5562 9.25435H9.96518C10.0433 9.25435 10.1134 9.2082 10.1516 9.14002C10.5811 8.37331 11.6018 8.02924 12.4403 8.54175ZM11.7678 13.4553C11.5679 13.5783 11.3105 13.4344 11.3105 13.1998V12.6555C11.3105 12.545 11.221 12.4555 11.1105 12.4555H9.44258C9.27689 12.4555 9.14258 12.3212 9.14258 12.1555V11.05C9.14258 10.8843 9.27689 10.75 9.44258 10.75H11.1105C11.221 10.75 11.3105 10.6605 11.3105 10.55V10.0075C11.3105 9.77282 11.5679 9.62901 11.7678 9.752L14.3618 11.3481C14.5522 11.4653 14.5522 11.742 14.3618 11.8591L11.7678 13.4553Z" fill="currentColor"/>
</svg>
`},19010:$=>{$.exports=`<svg id="Component_669_2" data-name="Component 669 \u2013 2" xmlns="http://www.w3.org/2000/svg" width="72" height="64" viewBox="0 0 72 64">
	<rect id="Rectangle_24800" data-name="Rectangle 24800" width="72" height="64" rx="6" fill="none"/>
	<rect id="Rectangle_6612" data-name="Rectangle 6612" width="42" height="6" rx="3" transform="translate(22 8)" fill="#d1d1d1"/>
	<rect id="Rectangle_42316" data-name="Rectangle 42316" width="30" height="6" rx="3" transform="translate(34 22)" fill="#d1d1d1"/>
	<rect id="Rectangle_42318" data-name="Rectangle 42318" width="30" height="6" rx="3" transform="translate(34 46)" fill="#d1d1d1"/>
	<rect id="Rectangle_42317" data-name="Rectangle 42317" width="18" height="6" rx="3" transform="translate(34 34)" fill="#d1d1d1"/>
	<path id="Path_6339" data-name="Path 6339" d="M0,4,3.962,0,8,4" transform="translate(16 13) rotate(180)" fill="none" stroke="#004fd6" stroke-width="2"/>
	<path id="Path_11752" data-name="Path 11752" d="M0,4,3.962,0,8,4" transform="translate(28 21) rotate(90)" fill="none" stroke="#004fd6" stroke-width="2"/>
	<path id="Path_11753" data-name="Path 11753" d="M0,4,3.962,0,8,4" transform="translate(28 45) rotate(90)" fill="none" stroke="#004fd6" stroke-width="2"/>
</svg>
`}}]);
