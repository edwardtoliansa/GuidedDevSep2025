(self.webpackChunkapp_studio_enterprise_schema_view=self.webpackChunkapp_studio_enterprise_schema_view||[]).push([[8150],{68150:(G,c,t)=>{t.r(c),t.d(c,{GoogleAnalyticsLoginHandler:()=>o,GoogleAnalyticsLoginRequest:()=>h,GoogleAnalyticsModule:()=>I});var s=t(5960),a=t(40297),d=t(59131),r=t(10067),m=t(55642),i=t(79772),u=t(59969),p=t(23092),A=t(62278),P=t(844),M=t(40968),g=t(6503),f=t(78037),C=t(76499),n=t(34845),e=t(13443);let o=class extends C.N{constructor(S,v,T,R,F,D){super(v,T,R,F,D),this.translateService=S,this.httpClient=v,this.notifyService=T,this.restErrorHandler=R,this.sessionIdentifierService=F,this.window=D}getInvalidPlatformMessage(){return this.translateService.instant("GoogleAnalytics.PlatformUndefinedMessage")}getInvalidApplicationMessage(){return this.translateService.instant("GoogleAnalytics.ApplicationUndefinedMessage")}};o=(0,s.__decorate)([(0,P.l)({type:"crt.GoogleAnalyticsLoginHandler",requestType:"crt.GoogleAnalyticsLogin"}),(0,s.__param)(5,(0,M.j)(u.ZP)),(0,s.__metadata)("design:paramtypes",[i.TranslateService,f.v,g.F,e.x,n.b,Window])],o);var l=t(2828),y=t(93993);let h=class extends y.i{constructor(){super(...arguments),this.type="crt.GoogleAnalyticsLogin"}};h=(0,s.__decorate)([(0,l.$)({type:"crt.GoogleAnalyticsLogin",scopes:["WebAnalytics_SectionPage"],propertiesPanelComponentTypeName:"crt.GoogleAnalyticsLoginPropertiesPanel",position:960,title:"GoogleAnalytics.LoginRequestTitle"})],h);function E(){const L=[h]}E();function H(L,S){return()=>(0,A.lastValueFrom)(L.loadCurrentUserInfo().pipe((0,A.tap)(v=>{S.use(v?.userInfo?.cultureInfo?.sysCultureName)})),{defaultValue:null})}let I=class x{static{this.\u0275fac=function(v){return new(v||x)}}static{this.\u0275mod=d.\u0275\u0275defineNgModule({type:x})}static{this.\u0275inj=d.\u0275\u0275defineInjector({providers:[u.rK,{provide:d.APP_INITIALIZER,useFactory:H,deps:[p.fv,i.TranslateService],multi:!0}],imports:[a.CommonModule,r.MatSnackBarModule,i.TranslateModule]})}};I=(0,s.__decorate)([(0,m.g)({requestHandlers:[o]})],I),function(){(typeof ngJitMode>"u"||ngJitMode)&&d.\u0275\u0275setNgModuleScope(I,{imports:[a.CommonModule,r.MatSnackBarModule,i.TranslateModule]})}()},76499:(G,c,t)=>{t.d(c,{N:()=>f});var s=t(73308),a=t(5960),d=t(41287),r=t(40968),m=t(6503),i=t(59969),u=t(78037),p=t(13443),A=t(62278);class P{constructor(n,e,o){this.application=n,this.platform=e,this.websocketSessionId=o}}var M=t(34845),g=t(59131);let f=class j extends d.l{constructor(n,e,o,l,y){super(),this.httpClient=n,this.notifyService=e,this.restErrorHandler=o,this.sessionIdentifierService=l,this.window=y,this._snackbarDuration=3e3}_validateRequest(n){return n.platform===void 0?(this._showMessage(this.getInvalidPlatformMessage()),!1):n.app===void 0?(this._showMessage(this.getInvalidApplicationMessage()),!1):!0}_getFlowUrl(n){const e=this.sessionIdentifierService.identifier,o=new P(n.app,n.platform,e);return this.restErrorHandler.handleRequest(this.httpClient.post("/rest/SocialOAuthProxyService/AuthenticateToPlatform",o,{responseType:"json"})).pipe((0,A.map)(l=>{if(l.body!=="")return new URL(l.body)}))}_showMessage(n){var e=this;return(0,s.A)(function*(){yield e.notifyService.show({message:n,duration:e._snackbarDuration})})()}_showLoginWindow(n){const e="Login",y=window.screenLeft+(window.innerWidth-650)/2,h=window.screenTop+(window.innerHeight-650)/2,E=`width=650,height=650,left=${y},top=${h},
		  scrollbars=no,resizable=no,status=no,location=no,toolbar=no,menubar=no`;this.window.open(n.toString(),e,E)}handle(n){var e=this;return(0,s.A)(function*(){e._context=n.$context;const o=e._context.attributes.Connect_account_button_enabled;if(o&&o===!0){e._context.attributes.Connect_account_button_enabled=!1;try{if(!e._validateRequest(n))return;e._getFlowUrl(n).subscribe(l=>{l&&e._showLoginWindow(l)})}finally{e._context.attributes.Connect_account_button_enabled=!0,yield e.next?.handle(n)}}})()}static{this.\u0275fac=function(e){return new(e||j)(g.\u0275\u0275inject(u.v),g.\u0275\u0275inject(m.F),g.\u0275\u0275inject(p.x),g.\u0275\u0275inject(M.b),g.\u0275\u0275inject(Window))}}static{this.\u0275prov=g.\u0275\u0275defineInjectable({token:j,factory:j.\u0275fac})}};f=(0,a.__decorate)([(0,a.__param)(4,(0,r.j)(i.ZP)),(0,a.__metadata)("design:paramtypes",[u.v,m.F,p.x,M.b,Window])],f)},93993:(G,c,t)=>{t.d(c,{i:()=>a});var s=t(81517);class a extends s.S{}},34845:(G,c,t)=>{t.d(c,{b:()=>r});var s=t(35293),a=t(59131),d=t.n(a);class r{constructor(){this._storageKey="uniqueIdentifier",sessionStorage.removeItem(this._storageKey)}get identifier(){let i=sessionStorage.getItem(this._storageKey);return i||(i=(0,s.A)(),sessionStorage.setItem(this._storageKey,i)),i}static{this.\u0275fac=function(u){return new(u||r)}}static{this.\u0275prov=a.\u0275\u0275defineInjectable({token:r,factory:r.\u0275fac,providedIn:"root"})}}}}]);
