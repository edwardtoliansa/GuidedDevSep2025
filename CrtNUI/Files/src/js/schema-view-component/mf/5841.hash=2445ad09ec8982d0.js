(self.webpackChunkapp_studio_enterprise_schema_view=self.webpackChunkapp_studio_enterprise_schema_view||[]).push([[5841],{90262:(z,O,e)=>{e.d(O,{G:()=>g});var n=e(93277),a=e.n(n),s=e(90865),l=e.n(s),t=e(59131),y=e.n(t),_=e(56711),u=e.n(_),d=e(98093),r=e.n(d),p=e(82944),b=e(40297),W=e.n(b),A=e(80203),v=e.n(A);function V(C,x){if(C&1&&(t.\u0275\u0275elementStart(0,"div",5),t.\u0275\u0275text(1),t.\u0275\u0275elementEnd()),C&2){const D=t.\u0275\u0275nextContext();t.\u0275\u0275advance(),t.\u0275\u0275textInterpolate(D.title)}}function c(C,x){if(C&1&&(t.\u0275\u0275elementStart(0,"div",6),t.\u0275\u0275text(1),t.\u0275\u0275elementEnd()),C&2){const D=t.\u0275\u0275nextContext();t.\u0275\u0275advance(),t.\u0275\u0275textInterpolate(D.description)}}class g extends p.F{set default(x){this.value=x}get default(){return this.value}constructor(x,D,T){super(x,D,T),this.controlType="crt-slide-toggle",this.useDefaultWidth=!1,this.labelPosition="before",this.toggleChange=new t.EventEmitter}valueChanged(x){this.innerValue=x.checked,this.toggleChange.emit(x)}static{this.\u0275fac=function(D){return new(D||g)(t.\u0275\u0275directiveInject(_.NgControl,10),t.\u0275\u0275directiveInject(s.AutofillMonitor),t.\u0275\u0275directiveInject(n.FocusMonitor))}}static{this.\u0275cmp=t.\u0275\u0275defineComponent({type:g,selectors:[["crt-slide-toggle"]],inputs:{title:"title",description:"description",useDefaultWidth:"useDefaultWidth",labelPosition:"labelPosition",default:"default"},outputs:{toggleChange:"toggleChange"},features:[t.\u0275\u0275ProvidersFeature([{provide:d.MatFormFieldControl,useExisting:g}]),t.\u0275\u0275InheritDefinitionFeature],decls:5,vars:7,consts:[["input",""],[1,"slide-wrapper",3,"change","disabled","checked","labelPosition"],[1,"slide-content"],["class","slide-title",4,"ngIf"],["class","slide-description",4,"ngIf"],[1,"slide-title"],[1,"slide-description"]],template:function(D,T){if(D&1){const R=t.\u0275\u0275getCurrentView();t.\u0275\u0275elementStart(0,"mat-slide-toggle",1,0),t.\u0275\u0275listener("change",function(h){return t.\u0275\u0275restoreView(R),t.\u0275\u0275resetView(T.valueChanged(h))}),t.\u0275\u0275elementStart(2,"div",2),t.\u0275\u0275template(3,V,2,1,"div",3)(4,c,2,1,"div",4),t.\u0275\u0275elementEnd()()}D&2&&(t.\u0275\u0275classProp("slide-toggle-default-width",T.useDefaultWidth),t.\u0275\u0275property("disabled",T.disabled)("checked",T.innerValue)("labelPosition",T.labelPosition),t.\u0275\u0275advance(3),t.\u0275\u0275property("ngIf",T.title),t.\u0275\u0275advance(),t.\u0275\u0275property("ngIf",T.description))},dependencies:[b.NgIf,A.MatLegacySlideToggle],styles:[`.slide-wrapper.slide-toggle-default-width{width:400px}.slide-wrapper.mat-slide-toggle .mat-slide-toggle-label{justify-content:space-between}.slide-wrapper.mat-slide-toggle.mat-checked .mat-slide-toggle-bar{background-color:var(--crt-palette-label-500)}.slide-wrapper.mat-slide-toggle.mat-checked .mat-slide-toggle-thumb{background-color:#fff}.slide-wrapper.mat-slide-toggle .mat-slide-toggle-bar{height:22px;border-radius:22px}.slide-wrapper.mat-slide-toggle .mat-slide-toggle-thumb-container{margin:auto 0;top:0;bottom:0}.slide-wrapper .slide-title{white-space:break-spaces}.slide-wrapper.cdk-keyboard-focused{outline:none;outline-offset:-1px;border-radius:2px;box-shadow:inset 0 0 0 1px #0d2e4e,inset 0 0 0 2px #fff}
`],encapsulation:2})}}},30306:(z,O,e)=>{e.d(O,{E:()=>p});var n=e(5960),a=e.n(n),s=e(1034),l=e(96677),t=e(68712),y=e(59131),_=e.n(y),u=e(58433);const d=()=>({height:"52px"}),r=()=>({height:"32px",width:"100px","margin-right":"8px"});let p=class Re extends t.K{static{this.\u0275fac=(()=>{let W;return function(v){return(W||(W=y.\u0275\u0275getInheritedFactory(Re)))(v||Re)}})()}static{this.\u0275cmp=y.\u0275\u0275defineComponent({type:Re,selectors:[["crt-base-message-composer-skeleton"]],features:[y.\u0275\u0275InheritDefinitionFeature],decls:3,vars:4,consts:[[1,"message-composer-skeleton-container"],["appearance","line","count","1",1,"message-composer-skeleton-container-body",3,"styles"],["appearance","line","count","2",1,"message-composer-skeleton-container-buttons",3,"styles"]],template:function(A,v){A&1&&(y.\u0275\u0275elementStart(0,"div",0),y.\u0275\u0275element(1,"crt-skeleton-loader",1)(2,"crt-skeleton-loader",2),y.\u0275\u0275elementEnd()),A&2&&(y.\u0275\u0275advance(),y.\u0275\u0275property("styles",y.\u0275\u0275pureFunction0(2,d)),y.\u0275\u0275advance(),y.\u0275\u0275property("styles",y.\u0275\u0275pureFunction0(3,r)))},dependencies:[u.W],styles:[".message-composer-skeleton-container-body[_ngcontent-%COMP%]{margin:5px 0}.message-composer-skeleton-container-buttons[_ngcontent-%COMP%]{justify-content:space-between;text-align:end}"]})}};p=(0,n.__decorate)([(0,s.v)({type:"crt.BaseMessageComposerSkeleton",reuseStrategy:l.B.Reuse})],p)},58551:(z,O,e)=>{e.d(O,{l:()=>i});var n=e(5960),a=e.n(n),s=e(59131),l=e.n(s),t=e(56711),y=e.n(t),_=e(10067),u=e.n(_),d=e(6530),r=e(77592),p=e(34760),b=e(1034),W=e(96677),A=e(79772),v=e.n(A),V=e(59969),c=e(95145),g=e(73270),C=e(54918),x=e(31774),D=e(2122),T=e(26594),R=e(85040),$=e(83455),h=e(48534),L=e(41314),N=e(28399),G=e.n(N),J=e(62278),ce=e.n(J),m=e(36486),f=e.n(m),S=e(29957),I=e.n(S),B=e(86190),H=e(40297),w=e.n(H),ie=e(62115),de=e(52989),Ee=e.n(de),oe=e(45093),ne=e(54327),re=e(78027),U=e(59834);const Q=["crtRichTextInput"],k=["attachUploadElement"],q=["baseMessageComposerWrap"],ee=E=>({"extendable-message-composer":E});function _e(E,o){if(E&1&&(s.\u0275\u0275elementStart(0,"div",22),s.\u0275\u0275element(1,"img",23),s.\u0275\u0275pipe(2,"translate"),s.\u0275\u0275pipe(3,"bypassSecurityTrust"),s.\u0275\u0275elementEnd()),E&2){const M=s.\u0275\u0275nextContext().$implicit,P=s.\u0275\u0275nextContext();s.\u0275\u0275advance(),s.\u0275\u0275propertyInterpolate2("alt","",s.\u0275\u0275pipeBind1(2,4,"MessageComposer.AttachmentPreview"),": ",M.file.name,""),s.\u0275\u0275property("src",s.\u0275\u0275pipeBind2(3,6,P.getFilePreview(M),"resourceUrl"),s.\u0275\u0275sanitizeUrl)}}function Ce(E,o){if(E&1&&s.\u0275\u0275element(0,"mat-icon",24),E&2){const M=s.\u0275\u0275nextContext().$implicit,P=s.\u0275\u0275nextContext();s.\u0275\u0275property("svgIcon",P.getFileIcon(M.file.name))}}function ye(E,o){if(E&1){const M=s.\u0275\u0275getCurrentView();s.\u0275\u0275elementStart(0,"div",16),s.\u0275\u0275template(1,_e,4,9,"div",17)(2,Ce,1,1,"mat-icon",18),s.\u0275\u0275elementStart(3,"span",19),s.\u0275\u0275text(4),s.\u0275\u0275elementEnd(),s.\u0275\u0275elementStart(5,"span",20),s.\u0275\u0275text(6),s.\u0275\u0275pipe(7,"memoryFormat"),s.\u0275\u0275elementEnd(),s.\u0275\u0275elementStart(8,"mat-icon",21),s.\u0275\u0275pipe(9,"translate"),s.\u0275\u0275pipe(10,"translate"),s.\u0275\u0275listener("click",function(){const F=s.\u0275\u0275restoreView(M).$implicit,X=s.\u0275\u0275nextContext();return s.\u0275\u0275resetView(X.onRemoveAttachClick(F.id))})("keydown.enter",function(){const F=s.\u0275\u0275restoreView(M).$implicit,X=s.\u0275\u0275nextContext();return s.\u0275\u0275resetView(X.onRemoveAttachClick(F.id))}),s.\u0275\u0275elementEnd()()}if(E&2){const M=o.$implicit,P=s.\u0275\u0275nextContext();s.\u0275\u0275advance(),s.\u0275\u0275property("ngIf",P.canShowPreview(M)),s.\u0275\u0275advance(),s.\u0275\u0275property("ngIf",!P.canShowPreview(M)),s.\u0275\u0275advance(2),s.\u0275\u0275textInterpolate(M.file.name),s.\u0275\u0275advance(2),s.\u0275\u0275textInterpolate(s.\u0275\u0275pipeBind1(7,7,M.file.size||M.size)),s.\u0275\u0275advance(2),s.\u0275\u0275propertyInterpolate("title",s.\u0275\u0275pipeBind1(9,9,"MessageComposer.RemoveAttachmentHint")),s.\u0275\u0275attribute("aria-label",s.\u0275\u0275pipeBind1(10,11,"MessageComposer.RemoveAttachmentHint"))("aria-hidden",!1)}}function Pe(E,o){E&1&&s.\u0275\u0275elementContainer(0)}function De(E,o){if(E&1&&(s.\u0275\u0275elementStart(0,"div"),s.\u0275\u0275template(1,Pe,1,0,"ng-container",11),s.\u0275\u0275elementEnd()),E&2){const M=s.\u0275\u0275nextContext();s.\u0275\u0275advance(),s.\u0275\u0275property("ngTemplateOutlet",M.channelSelector)}}function fe(E,o){E&1&&s.\u0275\u0275elementContainer(0)}function Z(E,o){if(E&1){const M=s.\u0275\u0275getCurrentView();s.\u0275\u0275elementStart(0,"crt-button",25),s.\u0275\u0275pipe(1,"translate"),s.\u0275\u0275listener("clicked",function(){s.\u0275\u0275restoreView(M);const F=s.\u0275\u0275nextContext();return s.\u0275\u0275resetView(F.onCancelClick())}),s.\u0275\u0275text(2),s.\u0275\u0275pipe(3,"translate"),s.\u0275\u0275elementEnd()}E&2&&(s.\u0275\u0275propertyInterpolate("title",s.\u0275\u0275pipeBind1(1,2,"MessageComposer.CancelButtonHint")),s.\u0275\u0275advance(2),s.\u0275\u0275textInterpolate1("",s.\u0275\u0275pipeBind1(3,4,"MessageComposer.CancelButtonText")," "))}function ae(E,o){if(E&1){const M=s.\u0275\u0275getCurrentView();s.\u0275\u0275elementStart(0,"crt-button",26),s.\u0275\u0275pipe(1,"translate"),s.\u0275\u0275listener("clicked",function(){s.\u0275\u0275restoreView(M);const F=s.\u0275\u0275nextContext();return s.\u0275\u0275resetView(F.onSaveDraftClick())}),s.\u0275\u0275text(2),s.\u0275\u0275pipe(3,"translate"),s.\u0275\u0275elementEnd()}E&2&&(s.\u0275\u0275propertyInterpolate("title",s.\u0275\u0275pipeBind1(1,2,"MessageComposer.SaveDraftButtonText")),s.\u0275\u0275advance(2),s.\u0275\u0275textInterpolate1("",s.\u0275\u0275pipeBind1(3,4,"MessageComposer.SaveDraftButtonText")," "))}let i=class Ae{set height(o){o&&(this._height=o+"px")}set dataCachingService(o){this._dataCachingService=o}get dataCachingService(){return(0,N.isEmpty)(this._dataCachingService)&&(this._dataCachingService=this._injector.get(B.$)),this._dataCachingService}constructor(o,M,P,F,X,te,pe,me,he){this._injector=o,this._fileService=M,this._fileIconService=P,this._richTextEditorUploadService=F,this._sysSettingsService=X,this._changeDetectorRef=te,this._messageDialogProvider=pe,this._copilotToEditorCommunicationService=me,this._liveAnnouncementService=he,this._publishMessageHotKeys=["ctrl+enter","command+enter"],this._publishKeyboardAction="publishMessage",this._bytesInMegabyte=1024*1024,this._setCacheDraftDataDebounce=300,this._filterExtensions="",this._disableFileSecurityMode="9801c625-fafb-4ed3-9383-c3c942a5c1e3",this._denyFileSecurityMode="60849c6e-24b4-45df-9aad-2f69d419823c",this._fileSecurityMode=this._denyFileSecurityMode,this._maxFileSize=0,this.keyboardHotkeysMap={keydown:{[this._publishKeyboardAction]:{sequence:this._publishMessageHotKeys}}},this.inputControl=new t.FormControl(null),this.attachments=[],this.disabled=!1,this.sendingButtonDisabled=!1,this.footerPanelExpanded=!1,this.selectionChange=new s.EventEmitter,this.footerPanelIndent=0,this.useTemplates=!1,this.useDrafts=!1,this.discardBtnVisible=!1,this.maxAttachmentsSize=0,this.messageChangesCancel=new s.EventEmitter,this.composerCleared=new s.EventEmitter,this.messageInputFocus=new s.EventEmitter,this.messageInputBlur=new s.EventEmitter,this.messageInputClick=new s.EventEmitter,this.messageChanged=new s.EventEmitter,this.messagePublish=new s.EventEmitter,this.selectTemplate=new s.EventEmitter,this.attachmentAdded=new s.EventEmitter,this.saveDraft=new s.EventEmitter,this.newMention=new s.EventEmitter,this._snackBar=o.get(_.MatSnackBar),this._translateService=o.get(A.TranslateService),this._featureValues=o.get(T.G);const ue="FileExtensionsDenyList",ve="FileExtensionsAllowList";this._sysSettingsService.getByCodes(["FileSecurityMode","MaxFileSize",ue,ve]).subscribe(Me=>{if(Me?.success&&(this._maxFileSize=Me.values.MaxFileSize?.value||0,this._fileSecurityMode=Me.values.FileSecurityMode?.value.toLowerCase()||this._denyFileSecurityMode,this._fileSecurityMode!==this._disableFileSecurityMode)){const Se=this._fileSecurityMode===this._denyFileSecurityMode?ue:ve;this._filterExtensions=Me.values[Se]?.value||""}})}get extendableMessageComposer(){return this._featureValues.ExtendableMessageComposer}_blurCurrentElement(){document.activeElement.blur()}_isContentTypeString(o){return o?.byteLength===void 0}_convertToBase64String(o){return this._isContentTypeString(o)?o:(0,L.M6)(o)}_cacheInputMessage(){if((0,N.isEmpty)(this.inputControl?.value))this.dataCachingService.remove(this.composerCacheCode);else try{this.dataCachingService.set(this.composerCacheCode,this.inputControl.value)}catch(o){console.error(o),this.dataCachingService.remove(this.composerCacheCode)}}_setCacheDraftData(o){if((0,N.isEmpty)(o))return;const M=this.dataCachingService.get(o)??"";if(!(0,N.isEmpty)(M)){const P=this.inputControl?.value??"";if(P.includes(M))return;this.inputControl.setValue(M+P)}}_waitScrollEnd(){return new Promise(o=>{const M=this.baseMessageComposerWrap?.nativeElement;if(!M){o(!0);return}const P=new IntersectionObserver(F=>{const[X]=F;X.isIntersecting&&(P?.unobserve(M),o(!0))});P.observe(M)})}_getOversizeAttachmentsErrorMessage(o){o=o.reverse();const M=this._translateService.instant("InfoDialog.FileUpload.MaxFileSizeExceededExceptionMessage"),P=`\r
\r
`,F=this._translateService.instant("InfoDialog.FileUpload.FileListHeader"),X=M+P+F+`:\r
{1}`;let te="";return te+=(0,S.formatString)(X,this._maxFileSize,o.map(pe=>"- "+pe).join(`\r
`)),te+=P,te+=this._translateService.instant("InfoDialog.FileUpload.ChangeFileSizeInfoMessage"),te}_getExtensionAttachmentsErrorMessage(o){const M=(0,N.groupBy)(o,me=>me.name.split(".").pop().toLowerCase()),P=this._fileSecurityMode===this._denyFileSecurityMode?"InvalidExtension.Deny":"InvalidExtension.Allow",F=this._translateService.instant("InfoDialog.FileUpload."+P),X=`\r
\r
`,te=this._translateService.instant("InfoDialog.FileUpload.FileListHeader");let pe="";for(const me in M)if(Object.prototype.hasOwnProperty.call(M,me)){const he=M[me];let ue=(0,S.formatString)(F+X+te+`:\r
`,me);he.forEach(ve=>{ue+="- "+ve.name+`\r
`}),pe+=ue+`\r
`}return pe}_isFileExtensionAllowed(o){if(this._fileSecurityMode===this._disableFileSecurityMode)return!0;const M=o.name.split(".").pop().toLowerCase(),P=this._filterExtensions.toLowerCase();return this._fileSecurityMode===this._denyFileSecurityMode?P.indexOf(M)===-1:P.indexOf(M)>=0}_validateAttachmentsSize(o){if(this.maxAttachmentsSize<=0)return!0;let M=0;this.attachments.forEach(F=>M+=F.size?F.size:F.file.size);for(const F in o)if(Object.prototype.hasOwnProperty.call(o,F)){const X=o[F].size;X&&(M+=X)}const P=M/this._bytesInMegabyte<=this.maxAttachmentsSize;if(!P){const F=(0,S.formatString)(this._translateService.instant("MessageComposer.Email.AttachmentsSizeLimitReached"),this.maxAttachmentsSize);this._messageDialogProvider.error(F)}return P}_removeCopilotHighlighting(){this._copilotToEditorCommunicationService?.notify({editorAction:R.u.RemoveHighlighting})}showSnackbar(o){this._snackBar.openFromComponent(o,{duration:3e3,panelClass:"message-action-snackbar-container"})}onMessageInputBlur(){this._cacheInputMessage(),this.messageInputBlur.emit()}onMessageInputFocus(){this.disabled||this.messageInputFocus.emit()}onMessagePublish(){this._removeCopilotHighlighting(),this.messagePublish.emit()}focus(){this.disabled||(this.footerPanelExpanded=!0,this._waitScrollEnd().then(()=>{this.crtRichTextInput?.focus(),this.messageInputFocus.emit()}))}onInputClick(){this.disabled||(this.footerPanelExpanded=!0,this.messageInputClick.emit())}onHotKeyPressed({action:o,event:M}){o===this._publishKeyboardAction&&!this.sendingButtonDisabled&&(M.preventDefault(),this._blurCurrentElement(),this.onMessagePublish())}onCancelClick(){this._messageDialogProvider.confirmation("CanDiscardUnsavedData.Default.Message").subscribe(o=>{o&&(this.clear(),this.messageChangesCancel.emit())})}onSaveDraftClick(){this._removeCopilotHighlighting(),this.dataCachingService.remove(this.composerCacheCode),this.saveDraft.emit()}onRichTextFilesUploaded(o){const M=o.map(({file:P,fileId:F})=>(P.id=F,P));this.uploadFiles({target:{files:M}})}uploadFiles({target:o}){if(!this._validateAttachmentsSize(o.files))return;const M=[],P=[],F=Array.from(o.files).map(te=>this._maxFileSize>0&&te.size/this._bytesInMegabyte>=this._maxFileSize?(M.push(te.name),(0,J.of)(!0)):this._isFileExtensionAllowed(te)?this._fileService.read(te).pipe((0,m.switchMap)(he=>(he.id=(0,N.isEmpty)(te.id)?(0,d.qv)():te.id,this.attachments.some(ue=>ue.file.id===he.id)||(this.attachments=[...this.attachments,he]),this._changeDetectorRef.markForCheck(),(0,J.of)(!0)))):(P.push(te),(0,J.of)(!0)));let X="";P.length>0&&(X+=this._getExtensionAttachmentsErrorMessage(P)),M.length>0?X+=this._getOversizeAttachmentsErrorMessage(M):(0,N.isEmpty)(X)||(X=X.slice(0,-4)),(0,N.isEmpty)(X)||this._messageDialogProvider.error(X),o.value="",(0,J.forkJoin)(F).subscribe(()=>{this.attachmentAdded.emit(),this._liveAnnouncementService.announce("MessageComposer.Attachment.Added"),this._changeDetectorRef.markForCheck()})}onRemoveAttachClick(o){this.attachments=this.attachments.filter(M=>M.id!==o),this.crtRichTextInput.removeReadyToUploadFile(o),this._liveAnnouncementService.announce("MessageComposer.Attachment.Removed"),this._changeDetectorRef.markForCheck()}onMessageChanged(){this.messageChanged.emit()}clear(){this.crtRichTextInput?.focus(),this.dataCachingService.remove(this.composerCacheCode),this.inputControl.setValue(""),this.crtRichTextInput?.clearSelection(),this.attachments.forEach(o=>this.crtRichTextInput.removeReadyToUploadFile(o.id)),this.attachments=[],this._blurCurrentElement(),this._changeDetectorRef.markForCheck(),this.composerCleared.emit()}getValue(){return this.inputControl.value}setValue(o){this.inputControl.setValue(o)}onSelectAttachments(){this.attachUploadElement.nativeElement.click()}canShowPreview(o){return this._featureValues.ShowAttachmentsPreview?(this._isContentTypeString(o.content)?o.content!=="":o.content.byteLength>0)&&this.getFileIcon(o.file.name).startsWith(g.k.IMAGE):!1}getFilePreview(o){return this.canShowPreview(o)?`data:${o.file.type};base64,${this._convertToBase64String(o.content)}`:""}getFileIcon(o){return this._fileIconService.getFileIcon(o,"large")}saveInlineImagesToDb(o){return this._richTextEditorUploadService.uploadImages([this.crtRichTextInput.currentEditor],o).pipe((0,m.last)())}onSelectTemplate(){this.selectTemplate.emit()}onBeforeUnload(){this.crtRichTextInput?.isFocused&&this._cacheInputMessage()}isValueEmpty(){return(0,N.isEmpty)(this.inputControl.value)}isDiscardBtnVisible(){return this.discardBtnVisible||!this.isValueEmpty()}onNewMention(o){this.newMention.next(o)}ngOnChanges(o){const M=o.composerCacheCode?.currentValue;(0,N.debounce)(()=>this._setCacheDraftData(M),this._setCacheDraftDataDebounce)()}onSelectionChange(o){this.selectionChange.next(o)}static{this.\u0275fac=function(M){return new(M||Ae)(s.\u0275\u0275directiveInject(s.Injector),s.\u0275\u0275directiveInject($.d),s.\u0275\u0275directiveInject(C.H),s.\u0275\u0275directiveInject(D.H),s.\u0275\u0275directiveInject(c.A),s.\u0275\u0275directiveInject(s.ChangeDetectorRef),s.\u0275\u0275directiveInject(x.r),s.\u0275\u0275directiveInject(h.i),s.\u0275\u0275directiveInject(V.DW))}}static{this.\u0275cmp=s.\u0275\u0275defineComponent({type:Ae,selectors:[["crt-base-message-composer"]],viewQuery:function(M,P){if(M&1&&(s.\u0275\u0275viewQuery(Q,5),s.\u0275\u0275viewQuery(k,5),s.\u0275\u0275viewQuery(q,5)),M&2){let F;s.\u0275\u0275queryRefresh(F=s.\u0275\u0275loadQuery())&&(P.crtRichTextInput=F.first),s.\u0275\u0275queryRefresh(F=s.\u0275\u0275loadQuery())&&(P.attachUploadElement=F.first),s.\u0275\u0275queryRefresh(F=s.\u0275\u0275loadQuery())&&(P.baseMessageComposerWrap=F.first)}},hostVars:2,hostBindings:function(M,P){M&1&&s.\u0275\u0275listener("beforeunload",function(){return P.onBeforeUnload()},!1,s.\u0275\u0275resolveWindow),M&2&&s.\u0275\u0275styleProp("--height",P._height)},inputs:{disabled:"disabled",sendingButtonDisabled:"sendingButtonDisabled",footerPanelExpanded:"footerPanelExpanded",footerPanelOptions:"footerPanelOptions",channelSelector:"channelSelector",selectionActions:"selectionActions",disableSelectionOptions:"disableSelectionOptions",footerPanelIndent:"footerPanelIndent",inputPlaceHolder:"inputPlaceHolder",useTemplates:"useTemplates",useDrafts:"useDrafts",composerCacheCode:"composerCacheCode",discardBtnVisible:"discardBtnVisible",sendButtonIcon:"sendButtonIcon",maxAttachmentsSize:"maxAttachmentsSize",mentionsService:"mentionsService",height:"height",dataCachingService:"dataCachingService"},outputs:{selectionChange:"selectionChange",messageChangesCancel:"messageChangesCancel",composerCleared:"composerCleared",messageInputFocus:"messageInputFocus",messageInputBlur:"messageInputBlur",messageInputClick:"messageInputClick",messageChanged:"messageChanged",messagePublish:"messagePublish",selectTemplate:"selectTemplate",attachmentAdded:"attachmentAdded",saveDraft:"saveDraft",newMention:"newMention"},features:[s.\u0275\u0275NgOnChangesFeature],decls:20,vars:32,consts:[["baseMessageComposerWrap",""],["crtRichTextInput",""],["attachUploadElement",""],[1,"base-message-composer"],[1,"base-message-composer-input"],["labelPosition","hidden","data-qa","base-message-composer-text-input",1,"base-message-composer-input-field",3,"editorBlur","editorFocus","editorValueChanged","crtKeyboardHotkeyPressed","click","selectAttachments","selectTemplate","newMention","filesUploaded","selectionChange","crtKeyboardHotkeys","control","showClip","useTemplates","readonly","placeholder","mentionsService","useBodyFilesLinks","selectionActions","disableSelectionOptions","label"],[1,"message-composer-attachments"],["role","group","class","message-composer-attachment",4,"ngFor","ngForOf"],["data-qa","base-message-composer-footer",1,"base-message-composer-footer",3,"hidden","ngClass"],["type","file","multiple","",2,"display","none",3,"change"],[4,"ngIf"],[4,"ngTemplateOutlet"],[1,"base-message-composer-footer-actions"],["alt","discard","color","default","size","large","class","base-message-composer-footer-actions-button","data-qa","base-message-composer-cancel-btn",3,"title","clicked",4,"ngIf"],["alt","save draft","color","default","size","large","class","base-message-composer-footer-actions-button","data-qa","base-message-composer-save-draft-btn",3,"title","clicked",4,"ngIf"],["alt","send","color","accent","size","large","iconPosition","left-icon","data-qa","base-message-composer-submit-btn",1,"base-message-composer-footer-actions-button",3,"clicked","title","icon","disabled"],["role","group",1,"message-composer-attachment"],["class","message-composer-attachment-icon",4,"ngIf"],["matSuffix","","class","message-composer-attachment-icon",3,"svgIcon",4,"ngIf"],[1,"message-composer-attachment-name"],[1,"message-composer-attachment-size"],["tabindex","0","role","button","svgIcon","message-composer-attach-cross","data-qa","message-composer-attachment-remove-icon",1,"message-composer-attachment-remove-icon",3,"click","keydown.enter","title"],[1,"message-composer-attachment-icon"],[3,"src","alt"],["matSuffix","",1,"message-composer-attachment-icon",3,"svgIcon"],["alt","discard","color","default","size","large","data-qa","base-message-composer-cancel-btn",1,"base-message-composer-footer-actions-button",3,"clicked","title"],["alt","save draft","color","default","size","large","data-qa","base-message-composer-save-draft-btn",1,"base-message-composer-footer-actions-button",3,"clicked","title"]],template:function(M,P){if(M&1){const F=s.\u0275\u0275getCurrentView();s.\u0275\u0275elementStart(0,"div",3)(1,"div",4,0)(3,"crt-rich-text-editor",5,1),s.\u0275\u0275pipe(5,"translate"),s.\u0275\u0275listener("editorBlur",function(){return s.\u0275\u0275restoreView(F),s.\u0275\u0275resetView(P.onMessageInputBlur())})("editorFocus",function(){return s.\u0275\u0275restoreView(F),s.\u0275\u0275resetView(P.onMessageInputFocus())})("editorValueChanged",function(){return s.\u0275\u0275restoreView(F),s.\u0275\u0275resetView(P.onMessageChanged())})("crtKeyboardHotkeyPressed",function(te){return s.\u0275\u0275restoreView(F),s.\u0275\u0275resetView(P.onHotKeyPressed(te))})("click",function(){return s.\u0275\u0275restoreView(F),s.\u0275\u0275resetView(P.onInputClick())})("selectAttachments",function(){return s.\u0275\u0275restoreView(F),s.\u0275\u0275resetView(P.onSelectAttachments())})("selectTemplate",function(){return s.\u0275\u0275restoreView(F),s.\u0275\u0275resetView(P.onSelectTemplate())})("newMention",function(te){return s.\u0275\u0275restoreView(F),s.\u0275\u0275resetView(P.onNewMention(te))})("filesUploaded",function(te){return s.\u0275\u0275restoreView(F),s.\u0275\u0275resetView(P.onRichTextFilesUploaded(te))})("selectionChange",function(te){return s.\u0275\u0275restoreView(F),s.\u0275\u0275resetView(P.onSelectionChange(te))}),s.\u0275\u0275elementEnd()(),s.\u0275\u0275elementStart(6,"div",6),s.\u0275\u0275template(7,ye,11,13,"div",7),s.\u0275\u0275elementEnd(),s.\u0275\u0275elementStart(8,"div",8)(9,"input",9,2),s.\u0275\u0275listener("change",function(te){return s.\u0275\u0275restoreView(F),s.\u0275\u0275resetView(P.uploadFiles(te))}),s.\u0275\u0275elementEnd(),s.\u0275\u0275template(11,De,2,1,"div",10)(12,fe,1,0,"ng-container",11),s.\u0275\u0275elementStart(13,"div",12),s.\u0275\u0275template(14,Z,4,6,"crt-button",13)(15,ae,4,6,"crt-button",14),s.\u0275\u0275elementStart(16,"crt-button",15),s.\u0275\u0275pipe(17,"translate"),s.\u0275\u0275listener("clicked",function(){return s.\u0275\u0275restoreView(F),s.\u0275\u0275resetView(P.onMessagePublish())}),s.\u0275\u0275text(18),s.\u0275\u0275pipe(19,"translate"),s.\u0275\u0275elementEnd()()()()}M&2&&(s.\u0275\u0275advance(3),s.\u0275\u0275property("crtKeyboardHotkeys",P.keyboardHotkeysMap)("control",P.inputControl)("showClip",!0)("useTemplates",P.useTemplates)("readonly",P.disabled)("placeholder",P.inputPlaceHolder)("mentionsService",P.mentionsService)("useBodyFilesLinks",!1)("selectionActions",P.selectionActions)("disableSelectionOptions",P.disableSelectionOptions)("label",s.\u0275\u0275pipeBind1(5,24,"MessageComposer.ComposerAreaLabel")),s.\u0275\u0275advance(4),s.\u0275\u0275property("ngForOf",P.attachments),s.\u0275\u0275advance(),s.\u0275\u0275styleProp("margin-inline-start",P.footerPanelIndent,"px"),s.\u0275\u0275property("hidden",!P.footerPanelExpanded)("ngClass",s.\u0275\u0275pureFunction1(30,ee,P.extendableMessageComposer)),s.\u0275\u0275advance(3),s.\u0275\u0275property("ngIf",P.extendableMessageComposer),s.\u0275\u0275advance(),s.\u0275\u0275property("ngTemplateOutlet",P.footerPanelOptions),s.\u0275\u0275advance(2),s.\u0275\u0275property("ngIf",P.isDiscardBtnVisible()),s.\u0275\u0275advance(),s.\u0275\u0275property("ngIf",P.useDrafts&&!P.isValueEmpty()),s.\u0275\u0275advance(),s.\u0275\u0275propertyInterpolate("title",s.\u0275\u0275pipeBind1(17,26,"MessageComposer.SendButtonHint")),s.\u0275\u0275property("icon",P.sendButtonIcon)("disabled",P.sendingButtonDisabled),s.\u0275\u0275advance(2),s.\u0275\u0275textInterpolate1("",s.\u0275\u0275pipeBind1(19,28,"MessageComposer.SendButtonText")," "))},dependencies:[H.NgClass,H.NgForOf,H.NgIf,H.NgTemplateOutlet,ie.B,de.MatIcon,oe.R,ne.h,re.v,U.l,A.TranslatePipe],styles:[`body{--focus-outline-outer-color: var(--crt-palette-secondary-500);--focus-outline-inner-color: white}.base-message-composer{position:relative}.base-message-composer-footer{margin-top:7px;display:flex;justify-content:flex-end;align-items:center}.base-message-composer-footer.extendable-message-composer{justify-content:space-between}.base-message-composer-footer[hidden]{display:none;height:0px}.base-message-composer-footer-actions{display:flex}.base-message-composer-footer-actions .base-message-composer-footer-actions-button .crt-button.button-size-large{border-radius:4px;margin-inline-start:8px}.base-message-composer-input{display:flex}.base-message-composer-input-field{width:100%;margin-inline-start:0}.base-message-composer-input-field .crt-input,.base-message-composer-input-field .crt-input-control{padding-inline-end:0!important}.base-message-composer-input-field .rich-editor-wrapper{min-height:48px;border:1px solid var(--crt-palette-border-500);border-radius:8px}.base-message-composer-input-field .rich-editor-wrapper:hover,.base-message-composer-input-field .rich-editor-wrapper:focus-within{border:1px solid var(--crt-palette-primary-500)}.base-message-composer-input-field .rich-editor-wrapper [data-cke-editorplaceholder]:before{max-width:calc(100% - 44px)}.base-message-composer-input-field .rich-editor-wrapper .cke_editable{line-height:20px;padding-inline-start:16px;padding-top:16px;padding-bottom:16px;width:calc(100% - 22px);height:var(--height, unset)}.base-message-composer .message-composer-attachments{display:flex;flex-wrap:wrap;font-family:var(--crt-caption-font-family);font-size:var(--crt-caption-font-size);line-height:var(--crt-caption-line-height);font-weight:var(--crt-caption-font-weight);letter-spacing:var(--crt-caption-letter-spacing);text-transform:var(--crt-caption-text-transform);-webkit-font-smoothing:antialiased}.base-message-composer .message-composer-attachments .message-composer-attachment{display:flex;max-width:100%;margin-inline-end:30px;margin-top:10px}.base-message-composer .message-composer-attachments .message-composer-attachment-icon{width:24px;min-width:24px;height:17px;margin-inline-end:10px;border:1px solid var(--crt-palette-label-100);border-radius:4px}.base-message-composer .message-composer-attachments .message-composer-attachment-icon img{object-fit:contain;height:100%;width:100%}.base-message-composer .message-composer-attachments .message-composer-attachment-name{overflow:hidden;text-overflow:ellipsis;white-space:nowrap;margin-inline-end:10px}.base-message-composer .message-composer-attachments .message-composer-attachment-size{color:var(--crt-palette-label-500);margin-inline-end:10px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.base-message-composer .message-composer-attachments .message-composer-attachment-remove-icon{width:16px;min-width:8px;height:16px;cursor:pointer;color:var(--crt-palette-label-500)}.base-message-composer .message-composer-attachments .message-composer-attachment-remove-icon svg{height:8px}.base-message-composer .message-composer-attachments .message-composer-attachment-remove-icon:focus-visible{box-shadow:inset 0 0 0 1px var(--focus-outline-outer-color),inset 0 0 0 2px var(--focus-outline-inner-color);outline:none;border-radius:4px}.base-message-composer .base-message-composer-input .base-message-composer-input-field .rich-editor-wrapper div.icons{padding-inline-end:5px;position:absolute;right:0;background:var(--crt-palette-background-50);border-top-left-radius:12px;padding-top:2px}[dir=rtl] .base-message-composer .base-message-composer-input .base-message-composer-input-field .rich-editor-wrapper div.icons{left:0;border-top-right-radius:12px;border-top-left-radius:initial;right:auto}
`],encapsulation:2})}};(0,n.__decorate)([(0,r.k)(),(0,n.__metadata)("design:type",Object)],i.prototype,"disabled",void 0),(0,n.__decorate)([(0,r.k)(),(0,n.__metadata)("design:type",Object)],i.prototype,"sendingButtonDisabled",void 0),(0,n.__decorate)([(0,r.k)(),(0,n.__metadata)("design:type",Object)],i.prototype,"footerPanelExpanded",void 0),(0,n.__decorate)([(0,r.k)(),(0,n.__metadata)("design:type",s.TemplateRef)],i.prototype,"footerPanelOptions",void 0),(0,n.__decorate)([(0,r.k)(),(0,n.__metadata)("design:type",s.TemplateRef)],i.prototype,"channelSelector",void 0),(0,n.__decorate)([(0,r.k)(),(0,n.__metadata)("design:type",s.TemplateRef)],i.prototype,"selectionActions",void 0),(0,n.__decorate)([(0,p.j)(),(0,n.__metadata)("design:type",Object)],i.prototype,"selectionChange",void 0),(0,n.__decorate)([(0,r.k)(),(0,n.__metadata)("design:type",Boolean)],i.prototype,"disableSelectionOptions",void 0),(0,n.__decorate)([(0,r.k)(),(0,n.__metadata)("design:type",Object)],i.prototype,"footerPanelIndent",void 0),(0,n.__decorate)([(0,r.k)(),(0,n.__metadata)("design:type",String)],i.prototype,"inputPlaceHolder",void 0),(0,n.__decorate)([(0,r.k)(),(0,n.__metadata)("design:type",Object)],i.prototype,"useTemplates",void 0),(0,n.__decorate)([(0,r.k)(),(0,n.__metadata)("design:type",Object)],i.prototype,"useDrafts",void 0),(0,n.__decorate)([(0,r.k)(),(0,n.__metadata)("design:type",String)],i.prototype,"composerCacheCode",void 0),(0,n.__decorate)([(0,r.k)(),(0,n.__metadata)("design:type",Object)],i.prototype,"discardBtnVisible",void 0),(0,n.__decorate)([(0,r.k)(),(0,n.__metadata)("design:type",String)],i.prototype,"sendButtonIcon",void 0),(0,n.__decorate)([(0,r.k)(),(0,n.__metadata)("design:type",Object)],i.prototype,"maxAttachmentsSize",void 0),(0,n.__decorate)([(0,p.j)(),(0,n.__metadata)("design:type",Object)],i.prototype,"messageChangesCancel",void 0),(0,n.__decorate)([(0,p.j)(),(0,n.__metadata)("design:type",Object)],i.prototype,"composerCleared",void 0),(0,n.__decorate)([(0,p.j)(),(0,n.__metadata)("design:type",Object)],i.prototype,"messageInputFocus",void 0),(0,n.__decorate)([(0,p.j)(),(0,n.__metadata)("design:type",Object)],i.prototype,"messageInputBlur",void 0),(0,n.__decorate)([(0,p.j)(),(0,n.__metadata)("design:type",Object)],i.prototype,"messageInputClick",void 0),(0,n.__decorate)([(0,p.j)(),(0,n.__metadata)("design:type",Object)],i.prototype,"messageChanged",void 0),(0,n.__decorate)([(0,p.j)(),(0,n.__metadata)("design:type",Object)],i.prototype,"messagePublish",void 0),(0,n.__decorate)([(0,p.j)(),(0,n.__metadata)("design:type",Object)],i.prototype,"selectTemplate",void 0),(0,n.__decorate)([(0,p.j)(),(0,n.__metadata)("design:type",Object)],i.prototype,"attachmentAdded",void 0),(0,n.__decorate)([(0,p.j)(),(0,n.__metadata)("design:type",Object)],i.prototype,"saveDraft",void 0),(0,n.__decorate)([(0,r.k)(),(0,n.__metadata)("design:type",Object)],i.prototype,"mentionsService",void 0),(0,n.__decorate)([(0,r.k)(),(0,n.__metadata)("design:type",Number),(0,n.__metadata)("design:paramtypes",[Number])],i.prototype,"height",null),(0,n.__decorate)([(0,p.j)(),(0,n.__metadata)("design:type",Object)],i.prototype,"newMention",void 0),(0,n.__decorate)([(0,r.k)(),(0,n.__metadata)("design:type",B.$),(0,n.__metadata)("design:paramtypes",[B.$])],i.prototype,"dataCachingService",null),i=(0,n.__decorate)([(0,b.v)({type:"crt.BaseMessageComposer",reuseStrategy:W.B.Reuse}),(0,n.__metadata)("design:paramtypes",[s.Injector,$.d,C.H,D.H,c.A,s.ChangeDetectorRef,x.r,h.i,V.DW])],i)},10468:(z,O,e)=>{e.d(O,{l:()=>_});var n=e(68712),a=e(59131),s=e.n(a),l=e(79111),t=e(79772),y=e.n(t);class _ extends n.K{constructor(){super(...arguments),this.labelText="MessageComposer.MessageSent"}static{this.\u0275fac=(()=>{let d;return function(p){return(d||(d=a.\u0275\u0275getInheritedFactory(_)))(p||_)}})()}static{this.\u0275cmp=a.\u0275\u0275defineComponent({type:_,selectors:[["crt-base-snackbar-label"]],features:[a.\u0275\u0275InheritDefinitionFeature],decls:4,vars:3,consts:[[1,"message-snackbar-label-container"],["labelTextAlign","center"]],template:function(r,p){r&1&&(a.\u0275\u0275elementStart(0,"div",0)(1,"crt-label",1),a.\u0275\u0275text(2),a.\u0275\u0275pipe(3,"translate"),a.\u0275\u0275elementEnd()()),r&2&&(a.\u0275\u0275advance(2),a.\u0275\u0275textInterpolate(a.\u0275\u0275pipeBind1(3,1,p.labelText)))},dependencies:[l.V,t.TranslatePipe],styles:[`.message-action-snackbar-container{--mdc-snackbar-container-color: var(--crt-color-primary-black);opacity:.6!important}.message-action-snackbar-container .message-snackbar-label-container{width:100%}.message-action-snackbar-container .message-snackbar-label-container .crt-label{width:100%;color:var(--crt-palette-background-50)}
`],encapsulation:2})}}},52808:(z,O,e)=>{e.d(O,{B:()=>v});var n=e(5960),a=e.n(n),s=e(59131),l=e.n(s),t=e(77592),y=e(34760),_=e(1034),u=e(68712),d=e(40297),r=e.n(d),p=e(62115);const b=V=>({"selected-composer":V});function W(V,c){if(V&1){const g=s.\u0275\u0275getCurrentView();s.\u0275\u0275elementContainerStart(0),s.\u0275\u0275elementStart(1,"crt-button",2),s.\u0275\u0275listener("clicked",function(){const x=s.\u0275\u0275restoreView(g).$implicit,D=s.\u0275\u0275nextContext(2);return s.\u0275\u0275resetView(D.showComposer(x))}),s.\u0275\u0275elementEnd(),s.\u0275\u0275elementContainerEnd()}if(V&2){const g=c.$implicit,C=s.\u0275\u0275nextContext(2);s.\u0275\u0275advance(),s.\u0275\u0275property("ngClass",s.\u0275\u0275pureFunction1(3,b,C.isComposerSelected(g)))("icon",C.getComposerIcon(g))("caption",C.getComposerCaption(g))}}function A(V,c){if(V&1&&(s.\u0275\u0275elementContainerStart(0),s.\u0275\u0275template(1,W,2,5,"ng-container",1),s.\u0275\u0275elementContainerEnd()),V&2){const g=s.\u0275\u0275nextContext();s.\u0275\u0275advance(),s.\u0275\u0275property("ngForOf",g.visibleChannels)}}let v=class Te extends u.K{constructor(){super(...arguments),this._iconsMap={Email:"email-composer-icon",Feed:"feed-composer-icon"},this.selectedChannelIndexChange=new s.EventEmitter}get isVisible(){return this.visibleChannels?.length>1}get visibleChannels(){return this.channels?.filter(c=>c.visible!==!1)}set selectedChannelIndex(c){this._selectedChannelIndex=c,this.changeDetectorRef.markForCheck()}showComposer(c){this.selectedChannelIndex=this.channels.indexOf(c),this.selectedChannelIndexChange.emit(this._selectedChannelIndex)}getComposerIcon(c){const g=c.data;return g?.icon?g?.icon:this._iconsMap[g?.schemaType]||"send-icon"}getComposerCaption(c){return c.data?.caption||""}isComposerSelected(c){return this.channels.indexOf(c)===this._selectedChannelIndex}static{this.\u0275fac=(()=>{let c;return function(C){return(c||(c=s.\u0275\u0275getInheritedFactory(Te)))(C||Te)}})()}static{this.\u0275cmp=s.\u0275\u0275defineComponent({type:Te,selectors:[["crt-channel-selector"]],inputs:{channels:"channels",selectedChannelIndex:"selectedChannelIndex"},outputs:{selectedChannelIndexChange:"selectedChannelIndexChange"},features:[s.\u0275\u0275ProvidersFeature([]),s.\u0275\u0275InheritDefinitionFeature],decls:1,vars:1,consts:[[4,"ngIf"],[4,"ngFor","ngForOf"],["size","large","iconPosition","only-icon",1,"select-composer-button",3,"clicked","ngClass","icon","caption"]],template:function(g,C){g&1&&s.\u0275\u0275template(0,A,2,1,"ng-container",0),g&2&&s.\u0275\u0275property("ngIf",C.isVisible)},dependencies:[d.NgClass,d.NgForOf,d.NgIf,p.B],styles:[`.select-composer-button{margin-inline-end:4px;border-radius:8px}.select-composer-button button:hover{border-radius:8px}.select-composer-button.selected-composer{background-color:var(--crt-button-default-hover-color)}.select-composer-button.selected-composer button{color:var(--crt-palette-primary-500)!important}
`],encapsulation:2})}};(0,n.__decorate)([(0,t.k)(),(0,n.__metadata)("design:type",Array)],v.prototype,"channels",void 0),(0,n.__decorate)([(0,t.k)(),(0,n.__metadata)("design:type",Number),(0,n.__metadata)("design:paramtypes",[Number])],v.prototype,"selectedChannelIndex",null),(0,n.__decorate)([(0,y.j)(),(0,n.__metadata)("design:type",Object)],v.prototype,"selectedChannelIndexChange",void 0),v=(0,n.__decorate)([(0,_.v)({type:"crt.ChannelSelector"})],v)},74404:(z,O,e)=>{e.d(O,{Z:()=>r});var n=e(5960),a=e.n(n),s=e(59131),l=e.n(s),t=e(34760),y=e(77592),_=e(68712),u=e(58909);const d=["baseComposer"];class r extends _.K{constructor(b){super(b),this.injector=b,this.footerPanelExpanded=!1,this.maxAttachmentsSize=0,this.composerEventChange=new s.EventEmitter,this.selectionChange=new s.EventEmitter,this._elementRef=b.get(s.ElementRef)}publishInputFocusEvent(){this.composerEventChange.emit([{name:u.An,params:{isFocused:this.footerPanelExpanded}}]),this.baseComposer&&(this.baseComposer.maxAttachmentsSize=this.maxAttachmentsSize)}onMessageInputFocus(){this.footerPanelExpanded=!0,this.publishInputFocusEvent()}onMessageInputBlur(){this.baseComposer?.getValue()||(this.footerPanelExpanded=!1,this.publishInputFocusEvent())}onMessageInputClick(){this.baseComposer?.getValue()||(this.footerPanelExpanded=!0,this.publishInputFocusEvent())}sendComponentReadyEvent(b){this.composerEventChange.emit([{name:u.iQ,params:{composerSchemaType:b}}])}get element(){return this.elementRef?.nativeElement}onSelectionChange(b){this.selectionChange.next(b)}static{this.\u0275fac=function(W){return new(W||r)(s.\u0275\u0275directiveInject(s.Injector))}}static{this.\u0275dir=s.\u0275\u0275defineDirective({type:r,viewQuery:function(W,A){if(W&1&&s.\u0275\u0275viewQuery(d,5),W&2){let v;s.\u0275\u0275queryRefresh(v=s.\u0275\u0275loadQuery())&&(A.baseComposer=v.first)}},inputs:{maxAttachmentsSize:"maxAttachmentsSize",selection:"selection",disableSelectionOptions:"disableSelectionOptions"},outputs:{composerEventChange:"composerEventChange",selectionChange:"selectionChange"},features:[s.\u0275\u0275InheritDefinitionFeature]})}}(0,n.__decorate)([(0,t.j)(),(0,n.__metadata)("design:type",Object)],r.prototype,"composerEventChange",void 0),(0,n.__decorate)([(0,y.k)(),(0,n.__metadata)("design:type",String)],r.prototype,"selection",void 0),(0,n.__decorate)([(0,t.j)(),(0,n.__metadata)("design:type",Object)],r.prototype,"selectionChange",void 0),(0,n.__decorate)([(0,y.k)(),(0,n.__metadata)("design:type",Boolean)],r.prototype,"disableSelectionOptions",void 0)},20922:(z,O,e)=>{e.d(O,{u:()=>_});var n=e(10468),a=e(59131),s=e.n(a),l=e(79111),t=e(79772),y=e.n(t);class _ extends n.l{constructor(){super(...arguments),this.labelText="MessageComposer.Email.DraftSaved"}static{this.\u0275fac=(()=>{let d;return function(p){return(d||(d=a.\u0275\u0275getInheritedFactory(_)))(p||_)}})()}static{this.\u0275cmp=a.\u0275\u0275defineComponent({type:_,selectors:[["crt-draft-saved-snackbar-label"]],features:[a.\u0275\u0275InheritDefinitionFeature],decls:4,vars:3,consts:[[1,"message-snackbar-label-container"],["labelTextAlign","center"]],template:function(r,p){r&1&&(a.\u0275\u0275elementStart(0,"div",0)(1,"crt-label",1),a.\u0275\u0275text(2),a.\u0275\u0275pipe(3,"translate"),a.\u0275\u0275elementEnd()()),r&2&&(a.\u0275\u0275advance(2),a.\u0275\u0275textInterpolate(a.\u0275\u0275pipeBind1(3,1,p.labelText)))},dependencies:[l.V,t.TranslatePipe],styles:[`.message-action-snackbar-container{--mdc-snackbar-container-color: var(--crt-color-primary-black);opacity:.6!important}.message-action-snackbar-container .message-snackbar-label-container{width:100%}.message-action-snackbar-container .message-snackbar-label-container .crt-label{width:100%;color:var(--crt-palette-background-50)}
`],encapsulation:2})}}},30816:(z,O,e)=>{e.d(O,{n:()=>Z,P:()=>fe});var n=e(73308),a=e(5960),s=e(95567),l=e(40297),t=e(59131),y=e(56711),_=e(91775),u=e(6530),d=e(77592),r=e(34760),p=e(1034),b=e(96677),W=e(75456),A=e(10098),v=e(79772),V=e(88033),c=e(95145),g=e(31774),C;(function(ae){ae.DefaultMailbox="crt.DefaultSenderComposerRequest",ae.CaseMailbox="crt.CaseSenderComposerRequest"})(C||(C={}));var x=e(29423),D=e(23092),T=e(28399),R=e(62278),$=e(29957),h=e(16296),L=e(58909),N=e(46690),G=e(85688),J=e(55529),ce=e(59784),m=e(2023),f=e(74404),S=e(20922),I=e(82436),B=e(62115),H=e(58433),w=e(66803),ie=e(19344),de=e(2126),Ee=e(58551),oe=e(30306);const ne=["toRecipientSearch"],re=["ccRecipientSearch"],U=["bccRecipientSearch"],Q=[[["","channelsPanel",""]],[["","selectionActions",""]]],k=["[channelsPanel]","[selectionActions]"],q=ae=>({display:ae}),ee=()=>({height:"12px",width:"80%","margin-bottom":"5px","margin-top":"5px"});function _e(ae,i){if(ae&1&&(t.\u0275\u0275element(0,"crt-button",28),t.\u0275\u0275pipe(1,"translate")),ae&2){const E=t.\u0275\u0275nextContext();t.\u0275\u0275propertyInterpolate("title",t.\u0275\u0275pipeBind1(1,3,"MessageComposer.Email.ChangeReplyAction")),t.\u0275\u0275property("icon",E.getReplyActionIcon())("menuItems",E.itemActionItems)}}function Ce(ae,i){if(ae&1){const E=t.\u0275\u0275getCurrentView();t.\u0275\u0275elementStart(0,"crt-button",29),t.\u0275\u0275pipe(1,"translate"),t.\u0275\u0275listener("clicked",function(){t.\u0275\u0275restoreView(E);const M=t.\u0275\u0275nextContext();return t.\u0275\u0275resetView(M.toggleVisibleCc())}),t.\u0275\u0275text(2),t.\u0275\u0275pipe(3,"translate"),t.\u0275\u0275elementEnd()}ae&2&&(t.\u0275\u0275property("title",t.\u0275\u0275pipeBind1(1,2,"MessageComposer.Email.CC")),t.\u0275\u0275advance(2),t.\u0275\u0275textInterpolate1(" ",t.\u0275\u0275pipeBind1(3,4,"MessageComposer.Email.CcToggleCaption")," "))}function ye(ae,i){if(ae&1){const E=t.\u0275\u0275getCurrentView();t.\u0275\u0275elementStart(0,"crt-button",30),t.\u0275\u0275pipe(1,"translate"),t.\u0275\u0275listener("clicked",function(){t.\u0275\u0275restoreView(E);const M=t.\u0275\u0275nextContext();return t.\u0275\u0275resetView(M.toggleVisibleBcc())}),t.\u0275\u0275text(2),t.\u0275\u0275pipe(3,"translate"),t.\u0275\u0275elementEnd()}ae&2&&(t.\u0275\u0275property("title",t.\u0275\u0275pipeBind1(1,2,"MessageComposer.Email.BCC")),t.\u0275\u0275advance(2),t.\u0275\u0275textInterpolate1(" ",t.\u0275\u0275pipeBind1(3,4,"MessageComposer.Email.BccToggleCaption")," "))}function Pe(ae,i){ae&1&&t.\u0275\u0275projection(0)}function De(ae,i){ae&1&&t.\u0275\u0275projection(0,1)}class fe{}let Z=class xe extends f.Z{get activityId(){return this._activityId}get replyAction(){return this._replyAction}set replyAction(i){this._replyAction=i,this._updateLabelsWidth()}set from(i){if(this._from=i,this._skeletonLoading){this._defaultFrom=this._from;return}this._setFrom(this._from)}get from(){return this._from}set sendersMailboxes(i){if(i){if(this._sendersMailboxes=i,this.fromLookupValues=this._getFromLookupValues(this._sendersMailboxes),i.length>0){const E=i.length===1?i[0].senderEmailAddress:this._from;!(0,T.isEmpty)(E)&&!this.fromInputControl?.value&&this._setFrom(E)}this._mailboxSendersSet.next(this.maxAttachmentsSize)}}get sendersMailboxes(){return this._sendersMailboxes}set to(i){i!=null&&this.toInputControl?.setRecipients(i)}get to(){return this._to}set cc(i){i!=null&&this.ccInputControl?.setRecipients(i)}get cc(){return this._cc}set bcc(i){i!=null&&this.bccInputControl?.setRecipients(i)}get bcc(){return this._bcc}set body(i){i!=null&&this.baseComposer.setValue(i)}get body(){return this._body}set recipientsMailboxes(i){i?.recipients&&(this.toInputControl.rawRecipinets=i.recipients,this.ccInputControl.rawRecipinets=i.recipients,this.bccInputControl.rawRecipinets=i.recipients)}set emailId(i){this._debounceSetReplyAction(i)}set skeletonLoading(i){this._skeletonLoading=i}get skeletonLoading(){return this._skeletonLoading||this.loading}get cacheCode(){if((0,T.isEmpty)(this._userId)||!(0,T.isEmpty)(this.entitySchemaName)&&(0,T.isEmpty)(this.recordId)||this._replyAction===h.T.EditDraft)return"";let i=`email_composer_cache_data_${this._userId}_`;return!(0,T.isEmpty)(this.entitySchemaName)&&!(0,T.isEmpty)(this.recordId)&&(i+=`${this.entitySchemaName}_${this.recordId}`),i}set headerLabelsWidth(i){i&&(this._headerLabelsWidth=this.getReplyButtonVisible()?this._defaultHeaderLabelsWidth:i,this._headerLabelsWidthString=this._headerLabelsWidth+"px")}get headerLabelsWidth(){return this._headerLabelsWidth}set expandOnLoad(i){i&&this.onMessageInputFocus()}set composerEvent(i){i?.forEach(E=>{switch(E?.name){case L.M7:this._handleReplyAction(E.params?.emailId,E.params?.action);break;case L.J3:this._emailSaved(E.params.response);break}})}constructor(i,E){super(i),this._document=E,this._defaultAttachmentsSizeLimit=50,this._emailSchemaName="Activity",this._iconsMap={reply:"reply-message","reply-all":"reply-all-message",forward:"forward-message"},this._defaultHeaderLabelsWidth=136,this._debounceTime=500,this._skeletonLoading=!1,this._defaultFrom="",this._subscriptions=[],this._headers=[],this._postponeSignature=!1,this._mailboxSendersSet=new R.Subject,this._debounceSetSignature=(0,T.debounce)(this._setSignature,this._debounceTime),this._debounceSetReplyAction=(0,T.debounce)(o=>this._setReplyAction(o),this._debounceTime),this.fromInputControl=new y.FormControl(null),this.itemActionItems=[],this.subjectInputControl=new y.FormControl(null),this._defaultHeaderLabelsWidthString="136px",this.subjectChange=new t.EventEmitter,this.fromChange=new t.EventEmitter,this.toChange=new t.EventEmitter,this.ccChange=new t.EventEmitter,this.bccChange=new t.EventEmitter,this.bodyChange=new t.EventEmitter,this.isReplyExpanded=!1,this.visibleCc=!1,this.visibleCcChange=new t.EventEmitter,this.visibleBcc=!1,this.visibleBccChange=new t.EventEmitter,this.headerExpanded=!1,this.headerExpandedChange=new t.EventEmitter,this.emailComposerCleared=new t.EventEmitter,this.emailComposerSaved=new t.EventEmitter,this.refreshRecipients=new t.EventEmitter,this._isDesignTime=i.get(x.w,!1),this._sendEmailService=i.get(N.y),this._maskService=i.get(V.s),this._messageDialogProvider=i.get(g.r),this._translateService=i.get(v.TranslateService),this._sysSettingsService=i.get(c.A),this._emailsService=i.get(G.d),this._emailTemplatesService=i.get(J.B),this._emailSignatureService=i.get(ce.S),this.emailComposerCachingService=i.get(m.v),this._userInfo=i.get(D.oq),!this._isDesignTime&&(this._userId=this._userInfo.id,this._init(),this._initItemActionItems())}_initItemActionItems(){this.itemActionItems=[{caption:this._translateService.instant("MessageComposer.Email.Reply"),type:"crt.MenuItem",name:"Reply",icon:"reply-message",handleItemClick:()=>this.changeReplyAction(h.T.Reply)},{caption:this._translateService.instant("MessageComposer.Email.ReplyAll"),type:"crt.MenuItem",name:"ReplyAll",icon:"reply-all-message",handleItemClick:()=>this.changeReplyAction(h.T.ReplyAll)},{caption:this._translateService.instant("MessageComposer.Email.Forward"),type:"crt.MenuItem",name:"Forward",icon:"forward-message",handleItemClick:()=>this.changeReplyAction(h.T.Forward)}]}_init(){this._skeletonLoading=!0,this._subscribeToEvents(),this._subscriptions.push((0,R.of)(this._sysSettingsService.getValueByCode("MaxAttachmentsSize",this._defaultAttachmentsSizeLimit),this._mailboxSendersSet).pipe((0,R.concatAll)()).subscribe(i=>{this.maxAttachmentsSize=i,this._skeletonLoading=!1,this.changeDetectorRef.markForCheck(),this._requestDefaultSender().then(()=>this._setDefaultFrom())}))}_requestDefaultSender(){if((0,T.isEmpty)(this.defaultSenderRequest))return new Promise(E=>E());const i={type:this.defaultSenderRequest,...this._getDefaultSenderRequestParams()};return _.t.instance.process(i).then(E=>this._defaultFrom=E).then()}_getDefaultSenderRequestParams(){return{recordId:this.defaultSenderRequest===C.DefaultMailbox?this._userId:this.recordId}}_setDefaultFrom(){!(0,T.isEmpty)(this._defaultFrom)&&(0,T.isEmpty)(this.from)&&this._setFrom(this._defaultFrom)}_setFrom(i){if((0,T.isEmpty)(i))this.fromInputControl?.setValue("");else{i=i.toLowerCase();let E=this.fromLookupValues?.find(o=>o.displayValue.toLowerCase().trim()===i.trim());(0,T.isEmpty)(E)&&(E=this.fromLookupValues?.find(o=>o.displayValue.toLowerCase().includes(i))),E?(this.fromInputControl?.setValue(E),this._debounceSetSignature()):this.fromInputControl?.setValue("")}}_subscribeToEvents(){this._subscriptions.push(this.fromInputControl.valueChanges.pipe((0,R.startWith)(null),(0,R.pairwise)()).subscribe(([i,E])=>{(i??"")!==(E??"")&&this.fromChange.emit(E?.displayValue)})),this._subscriptions.push(this.subjectInputControl.valueChanges.pipe((0,R.startWith)(null),(0,R.pairwise)()).subscribe(([i,E])=>{i!==E&&this.subjectChange.emit(E)}))}_emailSaved(i){i.activityId===this._activityId&&(this._isDraftSaving?this._processDraftSaved(i):this._processEmailSaving(i).pipe((0,R.concatMap)(E=>this._processSendingResult(E))).subscribe())}_processDraftSaved(i){i.success?(this.baseComposer.showSnackbar(S.u),this._updateNextSteps(),this.onMessageCancel()):this._showErrorMessage(this._translateService.instant("MessageComposer.Email.SaveDraftError")),this._maskService.hideBodyMask()}_processEmailSaving(i){return i.success?this._sendEmailService.sendEmail(this._activityId):(0,R.of)(i)}_unsubscribeFromEvents(){this._subscriptions.forEach(i=>i?.unsubscribe())}_setReplyAction(i){!(0,T.isEmpty)(i)&&i!==u.To&&(this._replyAction=h.T.EditDraft,this._postponeSignature=!0,this._handleReplyAction(i,h.T.EditDraft))}_setSignature(){if(this._postponeSignature)return;const i=this.fromInputControl.value,E=this.baseComposer?.getValue();if((0,T.isEmpty)(i)&&(0,T.isEmpty)(E))return;const M=this.sendersMailboxes?.find(F=>F.id===i?.value),P=M?.useSignature?M?.signature:$.String.empty;this._subscriptions.push(this._emailSignatureService.updateSignatureInBody(E,P).subscribe(F=>this.baseComposer?.setValue(F)))}_handleReplyAction(i,E){if(!(!(0,T.isEmpty)(i)&&this._inReplyTo?.id===i&&this.replyAction===E)){if((0,T.isEmpty)(i)){this._clearFields(),window.requestAnimationFrame(()=>{this.baseComposer?.focus()});return}this._subscriptions.push(this._emailsService.getEmail(i,[h.T.Forward,h.T.EditDraft].includes(E)).pipe((0,R.concatMap)(o=>(this._inReplyTo=E===h.T.EditDraft?null:o,this.replyAction=E,E===h.T.EditDraft?(0,R.of)({...o,bodyShort:o.body}):this._emailsService.getReplyDraft(o,E)))).subscribe(o=>{E!==h.T.EditDraft?(this._inReplyTo.body=o.body,this._inReplyTo.bodyShort=o.bodyShort,this._activityId=null):this._activityId=o.id,this.isReplyExpanded=!1,this._postponeSignature=!1,this._fillForm(o,!0)}))}}_fillForm(i,E=!1){this.toInputControl.setRecipients(i.to),this.ccInputControl.setRecipients(i.cc),this.bccInputControl.setRecipients(i.bcc),this.setVisibleCc(i.cc?.length>0),this.setVisibleBcc(i.bcc?.length>0),this._headers=i.headers,this.subjectInputControl.setValue(i.subject);const o=this.baseComposer.getValue();if(!o||E){const P=!(0,T.isEmpty)(o)&&(0,T.isEmpty)(this._activityId)?this._emailsService.getDraftUserContent(o,!0):i.bodyShort;this.baseComposer.setValue(P)}this.replyAction===h.T.EditDraft?this.from=i.from:(this.from="",this._requestDefaultSender().then(()=>this._setDefaultFrom()));let M=[];E||(M=this.baseComposer.attachments.filter(P=>P.content.byteLength===void 0?P.content!=="":P.content.byteLength>0)),this.baseComposer.attachments=[...M,...i.attachments],this.baseComposer?.focus()}_getFromLookupValues(i){return i?.map(E=>({value:E.id,displayValue:E.senderDisplayValue?`${E.senderDisplayValue} <${E.senderEmailAddress}>`:E.senderEmailAddress}))}_getEmail(){const i=this.baseComposer.attachments;let E=!1;return this._activityId?E=!0:this._activityId=(0,u.qv)(),this.baseComposer.saveInlineImagesToDb({schemaName:this._emailSchemaName,recordId:this._activityId,fileSchemaName:""}).pipe((0,R.map)(()=>({id:this._activityId,from:this.fromInputControl?.value?.displayValue,to:this.toInputControl.getRecipients(),cc:this.ccInputControl.getRecipients(),bcc:this.bccInputControl.getRecipients(),subject:this.subjectInputControl?.value,body:this.baseComposer?.getValue(),isDraft:E,headers:(0,T.cloneDeep)(this._headers),attachments:i?.map(o=>({...o,recordId:this._activityId,fileEntitySchemaName:"ActivityFile",recordEntitySchemaName:this._emailSchemaName,recordColumnName:"Activity"}))})))}_validate(){const i=new Array;return this.fromInputControl.value||i.push(this._translateService.instant("MessageComposer.Email.FromValidationErrorMessage")),!this.toInputControl.validate()&&!this.ccInputControl.validate()&&!this.bccInputControl.validate()&&i.push(this._translateService.instant("MessageComposer.Email.ToValidationErrorMessage")),this.subjectInputControl.value||i.push(this._translateService.instant("MessageComposer.Email.SubjectValidationErrorMessage")),i.length>0?(this._showErrorMessage(i.join(`\r
\r
`)),!1):!0}_showErrorMessage(i){this._messageDialogProvider.error(i)}_onTemplateSelected(i){var E=this;return(0,n.A)(function*(){if(i&&!i.canceled){const M=(yield i?.getLookupValues())[0]?.value;if((0,T.isEmpty)(M))return;E._maskService.showBodyMask(),E._emailTemplatesService.getMultiLanguageTemplate(M,E.entitySchemaName,E.recordId).subscribe({next:P=>E._insertTemplate(P?.subjectTemplate,P?.textTemplate),error:P=>E._onErrorProcessedTemplate(P)})}})()}_onErrorProcessedTemplate(i=null){this._maskService.hideBodyMask(),i&&console.error(i),this._showErrorMessage("MessageComposer.Email.TemplateInsertError")}_insertTemplate(i,E){const o=this.baseComposer?.getValue();(0,T.isEmpty)(o)||(E+=o),this.baseComposer?.setValue(E),(0,T.isEmpty)(this.subjectInputControl?.value)&&this.subjectInputControl?.setValue(i),this._maskService.hideBodyMask(),this.baseComposer?.focus()}_saveEmail(i){this._inReplyTo&&!this.isReplyExpanded&&(i.body=this._emailsService.getSafeUserContentReplyBody(i.body,this._inReplyTo.body));const E={inReplyToId:this._inReplyTo?.id,masterRecordId:this.recordId,masterSchemaName:this.entitySchemaName,defaultValues:new Array,bindingColumns:new Array};this.bindingColumns&&this.bindingColumns.forEach(M=>{E.bindingColumns.push({activityColumnName:M.activityColumnName,formAttributeName:M.formAttributeName})});const o={email:i,params:E};return this.emailComposerSaved.emit(o),(0,R.of)()}_processSendingResult(i){if(i.success)this.baseComposer.showSnackbar(I.m),this._updateNextSteps(),this.onMessageCancel();else{const E=this._translateService.instant("MessageComposer.Email.PublishError");this._showErrorMessage($.String.format(E,i.errorInfo.message))}return this._maskService.hideBodyMask(),(0,R.of)(!0)}_updateNextSteps(){const i={type:"crt.ChangeNextStepsStateRequest",$context:null};_.t.instance.process(i)}_clearFields(){this._activityId=null,this.baseComposer?.clear(),this.fromInputControl?.setValue(""),this.toInputControl?.clear(),this.ccInputControl?.clear(),this.bccInputControl?.clear(),this.subjectInputControl?.setValue(""),this.replyAction=null,this._inReplyTo=null}_updateLabelsWidth(){this.getReplyButtonVisible()&&((!this.toInputControl||!this.ccInputControl||!this.bccInputControl)&&this.changeDetectorRef.detectChanges(),this.headerLabelsWidth=this._defaultHeaderLabelsWidth,this.toInputControl.recipientLabelWidth=this._defaultHeaderLabelsWidth,this.ccInputControl.recipientLabelWidth=this._defaultHeaderLabelsWidth,this.bccInputControl.recipientLabelWidth=this._defaultHeaderLabelsWidth)}getReplyButtonVisible(){return this.replyAction&&this.replyAction!==h.T.EditDraft}saveDraft(){this.subjectInputControl.value||this.subjectInputControl.setValue(this._translateService.instant("MessageComposer.Email.Draft").toUpperCase()),this._isDraftSaving=!0,this._maskService.showBodyMask(),this._subscriptions.push(this._getEmail().pipe((0,R.concatMap)(i=>this._saveEmail(i))).subscribe())}onSelectTemplate(){const i=this._emailTemplatesService.getTemplatesLookupConfig(this.entitySchemaName);i.afterClosed=E=>this._onTemplateSelected(E),_.t.instance.process(i)}onMessagePublish(){this._validate()&&(this._isDraftSaving=!1,this._maskService.showBodyMask(),this._subscriptions.push(this._getEmail().pipe((0,R.concatMap)(i=>this._saveEmail(i))).subscribe()))}onMessageChanged(){const i=this._document.getElementsByClassName("email-composer-reply-expander");i.length>0&&i[i.length-1].addEventListener("click",this.toggleReplyBody.bind(this)),this.bodyChange.emit(this.baseComposer.getValue())}setHeaderExpanded(i){this.headerExpanded=i,this.headerExpandedChange.emit(this.headerExpanded)}setVisibleCc(i){this.visibleCc=i,this.visibleCcChange.emit(this.visibleCc)}setVisibleBcc(i){this.visibleBcc=i,this.visibleBccChange.emit(this.visibleBcc)}onMessageCancel(){this._clearFields(),this.setHeaderExpanded(!1),this.setVisibleCc(!1),this.setVisibleBcc(!1)}onMessageInputFocus(){this.footerPanelExpanded=!0,this.publishInputFocusEvent(),this.setHeaderExpanded(!0)}onMessageInputBlur(){this.headerExpanded||(this.footerPanelExpanded=!1,this.publishInputFocusEvent())}onMessageInputClick(){this.headerExpanded||(this.footerPanelExpanded=!0,super.onMessageInputClick())}toggleVisibleCc(){this.setVisibleCc(!this.visibleCc)}toggleVisibleBcc(){this.setVisibleBcc(!this.visibleBcc)}getReplyActionIcon(){return this._iconsMap[this.replyAction]}changeReplyAction(i){if(i===this.replyAction)return;this.replyAction=i;let E=(0,R.of)(this._inReplyTo);i===h.T.Forward&&this._inReplyTo.attachments?.length===0&&(E=this._emailsService.getAttachments(this._inReplyTo.id).pipe((0,R.switchMap)(o=>(this._inReplyTo.attachments=o,(0,R.of)(this._inReplyTo))))),this._subscriptions.push(E.pipe((0,R.concatMap)(o=>this._emailsService.getReplyDraft(o,i))).subscribe(o=>{this._fillForm(o)}))}toggleReplyBody(){const i=this.baseComposer.getValue();this._inReplyTo.body=this._emailsService.getSafeUserContentReplyBody(i,this._inReplyTo.body),this.baseComposer.setValue(this._inReplyTo.body),this.isReplyExpanded=!0}onFromFocus(){this.setHeaderExpanded(!0)}ngOnDestroy(){this._unsubscribeFromEvents(),this._clearFields()}ngAfterViewInit(){this.sendComponentReadyEvent("Email")}loadRecipients({query:i,recipientsLength:E}){this.refreshRecipients.next({query:i,recipientsLength:E})}toChanged(i){this.toChange.next(i)}ccChanged(i){this.ccChange.next(i)}bccChanged(i){this.bccChange.next(i)}static{this.\u0275fac=function(E){return new(E||xe)(t.\u0275\u0275directiveInject(t.Injector),t.\u0275\u0275directiveInject(l.DOCUMENT))}}static{this.\u0275cmp=t.\u0275\u0275defineComponent({type:xe,selectors:[["crt-email-composer"]],viewQuery:function(E,o){if(E&1&&(t.\u0275\u0275viewQuery(ne,5),t.\u0275\u0275viewQuery(re,5),t.\u0275\u0275viewQuery(U,5)),E&2){let M;t.\u0275\u0275queryRefresh(M=t.\u0275\u0275loadQuery())&&(o.toInputControl=M.first),t.\u0275\u0275queryRefresh(M=t.\u0275\u0275loadQuery())&&(o.ccInputControl=M.first),t.\u0275\u0275queryRefresh(M=t.\u0275\u0275loadQuery())&&(o.bccInputControl=M.first)}},hostVars:4,hostBindings:function(E,o){E&2&&t.\u0275\u0275styleProp("--defaultHeaderLabelsWidthString",o._defaultHeaderLabelsWidthString)("--headerLabelsWidthString",o._headerLabelsWidthString)},inputs:{subject:"subject",from:"from",sendersMailboxes:"sendersMailboxes",to:"to",cc:"cc",bcc:"bcc",body:"body",recipientsMailboxes:"recipientsMailboxes",emailId:"emailId",skeletonLoading:"skeletonLoading",height:"height",defaultSenderRequest:"defaultSenderRequest",bindingColumns:"bindingColumns",recordId:"recordId",entitySchemaName:"entitySchemaName",isReplyExpanded:"isReplyExpanded",visibleCc:"visibleCc",visibleBcc:"visibleBcc",headerExpanded:"headerExpanded",headerLabelsWidth:"headerLabelsWidth",expandOnLoad:"expandOnLoad",composerEvent:"composerEvent"},outputs:{subjectChange:"subjectChange",fromChange:"fromChange",toChange:"toChange",ccChange:"ccChange",bccChange:"bccChange",bodyChange:"bodyChange",visibleCcChange:"visibleCcChange",visibleBccChange:"visibleBccChange",headerExpandedChange:"headerExpandedChange",emailComposerCleared:"emailComposerCleared",emailComposerSaved:"emailComposerSaved",refreshRecipients:"refreshRecipients"},features:[t.\u0275\u0275InheritDefinitionFeature],ngContentSelectors:k,decls:37,vars:58,consts:[["toRecipientSearch",""],["ccRecipientSearch",""],["bccRecipientSearch",""],["baseComposer",""],["channelSelector",""],["selectionActions",""],[1,"email-composer",3,"ngStyle"],[1,"email-composer-header"],[1,"email-composer-header-actions"],["class","email-composer-header-actions-button","size","large","clickMode","menu","data-qa","change-reply-action",3,"title","icon","menuItems",4,"ngIf"],[1,"email-composer-header-properties"],[1,"email-composer-header-properties-main"],[1,"email-composer-header-properties-main-from-field"],["data-qa","email-composer-from",1,"without-padding-top",3,"focusin","control","items","value","useStaticFiltering","label","labelPosition","appearance"],[1,"email-composer-header-properties-main-controls"],["displayType","text","data-qa","cc-button","class","email-composer-header-properties-main-controls-togglebtn",3,"title","clicked",4,"ngIf"],["displayType","text","data-qa","bcc-button","class","email-composer-header-properties-main-controls-togglebtn",3,"title","clicked",4,"ngIf"],[1,"email-composer-header-properties-collapsible"],["data-qa","email-composer-to",3,"recipientsChanged","loadRecipients","rawRecipients","recipientLabel","recipientLabelWidth"],[1,"email-composer-header-properties-collapsible-cc"],["data-qa","email-composer-cc",3,"recipientsChanged","loadRecipients","rawRecipients","recipientLabel","recipientLabelWidth"],[1,"email-composer-header-properties-collapsible-bcc"],["data-qa","email-composer-bcc",3,"recipientsChanged","loadRecipients","rawRecipients","recipientLabel","recipientLabelWidth"],[1,"email-composer-header-properties-collapsible-subject"],["data-qa","email-composer-subject",1,"without-padding-top",3,"control","value","appearance","label","labelPosition"],[3,"selectionChange","messagePublish","selectTemplate","messageChangesCancel","messageInputFocus","messageInputBlur","messageInputClick","messageChanged","saveDraft","composerCleared","composerCacheCode","inputPlaceHolder","footerPanelExpanded","channelSelector","selectionActions","disableSelectionOptions","useTemplates","useDrafts","height","discardBtnVisible","dataCachingService"],[3,"ngStyle"],["appearance","line","count","3",1,"email-composer-skeleton-loader",3,"styles"],["size","large","clickMode","menu","data-qa","change-reply-action",1,"email-composer-header-actions-button",3,"title","icon","menuItems"],["displayType","text","data-qa","cc-button",1,"email-composer-header-properties-main-controls-togglebtn",3,"clicked","title"],["displayType","text","data-qa","bcc-button",1,"email-composer-header-properties-main-controls-togglebtn",3,"clicked","title"]],template:function(E,o){if(E&1){const M=t.\u0275\u0275getCurrentView();t.\u0275\u0275projectionDef(Q),t.\u0275\u0275elementStart(0,"div",6)(1,"div",7)(2,"div",8),t.\u0275\u0275template(3,_e,2,5,"crt-button",9),t.\u0275\u0275elementEnd(),t.\u0275\u0275elementStart(4,"div",10)(5,"div",11)(6,"div",12)(7,"crt-combobox",13),t.\u0275\u0275pipe(8,"translate"),t.\u0275\u0275listener("focusin",function(){return t.\u0275\u0275restoreView(M),t.\u0275\u0275resetView(o.onFromFocus())}),t.\u0275\u0275elementEnd()(),t.\u0275\u0275elementStart(9,"div",14),t.\u0275\u0275template(10,Ce,4,6,"crt-button",15)(11,ye,4,6,"crt-button",16),t.\u0275\u0275elementEnd()(),t.\u0275\u0275elementStart(12,"div",17)(13,"crt-recipient-search",18,0),t.\u0275\u0275pipe(15,"translate"),t.\u0275\u0275listener("recipientsChanged",function(F){return t.\u0275\u0275restoreView(M),t.\u0275\u0275resetView(o.toChanged(F))})("loadRecipients",function(F){return t.\u0275\u0275restoreView(M),t.\u0275\u0275resetView(o.loadRecipients(F))}),t.\u0275\u0275elementEnd(),t.\u0275\u0275elementStart(16,"div",19)(17,"crt-recipient-search",20,1),t.\u0275\u0275pipe(19,"translate"),t.\u0275\u0275listener("recipientsChanged",function(F){return t.\u0275\u0275restoreView(M),t.\u0275\u0275resetView(o.ccChanged(F))})("loadRecipients",function(F){return t.\u0275\u0275restoreView(M),t.\u0275\u0275resetView(o.loadRecipients(F))}),t.\u0275\u0275elementEnd()(),t.\u0275\u0275elementStart(20,"div",21)(21,"crt-recipient-search",22,2),t.\u0275\u0275pipe(23,"translate"),t.\u0275\u0275listener("recipientsChanged",function(F){return t.\u0275\u0275restoreView(M),t.\u0275\u0275resetView(o.bccChanged(F))})("loadRecipients",function(F){return t.\u0275\u0275restoreView(M),t.\u0275\u0275resetView(o.loadRecipients(F))}),t.\u0275\u0275elementEnd()(),t.\u0275\u0275elementStart(24,"div",23),t.\u0275\u0275element(25,"crt-input",24),t.\u0275\u0275pipe(26,"translate"),t.\u0275\u0275elementEnd()()()(),t.\u0275\u0275elementStart(27,"crt-base-message-composer",25,3),t.\u0275\u0275pipe(29,"translate"),t.\u0275\u0275listener("selectionChange",function(F){return t.\u0275\u0275restoreView(M),t.\u0275\u0275resetView(o.onSelectionChange(F))})("messagePublish",function(){return t.\u0275\u0275restoreView(M),t.\u0275\u0275resetView(o.onMessagePublish())})("selectTemplate",function(){return t.\u0275\u0275restoreView(M),t.\u0275\u0275resetView(o.onSelectTemplate())})("messageChangesCancel",function(){return t.\u0275\u0275restoreView(M),t.\u0275\u0275resetView(o.onMessageCancel())})("messageInputFocus",function(){return t.\u0275\u0275restoreView(M),t.\u0275\u0275resetView(o.onMessageInputFocus())})("messageInputBlur",function(){return t.\u0275\u0275restoreView(M),t.\u0275\u0275resetView(o.onMessageInputBlur())})("messageInputClick",function(){return t.\u0275\u0275restoreView(M),t.\u0275\u0275resetView(o.onMessageInputClick())})("messageChanged",function(){return t.\u0275\u0275restoreView(M),t.\u0275\u0275resetView(o.onMessageChanged())})("saveDraft",function(){return t.\u0275\u0275restoreView(M),t.\u0275\u0275resetView(o.saveDraft())})("composerCleared",function(){return t.\u0275\u0275restoreView(M),t.\u0275\u0275resetView(o.emailComposerCleared.emit())}),t.\u0275\u0275elementEnd(),t.\u0275\u0275template(30,Pe,1,0,"ng-template",null,4,t.\u0275\u0275templateRefExtractor)(32,De,1,0,"ng-template",null,5,t.\u0275\u0275templateRefExtractor),t.\u0275\u0275elementEnd(),t.\u0275\u0275elementStart(34,"div",26),t.\u0275\u0275element(35,"crt-skeleton-loader",27)(36,"crt-base-message-composer-skeleton"),t.\u0275\u0275elementEnd()}if(E&2){const M=t.\u0275\u0275reference(31),P=t.\u0275\u0275reference(33);t.\u0275\u0275property("ngStyle",t.\u0275\u0275pureFunction1(53,q,o.skeletonLoading?"none":"")),t.\u0275\u0275advance(),t.\u0275\u0275property("@collapse",!o.headerExpanded),t.\u0275\u0275advance(2),t.\u0275\u0275property("ngIf",o.getReplyButtonVisible()),t.\u0275\u0275advance(4),t.\u0275\u0275property("control",o.fromInputControl)("items",o.fromLookupValues)("value",o.from)("useStaticFiltering",!0)("label",t.\u0275\u0275pipeBind1(8,41,"MessageComposer.Email.From"))("labelPosition","left")("appearance","legacy"),t.\u0275\u0275advance(3),t.\u0275\u0275property("ngIf",!o.visibleCc),t.\u0275\u0275advance(),t.\u0275\u0275property("ngIf",o.visibleCc&&!o.visibleBcc),t.\u0275\u0275advance(2),t.\u0275\u0275property("rawRecipients",o.recipientsMailboxes)("recipientLabel",t.\u0275\u0275pipeBind1(15,43,"MessageComposer.Email.To"))("recipientLabelWidth",o.headerLabelsWidth),t.\u0275\u0275advance(3),t.\u0275\u0275property("@collapse",!o.visibleCc),t.\u0275\u0275advance(),t.\u0275\u0275property("rawRecipients",o.recipientsMailboxes)("recipientLabel",t.\u0275\u0275pipeBind1(19,45,"MessageComposer.Email.CC"))("recipientLabelWidth",o.headerLabelsWidth),t.\u0275\u0275advance(3),t.\u0275\u0275property("@collapse",!o.visibleBcc),t.\u0275\u0275advance(),t.\u0275\u0275property("rawRecipients",o.recipientsMailboxes)("recipientLabel",t.\u0275\u0275pipeBind1(23,47,"MessageComposer.Email.BCC"))("recipientLabelWidth",o.headerLabelsWidth),t.\u0275\u0275advance(4),t.\u0275\u0275property("control",o.subjectInputControl)("value",o.subject)("appearance","legacy")("label",t.\u0275\u0275pipeBind1(26,49,"MessageComposer.Email.Subject"))("labelPosition","left"),t.\u0275\u0275advance(2),t.\u0275\u0275property("composerCacheCode",o.cacheCode)("inputPlaceHolder",t.\u0275\u0275pipeBind1(29,51,"MessageComposer.Email.BodyPlaceholder"))("footerPanelExpanded",o.footerPanelExpanded)("channelSelector",M)("selectionActions",P)("disableSelectionOptions",o.disableSelectionOptions)("useTemplates",!0)("useDrafts",!0)("height",o.height)("discardBtnVisible",o.headerExpanded)("dataCachingService",o.emailComposerCachingService),t.\u0275\u0275advance(7),t.\u0275\u0275property("ngStyle",t.\u0275\u0275pureFunction1(55,q,o.skeletonLoading?"":"none")),t.\u0275\u0275advance(),t.\u0275\u0275property("styles",t.\u0275\u0275pureFunction0(57,ee))}},dependencies:[l.NgIf,l.NgStyle,B.B,H.W,w.q,ie.j,de.m,Ee.l,oe.E,v.TranslatePipe],styles:[`@charset "UTF-8";.email-composer-header{display:flex}.email-composer-header-actions{position:absolute}.email-composer-header-properties{width:100%}.email-composer-header-properties-main{display:flex}.email-composer-header-properties-main-from-field{width:80%}.email-composer-header-properties-main-controls{width:20%;display:flex;justify-content:flex-end}.email-composer-header-properties-main-controls-togglebtn{margin-left:8px}.email-composer-reply-expander{width:48px}.email-composer-reply-expander:after{content:"\\22ef";width:16px;height:24px;font-size:18px;background-color:var(--crt-palette-interaction-400);padding:0 16px;line-height:22px;border-radius:8px;cursor:pointer;display:block}.email-composer-reply-expander:hover{color:var(--crt-palette-primary-500)}.email-composer .email-composer-header-properties-main-from-field crt-combobox.without-padding-top .crt-input,.email-composer .email-composer-header-properties-collapsible-subject crt-input.without-padding-top .crt-input,.email-composer .recipients-container{padding-top:0}.email-composer .email-composer-header-properties-collapsible-subject crt-input.crt-base-edit-input .crt-base-input-container .crt-input .crt-input-label-container,.email-composer .email-composer-header-properties-main-from-field crt-combobox.crt-base-edit-input .crt-base-input-container .crt-input .crt-input-label-container{width:var(--headerLabelsWidthString, var(--defaultHeaderLabelsWidthString));min-width:var(--headerLabelsWidthString, var(--defaultHeaderLabelsWidthString))}.email-composer .email-composer-header-properties .email-composer-header-properties-main-controls crt-button.email-composer-header-properties-main-controls-togglebtn button.crt-button{padding:0 5px}.email-composer-skeleton-loader{justify-content:space-between;text-align:end}
`],encapsulation:2,data:{animation:[(0,s.trigger)("collapse",[(0,s.state)("false",(0,s.style)({height:s.AUTO_STYLE,visibility:s.AUTO_STYLE,overflow:"hidden",opacity:1})),(0,s.state)("true",(0,s.style)({height:"0",visibility:"hidden",overflow:"hidden",opacity:0})),(0,s.transition)("false => true",(0,s.animate)("300ms ease-in")),(0,s.transition)("true => false",(0,s.animate)("300ms ease-out"))])]}})}};(0,a.__decorate)([(0,d.k)(),(0,a.__metadata)("design:type",$.String)],Z.prototype,"subject",void 0),(0,a.__decorate)([(0,r.j)(),(0,a.__metadata)("design:type",Object)],Z.prototype,"subjectChange",void 0),(0,a.__decorate)([(0,d.k)(),(0,a.__metadata)("design:type",$.String),(0,a.__metadata)("design:paramtypes",[$.String])],Z.prototype,"from",null),(0,a.__decorate)([(0,r.j)(),(0,a.__metadata)("design:type",Object)],Z.prototype,"fromChange",void 0),(0,a.__decorate)([(0,d.k)(),(0,a.__metadata)("design:type",Array),(0,a.__metadata)("design:paramtypes",[Array])],Z.prototype,"sendersMailboxes",null),(0,a.__decorate)([(0,d.k)(),(0,a.__metadata)("design:type",Array),(0,a.__metadata)("design:paramtypes",[Array])],Z.prototype,"to",null),(0,a.__decorate)([(0,r.j)(),(0,a.__metadata)("design:type",Object)],Z.prototype,"toChange",void 0),(0,a.__decorate)([(0,d.k)(),(0,a.__metadata)("design:type",Array),(0,a.__metadata)("design:paramtypes",[Array])],Z.prototype,"cc",null),(0,a.__decorate)([(0,r.j)(),(0,a.__metadata)("design:type",Object)],Z.prototype,"ccChange",void 0),(0,a.__decorate)([(0,d.k)(),(0,a.__metadata)("design:type",Array),(0,a.__metadata)("design:paramtypes",[Array])],Z.prototype,"bcc",null),(0,a.__decorate)([(0,r.j)(),(0,a.__metadata)("design:type",Object)],Z.prototype,"bccChange",void 0),(0,a.__decorate)([(0,d.k)(),(0,a.__metadata)("design:type",$.String),(0,a.__metadata)("design:paramtypes",[$.String])],Z.prototype,"body",null),(0,a.__decorate)([(0,r.j)(),(0,a.__metadata)("design:type",Object)],Z.prototype,"bodyChange",void 0),(0,a.__decorate)([(0,d.k)(),(0,a.__metadata)("design:type",fe),(0,a.__metadata)("design:paramtypes",[fe])],Z.prototype,"recipientsMailboxes",null),(0,a.__decorate)([(0,d.k)(),(0,a.__metadata)("design:type",$.String),(0,a.__metadata)("design:paramtypes",[$.String])],Z.prototype,"emailId",null),(0,a.__decorate)([(0,d.k)(),(0,a.__metadata)("design:type",Boolean),(0,a.__metadata)("design:paramtypes",[Boolean])],Z.prototype,"skeletonLoading",null),(0,a.__decorate)([(0,d.k)(),(0,a.__metadata)("design:type",Number)],Z.prototype,"height",void 0),(0,a.__decorate)([(0,d.k)(),(0,a.__metadata)("design:type",$.String)],Z.prototype,"defaultSenderRequest",void 0),(0,a.__decorate)([(0,d.k)(),(0,a.__metadata)("design:type",Array)],Z.prototype,"bindingColumns",void 0),(0,a.__decorate)([(0,d.k)(),(0,a.__metadata)("design:type",$.String)],Z.prototype,"recordId",void 0),(0,a.__decorate)([(0,d.k)(),(0,a.__metadata)("design:type",$.String)],Z.prototype,"entitySchemaName",void 0),(0,a.__decorate)([(0,d.k)(),(0,a.__metadata)("design:type",Object)],Z.prototype,"isReplyExpanded",void 0),(0,a.__decorate)([(0,d.k)(),(0,a.__metadata)("design:type",Object)],Z.prototype,"visibleCc",void 0),(0,a.__decorate)([(0,r.j)(),(0,a.__metadata)("design:type",Object)],Z.prototype,"visibleCcChange",void 0),(0,a.__decorate)([(0,d.k)(),(0,a.__metadata)("design:type",Object)],Z.prototype,"visibleBcc",void 0),(0,a.__decorate)([(0,r.j)(),(0,a.__metadata)("design:type",Object)],Z.prototype,"visibleBccChange",void 0),(0,a.__decorate)([(0,d.k)(),(0,a.__metadata)("design:type",Object)],Z.prototype,"headerExpanded",void 0),(0,a.__decorate)([(0,r.j)(),(0,a.__metadata)("design:type",Object)],Z.prototype,"headerExpandedChange",void 0),(0,a.__decorate)([(0,r.j)(),(0,a.__metadata)("design:type",Object)],Z.prototype,"emailComposerCleared",void 0),(0,a.__decorate)([(0,r.j)(),(0,a.__metadata)("design:type",Object)],Z.prototype,"emailComposerSaved",void 0),(0,a.__decorate)([(0,r.j)(),(0,a.__metadata)("design:type",Object)],Z.prototype,"refreshRecipients",void 0),(0,a.__decorate)([(0,d.k)(),(0,a.__metadata)("design:type",Number),(0,a.__metadata)("design:paramtypes",[Number])],Z.prototype,"headerLabelsWidth",null),(0,a.__decorate)([(0,d.k)(),(0,a.__metadata)("design:type",Boolean),(0,a.__metadata)("design:paramtypes",[Boolean])],Z.prototype,"expandOnLoad",null),(0,a.__decorate)([(0,d.k)(),(0,a.__metadata)("design:type",Array),(0,a.__metadata)("design:paramtypes",[Array])],Z.prototype,"composerEvent",null),Z=(0,a.__decorate)([(0,p.v)({type:"crt.EmailComposer",contentSlots:["channelsPanel","selectionActions"],reuseStrategy:b.B.Reuse}),(0,W.f)({propertiesPanelComponentTypeName:"crt.EmailComposerPropertiesPanel",viewElementGroupType:A.J.CustomElements,typeCaption:"MessageComposer.Email.Caption"}),(0,a.__metadata)("design:paramtypes",[t.Injector,Document])],Z)},82436:(z,O,e)=>{e.d(O,{m:()=>_});var n=e(10468),a=e(59131),s=e.n(a),l=e(79111),t=e(79772),y=e.n(t);class _ extends n.l{constructor(){super(...arguments),this.labelText="MessageComposer.Email.EmailSent"}static{this.\u0275fac=(()=>{let d;return function(p){return(d||(d=a.\u0275\u0275getInheritedFactory(_)))(p||_)}})()}static{this.\u0275cmp=a.\u0275\u0275defineComponent({type:_,selectors:[["crt-email-sent-snackbar-label"]],features:[a.\u0275\u0275InheritDefinitionFeature],decls:4,vars:3,consts:[[1,"message-snackbar-label-container"],["labelTextAlign","center"]],template:function(r,p){r&1&&(a.\u0275\u0275elementStart(0,"div",0)(1,"crt-label",1),a.\u0275\u0275text(2),a.\u0275\u0275pipe(3,"translate"),a.\u0275\u0275elementEnd()()),r&2&&(a.\u0275\u0275advance(2),a.\u0275\u0275textInterpolate(a.\u0275\u0275pipeBind1(3,1,p.labelText)))},dependencies:[l.V,t.TranslatePipe],styles:[`.message-action-snackbar-container{--mdc-snackbar-container-color: var(--crt-color-primary-black);opacity:.6!important}.message-action-snackbar-container .message-snackbar-label-container{width:100%}.message-action-snackbar-container .message-snackbar-label-container .crt-label{width:100%;color:var(--crt-palette-background-50)}
`],encapsulation:2})}}},23854:(z,O,e)=>{e.d(O,{r:()=>ne});var n=e(73308),a=e(5960),s=e.n(a),l=e(59131),t=e.n(l),y=e(61541),_=e(6530),u=e(77592),d=e(34760),r=e(1034),p=e(96677),b=e(75456),W=e(10098),A=e(79772),v=e.n(A),V=e(88033),c=e(60575),g=e(31774),C=e(4092),x=e(23092),D=e(28399),T=e.n(D),R=e(62278),$=e.n(R),h=e(58909),L=e(98488),N=e(79341),G=e(10468),J=e(52808),ce=e(74404),m=e(40297),f=e.n(m),S=e(90262),I=e(58551);const B=[[["","channelsPanel",""]],[["","selectionActions",""]]],H=["[channelsPanel]","[selectionActions]"];function w(re,U){re&1&&l.\u0275\u0275projection(0)}function ie(re,U){re&1&&l.\u0275\u0275projection(0,1)}function de(re,U){re&1&&l.\u0275\u0275element(0,"div",10)}function Ee(re,U){if(re&1){const Q=l.\u0275\u0275getCurrentView();l.\u0275\u0275elementStart(0,"div",6),l.\u0275\u0275template(1,de,1,0,"div",7),l.\u0275\u0275elementStart(2,"div",8)(3,"crt-slide-toggle",9),l.\u0275\u0275pipe(4,"translate"),l.\u0275\u0275pipe(5,"translate"),l.\u0275\u0275listener("toggleChange",function(q){l.\u0275\u0275restoreView(Q);const ee=l.\u0275\u0275nextContext(2);return l.\u0275\u0275resetView(ee.onExternalPublishingChange(q))})("keydown.enter",function(){l.\u0275\u0275restoreView(Q);const q=l.\u0275\u0275nextContext(2);return l.\u0275\u0275resetView(q.onExternalPublishingEnter())}),l.\u0275\u0275elementEnd()()()}if(re&2){const Q=l.\u0275\u0275nextContext(2);l.\u0275\u0275advance(),l.\u0275\u0275property("ngIf",Q.showFooterDivider),l.\u0275\u0275advance(2),l.\u0275\u0275property("default",Q.forExternal)("useDefaultWidth",!0),l.\u0275\u0275attribute("title",l.\u0275\u0275pipeBind1(4,5,"Feed.ExternalUserTagTooltip"))("aria-label",l.\u0275\u0275pipeBind1(5,7,"Feed.ExternalUserTagTooltip"))}}function oe(re,U){if(re&1&&l.\u0275\u0275template(0,Ee,6,9,"div",5),re&2){const Q=l.\u0275\u0275nextContext();l.\u0275\u0275property("ngIf",Q.allowExternalPost)}}let ne=class Be extends ce.Z{set composerEvent(U){U?.forEach(Q=>{Q?.name===h.Od&&(this.footerPanelIndent=Q?.params.offset)})}set allowExternalPost(U){this._allowExternalPost=U}get allowExternalPost(){return this._allowExternalPost&&!this._userInfo.isSSP}get showFooterDivider(){return!!(this.footerPanelIndent>0||this.channelsPanel?.length>0&&this.channelsPanel.first?.isVisible)}constructor(U,Q,k,q,ee,_e,Ce){super(U),this._feedMessageComposerService=Q,this._messageDialogProvider=k,this._maskService=q,this._feedMentionServiceFactory=ee,this._translateService=_e,this._userInfo=Ce,this._attachments=[],this._forExternalDefault=!1,this._forExternal=!1,this._allowExternalPost=!1,this._feedComposerTypeName="Feed",this._sendExternalBtnIcon="send-external-button-icon",this.footerPanelIndent=0,this.messageChangesCanceled=new l.EventEmitter,this.messagePosted=new l.EventEmitter,this.feedMentionService=this._feedMentionServiceFactory.getInstance(null,null),this._googleTagManager=U.get(c.A)}get _isNewMessage(){return(0,D.isEmpty)(this._messageId)}get _isChildMessage(){return!(0,D.isEmpty)(this._parentMessageId)}set parentMessageId(U){this._parentMessageId=U}set messageId(U){this._messageId=U}set message(U){this._message=U}set schemaUId(U){this._schemaUId=U}set forExternal(U){this._forExternal=U}get forExternal(){return this._forExternal}set forExternalDefault(U){this._forExternal=U,this._forExternalDefault=U}get forExternalDefault(){return this._forExternalDefault}get disabled(){return this.cardState===y.n.Add}get sendButtonIcon(){return this.forExternal?this._sendExternalBtnIcon:""}get placeholder(){const U=this.disabled?"Feed.Publisher.DisabledInputPlaceholder":"Feed.Publisher.DefaultInputPlaceholder";return this._translateService.instant(U)}get cacheCode(){const U=this._userInfo?.id;if(!this._isNewMessage||this._isChildMessage||(0,D.isEmpty)(U)||!(0,D.isEmpty)(this.entitySchemaName)&&(0,D.isEmpty)(this.primaryColumnValue))return"";let Q=`feed_composer_cache_data_${U}_`;return!(0,D.isEmpty)(this.entitySchemaName)&&!(0,D.isEmpty)(this.primaryColumnValue)&&(Q+=`${this.entitySchemaName}_${this.primaryColumnValue}`),Q}_getMessage(){const U=this._isNewMessage?(0,_.qv)():this._messageId,Q=this.baseComposer.attachments.map(k=>({...k,recordId:U,fileEntitySchemaName:"FeedFile",recordEntitySchemaName:"SocialMessage",recordColumnName:"RecordId"}));return this.baseComposer.saveInlineImagesToDb({schemaName:"SocialMessage",recordId:U,fileSchemaName:"FeedFile",recordColumnName:"RecordId"}).pipe((0,R.map)(()=>({Id:U,Message:this.baseComposer.getValue(),EntityId:this.primaryColumnValue,EntitySchemaName:this.entitySchemaName,Attachments:Q,EntitySchemaUId:this._schemaUId,UserAccess:this._forExternal?C.U.External:C.U.General})))}_onFeedMessagePublishError(){this._messageDialogProvider.error("Feed.Publisher.PostingErrorMsg"),this._maskService.hideBodyMask()}_onFeedMessageSuccessfullyPosted(U){this.baseComposer.clear(),this._forExternal=this._forExternalDefault,this._maskService.hideBodyMask(),this.baseComposer.showSnackbar(G.l),this.messagePosted.emit(U),this._sendGTMData()}_sendGTMData(){const U={moduleName:this._feedComposerTypeName,schemaName:"FeedComposer",action:"FeedPostAdded"};this._googleTagManager.track(U)}_createOrUpdateChildMessage(U){return this._isNewMessage?this._feedMessageComposerService.postChildMessage(U,this._parentMessageId):this._feedMessageComposerService.updateChildMessage(U)}_createOrUpdateMessage(U){return this._isNewMessage?this._feedMessageComposerService.postMessage(U):this._feedMessageComposerService.updateMessage(U)}_composeFeedMessage(U){return this._isChildMessage?this._createOrUpdateChildMessage(U):this._createOrUpdateMessage(U)}_validate(){const Q=(this.baseComposer?.getValue()||"").replace(/<(?!img)[^>]*>|\s|&nbsp;/g,""),k=!(0,D.isEmpty)(Q);return k||this._messageDialogProvider.info("Feed.Publisher.PostingEmptyMsg"),k}_confirmPublish(){if(this._isNewMessage&&this.allowExternalPost||this.forExternalDefault===this.forExternal||!this.forExternal)return Promise.resolve(!0);const U=this._isChildMessage?"Feed.Publisher.ConfirmCommentAccessLevelChange":"Feed.Publisher.ConfirmMessageAccessLevelChange";return(0,R.lastValueFrom)(this._messageDialogProvider.confirmation(U))}_loadAttachments(U,Q,k){this._feedMessageComposerService.loadAttachments(U,Q,k).subscribe(q=>{this._attachments=q?q.map(ee=>{const _e=new File([],ee.fileName);return{id:ee.fileId,size:ee.fileSize,file:_e,content:new ArrayBuffer(0)}}):[],this.baseComposer&&(this.baseComposer.attachments=this._attachments,this.changeDetectorRef.detectChanges())})}ngOnChanges(U){const Q=U.primaryColumnValue?.currentValue||this.primaryColumnValue,k=U.entitySchemaName?.currentValue||this.entitySchemaName,q=U.schemaUId?.currentValue||this._schemaUId,ee=U.messageId?.currentValue;(0,D.isEmpty)(ee)||this._loadAttachments(ee,q,Q),Q&&(q||k)&&(this.feedMentionService=this._feedMentionServiceFactory.getInstance(Q,k,q))}onMessagePublish(){var U=this;return(0,n.A)(function*(){if(!(!U._validate()||!(yield U._confirmPublish()))){U._maskService.showBodyMask();try{U._getMessage().pipe((0,R.concatMap)(Q=>U._composeFeedMessage(Q)),(0,R.concatMap)(Q=>((0,_.gZ)(Q)?U._onFeedMessagePublishError():U._onFeedMessageSuccessfullyPosted(Q),(0,R.of)(!0)))).subscribe({error:()=>U._onFeedMessagePublishError()})}catch{U._onFeedMessagePublishError()}}})()}onMessageChangesCancel(){this._forExternal=this._forExternalDefault,this.messageChangesCanceled.emit()}ngAfterViewInit(){(0,D.isEmpty)(this._message)||this.baseComposer.setValue(this._message),this.baseComposer.attachments=this._attachments,this.sendComponentReadyEvent(this._feedComposerTypeName)}focus(){this.baseComposer?.focus()}onExternalPublishingChange(U){this._forExternal=U?.checked??!1,this.focus()}onExternalPublishingEnter(){this._forExternal=!this._forExternal}onNewMention(U){this.forExternal||(this._forExternal=!!U?.find(Q=>Q.connectionType===`${C.U.External}`),this.changeDetectorRef.detectChanges())}static{this.\u0275fac=function(Q){return new(Q||Be)(l.\u0275\u0275directiveInject(l.Injector),l.\u0275\u0275directiveInject(L.D),l.\u0275\u0275directiveInject(g.r),l.\u0275\u0275directiveInject(V.s),l.\u0275\u0275directiveInject(N.o),l.\u0275\u0275directiveInject(A.TranslateService),l.\u0275\u0275directiveInject(x.oq))}}static{this.\u0275cmp=l.\u0275\u0275defineComponent({type:Be,selectors:[["crt-feed-composer"]],contentQueries:function(Q,k,q){if(Q&1&&l.\u0275\u0275contentQuery(q,J.B,4),Q&2){let ee;l.\u0275\u0275queryRefresh(ee=l.\u0275\u0275loadQuery())&&(k.channelsPanel=ee)}},inputs:{primaryColumnValue:"primaryColumnValue",cardState:"cardState",entitySchemaName:"entitySchemaName",composerEvent:"composerEvent",allowExternalPost:"allowExternalPost",parentMessageId:"parentMessageId",messageId:"messageId",message:"message",schemaUId:"schemaUId",forExternal:"forExternal",forExternalDefault:"forExternalDefault"},outputs:{messageChangesCanceled:"messageChangesCanceled",messagePosted:"messagePosted"},features:[l.\u0275\u0275InheritDefinitionFeature,l.\u0275\u0275NgOnChangesFeature],ngContentSelectors:H,decls:8,vars:12,consts:[["baseComposer",""],["channelSelector",""],["selectionActions",""],["footerPanelOptions",""],[3,"selectionChange","messageInputFocus","messageInputBlur","messageInputClick","messagePublish","messageChangesCancel","newMention","composerCacheCode","inputPlaceHolder","footerPanelExpanded","mentionsService","sendingButtonDisabled","disabled","footerPanelIndent","footerPanelOptions","channelSelector","selectionActions","disableSelectionOptions","sendButtonIcon"],["class","feed-composer-footer",4,"ngIf"],[1,"feed-composer-footer"],["class","feed-composer-footer-divider",4,"ngIf"],[1,"feed-composer-footer-external-slide-wrap"],["data-qa","post-for-external","title","External","labelPosition","'after'",3,"toggleChange","keydown.enter","default","useDefaultWidth"],[1,"feed-composer-footer-divider"]],template:function(Q,k){if(Q&1){const q=l.\u0275\u0275getCurrentView();l.\u0275\u0275projectionDef(B),l.\u0275\u0275elementStart(0,"crt-base-message-composer",4,0),l.\u0275\u0275listener("selectionChange",function(_e){return l.\u0275\u0275restoreView(q),l.\u0275\u0275resetView(k.onSelectionChange(_e))})("messageInputFocus",function(){return l.\u0275\u0275restoreView(q),l.\u0275\u0275resetView(k.onMessageInputFocus())})("messageInputBlur",function(){return l.\u0275\u0275restoreView(q),l.\u0275\u0275resetView(k.onMessageInputBlur())})("messageInputClick",function(){return l.\u0275\u0275restoreView(q),l.\u0275\u0275resetView(k.onMessageInputClick())})("messagePublish",function(){return l.\u0275\u0275restoreView(q),l.\u0275\u0275resetView(k.onMessagePublish())})("messageChangesCancel",function(){return l.\u0275\u0275restoreView(q),l.\u0275\u0275resetView(k.onMessageChangesCancel())})("newMention",function(_e){return l.\u0275\u0275restoreView(q),l.\u0275\u0275resetView(k.onNewMention(_e))}),l.\u0275\u0275elementEnd(),l.\u0275\u0275template(2,w,1,0,"ng-template",null,1,l.\u0275\u0275templateRefExtractor)(4,ie,1,0,"ng-template",null,2,l.\u0275\u0275templateRefExtractor)(6,oe,1,1,"ng-template",null,3,l.\u0275\u0275templateRefExtractor)}if(Q&2){const q=l.\u0275\u0275reference(3),ee=l.\u0275\u0275reference(5),_e=l.\u0275\u0275reference(7);l.\u0275\u0275property("composerCacheCode",k.cacheCode)("inputPlaceHolder",k.placeholder)("footerPanelExpanded",k.footerPanelExpanded)("mentionsService",k.feedMentionService)("sendingButtonDisabled",k.disabled)("disabled",k.disabled)("footerPanelIndent",k.footerPanelIndent)("footerPanelOptions",_e)("channelSelector",q)("selectionActions",ee)("disableSelectionOptions",k.disableSelectionOptions)("sendButtonIcon",k.sendButtonIcon)}},dependencies:[m.NgIf,S.G,I.l,A.TranslatePipe],styles:[".feed-composer-footer[_ngcontent-%COMP%]{display:flex;flex:auto}.feed-composer-footer-external-slide-wrap[_ngcontent-%COMP%]{width:auto}.feed-composer-footer-divider[_ngcontent-%COMP%]{margin-top:4px;margin-inline-end:24px;margin-inline-start:20px;height:16px;border-left:1px solid var(--crt-palette-border-500)}"]})}};(0,a.__decorate)([(0,u.k)(),(0,a.__metadata)("design:type",String)],ne.prototype,"primaryColumnValue",void 0),(0,a.__decorate)([(0,u.k)(),(0,a.__metadata)("design:type",String)],ne.prototype,"cardState",void 0),(0,a.__decorate)([(0,u.k)(),(0,a.__metadata)("design:type",String)],ne.prototype,"entitySchemaName",void 0),(0,a.__decorate)([(0,u.k)(),(0,a.__metadata)("design:type",Array),(0,a.__metadata)("design:paramtypes",[Array])],ne.prototype,"composerEvent",null),(0,a.__decorate)([(0,u.k)(),(0,a.__metadata)("design:type",Boolean),(0,a.__metadata)("design:paramtypes",[Boolean])],ne.prototype,"allowExternalPost",null),(0,a.__decorate)([(0,d.j)(),(0,a.__metadata)("design:type",Object)],ne.prototype,"messageChangesCanceled",void 0),(0,a.__decorate)([(0,d.j)(),(0,a.__metadata)("design:type",l.EventEmitter)],ne.prototype,"messagePosted",void 0),(0,a.__decorate)([(0,u.k)(),(0,a.__metadata)("design:type",String),(0,a.__metadata)("design:paramtypes",[String])],ne.prototype,"parentMessageId",null),(0,a.__decorate)([(0,u.k)(),(0,a.__metadata)("design:type",String),(0,a.__metadata)("design:paramtypes",[String])],ne.prototype,"messageId",null),(0,a.__decorate)([(0,u.k)(),(0,a.__metadata)("design:type",String),(0,a.__metadata)("design:paramtypes",[String])],ne.prototype,"message",null),(0,a.__decorate)([(0,u.k)(),(0,a.__metadata)("design:type",String),(0,a.__metadata)("design:paramtypes",[String])],ne.prototype,"schemaUId",null),(0,a.__decorate)([(0,u.k)(),(0,a.__metadata)("design:type",Boolean),(0,a.__metadata)("design:paramtypes",[Boolean])],ne.prototype,"forExternal",null),(0,a.__decorate)([(0,u.k)(),(0,a.__metadata)("design:type",Boolean),(0,a.__metadata)("design:paramtypes",[Boolean])],ne.prototype,"forExternalDefault",null),ne=(0,a.__decorate)([(0,r.v)({type:"crt.FeedComposer",contentSlots:["channelsPanel","selectionActions"],reuseStrategy:p.B.Reuse}),(0,b.f)({propertiesPanelComponentTypeName:"crt.FeedComposerPropertiesPanel",viewElementGroupType:W.J.CustomElements,typeCaption:"MessageComposer.Feed.Caption"}),(0,a.__metadata)("design:paramtypes",[l.Injector,L.D,g.r,V.s,N.o,A.TranslateService,x.oq])],ne)},87300:(z,O,e)=>{e.d(O,{V:()=>f});var n=e(5960),a=e.n(n),s=e(95567),l=e.n(s),t=e(59131),y=e.n(t),_=e(77592),u=e(34760),d=e(1034),r=e(96677),p=e(75456),b=e(10098),W=e(38071),A=e(68712),v=e(90204),V=e(28399),c=e.n(V),g=e(62278),C=e.n(g),x=e(58909),D=e(36122),T=e(40297),R=e.n(T),$=e(52808);const h=["items"],L=["composerHeader"],N=["selectorActions"],G=["container"],J=S=>({display:S});function ce(S,I){S&1&&(t.\u0275\u0275elementContainerStart(0),t.\u0275\u0275element(1,"div",null,1),t.\u0275\u0275elementContainerEnd())}function m(S,I){if(S&1){const B=t.\u0275\u0275getCurrentView();t.\u0275\u0275elementStart(0,"div",6,2)(2,"crt-channel-selector",7),t.\u0275\u0275listener("selectedChannelIndexChange",function(w){t.\u0275\u0275restoreView(B);const ie=t.\u0275\u0275nextContext();return t.\u0275\u0275resetView(ie.onSelectedChannelIndexChange(w))}),t.\u0275\u0275elementEnd()()}if(S&2){const B=t.\u0275\u0275nextContext();t.\u0275\u0275property("ngStyle",t.\u0275\u0275pureFunction1(3,J,B.getChannelSelectorVisible()?"unset":"none")),t.\u0275\u0275advance(2),t.\u0275\u0275property("channels",B.items)("selectedChannelIndex",B.selectedComposerChannelIndex)}}let f=class Le extends A.K{get _visibleItems(){return this.items?.filter(I=>I.visible!==!1)}get visibleTemplate(){const I=this.itemsTemplates?.length>this.selectedComposerChannelIndex?this.selectedComposerChannelIndex:0;return this.itemsTemplates?.get(I)}get renderEmbededChannelSelector(){return this._featureService.getFeatureState("ExtendableMessageComposer").pipe((0,g.map)(I=>!I))}set defaultChannel(I){(0,V.isEmpty)(I)||(this._defaultChannel=I,this._setDefaultComposer())}get items(){return this._items}set items(I){this._items=I,this._setDefaultComposer()}set composerEvent(I){I?.forEach(B=>{switch(B?.name){case x.iQ:this._handleComposerReady(B.params?.composerSchemaType);break;case x.An:B.params&&(this._isVisible=B.params?.isFocused,this._updateOffsetOnFocus());break;case x.M7:this._handleReplyActionEvent({emailId:B.params?.emailId,action:B.params?.action})}})}set selectedComposerChannelIndex(I){this._isVisible=!1,this._selectedChannelIndex$.next(I),this.changeDetectorRef.markForCheck()}get selectedComposerChannelIndex(){return this._selectedChannelIndex$.value}constructor(I,B){super(I),this._changeComposerService=B,this._defaultChannel="crt.FeedComposer",this._subscriptions=[],this._updateView=new g.Subject,this._rendered=new Map,this._selectedChannelIndex$=new g.BehaviorSubject(0),this.composerEventChange=new t.EventEmitter,this.selectedComposerChannelIndexChange=new t.EventEmitter,this.preserveContent=!0,this._subscribeToChangeComposerEvent(this._changeComposerService),this._featureService=I.get(W.d)}_setDefaultComposer(){if(!this._items)return;const I=this._visibleItems.findIndex(B=>B.type===this._defaultChannel);this.selectedComposerChannelIndex=I<0?0:I,this.selectedComposerChannelIndexChange.emit(this.selectedComposerChannelIndex)}_subscribeToChangeComposerEvent(I){this._subscriptions.push(I.getComposerObservable().subscribe(B=>{const H=this._visibleItems?.find(w=>w.data.schemaType===B);H&&this.showComposer(H)}))}_updateOffsetOnFocus(){!this._isVisible||!this.renderEmbededChannelSelector||window.requestAnimationFrame(()=>{if(this._isVisible&&!this.selectorActions){this._updateOffsetOnFocus();return}this.composerEventChange.emit([{name:x.Od,params:{offset:this.selectorActions?.nativeElement?.offsetWidth??0}}])})}_handleReplyActionEvent(I){const B=this.items.findIndex(w=>w.data?.schemaType==="Email");if(B<0)return;const H=this.items[this.selectedComposerChannelIndex];(!H||H.data?.schemaType!=="Email")&&(this._replyActionEvent=I,this.selectedComposerChannelIndex=B,this.changeDetectorRef.detectChanges()),window.requestAnimationFrame(()=>{this.composerHeader?.nativeElement?.scrollIntoView({behavior:"smooth",block:"nearest"})})}_handleComposerReady(I){const B=[];if(this._isVisible=!1,typeof I=="string"&&I==="Feed"&&this.selectorActions?.nativeElement)B.push({name:x.Od,params:{offset:this.selectorActions?.nativeElement?.offsetWidth??0}});else if(I==="Email"){const H=this.items[this.selectedComposerChannelIndex];this._replyActionEvent&&H.data?.schemaType==="Email"&&(B.push({name:x.M7,params:this._replyActionEvent}),this._replyActionEvent=null)}this.composerEventChange.emit(B)}_renderItem(I,B){if(B!==this.selectedComposerChannelIndex)return;const H=this.itemsTemplates.get(B),w=I.createEmbeddedView(H);this._rendered.set(H,w),this.detectChanges(),requestAnimationFrame(()=>{const ie=w.rootNodes.filter(de=>!(de instanceof Comment));this._setVisibilityInDom(ie,"unset")})}_changeItemVisibility(I,B,H){const w=B.rootNodes.filter(ie=>!(ie instanceof Comment));I===this.selectedComposerChannelIndex?this._setVisibilityInDom(w,"unset"):this._setVisibilityInDom(w,"none")}_setVisibilityInDom(I,B){I.forEach(H=>{const w=H;w.style.display=B,B==="none"?w.classList.remove("rendered"):w.classList.add("rendered")})}_destroyRenderedItem(I){this._rendered.get(I)?.destroy(),this._rendered.delete(I)}showComposer(I){this.selectedComposerChannelIndex=this.items.indexOf(I)}showItem(){this.containers?.forEach((I,B)=>{const H=this.itemsTemplates.get(B);if(!H)return;const w=this._rendered.get(H);if(!w){this._renderItem(I,B);return}if(this.preserveContent){this._changeItemVisibility(B,w);return}B!==this.selectedComposerChannelIndex&&this._destroyRenderedItem(H)})}ngAfterViewInit(){this._subscriptions.push(this._updateView.asObservable().pipe((0,g.debounceTime)(0)).subscribe(()=>{this.showItem()})),this._subscriptions.push((0,g.merge)(this._selectedChannelIndex$.asObservable()).subscribe(()=>{this._updateView.next()}))}ngOnDestroy(){this._subscriptions.forEach(I=>I?.unsubscribe())}onSelectedChannelIndexChange(I){this.selectedComposerChannelIndex=I}getChannelSelectorVisible(){return this._isVisible?!!(this._visibleItems&&this._visibleItems.length>1):!1}static{this.\u0275fac=function(B){return new(B||Le)(t.\u0275\u0275directiveInject(t.Injector),t.\u0275\u0275directiveInject(D.I))}}static{this.\u0275cmp=t.\u0275\u0275defineComponent({type:Le,selectors:[["crt-message-composer-selector"]],contentQueries:function(B,H,w){if(B&1&&t.\u0275\u0275contentQuery(w,h,4,t.TemplateRef),B&2){let ie;t.\u0275\u0275queryRefresh(ie=t.\u0275\u0275loadQuery())&&(H.itemsTemplates=ie)}},viewQuery:function(B,H){if(B&1&&(t.\u0275\u0275viewQuery(L,5),t.\u0275\u0275viewQuery(N,5),t.\u0275\u0275viewQuery(G,5,t.ViewContainerRef)),B&2){let w;t.\u0275\u0275queryRefresh(w=t.\u0275\u0275loadQuery())&&(H.composerHeader=w.first),t.\u0275\u0275queryRefresh(w=t.\u0275\u0275loadQuery())&&(H.selectorActions=w.first),t.\u0275\u0275queryRefresh(w=t.\u0275\u0275loadQuery())&&(H.containers=w)}},inputs:{defaultChannel:"defaultChannel",items:"items",composerEvent:"composerEvent",selectedComposerChannelIndex:"selectedComposerChannelIndex",preserveContent:"preserveContent"},outputs:{composerEventChange:"composerEventChange",selectedComposerChannelIndexChange:"selectedComposerChannelIndexChange"},features:[t.\u0275\u0275ProvidersFeature([]),t.\u0275\u0275InheritDefinitionFeature],decls:6,vars:4,consts:[["composerHeader",""],["container",""],["selectorActions",""],[1,"message-composer-selector"],[4,"ngFor","ngForOf"],["class","message-composer-selector-actions",3,"ngStyle",4,"ngIf"],[1,"message-composer-selector-actions",3,"ngStyle"],[3,"selectedChannelIndexChange","channels","selectedChannelIndex"]],template:function(B,H){B&1&&(t.\u0275\u0275elementStart(0,"div",3),t.\u0275\u0275element(1,"div",null,0),t.\u0275\u0275template(3,ce,3,0,"ng-container",4)(4,m,3,5,"div",5),t.\u0275\u0275pipe(5,"async"),t.\u0275\u0275elementEnd()),B&2&&(t.\u0275\u0275advance(3),t.\u0275\u0275property("ngForOf",H.itemsTemplates),t.\u0275\u0275advance(),t.\u0275\u0275property("ngIf",t.\u0275\u0275pipeBind1(5,2,H.renderEmbededChannelSelector)))},dependencies:[T.NgForOf,T.NgIf,T.NgStyle,$.B,T.AsyncPipe],styles:[`.message-composer-selector{position:relative;min-height:32px}.message-composer-selector-actions{position:absolute;bottom:0;display:flex}
`],encapsulation:2,data:{animation:[(0,s.trigger)("collapse",[(0,s.state)("false",(0,s.style)({height:s.AUTO_STYLE,visibility:s.AUTO_STYLE,overflow:"hidden",opacity:1})),(0,s.state)("true",(0,s.style)({height:"0",visibility:"hidden",overflow:"hidden",opacity:0})),(0,s.transition)("false => true",(0,s.animate)("300ms ease-in")),(0,s.transition)("true => false",(0,s.animate)("300ms ease-out"))])]}})}};(0,n.__decorate)([(0,_.k)(),(0,n.__metadata)("design:type",String),(0,n.__metadata)("design:paramtypes",[String])],f.prototype,"defaultChannel",null),(0,n.__decorate)([(0,_.k)(),(0,n.__metadata)("design:type",Array),(0,n.__metadata)("design:paramtypes",[Array])],f.prototype,"items",null),(0,n.__decorate)([(0,_.k)(),(0,n.__metadata)("design:type",Array),(0,n.__metadata)("design:paramtypes",[Array])],f.prototype,"composerEvent",null),(0,n.__decorate)([(0,u.j)(),(0,n.__metadata)("design:type",Object)],f.prototype,"composerEventChange",void 0),(0,n.__decorate)([(0,_.k)(),(0,n.__metadata)("design:type",Number),(0,n.__metadata)("design:paramtypes",[Number])],f.prototype,"selectedComposerChannelIndex",null),(0,n.__decorate)([(0,u.j)(),(0,n.__metadata)("design:type",Object)],f.prototype,"selectedComposerChannelIndexChange",void 0),(0,n.__decorate)([(0,_.k)(),(0,n.__metadata)("design:type",Object)],f.prototype,"preserveContent",void 0),f=(0,n.__decorate)([(0,d.v)({type:"crt.MessageComposerSelector",contentSlots:[{name:"items",lazy:!0,input:!0}],reuseStrategy:r.B.Reuse}),(0,p.f)({toolbarConfig:{position:250,defaultPropertyValues:{items:[],name:"MessageComposer_"+v.N},icon:e(62127)},propertiesPanelComponentTypeName:"crt.MessageComposerPropertiesPanel",viewElementGroupType:b.J.Components,typeCaption:"Components.MessageComposer.Caption"}),(0,n.__metadata)("design:paramtypes",[t.Injector,D.I])],f)},2126:(z,O,e)=>{e.d(O,{m:()=>R});var n=e(59131),a=e.n(n),s=e(56711),l=e.n(s),t=e(6530),y=e(79772),_=e.n(y),u=e(59969),d=e(32625),r=e(28399),p=e.n(r),b=e(40297),W=e.n(b),A=e(84137),v=e(66803),V=e(79111),c=e(52989),g=e.n(c),C=e(82650);const x=["selectedRecipient"],D=$=>({"recipient-not-valid":$});function T($,h){if($&1){const L=n.\u0275\u0275getCurrentView();n.\u0275\u0275elementStart(0,"div",7,0),n.\u0275\u0275pipe(2,"translate"),n.\u0275\u0275listener("keydown.delete",function(){const G=n.\u0275\u0275restoreView(L).$implicit,J=n.\u0275\u0275nextContext();return n.\u0275\u0275resetView(J.removeRecipient(G.value))}),n.\u0275\u0275elementStart(3,"crt-label",8),n.\u0275\u0275pipe(4,"encodeHtml"),n.\u0275\u0275text(5),n.\u0275\u0275elementEnd(),n.\u0275\u0275elementStart(6,"mat-icon",9),n.\u0275\u0275pipe(7,"translate"),n.\u0275\u0275listener("click",function(){const G=n.\u0275\u0275restoreView(L).$implicit,J=n.\u0275\u0275nextContext();return n.\u0275\u0275resetView(J.removeRecipient(G.value))})("keydown.enter",function(){const G=n.\u0275\u0275restoreView(L).$implicit,J=n.\u0275\u0275nextContext();return n.\u0275\u0275resetView(J.removeRecipient(G.value))}),n.\u0275\u0275elementEnd()()}if($&2){const L=h.$implicit,N=n.\u0275\u0275nextContext();n.\u0275\u0275property("ngClass",n.\u0275\u0275pureFunction1(11,D,!N.validateRecipient(L))),n.\u0275\u0275attribute("aria-label",n.\u0275\u0275pipeBind1(2,5,N.recipientLabel)),n.\u0275\u0275advance(3),n.\u0275\u0275property("crtTooltip",n.\u0275\u0275pipeBind1(4,7,N.getTooltip(L))),n.\u0275\u0275advance(2),n.\u0275\u0275textInterpolate1(" ",N.getRecipientDisplayValue(L)," "),n.\u0275\u0275advance(),n.\u0275\u0275attribute("aria-label",n.\u0275\u0275pipeBind1(7,9,"MessageComposer.Email.RemoveRecipientLabel"))}}class R extends d.g{get dropDownRecipients(){return this.filteredRecipients.filter(h=>!this.selectedRecipients.some(L=>h.displayValue===L.displayValue))}set rawRecipinets(h){h&&(this._rawRecipients=h,this._loadRecipients(this.recipientSearchControl.value,0))}set recipientLabelWidth(h){h&&(this._labelWidth=h+"px")}constructor(h,L,N){super(h,null,L),this._translateService=N,this._hasNextPage=!0,this.recipientSearchControl=new s.FormControl(null),this.selectedRecipients=new Array,this.filteredRecipients=new Array,this._labelWidth="136px",this.loadRecipients=new n.EventEmitter,this.recipientsChanged=new n.EventEmitter,this.recipientSearchControl.valueChanges.subscribe(G=>this._selectRecipient(G))}_selectRecipient(h){h&&h.value&&!this.selectedRecipients.some(L=>L.displayValue===h.displayValue)&&(this.selectedRecipients.push(h),this.recipientsChanged.emit(this.selectedRecipients.map(L=>L.displayValue)))}_setRecipientsComboboxList(h,L=!1){this._rawRecipients=L?[...this._rawRecipients,...h]:h;const N=h.map(G=>G.emails).flat(1);this.filteredRecipients=L?[...this.filteredRecipients,...N]:N}_loadRecipients(h,L=0){this.recipientsLoading=!0,this._hasNextPage=this._rawRecipients.length>0,this._rawRecipients&&this._rawRecipients.length>0?this._setRecipientsComboboxList(this._rawRecipients,L>0):L===0&&!(0,r.isEmpty)(h)&&(h.includes(";")||h.includes(",")?this._selectPastedEmails(h):this._setRecipientsComboboxList([{emails:[this._mapRecipient(h)]}])),this.recipientsLoading=!1,this.changeDetectorRef.markForCheck()}_selectPastedEmails(h){h.split(/[;,]/).map(L=>L.trim()).filter(L=>!(0,r.isEmpty)(L)).forEach(L=>{this._selectRecipient(this._mapRecipient(L))}),this.clearCombobox(),window.requestAnimationFrame(()=>{this.selectedRecipient.last?.nativeElement?.focus()})}_mapRecipient(h){return{value:(0,t.qv)(),displayValue:h.trim()}}getRecipients(){return this.selectedRecipients?this.selectedRecipients.map(h=>h.displayValue):[]}setRecipients(h){this.selectedRecipients=h?.filter(L=>!(0,r.isEmpty)(L)).map(L=>this._mapRecipient(L))}clear(){this.clearCombobox(),this.selectedRecipients=[],this.recipientsChanged.emit([])}validate(){return this.selectedRecipients.length>0&&this.selectedRecipients.filter(h=>!this.validateRecipient(h)).length===0}searchRecipients(h){(0,r.isEmpty)(h)&&(h={viewElement:"crt.ComboBox",filterValue:null}),this.loadRecipients.emit({query:h.filterValue,recipientsLength:0})}clearCombobox(){this._hasNextPage=!0,this.recipientSearchControl.setValue(null)}removeRecipient(h){this.selectedRecipients=this.selectedRecipients.filter(L=>L.value!==h),this.recipientsChanged.emit(this.selectedRecipients.map(L=>L.displayValue)),this.changeDetectorRef.markForCheck()}getRecipientDisplayValue(h){const L=new RegExp(`\\s?<${u.Eu}>`,"g"),N=new RegExp(/^;+|;+$/,"g"),G=new RegExp(/[^\s]/,"g"),J=h.displayValue.replace(L,"").replace(N,"");return G.test(J)?J:h.displayValue}validateRecipient(h){return(0,u.m2)(h.displayValue)}getTooltip(h){return this.validateRecipient(h)?(0,u.Z6)(h.displayValue)?"":h.displayValue:`"${h.displayValue}" ${this._translateService.instant("MessageComposer.Email.NotContainsEmail")}`}loadNextPage(){this._hasNextPage&&this.loadRecipients.emit({query:this.recipientSearchControl.value,recipientsLength:this._rawRecipients.length})}static{this.\u0275fac=function(L){return new(L||R)(n.\u0275\u0275directiveInject(n.Injector),n.\u0275\u0275directiveInject(n.ChangeDetectorRef),n.\u0275\u0275directiveInject(y.TranslateService))}}static{this.\u0275cmp=n.\u0275\u0275defineComponent({type:R,selectors:[["crt-recipient-search"]],viewQuery:function(L,N){if(L&1&&n.\u0275\u0275viewQuery(x,5,n.ElementRef),L&2){let G;n.\u0275\u0275queryRefresh(G=n.\u0275\u0275loadQuery())&&(N.selectedRecipient=G)}},hostVars:2,hostBindings:function(L,N){L&2&&n.\u0275\u0275styleProp("--labelWidth",N._labelWidth)},inputs:{rawRecipinets:"rawRecipinets",recipientLabel:"recipientLabel",recipientLabelWidth:"recipientLabelWidth"},outputs:{loadRecipients:"loadRecipients",recipientsChanged:"recipientsChanged"},features:[n.\u0275\u0275InheritDefinitionFeature],decls:8,vars:9,consts:[["selectedRecipient",""],[1,"recipients-container"],[1,"recipients-label-container"],["labelType","caption"],[1,"selected-recipients-container"],["class","selected-recipient","tabindex","0",3,"ngClass","keydown.delete",4,"ngFor","ngForOf"],["labelPosition","none","data-item-marker","recipients-search-combobox",3,"closed","showList","paginationChange","control","items","loading","debounceTime","appearance"],["tabindex","0",1,"selected-recipient",3,"keydown.delete","ngClass"],["labelEllipsis","true",1,"selected-recipient-label",3,"crtTooltip"],["svgIcon","message-composer-attach-cross","data-qa","selected-recipient-remove-button","tabindex","0",1,"selected-recipient-remove-button",3,"click","keydown.enter"]],template:function(L,N){L&1&&(n.\u0275\u0275elementStart(0,"div",1)(1,"div",2)(2,"crt-label",3),n.\u0275\u0275text(3),n.\u0275\u0275pipe(4,"translate"),n.\u0275\u0275elementEnd()(),n.\u0275\u0275elementStart(5,"div",4),n.\u0275\u0275template(6,T,8,13,"div",5),n.\u0275\u0275elementStart(7,"crt-combobox",6),n.\u0275\u0275listener("closed",function(){return N.clearCombobox()})("showList",function(J){return N.searchRecipients(J)})("paginationChange",function(){return N.loadNextPage()}),n.\u0275\u0275elementEnd()()()),L&2&&(n.\u0275\u0275advance(3),n.\u0275\u0275textInterpolate1(" ",n.\u0275\u0275pipeBind1(4,7,N.recipientLabel)," "),n.\u0275\u0275advance(3),n.\u0275\u0275property("ngForOf",N.selectedRecipients),n.\u0275\u0275advance(),n.\u0275\u0275property("control",N.recipientSearchControl)("items",N.dropDownRecipients)("loading",N.recipientsLoading)("debounceTime",100)("appearance","legacy"))},dependencies:[b.NgClass,b.NgForOf,A.d,v.q,V.V,c.MatIcon,C.m,y.TranslatePipe],styles:[`body{--focus-outline-outer-color: var(--crt-palette-secondary-500);--focus-outline-inner-color: white}.recipients-container{display:flex;width:100%;padding-top:8px}.recipients-container .recipients-label-container{margin-inline-end:10px;display:flex;width:var(--labelWidth, 136px);min-width:var(--labelWidth, 136px);flex-direction:row-reverse}.recipients-container .recipients-label-container .crt-label{color:var(--crt-base-input-label-color);margin-top:9px}.recipients-container .selected-recipients-container{display:flex;width:calc(100% - var(--labelWidth, 136px));flex-wrap:wrap;min-height:32px;align-items:flex-end}.recipients-container .selected-recipients-container .selected-recipient{display:flex;align-items:center;background-color:var(--crt-palette-interaction-900);border-radius:12px;padding:0 12px;margin:4px 0;margin-inline-end:12px;width:min-content;max-width:calc(100% - 36px);cursor:pointer}.recipients-container .selected-recipients-container .selected-recipient label{color:var(--crt-palette-link-500)}.recipients-container .selected-recipients-container .selected-recipient.recipient-not-valid{background-color:var(--crt-palette-navigation-primary-500)}.recipients-container .selected-recipients-container .selected-recipient.recipient-not-valid label{color:var(--crt-palette-label-contrast-500)}.recipients-container .selected-recipients-container .selected-recipient:first-of-type{margin-top:9px}.recipients-container .selected-recipients-container .selected-recipient-label{max-width:100%}.recipients-container .selected-recipients-container .selected-recipient-remove-button{display:none;flex-basis:10px;height:10px;flex-grow:0;flex-shrink:0;width:unset;color:var(--crt-palette-label-500)}.recipients-container .selected-recipients-container .selected-recipient-remove-button:focus-visible{box-shadow:inset 0 0 0 1px var(--focus-outline-outer-color),inset 0 0 0 2px var(--focus-outline-inner-color);outline:none;border-radius:4px}.recipients-container .selected-recipients-container .selected-recipient:hover .selected-recipient-remove-button,.recipients-container .selected-recipients-container .selected-recipient:focus-within .selected-recipient-remove-button{display:flex}.recipients-container .selected-recipients-container .selected-recipient:hover .selected-recipient-label,.recipients-container .selected-recipients-container .selected-recipient:focus-within .selected-recipient-label{max-width:calc(100% - 10px)}.recipients-container .selected-recipients-container .selected-recipient:focus-visible{box-shadow:inset 0 0 0 1px var(--focus-outline-outer-color),inset 0 0 0 2px var(--focus-outline-inner-color);outline:none;border-radius:12px}
`],encapsulation:2})}}},50868:(z,O,e)=>{e.d(O,{q:()=>l});var n=e(5960),a=e.n(n),s=e(4164);let l=class{convert(y){const _=y[1],u=y[0];return _?null:u}};l=(0,n.__decorate)([(0,s.a)({type:"crt.ConditionalEmailId"})],l)},19484:(z,O,e)=>{e.d(O,{K:()=>u});var n=e(5960),a=e.n(n),s=e(6530),l=e(4164),t=e(62278),y=e.n(t),_=e(43673);let u=class{constructor(r){this._recipientsService=r}convert(r){return(0,t.lastValueFrom)(this._recipientsService.getRecipients(r.event.query,r.event.recipientsLength).pipe((0,t.map)(p=>({recipients:p,loadStamp:(0,s.qv)()}))))}};u=(0,n.__decorate)([(0,l.a)({type:"crt.ToRecipientsMailboxes"}),(0,n.__metadata)("design:paramtypes",[_.e])],u)},21122:(z,O,e)=>{e.d(O,{m:()=>u});var n=e(5960),a=e.n(n),s=e(4164),l=e(23092),t=e(62278),y=e.n(t),_=e(2047);let u=class{constructor(r,p){this._mailboxesService=r,this._userInfoService=p}convert(){return(0,t.lastValueFrom)(this._userInfoService.loadCurrentUserInfo().pipe((0,t.concatMap)(r=>this._mailboxesService.getMailboxesForSend(r?.userInfo.id))))}};u=(0,n.__decorate)([(0,s.a)({type:"crt.ToSendersMailboxes"}),(0,n.__metadata)("design:paramtypes",[_.W,l.fv])],u)},48531:(z,O,e)=>{e.d(O,{B:()=>t});var n=e(41287),a=e(93338),s=e(16296),l=e(58909);class t extends n.l{constructor(){super(...arguments),this.action=s.T.Reply}_processReply(_){const u=Object.keys(_.$context.attributes).filter(d=>d.startsWith(a._));u.length&&u.forEach(d=>_.$context[d]=[{name:l.M7,params:{emailId:_.recordId,action:this.action}}])}handle(_){return new Promise(u=>{this._processReply(_),u()})}}},99553:(z,O,e)=>{e.d(O,{E:()=>d});var n=e(73308),a=e(5960),s=e.n(a),l=e(41287),t=e(844),y=e(62278),_=e.n(y),u=e(2047);let d=class extends l.l{constructor(p){super(),this._service=p}handle(p){var b=this;return(0,n.A)(function*(){const W=p.recordId,A=yield(0,y.firstValueFrom)(b._service.getCaseDefaultMailbox(W));return A?.senderEmailAddress?A?.senderEmailAddress:yield b.next?.handle(p)})()}};d=(0,a.__decorate)([(0,t.l)({type:"crt.CaseSenderComposerHandler",requestType:"crt.CaseSenderComposerRequest"}),(0,a.__metadata)("design:paramtypes",[u.W])],d)},74575:(z,O,e)=>{e.d(O,{H:()=>_});var n=e(73308),a=e(5960),s=e.n(a),l=e(41287),t=e(844),y=e(36122);let _=class extends l.l{constructor(d){super(),this._service=d}handle(d){var r=this;return(0,n.A)(function*(){r._service.openComposer(d.composerSchemaType),yield r.next?.handle(d)})()}};_=(0,a.__decorate)([(0,t.l)({type:"crt.ChangeComposerHandler",requestType:"crt.ChangeComposerRequest"}),(0,a.__metadata)("design:paramtypes",[y.I])],_)},13787:(z,O,e)=>{e.d(O,{e:()=>C});var n=e(73308),a=e(5960),s=e.n(a),l=e(61541),t=e(844),y=e(40968),_=e(59969),u=e(38071),d=e(95145),r=e(29858),p=e(55359),b=e(66446),W=e(28399),A=e.n(W),v=e(62278),V=e.n(v),c=e(48531),g=e(16296);let C=class extends c.B{constructor(D,T,R,$){super(),this._featureService=D,this._entityConnectionService=T,this._sysSettingsService=R,this._window=$,this._freedomUiType="f4d757e1-2aeb-496f-b751-3d5b39708ea3",this._uiTypeSysSettingCode="EditPagesUITypeForFreedomHost",this.action=g.T.EditDraft}_openEditPage(D){var T=this;return(0,n.A)(function*(){let R;const $=(0,W.get)(T._window,["Terrasoft","isAngularHost"]),h=yield(0,v.lastValueFrom)(T._sysSettingsService.getValueByCode(T._uiTypeSysSettingCode));$&&h===T._freedomUiType?R={type:"crt.OpenPageRequest",schemaName:"EmailMiniPage",modelInitConfigs:[{recordId:D.recordId,action:l.n.Edit}],$context:D.$context}:R={type:"crt.UpdateRecordRequest",entityName:"Activity",recordId:D.recordId,$context:D.$context},yield T.handlerChain.process(R)})()}_openAddPage(D){var T=this;return(0,n.A)(function*(){const R=yield b.a.getPageSchemaNameForAction({entityName:"Activity",action:l.n.Add,typeColumnValue:p.Iq.toLowerCase()}),$=yield T._getDefaultValues(D),h={type:"crt.CreateRecordRequest",entityName:"Activity",entityPageName:R,defaultValues:$,$context:D.$context};yield T.handlerChain.process(h)})()}_getDefaultValues(D){var T=this;return(0,n.A)(function*(){const R=[{attributeName:"Type",value:p.Iq}],$=yield D.$context.getPrimaryDataSchema(),h=$.name,L=yield D.$context[$.primaryAttributeName],N=yield T._entityConnectionService.getEntityConnectionColumns("Activity",h),{$context:G}=D;return D.bindingColumns&&(yield Promise.all(D.bindingColumns.map(function(){var J=(0,n.A)(function*(ce){const m=yield G[ce.formAttributeName];m&&R.push({attributeName:ce.activityColumnName,value:m.value||m.activityAttributeName})});return function(ce){return J.apply(this,arguments)}}()))),N&&N.forEach(J=>{R.push({attributeName:J.name,value:L})}),R})()}handle(D){var T=()=>super.handle,R=this;return(0,n.A)(function*(){(yield(0,v.lastValueFrom)(R._featureService.getFeatureState("UseEmailComposer")))?yield T().call(R,{recordId:D.recordId,type:"crt.ReplyEmailComposerRequest",$context:D.$context}):(0,W.isEmpty)(D.recordId)?yield R._openAddPage(D):yield R._openEditPage(D),yield R.next?.handle(D)})()}};C=(0,a.__decorate)([(0,t.l)({type:"crt.CreateEmailRequestHandler",requestType:"crt.CreateEmailRequest"}),(0,a.__param)(3,(0,y.j)(_.ZP)),(0,a.__metadata)("design:paramtypes",[u.d,r.r,d.A,Window])],C)},37552:(z,O,e)=>{e.d(O,{x:()=>d});var n=e(73308),a=e(5960),s=e.n(a),l=e(41287),t=e(844),y=e(62278),_=e.n(y),u=e(2047);let d=class extends l.l{constructor(p){super(),this._service=p}handle(p){var b=this;return(0,n.A)(function*(){const W=p.recordId,A=yield(0,y.firstValueFrom)(b._service.getDefaultMailboxForSend(W));return A?.senderEmailAddress?A?.senderEmailAddress:yield b.next?.handle(p)})()}};d=(0,a.__decorate)([(0,t.l)({type:"crt.DefaultSenderComposerHandler",requestType:"crt.DefaultSenderComposerRequest"}),(0,a.__metadata)("design:paramtypes",[u.W])],d)},52162:(z,O,e)=>{e.d(O,{T:()=>_});var n=e(73308),a=e(5960),s=e.n(a),l=e(844),t=e(48531),y=e(16296);let _=class extends t.B{constructor(){super(),this.action=y.T.EditDraft}handle(d){var r=()=>super.handle,p=this;return(0,n.A)(function*(){yield r().call(p,d),yield p.next?.handle(d)})()}};_=(0,a.__decorate)([(0,l.l)({type:"crt.EditDraftEmailComposerRequestHandler",requestType:"crt.EditDraftEmailComposerRequest"}),(0,a.__metadata)("design:paramtypes",[])],_)},29373:(z,O,e)=>{e.d(O,{F:()=>V,_:()=>c});var n=e(73308),a=e(5960),s=e.n(a),l=e(59131),t=e.n(l),y=e(81517),_=e(2828),u=e(41287),d=e(844),r=e(62278),p=e.n(r),b=e(36486),W=e.n(b),A=e(58909),v=e(85688);let V=class extends y.S{};V=(0,a.__decorate)([(0,_.$)({type:"crt.EmailComposerSavedRequest"})],V);let c=class extends u.l{constructor(C){super(),this._composerEventAttrName="ComposerEvent",this._emailsService=C.get(v.d)}handle(C){var x=this;return(0,n.A)(function*(){const D=C.$context,T=C.emailWithParams;if(!T)return Promise.resolve();const R=T.params,h=D.modelInitConfigs.filter(L=>L.action==="add");return h.length===1&&h[0].defaultValues.forEach(N=>{R.defaultValues.push({attributeName:N.attributeName,value:N.value})}),R.bindingColumns&&(yield Promise.all(R.bindingColumns.map(function(){var L=(0,n.A)(function*(N){const G=yield D[N.formAttributeName];G&&R.defaultValues.push({attributeName:N.activityColumnName,value:G.value||G.activityAttributeName})});return function(N){return L.apply(this,arguments)}}()))),(0,r.lastValueFrom)(x._emailsService.saveEmail(T.email,T.params).pipe((0,b.switchMap)(L=>{const N=Object.keys(C.$context.attributes).filter(G=>G.startsWith(x._composerEventAttrName));return N.length&&N.forEach(G=>C.$context[G]=[{name:A.J3,params:{response:L}}]),(0,r.of)({})})))})()}};c=(0,a.__decorate)([(0,d.l)({type:"crt.EmailComposerSavedHandler",requestType:"crt.EmailComposerSavedRequest"}),(0,a.__metadata)("design:paramtypes",[l.Injector])],c)},16111:(z,O,e)=>{e.d(O,{M:()=>u});var n=e(73308),a=e(5960),s=e.n(a),l=e(41287),t=e(40269),y=e(65288),_=e(844);let u=class extends l.l{_getNeedClosePage(r){var p=this;return(0,n.A)(function*(){return(yield r.$context.IsChanged)?!1:(yield r.$context.ElementExecutionData)?!(yield p._getActualSendDate(r)):!0})()}_getActualSendDate(r){return(0,n.A)(function*(){const p=yield r.$context.Id;return((yield(yield t.K.create("Activity")).load({attributes:["SendDate"],parameters:[{type:y.E.PrimaryColumnValue,value:p}]}))[0]||{}).SendDate})()}handle(r){var p=this;return(0,n.A)(function*(){if(!(yield r.$context.ComposerVisible)){yield p.next?.handle(r);return}r.$context.ComposerVisible=!1,(yield r.$context.IsReplyMode)?r.$context.IsReplyMode=!1:(yield p._getNeedClosePage(r))&&(yield p.handlerChain.process({type:"crt.ClosePageRequest",$context:r.$context})),yield p.next?.handle(r)})()}};u=(0,a.__decorate)([(0,_.l)({type:"crt.EmailFormPageComposerClearedHandler",requestType:"crt.onEmailComposerClearedRequest",scopes:["EmailFormPage"]})],u)},28307:(z,O,e)=>{e.d(O,{p:()=>b});var n=e(73308),a=e(5960),s=e.n(a),l=e(41287),t=e(844),y=e(89285),_=e(65576),u=e(28399),d=e.n(u),r=e(62278),p=e.n(r);let b=class extends l.l{_subscribeViewModelEvents(A){var v=this;const V=new r.Subscription;V.add(A.events$.pipe((0,r.filter)(({type:c})=>c===_.n.FinishLoadModelAttributes)).subscribe({next:function(){var c=(0,n.A)(function*(g){yield v._updateComposerVisibility(g,A),yield v._updateEmailBody(g,A)});return function(C){return c.apply(this,arguments)}}(),complete:()=>{V.unsubscribe()}}))}_updateComposerVisibility(A,v){return(0,n.A)(function*(){if((yield v.getPrimaryModelMode())!==y.b.Update||!A?.payload?.SendDate||!A?.payload?.Id)return;const c=yield v.Id,g=!!(yield v.SendDate);!c||g||(v.ComposerVisible=!0)})()}_updateEmailBody(A,v){return(0,n.A)(function*(){if((yield v.getPrimaryModelMode())!==y.b.Update||!A?.payload?.EmailBody||!A?.payload?.IsHtmlBody)return;const c=yield v.IsHtmlBody,g=yield v.EmailBody;!c&&!u.isEmpty(g)&&!g.startsWith("<pre>")&&(v.EmailBody=`<pre>${u.escape(g)}</pre>`)})()}handle(A){var v=this;return(0,n.A)(function*(){yield v.next?.handle(A),v._subscribeViewModelEvents(A.$context)})()}};b=(0,a.__decorate)([(0,t.l)({type:"crt.EmailFormPageViewModelInitRequestHandler",requestType:"crt.HandleViewModelInitRequest",scopes:["EmailFormPage"]})],b)},58298:(z,O,e)=>{e.d(O,{I:()=>b});var n=e(73308),a=e(5960),s=e.n(a),l=e(41287),t=e(844),y=e(89285),_=e(65576),u=e(28399),d=e.n(u),r=e(62278),p=e.n(r);let b=class extends l.l{_subscribeViewModelEvents(A){var v=this;const V=new r.Subscription;V.add(A.events$.pipe((0,r.filter)(({type:c})=>c===_.n.FinishLoadModelAttributes)).subscribe({next:function(){var c=(0,n.A)(function*(g){yield v._tryOpenDraft(g,A),yield v._updateRecipients(g,A)});return function(C){return c.apply(this,arguments)}}(),complete:()=>{V.unsubscribe()}}))}_tryOpenDraft(A,v){var V=this;return(0,n.A)(function*(){if((yield v.getPrimaryModelMode())!==y.b.Update||!A?.payload?.SendDate||!A?.payload?.Id)return;const g=yield v.Id,C=!!(yield v.SendDate);!g||C||(yield V.handlerChain.process({type:"crt.EditDraftEmailComposerRequest",recordId:g,$context:v}))})()}_updateRecipients(A,v){return(0,n.A)(function*(){if((yield v.getPrimaryModelMode())!==y.b.Create||!A?.payload?.Recepient)return;const c=yield v.Recepient;u.isEmpty(c)||(v.EmailComposer_To=[...c.split(";")])})()}handle(A){var v=this;return(0,n.A)(function*(){yield v.next?.handle(A),v._subscribeViewModelEvents(A.$context)})()}};b=(0,a.__decorate)([(0,t.l)({type:"crt.EmailMiniPageViewModelInitRequestHandler",requestType:"crt.HandleViewModelInitRequest",scopes:["EmailMiniPage"]})],b)},81875:(z,O,e)=>{e.d(O,{p:()=>_});var n=e(73308),a=e(5960),s=e.n(a),l=e(844),t=e(48531),y=e(16296);let _=class extends t.B{constructor(){super(),this.action=y.T.Forward}handle(d){var r=()=>super.handle,p=this;return(0,n.A)(function*(){yield r().call(p,d),yield p.next?.handle(d)})()}};_=(0,a.__decorate)([(0,l.l)({type:"crt.ForwardEmailComposerRequestHandler",requestType:"crt.ForwardEmailComposerRequest"}),(0,a.__metadata)("design:paramtypes",[])],_)},83743:(z,O,e)=>{e.d(O,{B:()=>u,C:()=>d});var n=e(73308),a=e(5960),s=e.n(a),l=e(81517),t=e(2828),y=e(41287),_=e(844);let u=class extends l.S{};u=(0,a.__decorate)([(0,t.$)({type:"crt.RefreshEmailRecipientsRequest"})],u);let d=class extends y.l{handle(p){var b=this;return(0,n.A)(function*(){yield b.next?.handle(p)})()}};d=(0,a.__decorate)([(0,_.l)({type:"crt.RefreshEmailRecipientsHandler",requestType:"crt.RefreshEmailRecipientsRequest"})],d)},8610:(z,O,e)=>{e.d(O,{F:()=>_});var n=e(73308),a=e(5960),s=e.n(a),l=e(844),t=e(48531),y=e(16296);let _=class extends t.B{constructor(){super(),this.action=y.T.ReplyAll}handle(d){var r=()=>super.handle,p=this;return(0,n.A)(function*(){yield r().call(p,d),yield p.next?.handle(d)})()}};_=(0,a.__decorate)([(0,l.l)({type:"crt.ReplyAllEmailComposerRequestHandler",requestType:"crt.ReplyAllEmailComposerRequest"}),(0,a.__metadata)("design:paramtypes",[])],_)},54880:(z,O,e)=>{e.d(O,{I:()=>_});var n=e(73308),a=e(5960),s=e.n(a),l=e(844),t=e(48531),y=e(16296);let _=class extends t.B{constructor(){super(),this.action=y.T.Reply}handle(d){var r=()=>super.handle,p=this;return(0,n.A)(function*(){yield r().call(p,d),yield p.next?.handle(d)})()}};_=(0,a.__decorate)([(0,l.l)({type:"crt.ReplyEmailComposerRequestHandler",requestType:"crt.ReplyEmailComposerRequest"}),(0,a.__metadata)("design:paramtypes",[])],_)},15841:(z,O,e)=>{e.d(O,{Q:()=>Oe});var n=e(5960),a=e(40297),s=e(52989),l=e(10067),t=e(71252),y=e(55642),_=e(79772),u=e(5476),d=e(56484),r=e(56711),p=e(80203),b=e(90262),W=e(59131);class A{static{this.\u0275fac=function(K){return new(K||A)}}static{this.\u0275mod=W.\u0275\u0275defineNgModule({type:A})}static{this.\u0275inj=W.\u0275\u0275defineInjector({imports:[a.CommonModule,r.FormsModule,r.ReactiveFormsModule,p.MatLegacySlideToggleModule]})}}(function(){(typeof ngJitMode>"u"||ngJitMode)&&W.\u0275\u0275setNgModuleScope(A,{declarations:[b.G],imports:[a.CommonModule,r.FormsModule,r.ReactiveFormsModule,p.MatLegacySlideToggleModule],exports:[b.G]})})();var v=e(18351),V=e(59969),c=e(31149),g=e(75909),C=e(24091),x=e(57274),D=e(44267),T=e(57463),R=e(83455),$=e(72882),h=e(12841),L=e(24507),N=e(8346),G=e(82650),J=e(87300),ce=e(30816),m=e(23854),f=e(58551),S=e(30306),I=e(52808),B=e(2126),H=e(20922),w=e(82436),ie=e(10468),de=e(50868),Ee=e(21122),oe=e(19484),ne=e(74575),re=e(54880),U=e(8610),Q=e(81875),k=e(37552),q=e(99553),ee=e(52162),_e=e(13787),Ce=e(29373),ye=e(83743),Pe=e(28307),De=e(58298),fe=e(16111),Z=e(74368),ae=e(93338),i=e(26594),E=e(28399);class o{constructor(j){this._featureValues=j,this._selectedChannelAttributeName="SelectedComposerChannelIndex",this._channelsAttributeName="ComposerChannels",this._selectedChannelAttributeDefValue=0,this._channelSelectorItemName="ChannelSelector",this._channelSelectorTypeName="crt.ChannelSelector",this._parentComposerType="crt.MessageComposerSelector"}_getViewConfigs(j,K){return Z.u.getViewConfigInfoByProperty("type",K,j.viewConfig).map(Y=>Y?.viewConfig).filter(Boolean)}_createAndBindExtendableComposerAttributes(j,K){K.forEach((Y,le)=>{if(!Array.isArray(Y.items)||!Y.items.length)return;let se;(0,E.isEmpty)(Y.selectedComposerChannelIndex)?(se=`${this._selectedChannelAttributeName}_${le}`,j[se]={value:this._selectedChannelAttributeDefValue},Y.selectedComposerChannelIndex=`$${se}`):se=Y.selectedComposerChannelIndex;const ge=`${this._channelsAttributeName}_${le}`,Ie=[];Y.items.forEach(ze=>{this._createChannelSelector(ze,se,ge,Ie)}),j[ge]={value:Ie}})}_createChannelSelector(j,K,Y,le){const se=j.data;if(!(!se||(0,E.isEmpty)(se.schemaType))&&(le.push({visible:j.visible,data:{icon:se.icon,schemaType:se.schemaType,caption:se.caption}}),(0,E.isEmpty)(j.channelsPanel))){const ge={name:`${this._channelSelectorItemName}_${j.name}`,type:this._channelSelectorTypeName,selectedChannelIndex:`$${K}`,channels:`$${Y}`};j.channelsPanel=[ge]}}_createAndBindComposerEventAttribute(j,K){K.forEach((Y,le)=>{if(!Array.isArray(Y.items)||!Y.items.length)return;const se=`${ae._}_${le}`;j[se]={value:[]},Y.composerEvent="$"+se,Y.items.forEach(ge=>{ge.composerEvent="$"+se})})}_createAndBindComposerAttributes(j){const K=this._getViewConfigs(j,this._parentComposerType),Y=j.viewModelConfig.attributes;this._createAndBindComposerEventAttribute(Y,K),this._featureValues.ExtendableMessageComposer&&this._createAndBindExtendableComposerAttributes(Y,K)}crtOnMetaDataInit(j){const K=j;return this._createAndBindComposerAttributes(K),Promise.resolve(j)}static{this.\u0275fac=function(K){return new(K||o)(W.\u0275\u0275inject(i.G))}}static{this.\u0275prov=W.\u0275\u0275defineInjectable({token:o,factory:o.\u0275fac})}}var M=e(73308),P=e(12404);class F{constructor(j){this._selectionActionsMetadataService=j,this._pageSize=150}_getViewConfigs(j,K){return Z.u.getViewConfigInfoByProperty("type",K,j.viewConfig).map(Y=>Y?.viewConfig).filter(Boolean)}_setCrudEventsBindings(j){j.emailComposerSaved={request:"crt.EmailComposerSavedRequest",params:{emailWithParams:"@event"}},j.refreshRecipients={request:"crt.RefreshEmailRecipientsRequest",params:{event:"@event"}}}_setAttributes(j,K){K.from=`$${this._createAttribute(j,`${K.name}_From`,"")}`,K.to=`$${this._createAttribute(j,`${K.name}_To`,[])}`,K.cc=`$${this._createAttribute(j,`${K.name}_Cc`,[])}`,K.bcc=`$${this._createAttribute(j,`${K.name}_Bcc`,[])}`,K.subject=`$${this._createAttribute(j,`${K.name}_Subject`,"")}`,K.headerExpanded=`$${this._createAttribute(j,`${K.name}_HeaderExpanded`,"")}`,K.visibleCc=`$${this._createAttribute(j,`${K.name}_VisibleCc`,"")}`,K.visibleBcc=`$${this._createAttribute(j,`${K.name}_VisibleBcc`,"")}`}_setCalculatedAttributes(j,K){K.sendersMailboxes=`$${this._getOrAddEmailSendersAttribute(j,K,K.recordId)}`,K.recipientsMailboxes=`$${this._getOrAddEmailRecipientsAttribute(j,K,K.recordId)}`}_findCalculatedAttribute(j,K,Y){const le=j.viewModelConfig.attributes,se=Object.keys(le).find(ge=>{const Ie=le[ge]??{};return Ie.from===K&&Ie.converter===Y});return(0,E.isEmpty)(se)?void 0:se}_createAttribute(j,K,Y){const le=j.viewModelConfig.attributes;return le[K]={value:Y},K}_createCalculatedAttribute(j,K,Y,le){const se=j.viewModelConfig.attributes;return se[K]={from:Y,converter:le},K}_getOrAddEmailSendersAttribute(j,K,Y){return this._findCalculatedAttribute(j,Y,"crt.ToSendersMailboxes")||this._createCalculatedAttribute(j,`${K.name}_SendersMailboxes`,Y,"crt.ToSendersMailboxes")}_getOrAddEmailRecipientsAttribute(j,K,Y){return this._findCalculatedAttribute(j,Y,"crt.ToRecipientsMailboxes")||this._createCalculatedAttribute(j,`${K.name}_RecipientsMailboxes`,"crt.RefreshEmailRecipientsRequest","crt.ToRecipientsMailboxes")}crtOnMetaDataInit(j){var K=this;return(0,M.A)(function*(){const Y=j,le=K._getViewConfigs(Y,"crt.EmailComposer");for(const se of le)K._setCrudEventsBindings(se),K._setAttributes(Y,se),K._setCalculatedAttributes(Y,se),yield K._selectionActionsMetadataService.setRewriteOptions(Y,se);return Promise.resolve(j)})()}static{this.\u0275fac=function(K){return new(K||F)(W.\u0275\u0275inject(P.S))}}static{this.\u0275prov=W.\u0275\u0275defineInjectable({token:F,factory:F.\u0275fac})}}class X{constructor(j){this._selectionActionsMetadataService=j}_getViewConfigs(j,K){return Z.u.getViewConfigInfoByProperty("type",K,j.viewConfig).map(Y=>Y?.viewConfig).filter(Boolean)}crtOnMetaDataInit(j){var K=this;return(0,M.A)(function*(){const Y=j,le=K._getViewConfigs(Y,"crt.FeedComposer");for(const se of le)yield K._selectionActionsMetadataService.setRewriteOptions(Y,se);return Promise.resolve(j)})()}static{this.\u0275fac=function(K){return new(K||X)(W.\u0275\u0275inject(P.S))}}static{this.\u0275prov=W.\u0275\u0275defineInjectable({token:X,factory:X.\u0275fac})}}var te=e(86190),pe=e(36122),me=e(85688),he=e(2047),ue=e(55529),ve=e(59784),Me=e(46690),Se=e(43673),We=e(2023),Ke=e(98488),Fe=e(79341),Ve=e(43482),je=e(81517),Ne=e(2828);let be=class extends je.S{};be=(0,n.__decorate)([(0,Ne.$)({type:"crt.CreateEmailRequest",title:"InterfaceDesigner.PropertiesPages.ViewElementEventPropertiesPanel.Requests.CreateEmailRequest",propertiesPanelComponentTypeName:"crt.CreateEmailRequestPropertiesPanelComponent"})],be);function He(){const $e=[be]}He();let Oe=class Ue{constructor(j,K){this._matIconRegistry=j,this._domSanitizer=K,this._registerIcons()}_registerIcons(){[{name:"reply-message",icon:e(5719)},{name:"reply-all-message",icon:e(90277)},{name:"reply-message",icon:e(5719)}].forEach(({name:K,icon:Y})=>{this._matIconRegistry.addSvgIconLiteral(K,this._domSanitizer.bypassSecurityTrustHtml(Y))})}static{this.\u0275fac=function(K){return new(K||Ue)(W.\u0275\u0275inject(s.MatIconRegistry),W.\u0275\u0275inject(t.DomSanitizer))}}static{this.\u0275mod=W.\u0275\u0275defineNgModule({type:Ue})}static{this.\u0275inj=W.\u0275\u0275defineInjector({providers:[R.d,te.$,pe.I,me.d,he.W,ue.B,ve.S,Me.y,Se.e,We.v,Ke.D,$.Z,Fe.o,Ve.O,{provide:V.U2,useFactory:j=>new V.Dj(j),deps:[a.DOCUMENT]},{provide:h.m,useClass:o,multi:!0},{provide:h.m,useClass:F,multi:!0},{provide:h.m,useClass:X,multi:!0}],imports:[a.CommonModule,L.P,c.q,u.q,d.S,g.r,C.S,x.u,D.D,A,s.MatIconModule,l.MatSnackBarModule,T.q,v.C,N.d,_.TranslateModule]})}};Oe=(0,n.__decorate)([(0,y.g)({viewElements:[J.V,ce.n,m.r,f.l,S.E,I.B],requestHandlers:[ne.H,re.I,U.F,Q.p,k.x,q.E,ee.T,_e.e,Ce._,ye.C,Pe.p,De.I,fe.M],converters:[de.q,Ee.m,oe.K]}),(0,n.__metadata)("design:paramtypes",[s.MatIconRegistry,t.DomSanitizer])],Oe),function(){(typeof ngJitMode>"u"||ngJitMode)&&W.\u0275\u0275setNgModuleScope(Oe,{declarations:[J.V,ce.n,m.r,B.m,H.u,w.m,f.l,S.E,ie.l,I.B],imports:[a.CommonModule,L.P,c.q,u.q,d.S,g.r,C.S,x.u,G.m,D.D,A,s.MatIconModule,l.MatSnackBarModule,T.q,v.C,N.d,_.TranslateModule],exports:[J.V,ce.n,m.r,f.l,S.E,I.B]})}()},58909:(z,O,e)=>{e.d(O,{An:()=>t,J3:()=>a,M7:()=>n,Od:()=>s,iQ:()=>l});const n="ReplyEmailEvent",a="EmailSavedEvent",s="BlindZoneWidthEvent",l="ReadyEvent",t="FocusInputEvent"},16296:(z,O,e)=>{e.d(O,{T:()=>n});var n;(function(a){a.Reply="reply",a.ReplyAll="reply-all",a.Forward="forward",a.EditDraft="edit-draft"})(n||(n={}))},36122:(z,O,e)=>{e.d(O,{I:()=>_});var n=e(62278),a=e.n(n),s=e(29957),l=e.n(s),t=e(59131),y=e.n(t);class _{constructor(){this._changeComposer$=new n.Subject}getComposerObservable(){return this._changeComposer$.asObservable()}openComposer(d){s.String.isNullOrWhiteSpace(d)||this._changeComposer$.next(d)}static{this.\u0275fac=function(r){return new(r||_)}}static{this.\u0275prov=t.\u0275\u0275defineInjectable({token:_,factory:_.\u0275fac})}}},86190:(z,O,e)=>{e.d(O,{$:()=>_});var n=e(59969),a=e(28399),s=e.n(a),l=e(59131),t=e.n(l),y=e(38071);class _{constructor(d,r){this._doNotUseCache=!1,this._storage=d.localStorage,r.getFeatureState("DoNotCacheComposerData").subscribe(p=>{this._doNotUseCache=p})}remove(d){(0,a.isEmpty)(d)||this._doNotUseCache||this._storage.removeItem(d)}set(d,r){(0,a.isEmpty)(d)||this._doNotUseCache||this._storage.setItem(d,r)}get(d){return(0,a.isEmpty)(d)||this._doNotUseCache?"":this._storage.getItem(d)}static{this.\u0275fac=function(r){return new(r||_)(l.\u0275\u0275inject(n.ZP),l.\u0275\u0275inject(y.d))}}static{this.\u0275prov=l.\u0275\u0275defineInjectable({token:_,factory:_.\u0275fac})}}},2023:(z,O,e)=>{e.d(O,{v:()=>_});var n=e(59969),a=e(86190),s=e(59131),l=e.n(s),t=e(85688),y=e(38071);class _ extends a.${constructor(d,r,p){super(d,p),this._emailsService=r}set(d,r){const p=this._emailsService.getDraftUserContent(r);super.set(d,p)}static{this.\u0275fac=function(r){return new(r||_)(s.\u0275\u0275inject(n.ZP),s.\u0275\u0275inject(t.d),s.\u0275\u0275inject(y.d))}}static{this.\u0275prov=s.\u0275\u0275defineInjectable({token:_,factory:_.\u0275fac})}}},59784:(z,O,e)=>{e.d(O,{S:()=>W});var n=e(28399),a=e.n(n),s=e(62278),l=e.n(s),t=e(36486),y=e.n(t),_=e(29957),u=e.n(_),d=e(59131),r=e.n(d),p=e(56089),b=e(23092);class W{constructor(v,V){this._macrosHelperService=v,this._userInfo=V,this._indentation="<br>",this._signatureTag="<signature>",this._signatureTpl="<signature>{0}</signature>",this._macrosRegex=new RegExp(/\[#(.+?)#\]/)}_replaceSignatureInBody(v,V){return v.includes(this._signatureTag)?v.replace(this._getSignatureRegExp(),V):v.concat(V)}_getSignatureRegExp(){return/((<br.{1,4}>)|(\\r\\n)){0,1}((<br.{1,4}>)|(\\r\\n)){0,1}(<div>){0,1}<signature>[\s\S]*?<\/signature>(<\/div>){0,1}/}_getFormattedSignature(v){const V=v.indexOf(this._signatureTag);return(0,n.isEmpty)(v)||V===-1?_.String.format(`<div>${this._signatureTpl}</div>`,v||""):V===0?_.String.format("<div>{0}</div>",v):v}_processSignature(v,V){const c=this._getFormattedSignature(V);return(0,n.isEmpty)(v)?v=((0,n.isEmpty)(V)?this._indentation:this._indentation.repeat(2)).concat(c):v=this._replaceSignatureInBody(v,c),v}get signatureTpl(){return this._signatureTpl}get signatureTplWithIndent(){return this._indentation.repeat(2).concat(this.signatureTpl)}isBodyContainSignature(v){return!(0,n.isEmpty)(this._getSignatureRegExp().exec(v))}updateSignatureInBody(v,V){if(v=v||"",V=V||"",this._macrosRegex.test(V)){v=this._processSignature(v,_.String.empty);const c={entityId:this._userInfo.contactId,entityName:"Contact",textTemplate:V};return this._macrosHelperService.getTemplateByEntity(c,!0).pipe((0,s.map)(g=>this._processSignature(v,g)),(0,t.catchError)(()=>(0,s.of)(V)))}else return(0,s.of)(this._processSignature(v,V))}static{this.\u0275fac=function(V){return new(V||W)(d.\u0275\u0275inject(p.$),d.\u0275\u0275inject(b.oq))}}static{this.\u0275prov=d.\u0275\u0275defineInjectable({token:W,factory:W.\u0275fac})}}},55529:(z,O,e)=>{e.d(O,{B:()=>b});var n=e(41108),a=e(56267),s=e(5704),l=e(58504),t=e(29025),y=e(53163),_=e(62278),u=e.n(_),d=e(59131),r=e.n(d),p=e(56089);class b{constructor(A){this._macrosService=A,this._templatesEntitySchemaName="EmailTemplate",this._lookupPageSchemaName="EmailTemplatesLookupPage"}_handleEmailTextTemplate(A){return`<div>${A}</div>`.replace(new RegExp(/<(\/)?(html|head|body)([^><]*?)>/gim),"")}_getLookupPageFiltersConfig(A){const v="lookupObjectFilter",V=new n.X(a.H.Or),c=new s.x(l.H.Equal,new t.g({columnPath:"[SysSchema:UId:Object].Name"}),new y.J({value:A})),g=new s.x(l.H.Is_null,new t.g({columnPath:"Object"}),new y.J({value:null}));return V.add(c),V.add(g),{filterAttributes:[{name:v,loadOnChange:!1}],attributesConfig:{[v]:{value:V}}}}getTemplatesLookupConfig(A){return{type:"crt.OpenSelectionWindowRequest",$context:{},entitySchemaName:this._templatesEntitySchemaName,schemaName:this._lookupPageSchemaName,features:{create:{enabled:!1},select:{multiple:!1,selectAll:!1}},filtersConfig:this._getLookupPageFiltersConfig(A)}}getMultiLanguageTemplate(A,v,V){return this._macrosService.getMultiLanguageTemplate(V,v,A).pipe((0,_.map)(c=>(c.textTemplate=this._handleEmailTextTemplate(c.textTemplate),c)))}static{this.\u0275fac=function(v){return new(v||b)(d.\u0275\u0275inject(p.$))}}static{this.\u0275prov=d.\u0275\u0275defineInjectable({token:b,factory:b.\u0275fac})}}},85688:(z,O,e)=>{e.d(O,{d:()=>J});var n=e(63721),a=e.n(n),s=e(59131),l=e.n(s),t=e(49973),y=e(58504),_=e(86464),u=e(74709),d=e(43785),r=e(18587),p=e(6530),b=e(79772),W=e.n(b),A=e(65751),v=e(29858),V=e(26628),c=e(48899),g=e(55359),C=e(28399),x=e.n(C),D=e(62278),T=e.n(D),R=e(36486),$=e.n(R),h=e(29957),L=e.n(h),N=e(59784),G=e(16296);class J{constructor(m){this._injector=m,this._replyBodyLimiter="<div bodylimiter",this._copyEntitiesMethod="/rest/EntityUtilsService/CopyEntities",this._inReplyToActivityHeader="X-In-Reply-To-Activity",this._httpClient=this._injector.get(n.HttpClient),this._queryExecutor=this._injector.get(A.w),this._translateService=this._injector.get(b.TranslateService),this._emailSignatureService=this._injector.get(N.S),this._fileApiService=this._injector.get(V.k),this._entityConnectionService=this._injector.get(v.r),this._entitySchemaService=this._injector.get(c.e)}_getEmailEsq(m){const f=new t.s("Activity");return f.addSchemaColumn("Sender"),f.addSchemaColumn("Recepient"),f.addSchemaColumn("CopyRecepient"),f.addSchemaColumn("BlindCopyRecepient"),f.addSchemaColumn("Title"),f.addSchemaColumn("Body"),f.addSchemaColumn("SendDate"),f.addSchemaColumn("HeaderProperties"),f.filters.addSchemaColumnFilterWithParameter(y.H.Equal,"Id",m),f}_mapEmail(m){const f={id:m.Id,from:m.Sender,subject:m.Title,body:m.Body,sendDate:m.SendDate,attachments:[]},S=m.Recepient.toString(),I=m.CopyRecepient.toString(),B=m.BlindCopyRecepient.toString(),H=m.HeaderProperties.toString();return f.to=h.String.isNullOrWhiteSpace(S)?[]:S.split(";").filter(Boolean),f.cc=h.String.isNullOrWhiteSpace(I)?[]:I.split(";").filter(Boolean),f.bcc=h.String.isNullOrWhiteSpace(B)?[]:B.split(";").filter(Boolean),f.headers=h.String.isNullOrWhiteSpace(H)?[]:H.split(`
`).filter(Boolean).map(w=>this._mapHeader(w)),f}_getAttachmentsEsq(m){const f=new t.s("ActivityFile");return f.addSchemaColumn("Id"),f.addSchemaColumn("Name"),f.addSchemaColumn("Size"),f.filters.addSchemaColumnFilterWithParameter(y.H.Equal,"Activity",m),f.filters.addSchemaColumnFilterWithParameter(y.H.Equal,"Inline",!1),f}_mapAttachment(m){const f=new File([],m.Name);return{id:m.Id,size:m.Size,file:f,content:new ArrayBuffer(0)}}_prepareRecipient(m){return m.replace("<","&lt;").replace(">","&gt;")}_getBody(m){const f="<span style='font-weight: bold;'>{0}: </span><span>{1}</span><br>",S="<br>{0}><hr style='border:none;border-top: 1px solid #E3E3E3;'>",B="<div><blockquote style='margin-left: 0.8ex;border-left: 1px solid #E3E3E3;padding-left: 1ex;font: inherit;'>{0}</blockquote></div>",H=this._prepareRecipient(m.from),w=m.to?this._prepareRecipient(m.to.join(";")):"",ie=m.body,de=m.body.match(/<body.*?>([\s\S]*)<\/body>/),Ee=de&&de[1]||ie,oe=new h.StringBuilder;if(oe.appendFormat(this._emailSignatureService.signatureTplWithIndent,h.String.empty),oe.appendFormat(S,this._replyBodyLimiter),oe.appendFormat(f,this._translateService.instant("MessageComposer.Email.From"),H),oe.appendFormat(f,this._translateService.instant("MessageComposer.Email.SentOn"),m.sendDate),oe.appendFormat(f,this._translateService.instant("MessageComposer.Email.To"),w),m.cc?.length!==0){const ne=m.cc?this._prepareRecipient(m.cc.join(";")):"";oe.appendFormat(f,this._translateService.instant("MessageComposer.Email.CC"),ne)}return oe.appendFormat(f,this._translateService.instant("MessageComposer.Email.Subject"),m.subject),oe.appendFormat(B,Ee),oe.toString()}_getShortBody(m=!0){const f="<br>{0}>",S='<div><div class="email-composer-reply-expander"></div></div>',I=new h.StringBuilder;return m&&I.appendFormat(this._emailSignatureService.signatureTplWithIndent,h.String.empty),I.appendFormat(f,this._replyBodyLimiter),I.appendFormat(S),I.toString()}_getSubjectPrefix(m){return m===G.T.Forward?"FW: ":"RE: "}_getSubject(m,f){const S=this._getSubjectPrefix(f),I=m.subject;return I.startsWith(S)?I:S+I}_setRecipients(m,f,S){let I=[];const B=f.from;switch(S){case G.T.Reply:I=h.String.isNullOrWhiteSpace(B)?[]:[B];break;case G.T.ReplyAll:{const H=f.to?f.to:[];I=h.String.isNullOrWhiteSpace(B)?[...H]:[B,...H];break}default:break}m.to=I,m.cc=S===G.T.ReplyAll?f.cc:[],m.bcc=[]}_getInsertQuery(m,f){return this._getQueryWithEmailColumns(m,f).pipe((0,R.map)(S=>(S.addColumn("Id",m.id,_.r.Guid),S)))}_getUpdateQuery(m,f){return this._getQueryWithEmailColumns(m,f).pipe((0,R.map)(S=>(S.filters.addSchemaColumnFilterWithParameter(y.H.Equal,"Id",m.id),S)))}_mapHeader(m){const f=m.split("=");return{name:f[0],value:f[1]}}_getHeaderProperties(m,f){const S=m.headers||[];return!(0,C.isEmpty)(f.inReplyToId)&&!S.find(I=>I.name===this._inReplyToActivityHeader)&&S.push({name:this._inReplyToActivityHeader,value:f.inReplyToId}),S.map(I=>`${I.name}=${I.value}`).join(`
`)}_getQueryWithEmailColumns(m,f){const S=m.isDraft?new u.N("Activity"):new d.L("Activity");return S.addColumn("Title",m.subject,_.r.Text),S.addColumn("Body",m.body,_.r.Text),S.addColumn("Sender",m.from,_.r.Text),S.addColumn("Recepient",m.to?.join(";"),_.r.Text),S.addColumn("CopyRecepient",m.cc?.join(";"),_.r.Text),S.addColumn("BlindCopyRecepient",m.bcc?.join(";"),_.r.Text),S.addColumn("Type",g.Iq,_.r.Guid),S.addColumn("ActivityCategory",g.Aw,_.r.Guid),S.addColumn("IsHtmlBody",!0,_.r.Boolean),S.addColumn("HeaderProperties",this._getHeaderProperties(m,f),_.r.Text),this._entitySchemaService.getEntitySchemaByName("Activity").pipe((0,R.switchMap)(I=>this._addDefaultValues(f,S,I.entitySchema.columns))).pipe((0,R.switchMap)(I=>this._addEntityConnectionColumns(f,I)))}_getColumnDataValueType(m){return[_.r.LONG_TEXT,_.r.MAXSIZE_TEXT].includes(m.dataValueType)?_.r.Text:m.dataValueType}_addEntityConnectionColumns(m,f){return(0,C.isEmpty)(m?.masterSchemaName)||(0,C.isEmpty)(m?.masterRecordId)?(0,D.of)(f):(0,D.from)(this._entityConnectionService.getEntityConnectionColumns("Activity",m?.masterSchemaName)).pipe((0,R.switchMap)(S=>(S&&S.forEach(I=>{const B=this._getColumnDataValueType(I);f.addColumn(I.name,m.masterRecordId,B)}),(0,D.of)(f))))}_addDefaultValues(m,f,S){const I=m.defaultValues;return I&&I.forEach(B=>{const H=S.find(w=>w.name===B.attributeName);if(H){const w=this._getColumnDataValueType(H);f.addColumn(B.attributeName,B.value,w)}}),(0,D.of)(f)}_executeQuery(m,f){return m.isDraft?this._getUpdateQuery(m,f).pipe((0,R.switchMap)(S=>this._queryExecutor.executeUpdateQuery(S))):this._getInsertQuery(m,f).pipe((0,R.switchMap)(S=>this._queryExecutor.executeInsertQuery(S)))}_trimStart(m,f){return m.startsWith(f)?m.slice(f.length):m}_trimEnd(m,f){return m.endsWith(f)?m.slice(0,m.length-f.length):m}_trimBrTag(m){let f=this._trimStart(m,"&nbsp;");return f=this._trimEnd(f,"<br>"),f}_deleteRemovedAttachments(m){const f=new r.x("ActivityFile");return f.filters.addSchemaColumnFilterWithParameter(y.H.Equal,"Activity",m.id),f.filters.addSchemaColumnFilterWithParameter(y.H.Equal,"Inline",!1),m.attachments.forEach(I=>f.filters.addSchemaColumnFilterWithParameter(y.H.Not_equal,"Id",I.id)),this._queryExecutor.executeDeleteQuery(f)}getEmail(m,f){const S=this._getEmailEsq(m),I=this._queryExecutor.executeSelectQuery(S).pipe((0,R.map)(H=>this._mapEmail(H[0]))),B=f?this.getAttachments(m):(0,D.of)([]);return(0,D.forkJoin)([I,B]).pipe((0,R.map)(H=>{const w=H[0];return w.attachments=H[1],w}))}getAttachments(m){const f=this._getAttachmentsEsq(m);return this._queryExecutor.executeSelectQuery(f).pipe((0,R.map)(S=>S.map(I=>this._mapAttachment(I))))}getReplyDraft(m,f){const S={id:(0,p.qv)(),from:"",subject:this._getSubject(m,f),body:this._getBody(m),bodyShort:this._getShortBody(),isDraft:!1,attachments:f===G.T.Forward&&m.attachments?[...m.attachments]:[]};return this._setRecipients(S,m,f),(0,D.of)(S)}getSafeUserContentReplyBody(m,f){const S=this.getDraftUserContent(m),I=this.getDraftUserContent(f);return f.replace(I,S)}getDraftUserContent(m,f=!1){const S=m.indexOf(this._replyBodyLimiter);return S!==-1&&(m=this._trimBrTag(m.substring(0,S))),f?m+this._getShortBody(!1):m}saveEmail(m,f){return this._executeQuery(m,f).pipe((0,R.concatMap)(S=>{if(!S.success)throw new Error(S.errorInfo?.message);let I=m.attachments;return I?(I=I.filter(B=>B.content.byteLength>0),I.length===0?(0,D.of)([S]):(0,D.from)(I).pipe((0,R.concatMap)(B=>this._fileApiService.upload(B)),(0,R.last)())):(0,D.of)([S])}),(0,R.concatMap)(S=>{if(!S[0].success)throw new Error(S[0].errorInfo?.message);if(m.isDraft)return this._deleteRemovedAttachments(m).pipe((0,R.switchMap)(()=>(0,D.of)([S])),(0,D.catchError)(()=>(0,D.of)([S])));if(m.attachments.filter(H=>H.content.byteLength===0).length===0)return(0,D.of)([S]);const B={sourceEntityId:f?.inReplyToId,recipientEntityId:m.id,columnName:"Activity",entitySchemaName:"Activity",sourceEntitySchemaNames:["ActivityFile"],isOnlyInline:!0,inlineIds:m.attachments.filter(H=>H.content.byteLength===0).map(H=>H.id)};return this._httpClient.post(this._copyEntitiesMethod,B)}),(0,R.switchMap)(S=>{if(S.CopyEntitiesResult&&S.CopyEntitiesResult.length===0)throw new Error(S.errorInfo?.message);return(0,D.of)({success:!0,activityId:m.id})}),(0,D.catchError)(S=>(0,D.of)({success:!1,errorInfo:{errorCode:null,message:S.message,stackTrace:""},activityId:m.id})))}static{this.\u0275fac=function(f){return new(f||J)(s.\u0275\u0275inject(s.Injector))}}static{this.\u0275prov=s.\u0275\u0275defineInjectable({token:J,factory:J.\u0275fac})}}},79341:(z,O,e)=>{e.d(O,{o:()=>d});var n=e(63721),a=e.n(n),s=e(43482),l=e(59131),t=e.n(l),y=e(81923),_=e(38071),u=e(95145);class d{constructor(p,b,W,A){this._httpClient=p,this._entitySchemaRepository=b,this._featureService=W,this._sysSettingsService=A}getInstance(p,b,W){return new s.O(this._httpClient,this._entitySchemaRepository,p,b,this._featureService,this._sysSettingsService,W)}static{this.\u0275fac=function(b){return new(b||d)(l.\u0275\u0275inject(n.HttpClient),l.\u0275\u0275inject(y.v),l.\u0275\u0275inject(_.d),l.\u0275\u0275inject(u.A))}}static{this.\u0275prov=l.\u0275\u0275defineInjectable({token:d,factory:d.\u0275fac})}}},43482:(z,O,e)=>{e.d(O,{O:()=>v});var n=e(63721),a=e.n(n),s=e(58504),l=e(6530),t=e(28399),y=e.n(t),_=e(62278),u=e.n(_),d=e(36486),r=e.n(d),p=e(29957),b=e.n(p),W=e(59131),A=e.n(W);class v{constructor(c,g,C,x,D,T,R){this._httpClient=c,this._entitySchemaRepository=g,this._entityId=C,this._entitySchemaName=x,this._featureService=D,this._sysSettingsService=T,this._entitySchemaUId=R,this._getContactsFromDbMethod="/rest/ESNFeedModuleService/GetContactsForMention",this._getContactsFromEsMethod="/rest/ESNFeedModuleService/GetESContactsForMention",this._searchPageSize=15,this._useGlobalSearch=!1,this._featureService.getFeaturesState(["GlobalSearch_V2","ESMention","UseContactMentionFilterComparisonTypeForContactMention"]).subscribe($=>{const h=$?.slice(0,2),L=$&&$[2];this._useGlobalSearch=h?.length===2&&!h.includes(!1),L&&(this._comparisonType=s.H.Contain)})}_getSchemaUId(){return this._entitySchemaUId&&!(0,l.gZ)(this._entitySchemaUId)?(0,_.of)(this._entitySchemaUId):this._entitySchemaRepository.getSchemaByName(this._entitySchemaName).pipe((0,d.map)(c=>c.uId))}_mapContactsResponse(c){return c.result.map(g=>({value:g.value,displayValue:g.displayValue,primaryImageValue:g.primaryImage,connectionType:g.connectionType}))}_getComparisonType(){return this._comparisonType?(0,_.of)(this._comparisonType):this._sysSettingsService.getByCode("StringColumnSearchComparisonType").pipe((0,d.map)(c=>c?.value===1?s.H.Contain:s.H.Start_with),(0,d.map)(c=>(this._comparisonType=c,c)))}_getMentionsFromDb(c){return(0,_.forkJoin)([this._getSchemaUId(),this._getComparisonType()]).pipe((0,d.switchMap)(([g,C])=>this._httpClient.post(this._getContactsFromDbMethod,{entityId:this._entityId,entitySchemaUId:g,searchName:c,searchType:C}).pipe((0,d.map)(x=>this._mapContactsResponse(x)))))}_getMentionsFromGlobalSearch(c){if((0,t.isEmpty)(c))return(0,_.of)([]);const g=(c||p.String.empty).trim().split(" ").map(C=>C.trim());return this._httpClient.post(this._getContactsFromEsMethod,{query:g,rowsOffset:0,rowCount:this._searchPageSize}).pipe((0,d.map)(C=>this._mapContactsResponse(C)))}getContacts(c){return this._useGlobalSearch?this._getMentionsFromGlobalSearch(c):this._getMentionsFromDb(c)}static{this.\u0275fac=function(g){W.\u0275\u0275invalidFactory()}}static{this.\u0275prov=W.\u0275\u0275defineInjectable({token:v,factory:v.\u0275fac})}}},98488:(z,O,e)=>{e.d(O,{D:()=>v});var n=e(63721),a=e.n(n),s=e(6530),l=e(28399),t=e.n(l),y=e(62278),_=e.n(y),u=e(36486),d=e.n(u),r=e(59131),p=e.n(r),b=e(81923),W=e(72882),A=e(26628);class v{constructor(c,g,C,x){this._httpClient=c,this._entitySchemaRepository=g,this._feedNotificationService=C,this._fileApiService=x,this._postMessageMethod="/rest/EsnService/PostMessage",this._editMessageMethod="/rest/EsnService/EditMessage",this._postCommentMethod="/rest/EsnService/PostComment",this._editCommentMethod="/rest/EsnService/EditComment",this._readAttachmentsMethod="/rest/EsnService/ReadAttachments",this._deleteAttachmentsMethod="/rest/EsnService/DeleteAttachments"}_getSchemaUId(c){return this._entitySchemaRepository.getSchemaByName(c).pipe((0,u.map)(g=>g.uId))}_postMessage(c,g){return this._httpClient.post(c,g).pipe((0,u.map)(C=>C.Id))}_modifyMessage(c,g){return this._httpClient.post(c,g).pipe((0,u.map)(C=>C.success))}_uploadAttachments(c){const g=c.filter(C=>C.content.byteLength>0);return g.length===0?(0,y.of)(!0):(g.forEach(C=>{C.fileEntitySchemaName="FeedFile"}),(0,y.from)(g).pipe((0,u.concatMap)(C=>this._fileApiService.upload(C)),(0,u.last)(),(0,u.map)(()=>!0)))}_deleteAttachments(c,g,C,x){return this._httpClient.post(this._deleteAttachmentsMethod,{messageId:c,attachmentsToKeepIds:g,schemaUId:C,entityId:x})}_getAttachmentIds(c){const g=new RegExp(/FileService\/Download\/FeedFile\/(.+?)"/gi);return[...c.Message.matchAll(g)].map(x=>x[1]).concat(c.Attachments?.map(x=>x.id))}_updateMessageAttachments(c,g){const C=g?c.Id:s.To;return((0,l.isEmpty)(c.Attachments)?(0,y.of)(!0):this._uploadAttachments(c.Attachments)).pipe((0,u.concatMap)(()=>{const D=this._getAttachmentIds(c);return this._deleteAttachments(c.Id,D,c.EntitySchemaUId,c.EntityId)}),(0,u.map)(()=>C))}updateMessage(c){return this._modifyMessage(this._editMessageMethod,{messageId:c.Id,message:{Id:c.Id,SchemaUId:c.EntitySchemaUId,EntityId:c.EntityId,Message:c.Message,UserAccess:c.UserAccess}}).pipe((0,u.switchMap)(g=>this._updateMessageAttachments(c,g)))}updateChildMessage(c){return this._modifyMessage(this._editCommentMethod,{commentId:c.Id,comment:{Id:c.Id,SchemaUId:c.EntitySchemaUId,EntityId:c.EntityId,Message:c.Message,UserAccess:c.UserAccess}}).pipe((0,u.switchMap)(g=>this._updateMessageAttachments(c,g)))}postMessage(c){return this._getSchemaUId(c.EntitySchemaName).pipe((0,u.switchMap)(g=>this._postMessage(this._postMessageMethod,{message:{Id:c.Id,SchemaUId:g,EntityId:c.EntityId,Message:c.Message,UserAccess:c.UserAccess}})),(0,u.concatMap)(g=>(0,l.isEmpty)(c.Attachments)?(0,y.of)(g):this._uploadAttachments(c.Attachments).pipe((0,u.map)(()=>g))),(0,u.map)(g=>(this._feedNotificationService.onFeedPostPublished(g,c.EntityId),g)))}postChildMessage(c,g){return this._postMessage(this._postCommentMethod,{messageId:g,comment:{Id:c.Id,SchemaUId:c.EntitySchemaUId,EntityId:c.EntityId,Message:c.Message,UserAccess:c.UserAccess}}).pipe((0,u.concatMap)(C=>(0,l.isEmpty)(c.Attachments)?(0,y.of)(C):this._uploadAttachments(c.Attachments).pipe((0,u.map)(()=>C))))}loadAttachments(c,g,C,x,D){const T=x||"FeedFile",R=D||"RecordId";return this._httpClient.post(this._readAttachmentsMethod,{messageId:c,schemaUId:g,entityId:C,schemaName:T,columnName:R}).pipe((0,u.map)($=>$.files.map(h=>({fileId:h.Id,fileName:h.Name,fileSize:h.Size,fileCreatedOn:h.CreatedOn,getBoundDataSchemaByAttributePath:function(){return{name:T}}}))))}static{this.\u0275fac=function(g){return new(g||v)(r.\u0275\u0275inject(n.HttpClient),r.\u0275\u0275inject(b.v),r.\u0275\u0275inject(W.Z),r.\u0275\u0275inject(A.k))}}static{this.\u0275prov=r.\u0275\u0275defineInjectable({token:v,factory:v.\u0275fac})}}},2047:(z,O,e)=>{e.d(O,{W:()=>c});var n=e(63721),a=e.n(n),s=e(49973),l=e(41108),t=e(56267),y=e(58504),_=e(6530),u=e(28399),d=e.n(u),r=e(62278),p=e.n(r),b=e(36486),W=e.n(b),A=e(59131),v=e.n(A),V=e(65751);class c{constructor(C,x){this._queryExecutor=C,this._httpClient=x,this._getCaseSenderMethod="/rest/SenderObtainingService/ObtainSenderMailbox"}_getMailboxesEsq(C){const x=new s.s("MailboxSyncSettings");x.addSchemaColumn("SenderEmailAddress"),x.addSchemaColumn("SenderDisplayValue"),x.addSchemaColumn("Signature"),x.addSchemaColumn("UseSignature"),x.addSchemaColumn("CreatedBy");const D=new l.X(t.H.Or);return D.addSchemaColumnFilterWithParameter(y.H.Equal,"SysAdminUnit",C),D.addSchemaColumnFilterWithParameter(y.H.Equal,"IsShared",!0),x.filters.addSchemaColumnFilterWithParameter(y.H.Equal,"SendEmailsViaThisAccount",!0),x.filters.add(D),x}_getCaseParamsEsq(C){const x=new s.s("Case");return x.addSchemaColumn("ParentActivity.Recepient","To"),x.addSchemaColumn("ParentActivity.CopyRecepient","CC"),x.addSchemaColumn("ParentActivity.BlindCopyRecepient","BCC"),x.addSchemaColumn("Contact"),x.addSchemaColumn("Category"),x.filters.addSchemaColumnFilterWithParameter(y.H.Equal,"Id",C),x}_mapMailbox(C){return{id:C.Id,senderEmailAddress:C.SenderEmailAddress,senderDisplayValue:C.SenderDisplayValue,signature:C.Signature,useSignature:C.UseSignature,createdBy:C.CreatedBy}}_mapGetSenderRequestConfig(C){const x=[C.To,C.CC,C.BCC].filter(D=>!(0,u.isEmpty)(D));return{recipients:x.length>0?x.join(";"):"",contactId:C.Contact?C.Contact.value:null,categoryId:C.Category?C.Category.value:null}}_mapCaseSenderMailbox(C){return!C||!C.ObtainSenderMailboxResult||(0,u.isEmpty)(C.ObtainSenderMailboxResult.MailboxName)?null:{id:(0,_.qv)(),senderEmailAddress:C.ObtainSenderMailboxResult.MailboxName,useSignature:!1}}getMailboxesForSend(C){const x=this._getMailboxesEsq(C);return this._queryExecutor.executeSelectQuery(x).pipe((0,b.map)(D=>D?.map(T=>this._mapMailbox(T))))}getDefaultMailboxForSend(C){const x=this._getMailboxesEsq(C);return x.filters.addSchemaColumnFilterWithParameter(y.H.Equal,"IsDefault",!0),this._queryExecutor.executeSelectQuery(x).pipe((0,b.map)(D=>D?.map(T=>this._mapMailbox(T))),(0,b.switchMap)(D=>(0,r.of)(D[0])))}getCaseDefaultMailbox(C){const x=this._getCaseParamsEsq(C);return this._queryExecutor.executeSelectQuery(x).pipe((0,b.map)(D=>(0,u.isEmpty)(D)?null:this._mapGetSenderRequestConfig(D[0])),(0,b.concatMap)(D=>(0,u.isEmpty)(D)?(0,r.of)(null):this._httpClient.post(this._getCaseSenderMethod,D)),(0,b.switchMap)(D=>(0,r.of)(this._mapCaseSenderMailbox(D))))}static{this.\u0275fac=function(x){return new(x||c)(A.\u0275\u0275inject(V.w),A.\u0275\u0275inject(n.HttpClient))}}static{this.\u0275prov=A.\u0275\u0275defineInjectable({token:c,factory:c.\u0275fac,providedIn:"root"})}}},43673:(z,O,e)=>{e.d(O,{e:()=>x});var n=e(63721),a=e.n(n),s=e(49973),l=e(61320),t=e(41108),y=e(56267),_=e(58504),u=e(6530),d=e(59969),r=e(26594),p=e(28399),b=e.n(p),W=e(36486),A=e.n(W),v=e(29957),V=e.n(v),c=e(59131),g=e.n(c),C=e(65751);class x{constructor(T,R,$){this._queryExecutor=T,this._httpClient=R,this._globalSearchFeatureCode="GlobalSearch_V2",this._esEmailsSearchFeatureCode="IsESEmailsSearch",this._globalSearchMethodName="/rest/ESEmailService/SearchEmailsPage",this._itemsPerPage=15,this._useGlobalSearch=!1,this._useGlobalSearch=$[this._globalSearchFeatureCode]&&$[this._esEmailsSearchFeatureCode]}_getRecipientsEsq(T,R){const $=new s.s("VwRecepientEmail"),h=$.addSchemaColumn("Email");h.orderDirection=l.Z.Asc,$.rowCount=this._itemsPerPage,$.rowsOffset=R;const L=new t.X(y.H.Or);return L.addSchemaColumnFilterWithParameter(_.H.Contain,"Email",T),L.addSchemaColumnFilterWithParameter(_.H.Contain,"ContactName",T),$.filters.add(L),$}_mapRecipient(T){return{value:(0,u.qv)(),displayValue:T}}_getRecipientsFromGlobalSearch(T,R){const $=(T||v.String.empty).trim().split(" ").map(h=>h.trim());return this._httpClient.post(this._globalSearchMethodName,{query:$,rowsOffset:R,rowCount:this._itemsPerPage}).pipe((0,W.map)(h=>{const L=JSON.parse(h?.SearchEmailsResult||"[]")||[],N=[];return L.forEach(function(G){const J={emails:[]};Object.keys(G).forEach(function(ce){const m=G[ce];(0,d.m2)(m)&&J.emails.push(this._mapRecipient(m))},this),J.emails.length>0&&N.push(J)},this),N}))}_getRecipientsFromDb(T,R){const $=this._getRecipientsEsq(T,R);return this._queryExecutor.executeSelectQuery($).pipe((0,W.map)(h=>h?.map(L=>({emails:[this._mapRecipient(L.Email)]}))))}getRecipients(T,R=0){return this._useGlobalSearch&&!(0,p.isEmpty)(T)?this._getRecipientsFromGlobalSearch(T,R):this._getRecipientsFromDb(T,R)}static{this.\u0275fac=function(R){return new(R||x)(c.\u0275\u0275inject(C.w),c.\u0275\u0275inject(n.HttpClient),c.\u0275\u0275inject(r.G))}}static{this.\u0275prov=c.\u0275\u0275defineInjectable({token:x,factory:x.\u0275fac})}}},46690:(z,O,e)=>{e.d(O,{y:()=>d});var n=e(63721),a=e.n(n),s=e(62278),l=e.n(s),t=e(36486),y=e.n(t),_=e(59131),u=e.n(_);class d{constructor(p){this._httpClient=p,this._publishMessageMethod="/rest/EmailSendService/Send"}_mapSendResult(p){const b=p.SendResult[0].ErrorMessage,W={success:b===""};return W.success||(W.errorInfo={message:b,errorCode:"",stackTrace:""}),W}publishMessage(p){return this._httpClient.post(this._publishMessageMethod,{ActivityId:p})}sendEmail(p){return this.publishMessage(p).pipe((0,t.switchMap)(b=>(0,s.of)(this._mapSendResult(b))),(0,s.catchError)(b=>(0,s.of)({success:!1,errorInfo:{errorCode:null,message:b.message,stackTrace:""}})))}static{this.\u0275fac=function(b){return new(b||d)(_.\u0275\u0275inject(n.HttpClient))}}static{this.\u0275prov=_.\u0275\u0275defineInjectable({token:d,factory:d.\u0275fac})}}},55359:(z,O,e)=>{e.d(O,{Aw:()=>_,Iq:()=>s,er:()=>y,zY:()=>l});const n="C449D832-A4CC-4B01-B9D5-8A12C42A9F89",a="Activity",s="E2831DEC-CFC0-DF11-B00F-001D60E938C6",l="fbe0acdc-cfc0-df11-b00f-001d60e938c6",t="42c74c49-58e6-df11-971b-001d60e938c6",y="f51c4643-58e6-df11-971b-001d60e938c6",_="8038A396-7825-E011-8165-00155D043204"},93338:(z,O,e)=>{e.d(O,{_:()=>n});const n="ComposerEvent"},82650:(z,O,e)=>{e.d(O,{m:()=>t});var n=e(23493),a=e.n(n),s=e(59131),l=e.n(s);class t{transform(_){return(0,n.encode)(_)}static{this.\u0275fac=function(u){return new(u||t)}}static{this.\u0275pipe=s.\u0275\u0275definePipe({name:"encodeHtml",type:t,pure:!0,standalone:!0})}static{this.\u0275prov=s.\u0275\u0275defineInjectable({token:t,factory:t.\u0275fac,providedIn:"root"})}}},72882:(z,O,e)=>{e.d(O,{Z:()=>u});var n=e(59131),a=e.n(n),s=e(62278),l=e.n(s),t=e(91065),y=e(5240),_=e(23092);class u{constructor(r,p){this._messageChannelService=r,this._userInfo=p,this._subscriptions=[],this.newMessageEvent=new n.EventEmitter,this.feedPostPublishedEvent=new n.EventEmitter,this._subscribeMessageChannelEvents()}_subscribeMessageChannelEvents(){this._subscriptions.push(this._messageChannelService.messageEvent$.pipe((0,s.filter)(r=>r.header.sender==="UpdateSocialMessage"),(0,s.map)(r=>{const p=r.body;return{MessageId:r.id.toString(),AuthorId:p.sysAdminUnitId,Operation:p.operation,EntityId:p.channelId,ParentId:p.parentId,EntityName:p.entityName}})).subscribe(r=>this.newMessageEvent.emit(r)))}onFeedPostPublished(r,p){const b={MessageId:r,Operation:t.x.Insert,EntityId:p};this.feedPostPublishedEvent.emit(b)}ngOnDestroy(){this._subscriptions.forEach(r=>r?.unsubscribe())}static{this.\u0275fac=function(p){return new(p||u)(n.\u0275\u0275inject(y.A),n.\u0275\u0275inject(_.oq))}}static{this.\u0275prov=n.\u0275\u0275defineInjectable({token:u,factory:u.\u0275fac})}}},91065:(z,O,e)=>{e.d(O,{x:()=>n});var n;(function(a){a.Insert="insert",a.Update="update",a.Delete="delete",a.ForceUpdate="forceUpdate"})(n||(n={}))},62127:z=>{z.exports=`<svg width="73" height="64" viewBox="0 0 73 64" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M39.6128 25.1749H18.6128C16.9559 25.1749 15.6128 26.5181 15.6128 28.1749C15.6128 29.8318 16.9559 31.1749 18.6128 31.1749H39.6128C41.2696 31.1749 42.6128 29.8318 42.6128 28.1749C42.6128 26.5181 41.2696 25.1749 39.6128 25.1749Z" fill="#D1D1D1"/>
<path d="M53.6128 35.1749H18.6128C16.9559 35.1749 15.6128 36.5181 15.6128 38.1749C15.6128 39.8318 16.9559 41.1749 18.6128 41.1749H53.6128C55.2696 41.1749 56.6128 39.8318 56.6128 38.1749C56.6128 36.5181 55.2696 35.1749 53.6128 35.1749Z" fill="#D1D1D1"/>
<path d="M53.998 27.454V30.9513C53.998 31.1514 54.2593 31.2275 54.3667 31.0587L56.0831 28.3619L53.998 27.454Z" fill="#004FD6"/>
<path fill-rule="evenodd" clip-rule="evenodd" d="M61.9104 17.6219C61.9908 16.803 61.103 16.2429 60.3985 16.6681L48.9928 23.5514C48.2977 23.9709 48.3658 25.0001 49.1101 25.3243L52.1202 26.6359L58.0677 21.0965C58.2443 20.932 58.5071 21.1632 58.3665 21.3593L53.998 27.454L56.0831 28.3619L59.3996 29.8074C60.022 30.0787 60.7281 29.6641 60.7944 28.9884L61.9104 17.6219Z" fill="#004FD6"/>
<path d="M46.834 17.1179H11.25C9.59315 17.1179 8.25 18.4611 8.25 20.1179V46.2319C8.25 47.8888 9.59314 49.2319 11.25 49.2319H61.25C62.9069 49.2319 64.25 47.8888 64.25 46.2319V36.1749" stroke="#70ACEE" stroke-linecap="round"/>
</svg>
`},90277:z=>{z.exports=`<svg width="17" height="17" viewBox="0 0 17 17" fill="none" xmlns="http://www.w3.org/2000/svg">
	<path d="M5.41003 9.7832L2.41003 6.7832L5.41003 3.7832" stroke="#0D2E4E" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
	<path d="M8.41003 9.7832L5.41003 6.7832L8.41003 3.7832" stroke="#0D2E4E" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
	<path d="M14.41 12.7832C14.41 11.1919 13.7779 9.66578 12.6527 8.54056C11.5275 7.41534 10.0013 6.7832 8.41003 6.7832H5.41003" stroke="#0D2E4E" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
</svg>
`},5719:z=>{z.exports=`<svg width="17" height="17" viewBox="0 0 17 17" fill="none" xmlns="http://www.w3.org/2000/svg">
	<path d="M5.41003 9.7832L2.41003 6.7832L5.41003 3.7832" stroke="#0D2E4E" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
	<path d="M14.41 12.7832C14.41 11.1919 13.7779 9.66578 12.6527 8.54056C11.5275 7.41534 10.0013 6.7832 8.41003 6.7832H2.41003" stroke="#0D2E4E" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
</svg>
`}}]);
