(self.webpackChunkapp_studio_enterprise_schema_view=self.webpackChunkapp_studio_enterprise_schema_view||[]).push([[1823],{61823:(st,ct,s)=>{s.r(ct),s.d(ct,{ChangeCommunicationInvalidStateHandler:()=>G,ChangeCommunicationInvalidStateRequest:()=>ot,CommunicationEnum:()=>j,CommunicationOptionTypeEnum:()=>b,CommunicationOptionValidators:()=>Y,CreateCommunicationOptionHandler:()=>H,CreateCommunicationOptionRequest:()=>tt,CrtCommunicationOptionsComponent:()=>y,CrtCommunicationOptionsModule:()=>Q,MakeCommunicationOptionPrimaryHandler:()=>L,MakeCommunicationOptionPrimaryRequest:()=>nt,RemoveCommunicationOptionHandler:()=>W,RemoveCommunicationOptionRequest:()=>et,communicationOptionsToConfigArray:()=>T,findLatestValidOption:()=>q,getCommunicationTypeValue:()=>M});var l=s(5960),F=s(40297),z=s(52989),Mt=s(55642),P=s(79772),mt=s(5476),lt=s(28627),ut=s(50663),St=s(48067),dt=s(11475),pt=s(35284),Ct=s(94439),K=s(83515),U=s(57274),yt=s(31149),ht=s(44267),J=s(78007),X=s(75034),ft=s(96176),gt=s(63096),vt=s(12841),p=s(73308),i=s(59131),I=s(77592),Nt=s(66823),Vt=s(1034),Tt=s(96677),Rt=s(75456),xt=s(10098),It=s(59969),Dt=s(68712),_t=s(89285),bt=s(73723),C=s(62278),b;(function(m){m.Email="email",m.Phone="phone",m.Web="web",m.Google="google",m.Facebook="facebook",m.LinkedIn="linkedin",m.Twitter="twitter",m.Skype="skype",m.Text="text"})(b||(b={}));var j;(function(m){m.SMS="a09511b4-13f0-e011-a86b-00155d04c01d"})(j||(j={}));var At=s(29957);class Y{static numberDuplicate(t,e,n,o,a){const r=function(){var c=(0,p.A)(function*(u){const d=u.value,{primaryColumnName:g,typeColumnName:h,numberColumnName:A}=n,_=(yield Promise.all(o.map(function(){var f=(0,p.A)(function*(O){return{id:yield O[g],type:yield O[h],typeName:yield O[h+"Name"],number:yield O[A]}});return function(O){return f.apply(this,arguments)}}()))).find(f=>f.id!==t&&f.number===d&&(f.type===e||f.type?.value===e));return _?{invalidValueSyntax:{message:(0,At.formatString)(a,_.typeName,d)}}:null});return function(d){return c.apply(this,arguments)}}();return c=>r(c)}}var $t=s(12886),Ft=s(6975),jt=s(58433),Bt=s(22817),wt=s(19517);const Et=["container"],kt=()=>({columnGap:"large",rowGap:"none"}),Ht=()=>({top:"none",right:"none",bottom:"none",left:"none"}),Wt=m=>[m];function Lt(m,t){if(m&1&&i.\u0275\u0275element(0,"crt-skeleton-loader",4),m&2){const e=i.\u0275\u0275nextContext();i.\u0275\u0275property("styles",e.skeletonStyles)}}function Gt(m,t){if(m&1&&(i.\u0275\u0275elementStart(0,"div",11),i.\u0275\u0275elementContainer(1,12),i.\u0275\u0275elementEnd()),m&2){const e=t.$implicit,n=i.\u0275\u0275nextContext(4);i.\u0275\u0275advance(),i.\u0275\u0275property("crtViewModel",e)("viewConfig",i.\u0275\u0275pureFunction1(2,Wt,n.getTemplate(e)))}}function Zt(m,t){if(m&1&&(i.\u0275\u0275elementStart(0,"div",8)(1,"crt-grid",9),i.\u0275\u0275template(2,Gt,2,4,"div",10),i.\u0275\u0275elementEnd()()),m&2){const e=i.\u0275\u0275nextContext(3);i.\u0275\u0275advance(),i.\u0275\u0275property("columns",e.columns)("gap",i.\u0275\u0275pureFunction0(6,kt))("padding",i.\u0275\u0275pureFunction0(7,Ht))("borderRadius",e.none)("color",e.transparent),i.\u0275\u0275advance(),i.\u0275\u0275property("ngForOf",e.dataItems)}}function Qt(m,t){if(m&1&&(i.\u0275\u0275elementContainerStart(0),i.\u0275\u0275template(1,Zt,3,8,"div",7),i.\u0275\u0275elementContainerEnd()),m&2){const e=i.\u0275\u0275nextContext(2);i.\u0275\u0275advance(),i.\u0275\u0275property("ngIf",e.dataItems.length>0)}}function zt(m,t){m&1&&(i.\u0275\u0275elementContainerStart(0,14),i.\u0275\u0275element(1,"crt-placeholder",15),i.\u0275\u0275pipe(2,"translate"),i.\u0275\u0275elementContainerEnd()),m&2&&(i.\u0275\u0275advance(),i.\u0275\u0275propertyInterpolate("subhead",i.\u0275\u0275pipeBind1(2,1,"CommunicationOptions.NoDataPlaceholderText")))}function Kt(m,t){if(m&1&&i.\u0275\u0275template(0,zt,3,3,"ng-container",13),m&2){const e=i.\u0275\u0275nextContext(2);i.\u0275\u0275property("ngIf",e.showNoDataPlaceholder)}}function Ut(m,t){if(m&1&&(i.\u0275\u0275elementStart(0,"div",5,1),i.\u0275\u0275template(2,Qt,2,1,"ng-container",6)(3,Kt,1,1,"ng-template",null,2,i.\u0275\u0275templateRefExtractor),i.\u0275\u0275elementEnd()),m&2){const e=i.\u0275\u0275reference(4),n=i.\u0275\u0275nextContext();i.\u0275\u0275advance(2),i.\u0275\u0275property("ngIf",n.masterRecordColumnValue&&n.dataItems&&n.dataItems.length>0)("ngIfElse",e)}}let y=class at extends Dt.K{constructor(t){super(t),this.injector=t,this._defaultGridColumn="minmax(64px, 1fr)",this._columnsCount=2,this._templates={},this._subscriptions=new C.Subscription,this._columns=[this._defaultGridColumn],this.translatePrefix="CommunicationOptions",this.skeletonStyles={height:"52px",width:"100%"},this.width=Number.MAX_VALUE,this.placeholderImage={type:"icon",icon:"communication-options",width:null,height:null,padding:null},this.labelPosition="auto",this.showNoDataPlaceholder=!0,this.window=this.injector.get(It.ZP),this.translateService=this.injector.get(P.TranslateService)}set templates(t){this._templates=t}get templates(){return this._templates}set masterRecordColumnValue(t){this._masterRecordColumnValue=t}get masterRecordColumnValue(){return this._masterRecordColumnValue}set columnsCount(t){this._columnsCount=t||1,this._columns=new Array(this.columnsCount).fill(this._defaultGridColumn)}get columnsCount(){return this._columnsCount}set items(t){this._subscriptions.unsubscribe(),this._subscriptions=new C.Subscription,this._subscriptions.add(t?.changed?.subscribe(()=>{this._items=t,this.changeDetectorRef.markForCheck()})),this._items=t,this.setCollectionValidator(t)}get columns(){return this._columns}get dataItems(){return this._items}_translate(t){return this.translateService.instant(`${this.translatePrefix}.${t}`)}setCollectionValidator(t){var e=this;return(0,p.A)(function*(){if(!t)return;const n=yield Promise.all(t.map(function(){var o=(0,p.A)(function*(a){return{id:yield a[e.primaryColumnName],type:yield a[e.typeColumnName],control:a.getControl(e.numberColumnName)}});return function(a){return o.apply(this,arguments)}}()));for(const o of n){const a=typeof o.type=="string"?o.type:o.type.value,r={primaryColumnName:e.primaryColumnName,typeColumnName:e.typeColumnName,numberColumnName:e.numberColumnName};o.control.formControl.setAsyncValidators([Y.numberDuplicate(o.id,a,r,t,e._translate("Validations.DuplicateNumberMessage"))])}})()}getTemplate(t){const e=t.attributes[this.displayFormatColumnName],n=this.templates[b.Text],o=this.templates[e]||n;return o.autofocus=t.PrimaryModelMode===_t.b.Create,o}static{this.\u0275fac=function(e){return new(e||at)(i.\u0275\u0275directiveInject(i.Injector))}}static{this.\u0275cmp=i.\u0275\u0275defineComponent({type:at,selectors:[["crt-communication-options"]],viewQuery:function(e,n){if(e&1&&i.\u0275\u0275viewQuery(Et,5),e&2){let o;i.\u0275\u0275queryRefresh(o=i.\u0275\u0275loadQuery())&&(n.container=o.first)}},inputs:{templates:"templates",readonly:"readonly",masterRecordColumnValue:"masterRecordColumnValue",masterRecordColumnName:"masterRecordColumnName",columnsCount:"columnsCount",optionActions:"optionActions",items:"items",typeColumnName:"typeColumnName",displayFormatColumnName:"displayFormatColumnName",primaryColumnName:"primaryColumnName",numberColumnName:"numberColumnName",defaultOptionConfig:"defaultOptionConfig",labelPosition:"labelPosition",showNoDataPlaceholder:"showNoDataPlaceholder"},features:[i.\u0275\u0275InheritDefinitionFeature],decls:3,vars:2,consts:[["comm_options_template",""],["container",""],["no_data_placeholder",""],[3,"styles",4,"ngIf","ngIfElse"],[3,"styles"],[1,"crt-communication-options"],[4,"ngIf","ngIfElse"],["class","option-list",4,"ngIf"],[1,"option-list"],[3,"columns","gap","padding","borderRadius","color"],["class","option-wrap",4,"ngFor","ngForOf"],[1,"option-wrap"],["crtViewGenerator","",3,"crtViewModel","viewConfig"],["class","no-data-placeholder-wrap",4,"ngIf"],[1,"no-data-placeholder-wrap"],["skeleton","","image","","title","",3,"subhead"]],template:function(e,n){if(e&1&&i.\u0275\u0275template(0,Lt,1,1,"crt-skeleton-loader",3)(1,Ut,5,2,"ng-template",null,0,i.\u0275\u0275templateRefExtractor),e&2){const o=i.\u0275\u0275reference(2);i.\u0275\u0275property("ngIf",n.masterRecordColumnValue&&n.loading)("ngIfElse",o)}},dependencies:[$t.N,F.NgForOf,F.NgIf,Ft.aD,jt.W,Bt.Q,wt.k,P.TranslatePipe],styles:[".crt-communication-options[_ngcontent-%COMP%] > .option-list[_ngcontent-%COMP%]{width:100%}.crt-communication-options[_ngcontent-%COMP%] > .no-data-placeholder-wrap[_ngcontent-%COMP%]{min-height:52px;padding:22px 0}"],changeDetection:0})}};(0,l.__decorate)([(0,I.k)(),(0,l.__metadata)("design:type",Object),(0,l.__metadata)("design:paramtypes",[Object])],y.prototype,"templates",null),(0,l.__decorate)([(0,I.k)({propertyBindable:!0,defaultValue:!1,propertyName:Nt.R.Readonly}),(0,l.__metadata)("design:type",Boolean)],y.prototype,"readonly",void 0),(0,l.__decorate)([(0,I.k)(),(0,l.__metadata)("design:type",String),(0,l.__metadata)("design:paramtypes",[String])],y.prototype,"masterRecordColumnValue",null),(0,l.__decorate)([(0,I.k)(),(0,l.__metadata)("design:type",String)],y.prototype,"masterRecordColumnName",void 0),(0,l.__decorate)([(0,I.k)(),(0,l.__metadata)("design:type",Number),(0,l.__metadata)("design:paramtypes",[Number])],y.prototype,"columnsCount",null),(0,l.__decorate)([(0,I.k)(),(0,l.__metadata)("design:type",Array)],y.prototype,"optionActions",void 0),(0,l.__decorate)([(0,I.k)(),(0,l.__metadata)("design:type",bt.A),(0,l.__metadata)("design:paramtypes",[bt.A])],y.prototype,"items",null),(0,l.__decorate)([(0,I.k)(),(0,l.__metadata)("design:type",String)],y.prototype,"typeColumnName",void 0),(0,l.__decorate)([(0,I.k)(),(0,l.__metadata)("design:type",String)],y.prototype,"displayFormatColumnName",void 0),(0,l.__decorate)([(0,I.k)(),(0,l.__metadata)("design:type",String)],y.prototype,"primaryColumnName",void 0),(0,l.__decorate)([(0,I.k)(),(0,l.__metadata)("design:type",String)],y.prototype,"numberColumnName",void 0),(0,l.__decorate)([(0,I.k)(),(0,l.__metadata)("design:type",Object)],y.prototype,"defaultOptionConfig",void 0),(0,l.__decorate)([(0,I.k)(),(0,l.__metadata)("design:type",Object)],y.prototype,"labelPosition",void 0),(0,l.__decorate)([(0,I.k)(),(0,l.__metadata)("design:type",Object)],y.prototype,"showNoDataPlaceholder",void 0),y=(0,l.__decorate)([(0,Vt.v)({type:"crt.CommunicationOptions",contentSlots:["templates"],reuseStrategy:Tt.B.Reuse}),(0,Rt.f)({designViewItemCommands:{copy:"crt.CopyCommunicationOptionsItemCommand",delete:"crt.RemoveCollectionViewItemCommand"},propertiesPanelComponentTypeName:"crt.CommunicationOptionsPropertiesPanel",typeCaption:"Components.CommunicationOptions.Caption",viewElementGroupType:xt.J.Components}),(0,l.__metadata)("design:paramtypes",[i.Injector])],y);var B=s(81517),w=s(2828),E=s(844),Jt=s(6503),Xt=s(52439),Yt=s(92009);function q(m,t){const e=M(t),n=m.filter(o=>o.id!==t.id&&!o.isInvalid&&M(o)===e);return n.length>0?n.reduce((o,a)=>o.createdOn>a.createdOn?o:a):null}function M(m){return typeof m.communicationType=="string"?m.communicationType:m.communicationType?.value}function T(m,t){return Promise.all(m.map(function(){var e=(0,p.A)(function*(n){return{id:yield n[`${t}_Id`],createdOn:yield n[`${t}_CreatedOn`],communicationType:yield n[`${t}_CommunicationType`],isPrimary:yield n[`${t}_Primary`],isInvalid:yield n[`${t}_NonActual`],number:yield n[`${t}_Number`]}});return function(n){return e.apply(this,arguments)}}()))}var qt=s(41287);class k extends qt.l{constructor(t){super(),this.injector=t,this.translatePrefix="CommunicationOptions",this._announcementKey="Announcement.Option",this.injectDependencies()}injectDependencies(){this.translateService=this.injector.get(P.TranslateService),this.liveAnnouncementService=this.injector.get(It.DW)}translate(t){return this.translateService.instant(`${this.translatePrefix}.${t}`)}announceChanges(t,e,n=""){var o=this;return(0,p.A)(function*(){const a=At.String.format(o.translate(`${o._announcementKey}.${t}`),e||"",n);yield o.liveAnnouncementService.announce(a)})()}}let tt=class extends B.S{};tt=(0,l.__decorate)([(0,w.$)({type:"crt.CreateCommunicationOptionRequest"})],tt);let H=class extends k{constructor(t,e,n){super(t),this.injector=t,this._schemaService=e,this._notifyService=n}_setDuplicateValidator(t,e,n,o){var a=this;return(0,p.A)(function*(){const r=`${n}_Id`,c=`${n}_Number`,u=`${n}_CommunicationType`,d=yield t[r],g=t.getControl(c),h={primaryColumnName:r,typeColumnName:u,numberColumnName:c};g.formControl.setAsyncValidators([Y.numberDuplicate(d,o,h,e,a.translate("Validations.DuplicateNumberMessage"))])})()}_getComponentViewConfig(t){return this._schemaService.getViewConfigInfoByProperty("type","crt.CommunicationOptions")?.map(e=>e?.viewConfig)?.find(e=>e?.name===t)??null}_getDefaultItemValues(t,e){return(0,p.A)(function*(){const o=t.getModelByName(e)?.getDataSource()?.getDefaultValues();if(!o)return{};const a=(yield(0,C.firstValueFrom)(o))||{},r={};return Object.entries(a).forEach(([c,u])=>{const d=e+"_"+c;r[d]=u}),r})()}_createNewItem(t,e,n,o){var a=this;return(0,p.A)(function*(){if(!(0,Xt.qG)(t.items))return null;const r=t.items.slice(1),c=n.getBoundDataSourceNameByAttributePath(r),u=yield n[r];if(!u)return null;const d=o.CommunicationType.toLowerCase(),g=o.CommunicationTypeName;(yield T(u,c)).findIndex(O=>O.isPrimary===!0&&M(O)===d)===-1&&(o.Primary=!0);const v=yield a._getDefaultItemValues(n,c),_=u.createItem({index:e,initialModelValues:{...v,...o}}),f=yield _;return f&&a._setDuplicateValidator(f,u,c,d),a.announceChanges("Added",g),_})()}checkRequestParams(t){const{masterRecordColumnName:e,values:n}=t;let o=!0;return n[e]||(this._notifyService.show({message:this.translate("Validations.EmptyMasterRecordColumnNameInRequestMessage"),duration:1e4}),o=!1),o}handle(t){var e=this;return(0,p.A)(function*(){const{$context:n,componentName:o,indexToInsert:a,values:r}=t;if(!e.checkRequestParams(t))return null;const c=e._getComponentViewConfig(o);if(!c)return null;const u=yield e._createNewItem(c,a,n,r||{});return u?.formApiModel?.markAsDirty(),u})()}};H=(0,l.__decorate)([(0,E.l)({type:"crt.CreateCommunicationOptionHandler",requestType:"crt.CreateCommunicationOptionRequest"}),(0,l.__metadata)("design:paramtypes",[i.Injector,Yt.R,Jt.F])],H);let et=class extends B.S{};et=(0,l.__decorate)([(0,w.$)({type:"crt.RemoveCommunicationOptionRequest"})],et);let W=class extends k{constructor(t){super(t),this.injector=t}handle(t){var e=this;return(0,p.A)(function*(){const n=t.collectionAttributeName,o=t.$context.getBoundDataSourceNameByAttributePath(n),a=yield t.$context[n],r=yield T(a,o),c=r.findIndex(h=>h.id===t.recordId);if(c===-1)return(0,C.lastValueFrom)((0,C.of)(null));const u=r[c];if(u.isPrimary){const h=q(r,u);if(h){const A=r.findIndex(f=>f.id===h.id),v=yield a[A],_=`${o}_Primary`;v[_]=!0}}(yield a[c]).markPrimaryModelFor(_t.b.Delete);const g=u.communicationType.displayValue;return yield e.announceChanges("Deleted",g,u.number),(0,C.lastValueFrom)((0,C.of)(null))})()}};W=(0,l.__decorate)([(0,E.l)({type:"crt.RemoveCommunicationOptionHandler",requestType:"crt.RemoveCommunicationOptionRequest"}),(0,l.__metadata)("design:paramtypes",[i.Injector])],W);let nt=class extends B.S{};nt=(0,l.__decorate)([(0,w.$)({type:"crt.MakeCommunicationOptionPrimaryRequest"})],nt);let L=class extends k{constructor(t){super(t),this.injector=t}handle(t){var e=this;return(0,p.A)(function*(){const n=t.collectionAttributeName,o=t.$context.getBoundDataSourceNameByAttributePath(n),a=yield t.$context[n],r=yield T(a,o),c=r.findIndex(f=>f.id===t.recordId),u=r[c],d=M(u),g=r.findIndex(f=>f.isPrimary===!0&&f.id!==t.recordId&&M(f)===d),h=`${o}_Primary`,A=g!==-1?yield a[g]:null;A&&(A[h]=!1);const v=yield a[c];v[h]=!0;const _=u.communicationType.displayValue;return yield e.announceChanges("SetAsPrimary",_,u.number),(0,C.lastValueFrom)((0,C.of)(null))})()}};L=(0,l.__decorate)([(0,E.l)({type:"crt.MakeCommunicationOptionPrimaryHandler",requestType:"crt.MakeCommunicationOptionPrimaryRequest"}),(0,l.__metadata)("design:paramtypes",[i.Injector])],L);let ot=class extends B.S{};ot=(0,l.__decorate)([(0,w.$)({type:"crt.ChangeCommunicationInvalidStateRequest"})],ot);let G=class extends k{constructor(t){super(t),this.injector=t}handle(t){var e=this;return(0,p.A)(function*(){const n=t.collectionAttributeName,o=t.$context.getBoundDataSourceNameByAttributePath(n),a=yield t.$context[n],r=yield T(a,o),c=r.findIndex(v=>v.id===t.recordId);if(c===-1)return(0,C.lastValueFrom)((0,C.of)(null));const u=yield a[c],d=r[c];if(d.isPrimary&&!d.isInvalid){const v=`${o}_Primary`;u[v]=!1;const _=q(r,d);if(_){const f=r.findIndex(le=>le.id===_.id),O=yield a[f];O[v]=!0}}const g=`${o}_NonActual`,h=!d.isInvalid;u[g]=h;const A=d.communicationType.displayValue;return e.announceChanges(h?"MarkedAsInvalid":"MarkedAsValid",A,d.number),(0,C.lastValueFrom)((0,C.of)(null))})()}};G=(0,l.__decorate)([(0,E.l)({type:"crt.ChangeCommunicationInvalidStateHandler",requestType:"crt.ChangeCommunicationInvalidStateRequest"}),(0,l.__metadata)("design:paramtypes",[i.Injector])],G);var R=s(74368),te=s(55041),Ot=s(38071);class x{constructor(t){this._featureService=t,this._commonCommunicationsBehaviorFeature="CommonCommunicationsBehavior",this._communicationOptionsProcessingDisableFeature="DisableCommunicationOptionsPreprocessing",this._replacementConfig={ContactCommunicationOptions:{replaceData:[{type:"crt.EmailInput",label:"Email",labelPosition:"above",control:"$Email",visible:!0,placeholder:"",tooltip:"",name:"Email"},{type:"crt.PhoneInput",label:"Mobile phone",labelPosition:"above",control:"$MobilePhone",visible:!0,placeholder:"",tooltip:"",name:"MobilePhone"}],additionalAttributesConfig:{MobilePhone:{modelConfig:{path:"PDS.MobilePhone"}},Email:{modelConfig:{path:"PDS.Email"}}}},AccountCommunicationOptions:{replaceData:[{type:"crt.WebInput",label:"Web",labelPosition:"above",control:"$Web",visible:!0,placeholder:"",tooltip:"",name:"Web"},{type:"crt.PhoneInput",label:"Primary phone",labelPosition:"above",control:"$Phone",visible:!0,placeholder:"",tooltip:"",name:"Phone"}],additionalAttributesConfig:{Phone:{modelConfig:{path:"PDS.Phone"}},Web:{modelConfig:{path:"PDS.Web"}}}}},this._namesToDelete=[...Object.keys(this._replacementConfig),"ContactCommunicationOptionsAddButton","AccountCommunicationOptionsAddButton"]}get isCommonCommunicationsBehaviorEnabled(){return(0,C.lastValueFrom)(this._featureService.getFeatureState(this._commonCommunicationsBehaviorFeature))}get isProcessingDisabled(){return(0,C.lastValueFrom)(this._featureService.getFeatureState(this._communicationOptionsProcessingDisableFeature))}_prepareAttibutesBeforeReplacement(t,e){const n=t?.additionalAttributesConfig||{};for(const[o,a]of Object.entries(n)){const r=(0,te.v)(e,a.modelConfig?.path);r&&r!==o&&(n[r]=e[r],delete n[o],t.replaceData=[...t.replaceData].map(c=>c.control===`$${o}`?{...c,control:`$${r}`}:c))}Object.assign(e,n)}_replaceCommOptionsWithFields(t){t.viewModelConfig={attributes:{},...t.viewModelConfig},R.u.getViewConfigInfoByPropertyForValues("name",this._namesToDelete,t.viewConfig).forEach(n=>{const a=R.u.getViewConfigInfoByProperty("name",n.parentName,t.viewConfig)[0].viewConfig,r=n.viewConfig.name,c=a[n.parentPropertyName],u=c.indexOf(n.viewConfig);this._prepareAttibutesBeforeReplacement(this._replacementConfig[n.viewConfig.name],t.viewModelConfig.attributes);const d=this._replacementConfig[r]?.replaceData||[];c.splice(u,1,...d)})}_makeOtherCommOptionsComponentsReadonly(t){t.filter(n=>!this._namesToDelete.includes(n.viewConfig.name)).forEach(n=>n.viewConfig.readonly=!0)}crtOnMetaDataInit(t){var e=this;return(0,p.A)(function*(){if((yield e.isProcessingDisabled)||(yield e.isCommonCommunicationsBehaviorEnabled))return t;const n=t,o=R.u.getViewConfigInfoByProperty("type","crt.CommunicationOptions",n.viewConfig);return e._replaceCommOptionsWithFields(n),e._makeOtherCommOptionsComponentsReadonly(o),t})()}static{this.\u0275fac=function(e){return new(e||x)(i.\u0275\u0275inject(Ot.d))}}static{this.\u0275prov=i.\u0275\u0275defineInjectable({token:x,factory:x.\u0275fac})}}var ee=s(79125),ne=s(26746);class Z{constructor(t){this.translateService=t,this.translatePrefix="CommunicationOptions"}translate(t){return this.translateService.instant(`${this.translatePrefix}.${t}`)}}var oe=s(71252),ie=s(49973),Pt=s(92831),it=s(58504),ae=s(41314),re=s(65751),se=s(50485);class S extends Z{constructor(t,e,n,o,a){super(t),this.translateService=t,this._queryExecutor=e,this._domSanitizer=n,this._matIconRegistry=o,this._rightsService=a,this._addCommunicationOptionsRequestName="crt.AddCommunicationOptionsRequest"}_getMenuItemClickRequest(t,e,n,o,a,r){return{request:"crt.CreateCommunicationOptionRequest",params:{componentName:t,indexToInsert:"@event.index",masterRecordColumnName:a,values:{CommunicationType:e,[a]:o,CommunicationTypeName:r,CommunicationTypeDisplayFormat:n}},useRelativeContext:!0}}_getSubMenuItem(t,e,n,o,a,r,c){return{type:"crt.MenuItem",caption:t,clicked:this._getMenuItemClickRequest(e,n,o,a,r,t),...c&&{icon:`${c}`}}}_getMenuItem(t,e){return{type:"crt.MenuItem",caption:e,items:[],...t&&{icon:`${t}`}}}_registerIcon(t){if(!t)return;const e=this._domSanitizer.bypassSecurityTrustResourceUrl(window.location.origin+(0,ae.Mc)(t));this._matIconRegistry.addSvgIcon(t,e)}_getAddOptionItems(t,e,n,o){var a=this;return(0,p.A)(function*(){const r=[],c=yield a.getCommTypes(o),u=[...new Set(c.map(d=>d.typeOrGroupId))];for(const d of u){const g=c.filter(v=>v.typeOrGroupId===d),h=g[0],A=h?.groupIcon?.value;if(g.length>1){const v=a._getMenuItem(A,h.groupName);v.items=g.map(_=>a._getSubMenuItemFromType(_,t,e,n)),r.push(v)}else{const v=a._getSubMenuItemFromType(h,t,e,n);r.push(v)}}return r})()}_getSubMenuItemFromType(t,e,n,o){const a=this._getSubMenuItem(t.displayValue,e,t.value,t.displayFormat,n,o,t.typeIcon?.value);return this._registerIcon(t?.typeIcon?.value),this._registerIcon(t?.groupIcon?.value),a}_getValidationResult(t,e=""){return{success:t,errorMessage:e}}_validateComponentState(t,e){var n=this;return(0,p.A)(function*(){const o=n._getValidationResult(!0);if(!t.masterRecordColumnName||!t.masterRecordColumnValue)return n._getValidationResult(!1,n.translate("Validations.IncorrectSetupComponentMessage"));if(t.readonly)return n._getValidationResult(!1,n.translate("Validations.ReadOnlyStateMessage"));const a={isNew:!0,schemaName:e},r=yield(0,C.lastValueFrom)(n._rightsService.getCanEdit(a));return r&&!r.result?n._getValidationResult(!1,r.message):o})()}_applyAddButtonState(t,e,n,o){var a=this;return(0,p.A)(function*(){const r=yield a._validateComponentState(e,o);if(!r.success){t.forEach(c=>{c.clicked={request:"crt.NotificationRequest",params:{message:r.errorMessage,duration:1e4}},c.clickMode="default",c.menuItems=[]});return}t.forEach(c=>{c.clickMode="menu",c.menuItems=[...n,...c.menuItems||[]]})})()}_selectCommTypesFromDB(t){const e=new ie.s("CommunicationType");return e.addMacrosFunctionColumn(Pt.V.PrimaryColumn,"typeId"),e.addMacrosFunctionColumn(Pt.V.PrimaryDisplayColumn,"typeName"),e.addSchemaColumn("ImageLink","typeIcon"),e.addSchemaColumn("DisplayFormat","displayFormat"),e.addSchemaColumn("[ComTypebyCommunication:CommunicationType:Id].Communication.Id","groupId"),e.addSchemaColumn("[ComTypebyCommunication:CommunicationType:Id].Communication.Name","groupName"),e.addSchemaColumn("[ComTypebyCommunication:CommunicationType:Id].Communication.ImageLink","groupIcon"),e.filters.addSchemaColumnFilterWithParameter(it.H.Not_equal,"[ComTypebyCommunication:CommunicationType:Id].Communication",j.SMS),t==="ContactCommunication"&&e.filters.addSchemaColumnFilterWithParameter(it.H.Equal,"UseforContacts",!0),t==="AccountCommunication"&&e.filters.addSchemaColumnFilterWithParameter(it.H.Equal,"UseforAccounts",!0),this._queryExecutor.executeSelectQuery(e).pipe((0,C.share)(),(0,C.map)(n=>n.map(o=>({typeOrGroupId:o.groupId||o.typeId,value:o.typeId,displayValue:o.typeName,groupName:o.groupName,typeIcon:o.typeIcon,groupIcon:o.groupIcon,displayFormat:o.displayFormat}))),(0,C.catchError)(n=>(0,C.of)([])))}_getAddCommOptionsButtonsConfigs(t){return R.u.getViewConfigInfoByPropertyForValues("type",["crt.Button","crt.MenuItem"],t.viewConfig).filter(e=>e.viewConfig.clicked?.request===this._addCommunicationOptionsRequestName).map(e=>e.viewConfig)}getCommTypes(t){return(0,C.lastValueFrom)(this._selectCommTypesFromDB(t))}processAddButton(t,e,n){var o=this;return(0,p.A)(function*(){const a=o._getAddCommOptionsButtonsConfigs(e),r=e?.modelConfig?.dataSources,c=r&&r[n]?.config?.entitySchemaName||"",u=yield o._getAddOptionItems(t.name,t.masterRecordColumnValue,t.masterRecordColumnName,c),d=a.filter(g=>t.name===g.clicked?.params?.viewElementName);yield o._applyAddButtonState(d,t,u,c)})()}static{this.\u0275fac=function(e){return new(e||S)(i.\u0275\u0275inject(P.TranslateService),i.\u0275\u0275inject(re.w),i.\u0275\u0275inject(oe.DomSanitizer),i.\u0275\u0275inject(z.MatIconRegistry),i.\u0275\u0275inject(se.f))}}static{this.\u0275prov=i.\u0275\u0275defineInjectable({token:S,factory:S.\u0275fac})}}var ce=s(96252);class N extends Z{constructor(t){super(t),this.translateService=t}_getActionClickedRequest(t,e,n){return{request:t,params:{recordId:`$${e}.${n}_Id`,collectionAttributeName:e}}}_getDefaultOptionActions(t,e){const n=`${t}.${e}_Primary`,o=`${t}.${e}_NonActual`,a=this.translate("MarkAsPrimary"),r=this.translate("MarkAsValid"),c=this.translate("MarkAsInvalid"),u=this.translate("DeleteOption");return[{type:"crt.MenuItem",caption:a,icon:"flag-button-icon",visible:`$${n} | crt.NorCondition : $${o}`,clicked:this._getActionClickedRequest("crt.MakeCommunicationOptionPrimaryRequest",t,e)},{type:"crt.MenuItem",caption:`$${o}
					| crt.BooleanToStringValue : '${r}' : '${c}'`,icon:`$${o}
					| crt.BooleanToStringValue : 'valid-circle' : 'invalid-circle'`,clicked:this._getActionClickedRequest("crt.ChangeCommunicationInvalidStateRequest",t,e)},{type:"crt.MenuItem",caption:u,icon:"delete-button-icon",clicked:this._getActionClickedRequest("crt.RemoveCommunicationOptionRequest",t,e)}]}_getOptionActions(t,e,n){const o=this._getDefaultOptionActions(e,n),a=t.optionActions??[];return[...o,...a]}_extendViewConfig(t,e,n){t.primaryColumnName=`${n}_Id`,t.numberColumnName=`${n}_Number`,t.typeColumnName=`${n}_CommunicationType`,t.displayFormatColumnName=`${n}_CommunicationTypeDisplayFormat`,t.optionActions=this._getOptionActions(t,e,n)}_getDefaultOptionConfig(t,e,n){return{label:`$${`${`${t}.${e}_CommunicationTypeName`}_Extended`}`,control:`$${t}.${e}_Number`,labelPosition:n}}_applyReadonlyState(t,e){Object.entries(t).forEach(([,n])=>{e.readonly&&(n.readonly=e.readonly),n.bindTo=`$${(0,ce.W)(e.name)}`})}_getToolsTemplate(t){return[{type:"crt.Button",ariaLabel:this.translate("ToolsAriaLabel"),icon:"actions-button-icon",iconPosition:"only-icon",color:"default",size:"none",clickMode:"menu",displayType:"text",classes:["actions-btn"],menuItems:t.optionActions}]}_extendWithProperties(t,e){Object.keys(t).forEach(n=>{t[n]={...e,...t[n]}})}_initTemplates(t,e,n){const o=this._getDefaultOptionConfig(e,n,t.labelPosition??"auto"),a=t.templates??{},r=this._getToolsTemplate(t),c={[b.Email]:{type:"crt.EmailInput"},[b.Phone]:{type:"crt.PhoneInput",phoneAsLink:!0,displayAsPhone:!1,displayPhoneMask:!1},[b.Web]:{type:"crt.WebInput"},[b.Google]:{type:"crt.WebInput",icon:"google-web-icon"},[b.Facebook]:{type:"crt.WebInput",icon:"facebook-web-icon"},[b.LinkedIn]:{type:"crt.WebInput",icon:"linkedin-web-icon"},[b.Twitter]:{type:"crt.WebInput",icon:"twitter-web-icon"},[b.Skype]:{type:"crt.WebInput",icon:"skype-web-icon"},[b.Text]:{type:"crt.Input"}};this._extendWithProperties(c,{tools:r});const u={...c,...a};this._extendWithProperties(u,o),this._applyReadonlyState(u,t),t.templates=u}processViewConfig(t,e,n){this._extendViewConfig(t,e,n),this._initTemplates(t,e,n)}static{this.\u0275fac=function(e){return new(e||N)(i.\u0275\u0275inject(P.TranslateService))}}static{this.\u0275prov=i.\u0275\u0275defineInjectable({token:N,factory:N.\u0275fac})}}var me=s(65967);class V extends Z{constructor(t){super(t),this.translateService=t}_setSortingConfig(t,e){const n=t.items.slice(1),o=`${n}_Sorting`,a=e.viewModelConfig.attributes;a[o]={isCollection:!0,viewModelConfig:{attributes:{columnName:{},direction:{}}}};const r=a[n];r.modelConfig={...r.modelConfig,sortingConfig:{...r.modelConfig?.sortingConfig,attributeName:o,default:[{columnName:"CreatedOn",direction:"asc"}]}}}_initTypeNameAttribute(t,e){const n=`${e}_CommunicationTypeName`,o=`${e}_Primary`,a=`${e}_NonActual`,r=" \u2022 "+this.translate("Primary"),c=" \u2022 "+this.translate("Invalid"),u=`${n}_Extended`,d=t?.viewModelConfig.attributes??{};d[u]={from:[n,o,a],converter:`crt.AppendConditionalParts : '${r}' : '${c}'`}}_prepareAttributes(t,e,n,o){(0,me.o)(n)&&!n.modelConfig?.sortingConfig?.attributeName&&this._setSortingConfig(t,e),this._initTypeNameAttribute(n,o)}processAttributes(t,e,n,o){this._prepareAttributes(t,e,n,o)}static{this.\u0275fac=function(e){return new(e||V)(i.\u0275\u0275inject(P.TranslateService))}}static{this.\u0275prov=i.\u0275\u0275defineInjectable({token:V,factory:V.\u0275fac})}}class D extends Z{constructor(t,e,n,o,a){super(e),this._featureService=t,this.translateService=e,this._addButtonService=n,this._viewConfigService=o,this._attributesService=a,this._communicationOptionsProcessingDisableFeature="DisableCommunicationOptionsPreprocessing",this.translatePrefix="CommunicationOptions"}get isProcessingDisabled(){return(0,C.lastValueFrom)(this._featureService.getFeatureState(this._communicationOptionsProcessingDisableFeature))}_isValidItemsBinding(t,e){return(0,ee.j)(t.items,e.viewModelConfig?.attributes)?!0:(console.warn(`The setup property [items] for component [${t.name}] is incorrect.Only binding to the ViewModel collection attribute is allowed for this property.`),!1)}processItem(t,e){var n=this;return(0,p.A)(function*(){if(n._isValidItemsBinding(t,e)){const o=t.items.split("$")[1],a=e.viewModelConfig?.attributes?.[o]??{},r=a?.modelConfig?.path||"";n._viewConfigService.processViewConfig(t,o,r),n._attributesService.processAttributes(t,e,a,r),ne.F.addDependencies(e,t,r),yield n._addButtonService.processAddButton(t,e,r)}})()}processItemsAsync(t,e){var n=this;return(0,p.A)(function*(){const o=t.map(function(){var a=(0,p.A)(function*(r){yield n.processItem(r.viewConfig,e)});return function(r){return a.apply(this,arguments)}}());yield Promise.all(o)})()}crtOnMetaDataInit(t){var e=this;return(0,p.A)(function*(){if(yield e.isProcessingDisabled)return t;const n=t,o=R.u.getViewConfigInfoByProperty("type","crt.CommunicationOptions",n.viewConfig);return yield e.processItemsAsync(o,n),t})()}static{this.\u0275fac=function(e){return new(e||D)(i.\u0275\u0275inject(Ot.d),i.\u0275\u0275inject(P.TranslateService),i.\u0275\u0275inject(S),i.\u0275\u0275inject(N),i.\u0275\u0275inject(V))}}static{this.\u0275prov=i.\u0275\u0275defineInjectable({token:D,factory:D.\u0275fac})}}class ${static{this.\u0275fac=function(e){return new(e||$)}}static{this.\u0275mod=i.\u0275\u0275defineNgModule({type:$})}static{this.\u0275inj=i.\u0275\u0275defineInjector({providers:[S,N,V]})}}let Q=class rt{constructor(t){this._materialIconsRegistrator=t,this._materialIconsRegistrator.addIcons([{name:"communication-options",icon:s(42978)}])}static{this.\u0275fac=function(e){return new(e||rt)(i.\u0275\u0275inject(ut.K))}}static{this.\u0275mod=i.\u0275\u0275defineNgModule({type:rt})}static{this.\u0275inj=i.\u0275\u0275defineInjector({providers:[{provide:vt.m,useClass:x,multi:!0},{provide:vt.m,useClass:D,multi:!0}],imports:[dt.V,pt.C,F.CommonModule,z.MatIconModule,ft.c,mt.q,lt.f,Ct.y,K.y,X.u,U.u,yt.q,gt.h,ht.D,J.s,$,P.TranslateModule]})}};Q=(0,l.__decorate)([(0,Mt.g)({viewElements:[y],requestHandlers:[H,W,L,G],includes:[U.u,K.y,X.u,J.s]}),(0,l.__metadata)("design:paramtypes",[ut.K])],Q),function(){(typeof ngJitMode>"u"||ngJitMode)&&i.\u0275\u0275setNgModuleScope(Q,{declarations:[y],imports:[dt.V,pt.C,F.CommonModule,z.MatIconModule,ft.c,St.C,mt.q,lt.f,Ct.y,K.y,X.u,U.u,yt.q,gt.h,ht.D,J.s,$,P.TranslateModule],exports:[y]})}()},42978:st=>{st.exports=`<svg width="72" height="64" viewBox="0 0 72 64" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M51.9044 17L60 17C62.2091 17 64 18.7909 64 21L64 45C64 47.2091 62.2091 49 60 49L12 49C9.79086 49 8 47.2091 8 45L8 27.24" stroke="#70ACEE"/>
<rect x="14.001" y="26" width="43.998" height="6" rx="3" fill="#D1D1D1"/>
<rect x="14.001" y="35" width="35.9995" height="6" rx="3" fill="#D1D1D1"/>
<path d="M22.7946 15.268C22.4642 15.0271 22 15.2631 22 15.672V20.75C22 21.4375 22.54 22 23.2 22H32.8C33.46 22 34 21.4375 34 20.75V15.6707C34 15.2618 33.5358 15.0258 33.2054 15.2667L28.4301 18.7487C28.1713 18.9374 27.8269 18.9374 27.5681 18.7487L22.7946 15.268Z" fill="#FF8800"/>
<path d="M33.63 13.046C33.8077 12.9164 33.8877 12.6788 33.7588 12.5005C33.5393 12.1971 33.1907 12 32.8 12H23.2C22.8088 12 22.4598 12.1976 22.2404 12.5017C22.1117 12.68 22.1918 12.9174 22.3694 13.0469L27.7045 16.9371C27.88 17.0651 28.1181 17.0651 28.2937 16.9371L33.63 13.046Z" fill="#FF8800"/>
<path d="M17.533 20.0298C18.6608 20.9345 17.4582 21.992 16.9317 22.5954C16.5558 23.0478 16.1041 23.5001 12.8749 21.6908C11.7006 21.0614 10.6352 20.2462 9.71967 19.2763C8.74935 18.3421 7.91405 17.2763 7.23788 16.1099C5.50789 12.8649 5.95946 12.3366 6.41022 12.039C7.01152 11.5106 8.06453 10.3789 8.96694 11.4355C10.4707 13.2448 10.6212 14.0772 10.0947 14.5295C9.71878 14.7557 9.79362 14.8316 9.56824 14.9818C8.96694 15.5852 9.11747 16.5668 10.5455 18.0007L10.7708 18.3028C11.8238 19.3594 13.177 19.8878 13.7792 19.3595C13.9727 19.1477 14.1488 18.9204 14.3057 18.68C14.8321 18.1517 15.3587 18.3028 17.5394 20.037" fill="#22AC14"/>
<path d="M40.9354 16.2082C40.9203 16.3699 40.7892 16.4959 40.6305 16.4959H38.2933C38.117 16.4959 37.9776 16.3414 38.0017 16.1626C38.3182 13.8162 39.9618 11.8942 42.1467 11.1878C42.4072 11.1036 42.6019 11.4071 42.4565 11.6439C41.6103 13.0228 41.0874 14.5842 40.9354 16.2082Z" fill="#0048D1"/>
<path d="M42.2216 16.4959C42.0461 16.4959 41.9073 16.3432 41.9262 16.1645C42.1103 14.4217 42.7492 12.528 43.7745 11.1168C43.8876 10.9611 44.112 10.9611 44.2251 11.1168C45.2505 12.528 45.8894 14.4217 46.0735 16.1645C46.0924 16.3432 45.9535 16.4959 45.778 16.4959H42.2216Z" fill="#0048D1"/>
<path d="M49.9979 16.1626C50.022 16.3414 49.8826 16.4959 49.7063 16.4959H47.3691C47.2104 16.4959 47.0794 16.3699 47.0642 16.2082C46.9123 14.5842 46.3894 13.0228 45.5432 11.6439C45.3978 11.4071 45.5925 11.1036 45.853 11.1878C48.0378 11.8942 49.6815 13.8162 49.9979 16.1626Z" fill="#0048D1"/>
<path d="M45.853 22.792C45.5925 22.8763 45.3978 22.5728 45.5432 22.3359C46.3894 20.9571 46.9123 19.3957 47.0642 17.7716C47.0794 17.6099 47.2104 17.4839 47.3691 17.4839H49.7063C49.8826 17.4839 50.022 17.6384 49.9979 17.8172C49.6815 20.1637 48.0378 22.0856 45.853 22.792Z" fill="#0048D1"/>
<path d="M45.778 17.4839C45.9535 17.4839 46.0924 17.6366 46.0735 17.8153C45.8894 19.5601 45.2504 21.4698 44.225 22.8832C44.112 23.0389 43.8876 23.0389 43.7746 22.8832C42.7492 21.4698 42.1103 19.5601 41.9261 17.8153C41.9073 17.6366 42.0461 17.4839 42.2216 17.4839H45.778Z" fill="#0048D1"/>
<path d="M38.0017 17.8172C37.9776 17.6384 38.117 17.4839 38.2933 17.4839H40.6305C40.7892 17.4839 40.9203 17.6099 40.9354 17.7716C41.0874 19.3956 41.6103 20.9571 42.4565 22.3359C42.6019 22.5728 42.4072 22.8763 42.1467 22.792C39.9618 22.0856 38.3182 20.1637 38.0017 17.8172Z" fill="#0048D1"/>
</svg>
`}}]);
