(self.webpackChunkapp_studio_enterprise_error_list_dialog=self.webpackChunkapp_studio_enterprise_error_list_dialog||[]).push([[7128,3308],{48422:(E,Y,b)=>{var _={"./error-icon.svg":77017,"./warning-icon.svg":64207};function g(D){var c=R(D);return b(c)}function R(D){if(!b.o(_,D)){var c=new Error("Cannot find module '"+D+"'");throw c.code="MODULE_NOT_FOUND",c}return _[D]}g.keys=function(){return Object.keys(_)},g.resolve=R,E.exports=g,g.id=48422},47128:(E,Y,b)=>{var _=b(71252),g=b(74369),R=b(40297),D=b(63721),c=b(59131),w=b(48059),F=b(27397),T=b(79772),o=b(62278),u=b(36486);const Se=new c.InjectionToken("CustomEventApplicationIdToken"),U=new c.InjectionToken("CustomEventServiceToken");class nt{constructor(e,t=null){this.document=e,this.appId=t,this.customEventName="TSCustomEventChannel",this.appId=t||Math.random().toString()}subscribe(e){return this.customEventObserver$=this.customEventObserver$||(0,o.fromEvent)(document,this.customEventName),this.customEventObserver$.pipe((0,u.filter)(t=>t.detail.eventName===e&&t.detail.sender!==this.appId),(0,u.map)(t=>t.detail.payload))}createOutboundChannel(e){const t=new o.Subject;return t.asObservable().subscribe(s=>{const r=new CustomEvent(this.customEventName,{detail:{eventName:e,sender:this.appId,payload:s}});this.document.dispatchEvent(r)}),t}getDataViaEvent(e,t={}){return new o.Observable(s=>{this.subscribe(e).pipe((0,u.first)()).subscribe(r=>{s.next(r),s.complete()}),this.createOutboundChannel(e).next(t)})}getDataStreamViaEvent(e,t={}){return new o.Observable(s=>{const r=this.subscribe(e).subscribe(i=>{s.next(i)},o.noop,()=>s.complete());return this.createOutboundChannel(e).next(t),()=>{r.unsubscribe()}})}static#e=this.\u0275fac=function(t){return new(t||nt)(c.\u0275\u0275inject(R.DOCUMENT),c.\u0275\u0275inject(Se,8))};static#t=this.\u0275prov=c.\u0275\u0275defineInjectable({token:nt,factory:nt.\u0275fac,providedIn:"root"})}var Yn=b(34268),De=b.n(Yn);const qe="(?=^.{1,250}$)^[\u0430-\u044F\u0410-\u042Fa-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+(?:\\.[\u0430-\u044F\u0410-\u042Fa-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+)*@(?:[\u0430-\u044F\u0410-\u042Fa-zA-Z0-9](?:[\u0430-\u044F\u0410-\u042Fa-zA-Z0-9-]*[\u0430-\u044F\u0410-\u042Fa-zA-Z0-9])?\\.)+[\u0430-\u044F\u0410-\u042Fa-zA-Z0-9](?:[\u0430-\u044F\u0410-\u042Fa-zA-Z0-9-]*[\u0430-\u044F\u0410-\u042Fa-zA-Z0-9])?$",it=()=>new RegExp(qe,"g"),Hp=()=>new RegExp(CONTAINS_EMAIL_PATTERN,"g");function tl(n){return it().test(n)}function zp(n){return CONTAINS_EMAIL_REGEXP().test(n)}const Ko={name:"uponSanitizeElement",func:(n,e)=>{const t=e.tagName;tl(t)&&n.insertAdjacentText("afterbegin",`<${t}>`)}},Wo={name:"afterSanitizeAttributes",func:(n,e)=>{const t=window?.location?.origin;if(n.nodeName==="A"&&!n.getAttribute("href")?.toLowerCase().startsWith(t)){n.setAttribute("target","_blank");let s=n.getAttribute("rel")||"";["noopener","noreferrer"].forEach(r=>{s.includes(r)||(s+=" "+r)}),n.setAttribute("rel",s.trim())}}},Gp=new c.InjectionToken("Represents a DOM purifier",{factory:()=>(De().addHook(Ko.name,Ko.func),De().addHook(Wo.name,Wo.func),De()),providedIn:"platform"});function Kp(n){return n?Array.isArray(n)?n:[n]:[]}function Wp(n){return n||{}}function Jp(){}function sl(){return()=>{}}var Zp=b(26714);class rl{static create(e){return new e}}class Rt{constructor(){this.speechResult=new o.Subject,this.speechEnd=new o.Subject}static _getInternalApiClass(){return window.SpeechRecognition||window.webkitSpeechRecognition}static isSupported(){return Rt._getInternalApiClass()!==void 0}_subscribeEvents(){this._internalApi.addEventListener("result",this.onResult.bind(this)),this._internalApi.addEventListener("speechend",this.onSpeechEnd.bind(this))}_unsubscribeEvents(){this._internalApi.removeEventListener("result",this.onResult),this._internalApi.removeEventListener("speechend",this.onSpeechEnd)}init(e){const t=Rt._getInternalApiClass();this._internalApi=rl.create(t),this._internalApi.continuous=!0,this._internalApi.lang=e.lang||"en-US",this._subscribeEvents()}onResult(e){const{resultIndex:t,results:s}=e,r=s[t][0];if(!r)throw new Error("No results to transcript");this.speechResult.next(r.transcript)}onSpeechEnd(){this.speechEnd.next()}destroy(){this._unsubscribeEvents(),this._internalApi=null}startRecognition(){this._internalApi.start()}stopRecognition(){this._internalApi.stop()}static#e=this.\u0275fac=function(t){return new(t||Rt)};static#t=this.\u0275prov=c.\u0275\u0275defineInjectable({token:Rt,factory:Rt.\u0275fac})}var nl=b(73436);class il{get messages$(){return this._messages$}constructor(e,t){this._ngZone=t;const s=new o.Subject;this._messages$=s.pipe(this._runInZone(this._ngZone)),this._broadcastChannel=new nl.BroadcastChannel(e),this._broadcastChannel.onmessage=r=>s.next(r)}_runInZone(e){return t=>new o.Observable(s=>{t.subscribe(r=>e.run(()=>s.next(r)))})}publish(e){return(0,o.from)(this._broadcastChannel.postMessage(e))}}class wt{constructor(e){this._ngZone=e}createInstance(e){return new il(e,this._ngZone)}static#e=this.\u0275fac=function(t){return new(t||wt)(c.\u0275\u0275inject(c.NgZone))};static#t=this.\u0275prov=c.\u0275\u0275defineInjectable({token:wt,factory:wt.\u0275fac,providedIn:"root"})}class Xp{static toColdObservable(e){return new Observable(t=>{e().subscribe(r=>{t.next(r),t.complete()})})}}class Gr{log(e,t,...s){console.log(e,...s)}warn(e,t,...s){console.warn(e,...s)}error(e,t,...s){console.error(e,...s)}exception(e,t,...s){(console.exception||console.error)(e,...s)}static#e=this.\u0275fac=function(t){return new(t||Gr)};static#t=this.\u0275prov=c.\u0275\u0275defineInjectable({token:Gr,factory:Gr.\u0275fac})}const Yp={dataAccess:"data-access",feature:"feature",ui:"ui",util:"util",components:"components",deprecated:"deprecated"},Qp={studioFree:"studio-free",studioEnterprise:"studio-enterprise",sdk:"sdk"};class Kr{constructor(e,t,s=null){this._injector=e,this._registrationMap=t,this._defaultInstanceType=s}_getInstance(e,t){return t?"injectable"in t&&t.injectable!=null?this._injector.get(t.injectable):"useFactory"in t&&typeof t.useFactory=="function"?t.useFactory(e):"useValue"in t?t.useValue:null:null}_getDefaultInstance(e){return this._getInstance(e,this._defaultInstanceType)}_getInstanceByType(e){if(this._registrationMap.has(e)){const t=this._registrationMap.get(e);return this._getInstance(e,t)}}_getInstanceByPredicate(e){for(const[t,s]of this._registrationMap)if(typeof t=="function"&&t(e))return this._getInstance(e,s)}create(e=null){return e==null?this._getDefaultInstance(e):this._getInstanceByType(e)??this._getInstanceByPredicate(e)??this._getDefaultInstance(e)}static#e=this.\u0275fac=function(t){c.\u0275\u0275invalidFactory()};static#t=this.\u0275prov=c.\u0275\u0275defineInjectable({token:Kr,factory:Kr.\u0275fac,providedIn:"root"})}var v=b(28399);class Vs{static _createMappings(e){const t=new Map;return e=e??[],e.forEach(s=>{const r=s.predicate,i=(0,v.omit)(s,"predicate");t.set(r,i)}),t}static create(e){const{mappings:t,default:s,token:r}=e??{};return{provide:r,useFactory:i=>{const a=this._createMappings(t);return new Kr(i,a,s)},deps:[c.Injector]}}}function Qn(n){return Array.isArray(n)?n:[n]}function al(n,e){return e.forEach(({replaceMacros:t,replaceValue:s})=>{n=n.map(r=>r===t?s??"":r)}),n}function em(n,e){if(!n)return"";if(!e)return n;let t=[n];return e=Qn(e),t=ol(t,e),t=al(t,e),t.join("")}function ol(n,e){if(!n)return[];let t=Qn(n);if(!e)return t;const s=Qn(e),r=s.map(({replaceMacros:i})=>i);return s.forEach(({searchValue:i,replaceMacros:a})=>{if(i&&a){const l=new RegExp(`(${a})`,"g"),d=t.map(h=>r.includes(h)?h:h.split(i).join(a).split(l));t=flatten(d)}}),t}var tm=b(4930);function at(n){return function(e){Reflect.defineMetadata("requestType",n.requestType,e)}}function sm(n){return e=>{const t=e.pipe(share()),s=t.pipe(tap(n),take(1));return concat(s,t)}}function ei(n){return e=>e.pipe((0,u.concatMap)((t,s)=>n(t,s).pipe((0,u.map)(r=>[t,r]))))}function Jo(n){return e=>e.pipe((0,u.mergeMap)((t,s)=>n(t,s).pipe((0,u.map)(r=>[t,r]))))}function ti(n){return e=>e.pipe((0,u.mergeMap)((t,s)=>n(t,s).pipe((0,u.map)(()=>t))))}function Zo(n){return e=>e.pipe((0,u.switchMap)((t,s)=>n(t,s).pipe((0,u.map)(r=>[t,r]))))}function ot(n){return e=>e.pipe((0,u.switchMap)((t,s)=>n(t,s).pipe((0,u.map)(()=>t))))}function cl(n){return e=>n?new o.Observable(t=>{const s=a=>n.run(()=>t.next(a)),r=a=>n.run(()=>t.error(a)),i=()=>n.run(()=>t.complete());return e.subscribe({next:s,error:r,complete:i})}):e}function rm(n){return e=>n?new Observable(t=>{const s=a=>n.runOutsideAngular(()=>t.next(a)),r=a=>n.runOutsideAngular(()=>t.error(a)),i=()=>n.runOutsideAngular(()=>t.complete());return e.subscribe({next:s,error:r,complete:i})}):e}var si=b(23710);class Xo{static initialize(){si.config({disableDefaultAlphabetLength:!0,disableDefaultIdLength:!0,idLength:7}),si.characters("0123456789abcdefghijklmnopqrstuvwxyz")}static generateUnique(e,t="",s="_"){const r=new RegExp(`^${t}`);return t+e.replace(r,"")+s+si.generate()}static getUniqueIncrementalName(e,t){if(!t.includes(e))return e;let s;for(let r=1;r<=t.length;r++)if(s=`${e}-${r}`,!t.includes(s))return s;return s}}Xo.initialize();const nm=new c.InjectionToken("An abstraction over window.navigator object",{factory:()=>window.navigator,providedIn:"root"}),ul="00000000-0000-0000-0000-000000000000",ll=new RegExp("^[a-z0-9]{8}-[a-z0-9]{4}-[a-z0-9]{4}-[a-z0-9]{4}-[a-z0-9]{12}$","i");function xs(n){let e="";for(let t=0;t<n;t++)e+=((1+Math.random())*65536|0).toString(16).substring(1);return e}function O(){return[xs(2),xs(1),xs(1),xs(1),xs(3)].join("-")}function Yo(n){return!!n&&ll.test(n)}function dl(n){return!n||n===ul}const Qo=new c.InjectionToken("CURRENT_TAB_ID_TOKEN"),im={provide:Qo,useValue:O()},am=new c.InjectionToken("Dialog token"),pe=new c.InjectionToken("WindowToken",{providedIn:"root",factory:ec});function ec(){return window}const hl={provide:pe,useFactory:ec};class Wr{constructor(e){this._window=e,this._hasFocus=!1,this._window.addEventListener("focus",()=>{this._hasFocus=!0}),this._window.addEventListener("blur",()=>{this._hasFocus=!1})}_getIsDocumentVisible(){return document.visibilityState!=="hidden"}get hasFocus(){return this._hasFocus}get isActive(){return this._getIsDocumentVisible()}focus(){this._window.focus()}static#e=this.\u0275fac=function(t){return new(t||Wr)(c.\u0275\u0275inject(pe))};static#t=this.\u0275prov=c.\u0275\u0275defineInjectable({token:Wr,factory:Wr.\u0275fac,providedIn:"root"})}var pl=b(3633);class Os{constructor(e){this._injector=e}defineComponent(e,t,s=null){const r=(0,pl.createCustomElement)(t,{injector:s||this._injector});customElements.get(e)||customElements.define(e,r)}static#e=this.\u0275fac=function(t){return new(t||Os)(c.\u0275\u0275inject(c.Injector))};static#t=this.\u0275prov=c.\u0275\u0275defineInjectable({token:Os,factory:Os.\u0275fac,providedIn:"root"})}function ml(n,e){return n.creatio.tabId=e,(0,o.of)(void 0)}const om={provide:c.APP_INITIALIZER,multi:!0,useFactory:(n,e)=>()=>ml(n,e),deps:[pe,Qo]},tc=new c.InjectionToken("LOCAL_STORAGE_SERVICE_CONFIG");class Jr{static forRoot(e={}){return{ngModule:Jr,providers:[{provide:tc,useValue:e}]}}static#e=this.\u0275fac=function(t){return new(t||Jr)};static#t=this.\u0275mod=c.\u0275\u0275defineNgModule({type:Jr});static#s=this.\u0275inj=c.\u0275\u0275defineInjector({})}const ri="LOCAL_STORAGE_NOT_SUPPORTED";class Zr{constructor(e={}){this._isSupported=!1,this._prefix="ls",this._storageType="localStorage";const{prefix:t,storageType:s}=e;t!=null&&this._setPrefix(t),s!=null&&this._setStorageType(s),this._isSupported=this._checkSupport()}_deriveKey(e){return`${this._prefix}${e}`}_checkSupport(){try{const e=this._storageType in window&&window[this._storageType]!==null;if(e){this._webStorage=window[this._storageType];const t=this._deriveKey(`__${Math.round(Math.random()*1e7)}`);this._webStorage.setItem(t,""),this._webStorage.removeItem(t)}return e}catch(e){return console.error(e.message),!1}}_setPrefix(e){this._prefix=e;const t=".";this._prefix&&!this._prefix.endsWith(t)&&(this._prefix=this._prefix?`${this._prefix}${t}`:"")}_setStorageType(e){this._storageType=e}get(e){if(!this._isSupported)return console.warn(ri),null;const t=this._webStorage?this._webStorage.getItem(this._deriveKey(e)):null;if(!t||t==="null")return null;try{return JSON.parse(t)}catch{return null}}set(e,t){const s=t===void 0?null:JSON.stringify(t);if(!this._isSupported)return console.warn(ri),!1;try{this._webStorage&&this._webStorage.setItem(this._deriveKey(e),s)}catch(r){return console.error(r.message),!1}return!0}remove(...e){let t=!0;return e.forEach(s=>{this._isSupported||(console.warn(ri),t=!1);try{this._webStorage.removeItem(this._deriveKey(s))}catch(r){console.error(r.message),t=!1}}),t}static#e=this.\u0275fac=function(t){return new(t||Zr)(c.\u0275\u0275inject(tc,8))};static#t=this.\u0275prov=c.\u0275\u0275defineInjectable({token:Zr,factory:Zr.\u0275fac,providedIn:"root"})}var S=b(73308);class Xr{playFromSource(e,t=!1){return(0,S.A)(function*(){const s=new Audio(e),r=s.play();if(r!==void 0)try{yield r}catch(i){if(s.muted=!0,t)throw i}})()}static#e=this.\u0275fac=function(t){return new(t||Xr)};static#t=this.\u0275prov=c.\u0275\u0275defineInjectable({token:Xr,factory:Xr.\u0275fac,providedIn:"root"})}var He;(function(n){n.Small="small",n.Medium="medium",n.Large="large",n.XL="xl",n.XXL="xxl"})(He||(He={}));class Yr{constructor(e,t){this._window=e,this._document=t,this._minScreenSize=600,this._mediumScreenSize=790,this._largeScreenSize=1079,this._xlScreenSize=1280,this._screenSizeChanges$=new o.BehaviorSubject(this._currentScreenSizeType),this._changeScreenSizeType()}get currentScreenSizeType(){return this._currentScreenSizeType}get currentScreenSize(){return this._currentScreenSize}get isSmallScreen(){return this._currentScreenSizeType===He.Small}_setScreenSizeTypeAttribute(e){this._document.body.setAttribute("screen-size-type",e)}_getScreenSizeType(){return this._currentScreenSize=this._window.innerWidth,this._currentScreenSize<=this._minScreenSize?He.Small:this._currentScreenSize<=this._mediumScreenSize?He.Medium:this._currentScreenSize<=this._largeScreenSize?He.Large:this._currentScreenSize<=this._xlScreenSize?He.XL:He.XXL}_changeScreenSizeType(){const e=this._getScreenSizeType();return e===this._currentScreenSizeType?!1:(this._currentScreenSizeType=e,this._setScreenSizeTypeAttribute(e),!0)}screenSizeTypeChangeNotifier(){return this._screenSizeChanges$.asObservable()}refreshCurrentScreenSizeType(){this._changeScreenSizeType()&&this._screenSizeChanges$.next(this._currentScreenSizeType)}static#e=this.\u0275fac=function(t){return new(t||Yr)(c.\u0275\u0275inject(pe),c.\u0275\u0275inject(R.DOCUMENT))};static#t=this.\u0275prov=c.\u0275\u0275defineInjectable({token:Yr,factory:Yr.\u0275fac,providedIn:"root"})}const cm=new c.InjectionToken("DESKTOP_NOTIFICATION_SENDER_PROVIDER");var sc;(function(n){n[n.StayLoggedIn=0]="StayLoggedIn",n[n.Exit=1]="Exit",n[n.NotSet=2]="NotSet"})(sc||(sc={}));var ni=b(93277);class Qr{constructor(){this._liveAnnouncer=(0,c.inject)(ni.LiveAnnouncer),this._translateService=(0,c.inject)(T.TranslateService)}announce(e,t,s=200){var r=this;return(0,S.A)(function*(){const i=r._translateService.instant(e);yield r._liveAnnouncer.announce(i,t,s)})()}static#e=this.\u0275fac=function(t){return new(t||Qr)};static#t=this.\u0275prov=c.\u0275\u0275defineInjectable({token:Qr,factory:Qr.\u0275fac,providedIn:"root"})}function fl(n){return n.map(e=>({name:e.name,dependsOn:[...e.dependsOn]}))}function rc(n){return n.filter(e=>e.dependsOn.length===0).map(e=>e.name)}function nc(n){if(!n||n.length===0)return[];const e=fl(n),t=e.map(l=>l.dependsOn).flat().length;let s=0;const r=rc(e);if(r.length===0)throw new Error("Cyclic dependencies detected");const i=[[...r]];let a=e.filter(l=>l.dependsOn.length!==0);for(;a.length!==0;){if(s>t)throw new Error("Process is hanging while build order");s++,a=a.map(d=>({name:d.name,dependsOn:d.dependsOn.filter(h=>!r.includes(h))}));const l=rc(a);if(l.length===0)throw new Error("Cyclic dependencies detected");r.push(...l),i.push(l),a=a.filter(d=>d.dependsOn.length!==0)}return i}function um(n){return nc(n).flat()}class ic extends Error{constructor(){super("Next handler already specified")}}class gl{constructor(){this._refs=new Set,this.lazyLoadingDisabled=!1}static#e=this._globalInstancePath="creatio._lazyModulesManager";static get instance(){if(!this._instance){let e=(0,v.get)(window,this._globalInstancePath);e||(e=new this,(0,v.set)(window,this._globalInstancePath,e)),this._instance=e}return this._instance}add(e){this._refs.add(e)}size(){return this._refs.size}loadAll(){return Promise.all(Array.from(this._refs).map(e=>e.loadAndBootstrap()))}clear(){this._refs.clear()}}var en;(function(n){n[n.Schema=0]="Schema",n[n.Remote=1]="Remote",n[n.Host=2]="Host"})(en||(en={}));const ac=window;class ii{constructor(){this.store={typeInfos:new Map}}static#e=this._prefix="creatio.registry.";static get store(){if(!this._instance){let e=(0,v.get)(ac,this._prefix+this.registryKey);e||(e=new this,(0,v.set)(ac,this._prefix+this.registryKey,e)),this._instance=e}return this._instance.store}}class _l extends ii{static#e=this.registryKey="pkgTopology";static get items(){return this.store.typeInfos}static get(e){const t=this.items.get(e);if(t===void 0)throw new Error(`Package with name ${e} not found in topology`);return t}}class yl{constructor(e){this._request=e;const t=[...this._request.scopes??[]].reverse().map((s,r)=>[s,r]);this._scopesOrder=Object.fromEntries(t)}_getOrderByScopes(e){if(!e.scopes)return Number.MAX_VALUE;const t=e.scopes.filter(s=>s in this._scopesOrder).map(s=>this._scopesOrder[s]);return Math.min(...t)}_getOrderByPkgTopology(e){return e.source.type===en.Host?Number.MAX_VALUE:_l.get(e.source.packageName)}compare(e,t){const s=this._getOrderByScopes(e),r=this._getOrderByScopes(t);let i=s-r;if(i)return i;const a=this._getOrderByPkgTopology(e),l=this._getOrderByPkgTopology(t);return i=a-l,i||(i=e.source.type-t.source.type,i)}}const oc="module",cc="viewElement",ai="interfaceDesignerItem",uc="requestHandler",lc="designTimeViewElement",dc="validator",hc="converter";function bl(n,e){Reflect.defineMetadata(oc,n,e)}function Sl(n){const e=Reflect.getMetadata(oc,n);if(!e)throw new Error(`Module metadata was not found on '${n.name}' class`);return e}function lm(n,e){Reflect.defineMetadata(cc,n,e)}function dm(n){const e=Reflect.getMetadata(cc,n);if(!e)throw new Error(`View element metadata was not found on '${n.name}' class`);return e}function Cl(n,e){Reflect.defineMetadata(dc,n,e)}function hm(n){const e=Reflect.getOwnMetadata(dc,n);if(!e)throw new Error(`Validator metadata was not found on '${n.name}' class`);return e}function Al(n,e){Reflect.defineMetadata(hc,n,e)}function pm(n){const e=Reflect.getOwnMetadata(hc,n);if(!e)throw new Error(`Converter metadata was not found on '${n.name}' class`);return e}function mm(n,e){Reflect.defineMetadata(ai,n,e)}function fm(n){const e=Reflect.getOwnMetadata(ai,n);if(!e)throw new Error(`Interface designer item metadata was not found on '${n.name}' class`);return e}function gm(n,e){Reflect.defineMetadata(lc,n,e)}function _m(n){const e=Reflect.getOwnMetadata(lc,n);if(!e)throw new Error(`Design time view element metadata was not found on '${n.name}' class`);return e}function ym(n){return Reflect.hasOwnMetadata(ai,n)}function vl(n,e){Reflect.defineMetadata(uc,n,e)}function bm(n){const e=Reflect.getMetadata(uc,n);if(!e)throw new Error(`Request handler metadata was not found on '${n.name}' class`);return e}function Sm(n){const e=Reflect.getMetadata("requestType",n);if(!e)throw new Error(`requestType was not found on '${n.name}' class`);return{requestType:e,typeRef:n}}function Cm(n){const t=Reflect.getMetadataKeys(n).filter(s=>s.startsWith(crtInputPrefix));return Object.fromEntries(t.map(s=>{const r=Reflect.getMetadata(s,n);return[s.replace(crtInputPrefix,""),r]}))}function Am(n){const t=Reflect.getMetadataKeys(n).filter(s=>s.startsWith(crtOutputPrefix));return Object.fromEntries(t.map(s=>{const r=Reflect.getMetadata(s,n);return[s.replace(crtOutputPrefix,""),r]}))}function vm(n){const t=Reflect.getMetadataKeys(n).filter(s=>s.startsWith(crtValidationInputPrefix));return Object.fromEntries(t.map(s=>{const r=Reflect.getMetadata(s,n);return[s.replace(crtValidationInputPrefix,""),r]}))}function El(n){const t=Reflect.getOwnMetadataKeys(n).filter(s=>s.startsWith(crtInjectPrefix));return Object.fromEntries(t.map(s=>{const r=Number(s.replace(crtInjectPrefix,"")),i=Reflect.getMetadata(s,n);return[r,i]}))}function Ml(n){const e=n.prototype?Object.getPrototypeOf(n.prototype):null;return e?e.constructor:null}function Il(n){const e=Reflect.getOwnMetadata("design:paramtypes",n);if(!e){if(n.length>0)throw new Error(`Dependency Injection error. Cannot read dependencies of class '${n.name}'. Please make sure class '${n.name}' has decorator and 'emitDecoratorMetadata' option is enabled in your 'tsconfig.json' file.`);const s=Ml(n);return s&&s!==Object?Il(s):[]}const t=El(n);return Object.entries(t).forEach(([s,r])=>e[s]=r),e}function Rl(n){console.error("Not supported: lazy modules should not be dependent on other lazy modules. Some functions may not work correctly",n)}function wl(n){if(!Array.isArray(n))return[];if(n.length===0)return[];const e=new Set,t=[...n];for(;t.length>0;){const s=t.pop();if(!s||e.has(s))continue;if(typeof s!="function"){Rl(s);continue}e.add(s);const r=Sl(s)?.includes||[];t.push(...r)}return[...e]}function Pl(n,e){return n?.length?n.some(t=>e?.includes(t)):!0}const oi=window;oi.creatio??={},oi.creatio._bootstrappedCrtModules??=new Map;const pc=oi.creatio._bootstrappedCrtModules;function ci(n){pc.forEach((e,t)=>{e.root&&n(e,t)})}function Em(n){ci(e=>e.options?.onContextCreate?.(n))}function Dl(n){ci(e=>e.options?.onContextUpdate?.(n))}function Tl(n){ci(e=>e.options?.onContextDestroy?.(n))}class Nl{constructor(){var e=this;this._handlers=[],this._requestListeners=new Map,this._handlersCache=new Map,this._handlersScopesByContextId=new Map,this.handlerChain$={process:function(){var t=(0,S.A)(function*(s){let r;if(e._hasCacheHandler(s))r=e._getCacheHandler(s);else{const i=e._getMatchedHandlers(s);gl.instance.lazyLoadingDisabled||(yield e._loadLazyHandlers(s,i)),r=e._buildHandlersChain(s,i)}return e._requestListeners.forEach(i=>i?.(s)),r?.handle(s)});return function(r){return t.apply(this,arguments)}}(),register:t=>(this._handlersCache.delete(t.requestType),this._handlers.push(t),()=>{const s=this._handlers.indexOf(t);s>-1?(this._handlers.splice(s,1),this._handlersCache.delete(t.requestType)):console.warn(`${t?.requestType} not found to unsubscribe`)}),update:t=>{const s=this._handlers.find(r=>r.type===t.type);s&&(s.createHandler=t.createHandler)},subscribe:(t,s)=>{if(!t)return()=>{};const r=O(),i=a=>{(!s||a.$context===s)&&t(a)};return this._requestListeners.set(r,i),()=>this._requestListeners.delete(r)}}}clearContextedHandlersCache(e){return(this._handlersScopesByContextId.get(e)??[]).every(({requestType:s,scope:r})=>this._handlersCache.get(s)?.delete(r))}clear(){this._handlers.splice(0),this._requestListeners.clear(),this._handlersCache.clear(),this._handlersScopesByContextId.clear()}_getCacheHandler(e){const t=this._handlersCache.get(e.type),s=this._getCacheScopesKey(e);return t.get(s)}_hasCacheHandler(e){const t=this._handlersCache.get(e.type),s=this._getCacheScopesKey(e);return t&&t.has(s)}_getCacheScopesKey(e){const t=this._getInjectionContext(e?.$context)?.id??"";return(e.scopes||[""]).join("_").concat(t)}_getInjectionContext(e){return e?._injectionContext||e?.parent&&this._getInjectionContext(e.parent)}_setContextedScopes(e,t){const s=this._getInjectionContext(e?.$context)?.id,r=this._handlersScopesByContextId.has(s)?this._handlersScopesByContextId.get(s):[];r.push({requestType:e.type,scope:t}),this._handlersScopesByContextId.set(s,r)}_setCacheHandler(e,t){const s=this._handlersCache.has(e.type)?this._handlersCache.get(e.type):new Map,r=this._getCacheScopesKey(e);s.set(r,t),this._getInjectionContext(e?.$context)?.id&&this._setContextedScopes(e,r),this._handlersCache.set(e.type,s)}_isRequestHandler(e){return typeof e.handle=="function"&&typeof e.setNext=="function"}_checkHandlerInstanceOf(e){if(!this._isRequestHandler(e))throw new Error('Handler should implement "BaseRequestHandler"')}_loadLazyHandlers(e,t){var s=this;return(0,S.A)(function*(){const r=new Set;t.forEach(l=>{l.lazy&&!l.createHandler&&r.add(l.lazyModuleRef)});const i=[...r];yield Promise.all(i.map(l=>l.loadAndBootstrap()));const a=s._getInjectionContext(e?.$context);if(a&&r.size){const l=yield wl(i.map(d=>d.typeRef));for(const d of l)a.addLazyModule(d);Dl(a)}})()}_getMatchedHandlers(e){return this._handlers.filter(t=>t.requestType!==e.type?!1:Pl(t.scopes,e.scopes))}_buildHandlersChain(e,t){const s=new yl(e);t.sort((l,d)=>s.compare(l,d));const r=this._getInjectionContext(e?.$context),i=t.map(l=>l.createHandler.call(l,r));i.forEach(l=>this._checkHandlerInstanceOf(l)),this._joinHandlersInChain(i);const a=i[0];return this._setCacheHandler(e,a),a}_joinHandlersInChain(e){for(let t=0;t<e.length-1;t++)try{e[t].setNext(e[t+1])}catch(s){throw s instanceof ic?new Error("Handler factory should return new instance of BaseRequestHandler class or its subclass (next handler should not be specified)"):s}}}const mc=window;class ie{get _chain(){return mc.handlerChain}set _chain(e){mc.handlerChain=e}static get instance(){return ie._instance||(ie._instance=new ie)}constructor(){this._chain||this._createGlobalHandlerChain()}_createGlobalHandlerChain(){this._chain=new Nl}clearContextedHandlersCache(e){return this._chain.clearContextedHandlersCache(e)}register(e){return this._chain.handlerChain$.register(e)}update(e){return this._chain.handlerChain$.update(e)}process(e){return this._chain.handlerChain$.process(e)}subscribe(e,t){return this._chain.handlerChain$.subscribe(e,t)}clear(){this._chain.clear()}}function Ce(n,e){if(n.split(".").length<2)throw new Error(`Error when register ${n}. Type property should have format "VendorPrefix.${e}"`)}function Mm(n,e){return Ce(n,e)}function Im(n){const[e,t]=n.split("."),s=fc(t);if(!e||s!==t)throw new Error(`Error when register ${n}. Type property should have Pascal case, e.g. ${e+"."+s}. The first letter of each word in a compound word should be capitalized`)}function Ls(n){const[e,t]=n.split("."),s=fc(t);if(e.toLowerCase()==="crt"&&s!==t)throw new Error(`Error when register ${n}. Type property should have Pascal case, e.g. ${e+"."+s}. The first letter of each word in a compound word should be capitalized`)}function fc(n){return(0,v.upperFirst)((0,v.camelCase)(n))}function Vl(n,e){if(!e)throw new Error(`Error when resolve ${n}. Type was not registered.`)}function Rm(n,e,t){if(t.has(n)&&!isEqual(t.get(n),e))throw new Error(`Error when register ${n}. Element with this type has already exist`)}class xl extends ii{static#e=this.registryKey="HandlerChainServicesRegistry";static validate({requestType:e}){Ce(e,this.registryKey),Ls(e),this.checkUniqueRequestType(e)}static checkUniqueRequestType(e){if(this.services.get(e))throw new Error(`${e} already registered`)}static register(e){this.validate(e),this.services.set(e.requestType,e)}static get services(){return this.store.typeInfos}}class Z{constructor(){this.handlerChain=ie.instance}static#e=this._instanceOfKey="devkit_BaseRequestHandler";get next(){return this._next}static[Symbol.hasInstance](e){return e?.constructor?._instanceOfKey===Z._instanceOfKey}setNext(e){if(this._next)throw new ic;this._next=e}}class Pt{constructor(e){this._injector=e,this._handlerChain=ie.instance,this._unsubscribesHandlers=[],this._registerHandlerChain()}_registerHandlerChain(){xl.services.forEach((e,t)=>{Ce(t,"HandlerChainServiceTypeName"),Ls(t);const s=class extends Z{constructor(i){super(),this._innerInjector=i}handle(i){const l=this._innerInjector.get(e.typeRef)[i.method](...i.args);let d;return l instanceof Promise?d=l:l instanceof o.Observable?d=(0,o.lastValueFrom)(l,{defaultValue:null}):d=Promise.resolve(l),d}},r=()=>new s(this._injector);this._unsubscribesHandlers.push(this._handlerChain.register({requestType:t,createHandler:r,source:{type:en.Host}}))})}ngOnDestroy(){this._unsubscribesHandlers.forEach(e=>e())}static#e=this.\u0275fac=function(t){return new(t||Pt)(c.\u0275\u0275inject(c.Injector))};static#t=this.\u0275prov=c.\u0275\u0275defineInjectable({token:Pt,factory:Pt.\u0275fac})}const Ol={provide:c.APP_INITIALIZER,useFactory:()=>()=>{},deps:[Pt],multi:!0};var m=b(5960);const W=new c.InjectionToken("FEATURE_VALUES",{factory:()=>({})}),Ll=new Array("constructor","ngOnDestroy");let ui=!1;const li=new Proxy({},{get(n,e){if(ui||Ll.includes(e))return n[e];throw new Error(`FEATURE_VALUES. "${String(e)}" not loaded`)}}),Bl={provide:W,useFactory:()=>li};let di=class Gn{constructor(e){this.httpClient=e,this._getFeatureStatesEndpoint="rest/FeatureService/GetFeatureStates",this._cachedCodes=new Map,this._destroyed$=new o.Subject}_checkFeaturesFromURL(){const e=location.search;new URLSearchParams(e).forEach((s,r)=>{if(r.indexOf("feature:")>=0){const i=r.split(":")[1],a=s==="true";this._cachedCodes.set(i,a)}})}loadFeatureStates(){return this._featureStates$?this._featureStates$:(this._featureStates$=this.httpClient.post(this._getFeatureStatesEndpoint,{}).pipe((0,u.map)(e=>(e.GetFeatureStatesResult.forEach(t=>{this._cachedCodes.set(t.Key,t.Value===1)}),(0,c.isDevMode)()&&this._checkFeaturesFromURL(),Object.fromEntries(this._cachedCodes.entries()))),(0,u.tap)(e=>{Object.assign(li,e),Object.freeze(li),ui=!0}),(0,u.catchError)(()=>(ui=!0,(0,o.of)(null))),(0,u.share)(),(0,u.takeUntil)(this._destroyed$)),this._featureStates$)}getFeatureState(e){return e?this._cachedCodes.size>0?(0,o.of)(this._cachedCodes.get(e)||!1):this.loadFeatureStates().pipe((0,u.map)(()=>this._cachedCodes.get(e)||!1)):(0,o.of)(!1)}getFeaturesState(e){return(0,o.from)(this.getFeaturesStateAsync(e))}getFeaturesStateAsync(e){return Promise.all(e.map(t=>{const s=typeof t=="string"?this.getFeatureState(t):t;return new Promise(r=>s.pipe((0,u.first)()).subscribe({next:r}))}))}ngOnDestroy(){this._destroyed$.next(),this._destroyed$.complete()}static#e=this.\u0275fac=function(t){return new(t||Gn)(c.\u0275\u0275inject(D.HttpClient))};static#t=this.\u0275prov=c.\u0275\u0275defineInjectable({token:Gn,factory:Gn.\u0275fac,providedIn:"root"})};di=(0,m.__decorate)([at({requestType:"crt.FeatureService"}),(0,m.__metadata)("design:paramtypes",[D.HttpClient])],di);function kl(n){return()=>(0,o.lastValueFrom)(n.loadFeatureStates(),{defaultValue:null})}const Fl={provide:c.APP_INITIALIZER,useFactory:kl,deps:[di],multi:!0};var y=b(86464),hi=b(52989);class gc{constructor(e){Object.assign(this,e)}}class wm extends gc{constructor(e){super(e),this.externalLink=!1}}class _c extends gc{}var yc=b(91592),ct;(function(n){n[n.Error=1]="Error",n[n.Warning=2]="Warning",n[n.Information=4]="Information"})(ct||(ct={}));function jl(n,e){if(n&1&&c.\u0275\u0275element(0,"mat-icon",1),n&2){const t=c.\u0275\u0275nextContext();c.\u0275\u0275property("svgIcon",t.svgIconName)}}class $l extends _c{constructor(e){super(e),this.cellComponentClass=tn}}class tn extends yc.X{get svgIconName(){return{[ct.Error]:this.errorIconName,[ct.Warning]:this.warningIconName,[ct.Information]:""}[this.getValue()]??""}constructor(e,t){super(),this._matIconRegistry=e,this._domSanitizer=t,this.errorIconName="error-icon",this.warningIconName="warning-icon",this._registerIcons()}_registerIcons(){[this.warningIconName,this.errorIconName].forEach(e=>{this._matIconRegistry.addSvgIconLiteral(e,this._domSanitizer.bypassSecurityTrustHtml(b(48422)("./"+e+".svg")))})}static#e=this.\u0275fac=function(t){return new(t||tn)(c.\u0275\u0275directiveInject(hi.MatIconRegistry),c.\u0275\u0275directiveInject(_.DomSanitizer))};static#t=this.\u0275cmp=c.\u0275\u0275defineComponent({type:tn,selectors:[["ts-error-type-icon-table-cell"]],features:[c.\u0275\u0275InheritDefinitionFeature],decls:1,vars:1,consts:[["class","error-type-icon",3,"svgIcon",4,"ngIf"],[1,"error-type-icon",3,"svgIcon"]],template:function(t,s){t&1&&c.\u0275\u0275template(0,jl,1,1,"mat-icon",0),t&2&&c.\u0275\u0275property("ngIf",!s.isEmpty()&&s.getValue())},dependencies:[R.NgIf,hi.MatIcon],styles:[".error-type-icon[_ngcontent-%COMP%]{height:16px;width:16px}"]})}function Ul(n,e){if(n&1&&(c.\u0275\u0275elementStart(0,"div",1),c.\u0275\u0275element(1,"mat-icon",2),c.\u0275\u0275elementEnd()),n&2){const t=c.\u0275\u0275nextContext();c.\u0275\u0275advance(),c.\u0275\u0275property("svgIcon",t.iconName)}}class ql extends _c{constructor(e,t){super(e),this.cellComponentClass=Bs,this.iconName=t}}class Bs extends yc.X{get iconName(){return this.columnDataSchema.iconName.length?this.columnDataSchema.iconName:this.getValue()}static#e=this.\u0275fac=(()=>{let e;return function(s){return(e||(e=c.\u0275\u0275getInheritedFactory(Bs)))(s||Bs)}})();static#t=this.\u0275cmp=c.\u0275\u0275defineComponent({type:Bs,selectors:[["ts-icon-table-cell"]],features:[c.\u0275\u0275InheritDefinitionFeature],decls:1,vars:1,consts:[["class","drag-drop-icon-wrapper","cdkDragHandle","",4,"ngIf"],["cdkDragHandle","",1,"drag-drop-icon-wrapper"],[3,"svgIcon"]],template:function(t,s){t&1&&c.\u0275\u0275template(0,Ul,2,1,"div",0),t&2&&c.\u0275\u0275property("ngIf",!s.isEmpty())},dependencies:[R.NgIf,hi.MatIcon]})}var z=b(76923),Hl=b(14715);class zl extends Hl.MatLegacyTableDataSource{constructor(e=[]){super(e),this._visibleContentSize=0,this._pageSize=40,this.resetVisibleContentSize()}resetVisibleContentSize(){this._visibleContentSize=this._pageSize}loadNext(){this._visibleContentSize+=this._pageSize,this._updateChangeSubscription()}_pageData(e){return this._visibleContentSize>=e.length?e:e.slice(0,this._visibleContentSize)}}class pi extends Error{constructor(e){super(`Argument with name '${e}' is empty.`)}}class sn extends Error{constructor(e){super(`Argument with name '${e}' is out of range.`)}}class N{static checkArgumentEmpty(e,t){if(t==null)throw new pi(e)}static checkArrayEmpty(e,t){if(N.checkArgumentEmpty(e,t),t.length===0)throw new pi(e)}static checkStringIsNotEmpty(e,t){if(this.checkArgumentEmpty(e,t),t==="")throw new pi(e);return t}static checkArgumentOutOfRange(e,t,s){if(s.begin&&t<s.begin)throw new sn(e);if(s.end&&t>s.end)throw new sn(e)}static checkEnumOutOfRange(e,t,s){if(!s||!Object.values(s).includes(t))throw new sn(e)}}class ks{createObserver(e,t,s){return new Gl(e,t,s)}static#e=this.\u0275fac=function(t){return new(t||ks)};static#t=this.\u0275prov=c.\u0275\u0275defineInjectable({token:ks,factory:ks.\u0275fac,providedIn:"root"})}class Gl{constructor(e,t,s){if(this._bottomBuffer=100,this._lastScrollMaxPosition=0,this._emitter=new c.EventEmitter,N.checkArgumentEmpty("element",e),this._element=e,this._subscribeOnScroll(),s){if(s<=0)throw new Error(`Value of 'bottomBuffer' paramter must be positive, but actual value is ${s}.`);this._bottomBuffer=s}t&&this.subscribe(t)}_isWindowObserved(e){return!(this._element instanceof HTMLElement)}_scrolledToBottom(){const e=this._element,t=this._isWindowObserved(e)?e.document.documentElement.scrollTop:e.scrollTop,s=this._isWindowObserved(e)?e.document.body.scrollHeight:e.scrollHeight,r=this._isWindowObserved(e)?e.innerHeight:e.offsetHeight;if(!s||!r)return!1;const i=s-r-this._bottomBuffer;return this._lastScrollMaxPosition=t>this._lastScrollMaxPosition?t:this._lastScrollMaxPosition,this._lastScrollMaxPosition===t&&t>=i}_processScroll(){this._scrolledToBottom()&&this._emitter.emit()}_subscribeOnScroll(){this._eventListener=this._processScroll.bind(this),this._element.addEventListener("scroll",this._eventListener)}subscribe(e){this._emitter.subscribe(e)}resetScrollMaxPosition(){this._lastScrollMaxPosition=0}destroy(){this._element.removeEventListener("scroll",this._eventListener),this._element=null,this._emitter.unsubscribe()}}var Fs=b(23023);const Kl=["dataViewWrapper"],Wl=["tableNgContainer"];function Jl(n,e){if(n&1&&(c.\u0275\u0275elementStart(0,"div",10),c.\u0275\u0275text(1),c.\u0275\u0275elementEnd()),n&2){const t=c.\u0275\u0275nextContext();c.\u0275\u0275advance(),c.\u0275\u0275textInterpolate(t.additionalText)}}function Zl(n,e){if(n&1&&(c.\u0275\u0275elementStart(0,"div",11)(1,"a",12),c.\u0275\u0275text(2),c.\u0275\u0275elementEnd()()),n&2){const t=c.\u0275\u0275nextContext();c.\u0275\u0275advance(),c.\u0275\u0275property("href",t.helpLinkUrl.url,c.\u0275\u0275sanitizeUrl),c.\u0275\u0275advance(),c.\u0275\u0275textInterpolate(t.helpLinkUrl.caption)}}function Xl(n,e){if(n&1&&(c.\u0275\u0275elementContainerStart(0),c.\u0275\u0275elementStart(1,"button",13),c.\u0275\u0275text(2),c.\u0275\u0275pipe(3,"translate"),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementStart(4,"button",14),c.\u0275\u0275text(5),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementContainerEnd()),n&2){const t=c.\u0275\u0275nextContext();c.\u0275\u0275advance(),c.\u0275\u0275property("mat-dialog-close",!1),c.\u0275\u0275advance(),c.\u0275\u0275textInterpolate1(" ",c.\u0275\u0275pipeBind1(3,4,"TableDialog.Cancel")," "),c.\u0275\u0275advance(2),c.\u0275\u0275property("mat-dialog-close",!0),c.\u0275\u0275advance(),c.\u0275\u0275textInterpolate(t.continueButtonCaption)}}function Yl(n,e){n&1&&(c.\u0275\u0275elementStart(0,"button",13),c.\u0275\u0275text(1),c.\u0275\u0275pipe(2,"translate"),c.\u0275\u0275elementEnd()),n&2&&(c.\u0275\u0275advance(),c.\u0275\u0275textInterpolate1(" ",c.\u0275\u0275pipeBind1(2,1,"TableDialog.Close")," "))}class Dt{constructor(e,t){this.dialogData=e,this.scrollToBottomObserverFactory=t,this.title="",this.sortColumn="",this.additionalText="",this.continueButtonCaption=""}_renderTableComponent(e){var t=this;return(0,S.A)(function*(){yield Promise.all([b.e(5567),b.e(2225),b.e(8585)]).then(b.bind(b,88585)).then(s=>{const r=s.TableComponent;t._table=e.createComponent(r).instance,t._table.dataSchema=t.dataSchema,t._table.dataSource=t.tableDataSource,t._table.sortColumn=t.sortColumn,t._table.headerSticky=!0})})()}_initScrollToBottomObserver(){const e=this.dataViewWrapper.nativeElement;this._scrollToBottomObserver=this.scrollToBottomObserverFactory.createObserver(e,this._loadNextData.bind(this))}_loadNextData(){this.tableDataSource&&this.tableDataSource.loadNext()}ngAfterViewInit(){this._initScrollToBottomObserver()}ngOnInit(){var e=this;return(0,S.A)(function*(){!e.dialogData||!e.dialogData.data||(e.tableDataSource=new zl(e.dialogData.data),e.dataSchema=e.dialogData.dataSchema,e.title=e.dialogData.title||e.title,e.sortColumn=e.dialogData.sortColumn,e.additionalText=e.dialogData.additionalText,e.helpLinkUrl=e.dialogData.helpLinkUrl,e.continueButtonCaption=e.dialogData.continueButtonCaption,yield e._renderTableComponent(e.tableNgContainer))})()}ngOnDestroy(){this._scrollToBottomObserver&&this._scrollToBottomObserver.destroy()}static#e=this.\u0275fac=function(t){return new(t||Dt)(c.\u0275\u0275directiveInject(z.MAT_LEGACY_DIALOG_DATA),c.\u0275\u0275directiveInject(ks))};static#t=this.\u0275cmp=c.\u0275\u0275defineComponent({type:Dt,selectors:[["ts-table-dialog"]],viewQuery:function(t,s){if(t&1&&(c.\u0275\u0275viewQuery(Kl,7),c.\u0275\u0275viewQuery(Wl,7,c.ViewContainerRef)),t&2){let r;c.\u0275\u0275queryRefresh(r=c.\u0275\u0275loadQuery())&&(s.dataViewWrapper=r.first),c.\u0275\u0275queryRefresh(r=c.\u0275\u0275loadQuery())&&(s.tableNgContainer=r.first)}},decls:14,vars:5,consts:[["dataViewWrapper",""],["tableNgContainer",""],["withoutContinue",""],["mat-dialog-title",""],[1,"dialog-content-wrapper"],["class","table-dialog-additional-text",4,"ngIf"],["class","table-dialog-help-link-url",4,"ngIf"],["mat-dialog-content","",1,"data-table"],["mat-dialog-actions",""],[4,"ngIf","ngIfElse"],[1,"table-dialog-additional-text"],[1,"table-dialog-help-link-url"],["target","_blank","rel","noopener noreferrer",3,"href"],["mat-flat-button","","color","primary","cdkFocusInitial","",3,"mat-dialog-close"],["mat-button","",3,"mat-dialog-close"]],template:function(t,s){if(t&1&&(c.\u0275\u0275elementStart(0,"div",3)(1,"span"),c.\u0275\u0275text(2),c.\u0275\u0275elementEnd()(),c.\u0275\u0275elementStart(3,"div",4),c.\u0275\u0275template(4,Jl,2,1,"div",5)(5,Zl,3,2,"div",6),c.\u0275\u0275elementStart(6,"div",7,0),c.\u0275\u0275elementContainer(8,null,1),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementStart(10,"div",8),c.\u0275\u0275template(11,Xl,6,6,"ng-container",9)(12,Yl,3,3,"ng-template",null,2,c.\u0275\u0275templateRefExtractor),c.\u0275\u0275elementEnd()()),t&2){const r=c.\u0275\u0275reference(13);c.\u0275\u0275advance(2),c.\u0275\u0275textInterpolate(s.title),c.\u0275\u0275advance(2),c.\u0275\u0275property("ngIf",s.additionalText),c.\u0275\u0275advance(),c.\u0275\u0275property("ngIf",s.helpLinkUrl),c.\u0275\u0275advance(6),c.\u0275\u0275property("ngIf",s.continueButtonCaption)("ngIfElse",r)}},dependencies:[R.NgIf,Fs.MatLegacyButton,z.MatLegacyDialogClose,z.MatLegacyDialogTitle,z.MatLegacyDialogContent,z.MatLegacyDialogActions,T.TranslatePipe],styles:[`ts-table-dialog{min-width:850px;max-width:900px;margin:0 8px!important;padding:0}ts-table-dialog .table-dialog-additional-text{margin-bottom:4px;display:inline}ts-table-dialog .table-dialog-help-link-url{display:inline;cursor:pointer}ts-table-dialog .data-table{overflow-y:auto!important;max-height:330px;margin:0;padding:0}ts-table-dialog .data-table table{padding-top:0}ts-table-dialog [mat-dialog-actions]{display:flex;flex-direction:row;justify-content:flex-end;margin:20px 0 10px!important}
`],encapsulation:2})}var ze=b(29957),Tt;(function(n){n[n.Primary=0]="Primary",n[n.Secondary=1]="Secondary",n[n.Cancel=2]="Cancel",n[n.Delete=3]="Delete"})(Tt||(Tt={}));const Ql={caption:"ConfirmationDialog.YES",result:Tt.Secondary},ed={caption:"ConfirmationDialog.NO",result:Tt.Primary},Pm={caption:"ConfirmationDialog.CANCEL",result:Tt.Cancel},Dm={caption:"ConfirmationDialog.DELETE",result:Tt.Delete};function td(n,e){if(n&1&&(c.\u0275\u0275elementStart(0,"button",6),c.\u0275\u0275text(1),c.\u0275\u0275pipe(2,"translate"),c.\u0275\u0275elementEnd()),n&2){const t=c.\u0275\u0275nextContext();c.\u0275\u0275property("mat-dialog-close",t.secondaryButton.result),c.\u0275\u0275advance(),c.\u0275\u0275textInterpolate1(" ",c.\u0275\u0275pipeBind1(2,2,t.secondaryButton.caption)," ")}}function sd(n,e){if(n&1&&(c.\u0275\u0275elementStart(0,"button",6),c.\u0275\u0275text(1),c.\u0275\u0275pipe(2,"translate"),c.\u0275\u0275elementEnd()),n&2){const t=e.$implicit;c.\u0275\u0275property("mat-dialog-close",t.result),c.\u0275\u0275advance(),c.\u0275\u0275textInterpolate1(" ",c.\u0275\u0275pipeBind1(2,2,t.caption)," ")}}class Nt{constructor(e){this.data=e,this.buttons=[],e&&(this.primaryButton=e.primaryButton,this.secondaryButton=e.secondaryButton,this.message=e.message,this.buttons=e.buttons),this.buttons?.length||(this.primaryButton??=ed,this.secondaryButton??=Ql)}static#e=this.\u0275fac=function(t){return new(t||Nt)(c.\u0275\u0275directiveInject(z.MAT_LEGACY_DIALOG_DATA))};static#t=this.\u0275cmp=c.\u0275\u0275defineComponent({type:Nt,selectors:[["ts-confirmation-dialog"]],decls:9,vars:7,consts:[["mat-dialog-content",""],[1,"message"],["mat-dialog-actions",""],["mat-flat-button","","color","primary","cdkFocusInitial","",1,"action-button",3,"mat-dialog-close"],["class","action-button","mat-button","",3,"mat-dialog-close",4,"ngIf"],["class","action-button","mat-button","",3,"mat-dialog-close",4,"ngFor","ngForOf"],["mat-button","",1,"action-button",3,"mat-dialog-close"]],template:function(t,s){t&1&&(c.\u0275\u0275elementStart(0,"div",0)(1,"span",1),c.\u0275\u0275text(2),c.\u0275\u0275elementEnd()(),c.\u0275\u0275elementStart(3,"div",2)(4,"button",3),c.\u0275\u0275text(5),c.\u0275\u0275pipe(6,"translate"),c.\u0275\u0275elementEnd(),c.\u0275\u0275template(7,td,3,4,"button",4)(8,sd,3,4,"button",5),c.\u0275\u0275elementEnd()),t&2&&(c.\u0275\u0275advance(2),c.\u0275\u0275textInterpolate(s.data==null?null:s.data.message),c.\u0275\u0275advance(2),c.\u0275\u0275property("mat-dialog-close",s.primaryButton.result),c.\u0275\u0275advance(),c.\u0275\u0275textInterpolate1(" ",c.\u0275\u0275pipeBind1(6,5,s.primaryButton.caption)," "),c.\u0275\u0275advance(2),c.\u0275\u0275property("ngIf",s.secondaryButton),c.\u0275\u0275advance(),c.\u0275\u0275property("ngForOf",s.buttons))},dependencies:[R.NgForOf,R.NgIf,Fs.MatLegacyButton,z.MatLegacyDialogClose,z.MatLegacyDialogContent,z.MatLegacyDialogActions,T.TranslatePipe],styles:["[mat-dialog-content][_ngcontent-%COMP%]   .message[_ngcontent-%COMP%]{white-space:pre-line;word-break:break-word}[mat-dialog-actions][_ngcontent-%COMP%]{margin:27px 0 0!important;justify-content:flex-end}"]})}class Vt{constructor(e){this.data=e}static#e=this.\u0275fac=function(t){return new(t||Vt)(c.\u0275\u0275directiveInject(z.MAT_LEGACY_DIALOG_DATA))};static#t=this.\u0275cmp=c.\u0275\u0275defineComponent({type:Vt,selectors:[["ts-info-dialog"]],decls:7,vars:4,consts:[["mat-dialog-content",""],[1,"message"],["mat-dialog-actions",""],["type","button","mat-flat-button","","color","primary","cdkFocusInitial","",1,"action-button",3,"mat-dialog-close"]],template:function(t,s){t&1&&(c.\u0275\u0275elementStart(0,"div",0)(1,"span",1),c.\u0275\u0275text(2),c.\u0275\u0275elementEnd()(),c.\u0275\u0275elementStart(3,"div",2)(4,"button",3),c.\u0275\u0275text(5),c.\u0275\u0275pipe(6,"translate"),c.\u0275\u0275elementEnd()()),t&2&&(c.\u0275\u0275advance(2),c.\u0275\u0275textInterpolate(s.data==null?null:s.data.message),c.\u0275\u0275advance(3),c.\u0275\u0275textInterpolate1(" ",c.\u0275\u0275pipeBind1(6,2,"InfoDialog.OK")," "))},dependencies:[Fs.MatLegacyButton,z.MatLegacyDialogClose,z.MatLegacyDialogContent,z.MatLegacyDialogActions,T.TranslatePipe],styles:["[mat-dialog-content][_ngcontent-%COMP%]{max-height:450px;overflow-y:auto!important}[mat-dialog-content][_ngcontent-%COMP%]   .message[_ngcontent-%COMP%]{white-space:pre-line;word-break:break-word}[mat-dialog-actions][_ngcontent-%COMP%]{justify-content:right;margin:27px 0 0!important}"]})}class ut{constructor(e,t,s,r){this.document=e,this._ngZone=t,this._translateService=s,this.dialog=r}_stopEventPropagation(e,t){e.afterOpened().pipe((0,u.takeUntil)(t)).subscribe(s=>{const i=this.document.getElementsByClassName("cdk-overlay-container")[0];i&&i.addEventListener("click",function(a){a.stopImmediatePropagation()})})}getMessageDialogConfig(e){const t={width:"450px",panelClass:["dialog-top-border"],data:{}};if(typeof e=="string")return t.data.message=e,t;e.panelClass&&e.panelClass.length&&t.panelClass.push(...e.panelClass);const s=e;return s.primaryButton&&(t.data.primaryButton=s.primaryButton),s.secondaryButton&&(t.data.secondaryButton=s.secondaryButton),s.buttons&&(t.data.buttons=s.buttons),t.data.message=s.message,t}open(e,t){return this._ngZone.run(()=>{const s=this.dialog.open(e,t),r=s.afterClosed();return this._stopEventPropagation(s,r),r})}openInfoDialog(e){return this.open(Vt,this.getMessageDialogConfig(e))}openConfirmationDialog(e){return this.open(Nt,this.getMessageDialogConfig(e))}openOperationPermissionsErrorDialog(e){const t=ze.String.format(this._translateService.instant("OperationPermissionsErrorDialog.ErrorTemplate"),e);return this.openInfoDialog(t)}closeById(e){this.dialog.getDialogById(e)?.close()}closeAll(){this.dialog.closeAll()}hasOpenDialogs(){return!!this.dialog.openDialogs?.length}getOpenDialogs(){return this.dialog.openDialogs}static#e=this.\u0275fac=function(t){return new(t||ut)(c.\u0275\u0275inject(R.DOCUMENT),c.\u0275\u0275inject(c.NgZone),c.\u0275\u0275inject(T.TranslateService),c.\u0275\u0275inject(z.MatLegacyDialog))};static#t=this.\u0275prov=c.\u0275\u0275defineInjectable({token:ut,factory:ut.\u0275fac})}var P;(function(n){n.PrimaryColumnValue="primaryColumnValue",n.ColumnValue="columnValue",n.Filter="filter",n.PrimaryDisplayValueFilter="primaryDisplayValueFilter",n.Empty="empty",n.Never="never"})(P||(P={}));var X=b(78240);class js{static#e=this._instanceOfKey="devkit_BaseFilter";static get _instanceOfKeys(){return[this._instanceOfKey]}static[Symbol.hasInstance](e){return(e?.constructor?._instanceOfKeys??[]).includes(this._instanceOfKey)}constructor(e){this.isEnabled=!0,this.trimDateTimeParameterToDate=!1,this.filterType=e}static fromJson(e,t,s){throw new Error(`fromJson not supported on filter type ${this.constructor.name}`)}serializeItem(e){return typeof e.toJson=="function"?e.toJson():(0,X.classToPlain)(e,{exposeUnsetFields:!1,excludePrefixes:["_"]})}toJson(){return(0,X.classToPlain)(this,{exposeUnsetFields:!1,excludePrefixes:["_"]})}}class Ae extends js{static#e=this._instanceOfKey="devkit_SingleFilter";static get _instanceOfKeys(){return[...js._instanceOfKeys,this._instanceOfKey]}constructor(e,t,s){super(e),this.comparisonType=t,this.leftExpression=s?.clone()}toJson(){return{...super.toJson(),leftExpression:this.serializeItem(this.leftExpression)}}_getUsedColumns(){return this.leftExpression._getUsedColumns()}}var Q;(function(n){n[n.None=0]="None",n[n.Compare=1]="Compare",n[n.IsNull=2]="IsNull",n[n.Between=3]="Between",n[n.In=4]="In",n[n.Exists=5]="Exists",n[n.FilterGroup=6]="FilterGroup"})(Q||(Q={}));class ue extends Ae{static#e=this._instanceOfKey="devkit_CompareFilter";static get _instanceOfKeys(){return[...Ae._instanceOfKeys,this._instanceOfKey]}constructor(e,t,s){super(Q.Compare,e,t),this.rightExpression=s?.clone()}static fromJson(e,t,s){return new ue(e.comparisonType,s.fromJson(e.leftExpression,t),s.fromJson(e.rightExpression,t))}clone(){const e=new ue(this.comparisonType,this.leftExpression,this.rightExpression);return e.isEnabled=this.isEnabled,e.trimDateTimeParameterToDate=this.trimDateTimeParameterToDate,e}toJson(){return{...super.toJson(),rightExpression:this.serializeItem(this.rightExpression)}}_getUsedColumns(){return[...super._getUsedColumns(),...this.rightExpression._getUsedColumns()]}}var j;(function(n){n[n.Between=0]="Between",n[n.Contain=11]="Contain",n[n.End_with=13]="End_with",n[n.Equal=3]="Equal",n[n.Exists=15]="Exists",n[n.Greater=7]="Greater",n[n.Greater_or_equal=8]="Greater_or_equal",n[n.Is_not_null=2]="Is_not_null",n[n.Is_null=1]="Is_null",n[n.Less=5]="Less",n[n.Less_or_equal=6]="Less_or_equal",n[n.Not_contain=12]="Not_contain",n[n.Not_end_with=14]="Not_end_with",n[n.Not_equal=4]="Not_equal",n[n.Not_exists=16]="Not_exists",n[n.Not_start_with=10]="Not_start_with",n[n.Start_with=9]="Start_with"})(j||(j={}));var ee;(function(n){n[n.SchemaColumn=0]="SchemaColumn",n[n.Function=1]="Function",n[n.Parameter=2]="Parameter",n[n.SubQuery=3]="SubQuery",n[n.ArithmeticOperation=4]="ArithmeticOperation"})(ee||(ee={}));class ve{static#e=this._instanceOfKey="devkit_BaseExpression";static get _instanceOfKeys(){return[this._instanceOfKey]}static[Symbol.hasInstance](e){return(e?.constructor?._instanceOfKeys??[]).includes(this._instanceOfKey)}constructor(e){this.isBlock=!1,this.isBlock=e?.isBlock}static fromJson(e,t,s){throw new Error(`fromJson not supported on expression type ${this.constructor.name}`)}serializeItem(e){return typeof e.toJson=="function"?e.toJson():(0,X.classToPlain)(e,{exposeUnsetFields:!1,excludePrefixes:["_"]})}toJson(){return(0,X.classToPlain)(this,{exposeUnsetFields:!1,excludePrefixes:["_"]})}}class k extends ve{static#e=this._instanceOfKey="devkit_ColumnExpression";static get _instanceOfKeys(){return[...ve._instanceOfKeys,this._instanceOfKey]}constructor(e){super(e),this.expressionType=ee.SchemaColumn,this.columnPath=e?.columnPath}static fromJson(e){return new k({columnPath:e.columnPath})}clone(){return new k(this)}_getUsedColumns(){return[{path:this.columnPath}]}}function rd(n){return n.getFullYear()<1970}function nd(n){const e=n.getTimezoneOffset()*6e4;return new Date(n.getTime()-e).toISOString().slice(0,-1)}function id(n){const e=n.getFullYear(),t=$s(n.getMonth()+1),s=$s(n.getDate()),r=$s(n.getHours()),i=$s(n.getMinutes()),a=$s(n.getSeconds()),l=ad(n.getMilliseconds());return`${e}-${t}-${s}T${r}:${i}:${a}.${l}`}function $s(n){return String(n).padStart(2,"0")}function ad(n){return String(n).padStart(3,"0")}function mi(n){if(!(n instanceof Date))throw new TypeError;return rd(n)?id(n):nd(n)}function bc(n){return`"${mi(n)}"`}class $ extends ve{static#e=this._instanceOfKey="devkit_ParameterExpression";static get _instanceOfKeys(){return[...ve._instanceOfKeys,this._instanceOfKey]}constructor(e){super(e),this.expressionType=ee.Parameter;const t=e?.value;if(t instanceof Date){const s=new Date;s.setTime(t.getTime()),this.value=s}else t?this.value=typeof t=="object"?{...t}:t:this.value=t;this.dataValueType=e?.dataValueType??y.r.Text,this.parameter={dataValueType:this.dataValueType,...this._getParameterValueMetadata()}}static fromJson(e){return new $(e.parameter)}_convertStringToBlobArray(e){const t=[];let s=0;for(let r=0;r<e.length;r++){const i=e.charCodeAt(r);i<128?t[s++]=String.fromCharCode(i):i<2048?(t[s++]=String.fromCharCode(i>>6|192),t[s++]=String.fromCharCode(i&63|128)):(t[s++]=String.fromCharCode(i>>12|224),t[s++]=String.fromCharCode(i>>6&63|128),t[s++]=String.fromCharCode(i&63|128))}return t}_getParameterValueMetadata(){return this.dataValueType===y.r.Blob?{arrayValue:this.value?this._convertStringToBlobArray(this.value):[]}:this.value instanceof Date?{value:bc(this.value)}:{value:this.value}}clone(){return new $(this)}_getUsedColumns(){return[]}}(0,m.__decorate)([(0,X.Exclude)(),(0,m.__metadata)("design:type",Object)],$.prototype,"value",void 0),(0,m.__decorate)([(0,X.Exclude)(),(0,m.__metadata)("design:type",Number)],$.prototype,"dataValueType",void 0);class Tm{}const Sc=new c.InjectionToken("ContextService");var Ee;(function(n){n.ViewElement="viewElement",n.Page="page"})(Ee||(Ee={}));var x;(function(n){n.OwnAttribute="Own",n.ForwardReferenceAttribute="ForwardReference",n.BackReferenceAttribute="BackReference",n.AggregationAttribute="Aggregation",n.FunctionAttribute="Function"})(x||(x={}));var Cc;(function(n){n[n.General=0]="General",n[n.Advanced=1]="Advanced",n[n.None=2]="None"})(Cc||(Cc={}));class te{constructor(e){this._featureValues=e,this._consequentMeasureStartTimeCorrection=.001,this.rendering$=new o.BehaviorSubject(null),this._lastNowStartTime=0,this._useMeasurePerformanceTools=this._featureValues?.UseMeasurePerformanceTools}_getNowStartTimeWithCorrection(){const e=performance.now(),t=e<=this._lastNowStartTime?this._lastNowStartTime+this._consequentMeasureStartTimeCorrection:e;return this._lastNowStartTime=t,t}measure(e,t,s){if(!this._useMeasurePerformanceTools)return t();const r=s||this._getNowStartTimeWithCorrection(),i=t();return performance.measure(e,{start:r}),i}measureCallback(e,t){var s=this;return(0,S.A)(function*(){if(!s._useMeasurePerformanceTools)return t();const r=s._getNowStartTimeWithCorrection(),i=yield t();return performance.measure(e,{start:r}),i})()}measure$(e){if(!this._useMeasurePerformanceTools)return s=>s;let t;return s=>(0,o.of)(null).pipe((0,u.tap)(()=>t=this._getNowStartTimeWithCorrection()),(0,o.switchMap)(()=>s),(0,u.tap)(()=>{const r=typeof e=="string"?e:e();performance.measure(r,{start:t})}))}static#e=this.\u0275fac=function(t){return new(t||te)(c.\u0275\u0275inject(W,8))};static#t=this.\u0275prov=c.\u0275\u0275defineInjectable({token:te,factory:te.\u0275fac,providedIn:"root"})}var Us;(function(n){n[n.EntitySchema=3]="EntitySchema",n[n.ClientUnitSchema=4]="ClientUnitSchema"})(Us||(Us={}));class od{get closed(){return this._closed}constructor(e){this._initialTeardown=e,this._closed=!1}unsubscribe(){this._closed||(this._closed=!0,(0,v.isFunction)(this._initialTeardown)&&this._initialTeardown())}}var qs;(function(n){n.PTP="PTPMsg",n.BROADCAST="BroadcastMsg",n.SERVER="ServerMsg"})(qs||(qs={}));var cd=b(52874);const ud=new c.InjectionToken("MessageChannelAccessTokenFactory");var Ac=b(66736);class Hs{constructor(e){this._zone=e,this._message$=new o.Subject}init(e,t){return this._zone.runOutsideAngular(()=>{const s=t?{accessTokenFactory:t,withCredentials:!0}:void 0;return this._connection=new Ac.HubConnectionBuilder().withUrl(e,s).withAutomaticReconnect().withHubProtocol(new Ac.JsonHubProtocol).build(),this._connection.on("ServerMessage",r=>this._zone.run(()=>this._message$.next(r))),(0,o.from)(this._connection.start())})}sendMessage(e){return(0,o.from)(this._connection.send("SendMessage",e))}getMessages(){return this._message$}ngOnDestroy(){this._connection.off("ServerMessage"),this._message$.complete(),this._connection.stop().then()}static#e=this.\u0275fac=function(t){return new(t||Hs)(c.\u0275\u0275inject(c.NgZone))};static#t=this.\u0275prov=c.\u0275\u0275defineInjectable({token:Hs,factory:Hs.\u0275fac,providedIn:"root"})}var ld=b(5766);const dd=1e3,vc=3e4,Ec=1e4,Mc="ping",fi="pong";class zs{constructor(e){this._ngZone=e}_createHeartbeatRequestMessage(){return{Id:O(),Header:{Sender:"ConsoleCommand",BodyTypeName:"System.String"},Body:Mc}}_isHeartbeatRequestMessage(e){const t=e.Header?.Sender==="ConsoleCommand",s=e.Body===Mc;return t&&s}_isHeartbeatResponseMessage(e){const t=e.Header?.Sender==="CommandService",s=e.Body===fi;return t&&s}startHeartbeat(e){this.stopHeartbeat(),this._ngZone.runOutsideAngular(()=>{console.log(`WS-Heartbeat: connection ping scheduled for every [${vc/1e3}] sec`);const t=(0,o.timer)(dd,vc).pipe((0,o.tap)(()=>{e.next(this._createHeartbeatRequestMessage())}),(0,o.concatMap)(()=>(0,o.race)(e.pipe((0,o.filter)(s=>this._isHeartbeatResponseMessage(s)),(0,o.take)(1),(0,o.map)(s=>s.Body)),(0,o.of)("timeout").pipe((0,o.delay)(Ec)))));this._subscription=t.subscribe(s=>{switch(s){case fi:console.log(`WS-Heartbeat: Server responded with: ${fi}`);break;case"timeout":console.error(`WS-Heartbeat: Server failed to respond in ${Ec/1e3} seconds`);break}})})}stopHeartbeat(){this._subscription?.unsubscribe()}excludeHeartbeatResponses(){return(0,o.filter)(e=>!this._isHeartbeatRequestMessage(e)&&!this._isHeartbeatResponseMessage(e))}ngOnDestroy(){this.stopHeartbeat()}static#e=this.\u0275fac=function(t){return new(t||zs)(c.\u0275\u0275inject(c.NgZone))};static#t=this.\u0275prov=c.\u0275\u0275defineInjectable({token:zs,factory:zs.\u0275fac,providedIn:"root"})}const Ic=[1,2e3,5e3,1e4,2e4,...Array(10).fill(3e4)],hd=Ic.length;class Gs{constructor(e){this._heartbeatService=e,this._reconnectAttempts=0,this._webSocketCreated$=new o.ReplaySubject(1)}_maxReconnectAttemptsReached(){return this._reconnectAttempts>=hd}_resetReconnectAttempts(){this._reconnectAttempts=0}_getWebSocketUrl(){var e=this;return(0,S.A)(function*(){const t=yield e._accessTokenFactory?.();return t?`${e._serverUrl}?access_token=${encodeURIComponent(t)}`:e._serverUrl})()}_scheduleReconnectionAttempt(e){if(this._maxReconnectAttemptsReached()){console.error("WebSocket: Max reconnect attempts reached",e);return}const t=Ic[this._reconnectAttempts];setTimeout(()=>{this._createAndConnectWebSocketAsync({reconnectOnAccessTokenFactoryError:!0}).catch(console.error),this._reconnectAttempts++},t)}_handleWebSocketClosed(e){this._heartbeatService.stopHeartbeat(),this._scheduleReconnectionAttempt(e)}_createAndConnectWebSocketAsync(e){var t=this;return(0,S.A)(function*(){let s;try{s=yield t._getWebSocketUrl()}catch(r){throw e.reconnectOnAccessTokenFactoryError&&t._scheduleReconnectionAttempt(r),r}return new Promise(r=>{t._webSocket$=(0,ld.webSocket)({url:s,openObserver:{next:()=>{console.log(`Websocket channel opened for url: ${t._serverUrl}`),t._heartbeatService.startHeartbeat(t._webSocket$),t._resetReconnectAttempts(),r()}}}),t._webSocketSubscription?.unsubscribe(),t._webSocketSubscription=t._webSocket$.subscribe({error:i=>t._handleWebSocketClosed(i),complete:()=>t._handleWebSocketClosed()}),t._webSocketCreated$.next(t._webSocket$)})})()}_subscribeToSocketMessages(e,t){return e.pipe(this._heartbeatService.excludeHeartbeatResponses()).subscribe({next:s=>t.next(s),error:()=>{this._maxReconnectAttemptsReached()&&t.error(new Error("Max reconnect attempts reached"))}})}init(e,t){return this._serverUrl=e,this._accessTokenFactory=t,(0,o.from)(this._createAndConnectWebSocketAsync({reconnectOnAccessTokenFactoryError:!1}))}sendMessage(e){return new o.Observable(t=>{this._webSocket$.next(e),t.next(),t.complete()})}getMessages(){return new o.Observable(e=>{let t;const s=this._webSocketCreated$.subscribe(r=>{t?.unsubscribe(),t=this._subscribeToSocketMessages(r,e)});return()=>{t.unsubscribe(),s.unsubscribe()}})}ngOnDestroy(){this._heartbeatService.stopHeartbeat(),this._webSocket$?.complete(),this._webSocketSubscription?.unsubscribe()}static#e=this.\u0275fac=function(t){return new(t||Gs)(c.\u0275\u0275inject(zs))};static#t=this.\u0275prov=c.\u0275\u0275defineInjectable({token:Gs,factory:Gs.\u0275fac,providedIn:"root"})}class me{static create(e){const t=new me;return Object.assign(t,e),t}get isDebugEnabled(){return!!window.Terrasoft?.isDebug}static#e=this.\u0275fac=function(t){return new(t||me)};static#t=this.\u0275prov=c.\u0275\u0275defineInjectable({token:me,factory:me.\u0275fac,providedIn:"root"})}var gi;(function(n){n.Production="production",n.PreProduction="pre-production",n.Development="development"})(gi||(gi={}));let Rc=me.create({serviceUrl:"",clientConnectionClassName:""});const Nm={provide:me,useFactory:()=>Rc};let Ks=class Kn{constructor(e){this._httpClient=e,this._serviceEndpoint="ServiceModel/ApplicationInfoService.svc/"}_initApplicationInfo(){const e=this._serviceEndpoint+"GetApplicationInfo";this._applicationInfoObservable$=this._httpClient.post(e,null).pipe((0,u.map)(t=>{const s=t&&t.applicationInfo;return Rc=me.create(s),t}),(0,u.shareReplay)(1)),this._applicationInfoObservable$.subscribe()}loadApplicationInfo(){return this._applicationInfoObservable$||this._initApplicationInfo(),this._applicationInfoObservable$}loadSysValues(){return this.loadApplicationInfo().pipe((0,u.map)(e=>e?.applicationInfo?.sysValues))}getCoreVersion(){return this._coreVersion?(0,o.of)(this._coreVersion):this.loadSysValues().pipe((0,o.tap)(e=>this._coreVersion=e?.coreVersion),(0,u.map)(()=>this._coreVersion))}getIsProductionEnvironment(){return(this._environmentType?(0,o.of)(this._environmentType):this.loadSysValues().pipe((0,o.tap)(t=>this._environmentType=t?.environmentType),(0,u.map)(()=>this._environmentType))).pipe((0,u.map)(t=>t===gi.Production))}static#e=this.\u0275fac=function(t){return new(t||Kn)(c.\u0275\u0275inject(D.HttpClient))};static#t=this.\u0275prov=c.\u0275\u0275defineInjectable({token:Kn,factory:Kn.\u0275fac,providedIn:"root"})};Ks=(0,m.__decorate)([at({requestType:"crt.SysValuesService"}),(0,m.__metadata)("design:paramtypes",[D.HttpClient])],Ks);let rn=class Wn{constructor(e,t,s,r){this.injector=r,this._destroyed$=new o.Subject,this.init$=new o.ReplaySubject(1),this.messageEvent$=new o.Subject,!e.clientConnectionClassName||e.clientConnectionClassName===""?t.loadApplicationInfo().subscribe(i=>{this._initialize(i.applicationInfo,s)}):this._initialize(e,s)}_initialize(e,t){this.msgChannel=this._getChannel(e.clientConnectionClassName),this._initChannel(e.serviceUrl,t)}_getChannel(e){switch(e){case"Terrasoft.WebSocketChannel":return this.injector.get(Gs);case"Terrasoft.SignalRChannel":return this.injector.get(Hs)}}_buildMessageEvent(e){let t;if(e.Body&&typeof e.Body=="string")try{t=JSON.parse(e.Body)}catch(s){return(0,c.isDevMode)()&&console.warn(`MessageChannelService. Parse error: ${s}`),null}else e.Body&&typeof e.Body=="object"&&(t=e.Body);return{header:{sender:e?.Header?.Sender,bodyTypeName:e?.Header?.BodyTypeName},body:t,id:e.Id}}_subscribeToMsgChannel(){this.msgChannel.getMessages().pipe((0,u.takeUntil)(this._destroyed$)).subscribe(e=>{const t=this._buildMessageEvent(e);t&&this.messageEvent$.next(t)})}_initChannel(e,t){this.msgChannel.init(e,t).subscribe({complete:()=>{this.init$.next(this.msgChannel),this._subscribeToMsgChannel()}})}_sendMessageInternal(e,t,s){const r={Id:cd.Guid.create().toString(),Header:{Sender:e,BodyTypeName:"System.String",ChannelType:t},Body:JSON.stringify(s)};return this.init$.pipe((0,o.take)(1),(0,u.switchMap)(()=>this.msgChannel.sendMessage(r)))}getMessages(e){return N.checkArgumentEmpty("sender",e),this.messageEvent$.pipe((0,u.filter)(t=>t.header.sender===e))}subscribe(e,t){N.checkArgumentEmpty("sender",e),N.checkArgumentEmpty("callback",t);const s=this.getMessages(e).subscribe(t);return Promise.resolve(new od(()=>s.unsubscribe()))}sendMessage(e,t,s){let r,i;const a=!!s;a?(r=e,i=t,N.checkStringIsNotEmpty("sender",r),N.checkEnumOutOfRange("channelType",s,qs)):(i=e,r=t,N.checkArgumentEmpty("channelType",r),N.checkEnumOutOfRange("channelType",r,qs));const l=this._sendMessageInternal(r,s,i);return a?(0,o.firstValueFrom)(l):l}ngOnDestroy(){this._destroyed$.next(),this._destroyed$.complete(),this.init$.complete(),this.messageEvent$.complete()}static#e=this.\u0275fac=function(t){return new(t||Wn)(c.\u0275\u0275inject(me),c.\u0275\u0275inject(Ks),c.\u0275\u0275inject(ud,8),c.\u0275\u0275inject(c.Injector))};static#t=this.\u0275prov=c.\u0275\u0275defineInjectable({token:Wn,factory:Wn.\u0275fac,providedIn:"root"})};rn=(0,m.__decorate)([at({requestType:"crt.MessageChannelService"}),(0,m.__metadata)("design:paramtypes",[me,Ks,Function,c.Injector])],rn);const pd=new c.InjectionToken("Represents a list of schema change message predicates"),md=new c.InjectionToken("Represents a list of schema remove message predicates"),fd=new c.InjectionToken("Represents a list of schema rights message predicates");class xt{constructor(e,t,s,r,i){this._messageChannelService=e,this._broadcastChannelFactory=t,this._changePredicates=s,this._removePredicates=r,this._rightsPredicates=i,this._destroyed$=new o.Subject,this.schemaChanged$=new o.Subject,this.schemaRemoved$=new o.Subject,this.rightsChanged$=new o.Subject,this.requireJsChanged$=new o.Subject,this._subscribeMessageChannelEvent()}_getSchemaType(e){let t;switch(e){case"ClientUnitSchemaManager":t=Us.ClientUnitSchema;break;case"EntitySchemaManager":t=Us.EntitySchema;break}return t}_processMessage(e,t){const s=e.body,r=this._getSchemaType(s.ManagerName);r&&t.next({name:s.Name,uId:s.UId,schemaType:r,userId:s.UserId,isNew:s.IsNew,extendParent:s.ExtendParent})}_subscribeMessageChannelEvent(){this._messageChannelService.messageEvent$.pipe((0,u.filter)(e=>this._changePredicates?.some(t=>t(e))),(0,u.takeUntil)(this._destroyed$)).subscribe(e=>this._processMessage(e,this.schemaChanged$)),this._messageChannelService.messageEvent$.pipe((0,u.filter)(e=>this._removePredicates?.some(t=>t(e))),(0,u.takeUntil)(this._destroyed$)).subscribe(e=>this._processMessage(e,this.schemaRemoved$)),this._messageChannelService.messageEvent$.pipe((0,u.filter)(e=>this._rightsPredicates?.some(t=>t(e))),(0,u.takeUntil)(this._destroyed$)).subscribe(e=>this._processMessage(e,this.rightsChanged$)),this._broadcastChannelFactory.createInstance("schema-requirejs-path-changed").messages$.subscribe(e=>this._processMessage({body:e},this.requireJsChanged$))}ngOnDestroy(){this._destroyed$.next(),this._destroyed$.complete(),this.schemaChanged$.complete()}static#e=this.\u0275fac=function(t){return new(t||xt)(c.\u0275\u0275inject(rn),c.\u0275\u0275inject(wt),c.\u0275\u0275inject(pd,8),c.\u0275\u0275inject(md,8),c.\u0275\u0275inject(fd,8))};static#t=this.\u0275prov=c.\u0275\u0275defineInjectable({token:xt,factory:xt.\u0275fac,providedIn:"root"})}class Ws{constructor(e){this.schemaChangeListener=e,this._repository=new Map,this._uIdMap=new Map,this._destroyed$=new o.Subject,this.schemaChangeListener.schemaChanged$.pipe((0,u.filter)(t=>t.schemaType===this.provider.schemaType),(0,u.takeUntil)(this._destroyed$)).subscribe(t=>this.clearSchemaCacheByUId(t.uId))}add(e){this._repository.set(e.name,e),this._uIdMap.set(e.uId,e.name)}getCachedSchema(e){return this._repository.get(e)}getIsSchemaCached(e){return this._repository.has(e)}getCachedSchemesNames(){return[...this._repository.keys()]}getSchemaByName(e){const t=this.getCachedSchema(e);return t?(0,o.of)(t):this.provider.getSchemaByName(e).pipe((0,u.tap)(s=>this.add(s)))}getSchemaByUId(e){const t=this._uIdMap.get(e),s=t&&this.getCachedSchema(t);return s?(0,o.of)(s):this.provider.getSchemaByUId(e).pipe((0,u.tap)(r=>this.add(r)))}clearSchemaCacheByName(e){const t=this.getCachedSchema(e);t&&this._uIdMap.delete(t.uId),this._repository.delete(e)}clearSchemaCacheByUId(e){const t=this._uIdMap.get(e);t&&this._repository.delete(t),this._uIdMap.delete(e)}ngOnDestroy(){this._destroyed$.next(),this._destroyed$.complete()}static#e=this.\u0275fac=function(t){return new(t||Ws)(c.\u0275\u0275inject(xt))};static#t=this.\u0275prov=c.\u0275\u0275defineInjectable({token:Ws,factory:Ws.\u0275fac})}class nn{static getPathItemInfo(e){const s=/\[([\w-]+):([\w-]+):?([\w-]*)]$/g.exec(e);if(s){const r=s[1],i=s[2],a=s[3];return{isBackReference:!0,referenceSchemaName:r,referenceSchemaColumnName:i,columnName:a}}return{isBackReference:!1,columnName:e}}static getLastBackwardSchemaNameByColumnPath(e){let t="";return e?.split(".").reverse()?.forEach(r=>{t||r.includes("[")&&(t=this.getPathItemInfo(r).referenceSchemaName)}),t}}var an;(function(n){n.List="List",n.SelectionWindow="SelectionWindow"})(an||(an={}));class _i{get isLookupType(){return this.dataValueType?this.dataValueType===y.r.Lookup:!1}constructor(e){e&&(this.uId=e.uId,this.name=e.name,this.caption=e.caption,this.columnCaptionPath=e.columnCaptionPath,this.dataValueType=e.dataValueType,this.usageType=e.usageType,this.referenceSchemaUId=e.referenceSchemaUId,this.referenceSchemaName=e.referenceSchemaName,this.isRequired=e.isRequired,this.isValueCloneable=e.isValueCloneable,this.isMasked=e.isMasked,this.isFormatValidated=e.isFormatValidated,this.isSensitiveData=e.isSensitiveData,this.isValueMasked=e.isValueMasked,this.valueMaskingSettings=e.valueMaskingSettings,this.defaultValueSchema=e.defaultValueSchema,this.lookupMode=e.lookupMode)}}class gd{constructor(e){e&&(this.uId=e.uId,this.name=e.name,this.caption=e.caption,this.extendParent=e.extendParent,this.packageUId=e.packageUId)}}class wc extends gd{getPrimaryColumn(){return this.primaryColumnUId&&this.columns?.find(e=>e.uId===this.primaryColumnUId)}getPrimaryDisplayColumn(){return this.primaryDisplayColumnUId&&this.columns?.find(e=>e.uId===this.primaryDisplayColumnUId)}getPrimaryColorColumn(){return this.primaryColorColumnUId&&this.columns?.find(e=>e.uId===this.primaryColorColumnUId)}getHierarchyColumn(){return this.hierarchyColumnUId&&this.columns?.find(e=>e.uId===this.hierarchyColumnUId)}getCreatedOnColumn(){return this.createdOnColumnUId&&this.columns?.find(e=>e.uId===this.createdOnColumnUId)}getCreatedByColumn(){return this.createdByColumnUId&&this.columns?.find(e=>e.uId===this.createdByColumnUId)}getModifiedOnColumn(){return this.modifiedOnColumnUId&&this.columns?.find(e=>e.uId===this.modifiedOnColumnUId)}getModifiedByColumn(){return this.modifiedByColumnUId&&this.columns?.find(e=>e.uId===this.modifiedByColumnUId)}}var _d=b(61843),Me=b(23092),Ie;(function(n){n[n.None=0]="None",n[n.Const=1]="Const",n[n.Settings=2]="Settings",n[n.SystemValue=3]="SystemValue",n[n.Sequence=4]="Sequence"})(Ie||(Ie={}));var on=b(47149);class yd{static _getDefaultValue(e){if(!e)return null;if(e.source===Ie.Sequence)return{valueSourceType:Ie.Sequence,value:"Sequence",sequencePrefix:e.sequencePrefix,sequenceNumberOfChars:e.sequenceNumberOfChars};if(e.source===Ie.Const){const t=e.value,s=typeof t=="string"?t:t.value;return{valueSourceType:Ie.Const,value:s,valueSource:s,sequenceNumberOfChars:0}}return e.source===Ie.Settings?{valueSourceType:Ie.Settings,value:e.calculatedValue,valueSource:e.value,sequenceNumberOfChars:0}:e.source===Ie.SystemValue?{valueSourceType:Ie.SystemValue,value:e.calculatedValue,valueSource:e.sourceValue,sequenceNumberOfChars:0}:{valueSourceType:e.source,value:null,sequenceNumberOfChars:0}}static _getPrimaryDisplayColorColumnUId(e){if(!e.primaryColorColumnName)return null;const t=Object.values(e.columns).find(s=>s.name===e.primaryColorColumnName);if(!t)throw new Error(`Primary color column set in object ${e.name} but column ${e.primaryColorColumnName} does not exist`);return t?.uId}static map(e,t){const s={};return Object.entries(e.columns).forEach(([,r])=>{const i=r,a=i.dataValueTypeName==="Binary"?"Blob":i.dataValueTypeName,l=Object.entries(on.Q).find(([,p])=>p.name===a),d=l?Number(l[0]):i.dataValueType,h=this._getDefaultValue(i.defaultValue);s[i.uId]={uId:i.uId,name:i.name,caption:{[t]:i.caption},dataValueType:d,isInherited:!!i.isInherited,isRequired:!!i.isRequired,isValueCloneable:!!i.isValueCloneable,usageType:i.usageType,referenceSchemaName:i.referenceSchemaName,isMasked:!!i.isMasked,isFormatValidated:!!i.isFormatValidated,isSimpleLookup:!!i.isSimpleLookup,isSensitiveData:!!i.isSensitiveData,isValueMasked:!!i.isValueMasked,valueMaskingSettings:i.valueMaskingSettings,defValue:h}}),{administratedByOperations:e.administratedByOperations,administratedByRecords:e.administratedByRecords,useMasterRecordRights:e.useMasterRecordRights,masterRecordSchemaName:e.masterRecordSchemaName,primaryColumnUId:e.primaryColumn?.uId,primaryDisplayColumnUId:e.primaryDisplayColumn?.uId,primaryColorColumnUId:this._getPrimaryDisplayColorColumnUId(e),hierarchyColumnUId:e.hierarchyColumnUId,createdOnColumnUId:e.createdOnColumnUId,createdByColumnUId:e.createdByColumnUId,modifiedOnColumnUId:e.modifiedOnColumnUId,modifiedByColumnUId:e.modifiedByColumnUId,uId:e.uId,name:e.name,caption:{[t]:e.caption},columns:{Items:s},isVirtual:!!e.isVirtual,isDBView:!!e.isDBView,administratedByColumns:!!e.administratedByColumns,description:{[t]:e.description},parentUId:e.parentUId,isTrackChangesInDB:!!e.isTrackChangesInDB,extendParent:!!e.extendParent}}}let yi=class{constructor(e){this._window=e}_getItems(e,t=[]){var s=this;let r=[];const i=[...t];return new Promise(a=>{this._window.require(e,(0,S.A)(function*(...l){r=yield Promise.all(l.map(d=>s.map(d))),a({schemes:r,notFoundSchemes:i})}),l=>{const d=l.requireModules??[];i.push(...d),e=e.filter(h=>!d.includes(h)),e.length===0&&a({schemes:r,notFoundSchemes:i}),a(this._getItems(e,i))})})}map(e){return Promise.resolve(e)}get(e){var t=this;return new Promise(s=>{this._window.require([e],function(){var r=(0,S.A)(function*(i){const a=yield t.map(i);s(a)});return function(i){return r.apply(this,arguments)}}(),()=>{s(null)})})}getItems(e){return this._getItems(e,[])}};yi=(0,m.__decorate)([(0,m.__param)(0,(0,c.Inject)(pe)),(0,m.__metadata)("design:paramtypes",[Object])],yi);class lt{constructor(e,t){this._userInfo=e,this._httpClient=t}_getServiceUrlSspPart(){return this._userInfo.isSSP?"ssp/":""}_getDataServiceUrlWithSspPart(){return`DataService/${this._getServiceUrlSspPart()}`}getSchemaDesignerServiceEndpoint(){return this._getDataServiceUrlWithSspPart()+"json/SyncReply/SchemaDesignerRequest"}getRuntimeEntitySchemaServiceEndpoint(){return this._getDataServiceUrlWithSspPart()+"json/SyncReply/RuntimeEntitySchemaRequest"}getEntitySchemaServiceEndpoint(){return this._getDataServiceUrlWithSspPart()+"json/SyncReply/EntitySchemaRequest"}getRuntimeEntitySchemeServiceEndpoint(){return this._getDataServiceUrlWithSspPart()+"json/SyncReply/RuntimeEntitySchemesRequest"}getEntity(e){return(0,o.lastValueFrom)(this._httpClient.post(this.getRuntimeEntitySchemaServiceEndpoint(),{name:e}))}getEntities(e){return(0,o.lastValueFrom)(this._httpClient.post(this.getRuntimeEntitySchemeServiceEndpoint(),e))}static#e=this.\u0275fac=function(t){return new(t||lt)(c.\u0275\u0275inject(Me.oq),c.\u0275\u0275inject(D.HttpClient))};static#t=this.\u0275prov=c.\u0275\u0275defineInjectable({token:lt,factory:lt.\u0275fac,providedIn:"root"})}const bi=["SysSettings"];class Js extends yi{constructor(e,t,s){super(e),this._userInfo=t,this._entityHttpService=s}map(e){return Promise.resolve(yd.map(e,this._userInfo.cultureInfo.sysCultureName))}_getLookupEntities(e){const t=e.flatMap(r=>Object.values(r.columns.Items).filter(i=>i.dataValueType===y.r.Lookup&&i.referenceSchemaName&&!e.find(a=>a.name===i.referenceSchemaName)).map(i=>i.referenceSchemaName)),s=[...new Set(t)];return this.getItems(s)}_getReferenceEntityNameFromBackReferencePath(e){return nn.getPathItemInfo(e).referenceSchemaName}_getReferenceSchemaName(e,t){const s=this._getReferenceEntityNameFromBackReferencePath(e);let r;if(s)r=s;else{const i=Object.entries(t.columns.Items).find(([,l])=>l.name===e);if(!i)throw new Error(`Can't find column '${e}' in EntitySchema '${t.name}'`);const[,a]=i;r=a.referenceSchemaName}return r}_loadSchemasByPath(e,t,s){var r=this;return(0,S.A)(function*(){const i=s.find(f=>f.name===e);if(!i)return{schemas:[],notFoundSchemas:[e]};const a=[...t],l=a.shift(),d=r._getReferenceSchemaName(l,i);if(!d)return{schemas:[],notFoundSchemas:[]};let h=s.find(f=>f.name===d);if(!h)try{if(h=yield r.get(d),h)s.push(h);else return{schemas:[],notFoundSchemas:[d]}}catch{return{schemas:[],notFoundSchemas:[d]}}const p=a.length?yield r._loadSchemasByPath(h.name,a,s):{schemas:[],notFoundSchemas:[]};return{schemas:[h,...p.schemas],notFoundSchemas:p.notFoundSchemas}})()}_getForwardReferenceSchemas(e,t){var s=this;return(0,S.A)(function*(){const r=yield Promise.all(e.filter(i=>i.forwardReferencePaths).flatMap(i=>i.forwardReferencePaths.flatMap(a=>s._loadSchemasByPath(i.name,a.split("."),t))));return{schemes:r.flatMap(i=>i.schemas),notFoundSchemes:r.flatMap(i=>i.notFoundSchemas)}})()}_getEntitiesToLoadLookups(e,t){return t.schemes.filter(s=>e.requests.find(r=>r.loadLookupColumns===!0&&r.name===s.name))}get(e){var t=()=>super.get,s=this;return(0,S.A)(function*(){return bi.includes(e)?(yield s._entityHttpService.getEntity(e)).schema:t().call(s,e)})()}getItems(e){var t=()=>super.getItems,s=this;return(0,S.A)(function*(){const r=e.filter(d=>bi.includes(d)),i=e.filter(d=>!bi.includes(d));let a={success:!0,schemes:[],notFoundSchemes:[]};if(r.length!==0){const d={requests:r.map(h=>({name:h,loadLookupColumns:!1}))};a=yield s._entityHttpService.getEntities(d)}const l=yield t().call(s,i);return{schemes:[...l.schemes,...a.schemes],notFoundSchemes:[...l.notFoundSchemes,...a.notFoundSchemes]}})()}getEntity(e){var t=this;return(0,S.A)(function*(){const s=yield t.get(e);return{success:!!s,schema:s}})()}getEntities(e){var t=this;return(0,S.A)(function*(){const s=e.requests.map(d=>d.name),r=yield t.getItems(s),i=t._getEntitiesToLoadLookups(e,r),a=yield t._getLookupEntities(i),l=yield t._getForwardReferenceSchemas(e.requests,[...r.schemes,...a.schemes]);return{success:!0,schemes:[...r.schemes,...a.schemes,...l.schemes],notFoundSchemes:[...r.notFoundSchemes,...a.notFoundSchemes,...l.notFoundSchemes]}})()}static#e=this.\u0275fac=function(t){return new(t||Js)(c.\u0275\u0275inject(pe),c.\u0275\u0275inject(Me.oq),c.\u0275\u0275inject(lt))};static#t=this.\u0275prov=c.\u0275\u0275defineInjectable({token:Js,factory:Js.\u0275fac,providedIn:"root"})}class Zs{constructor(e,t,s,r){this.httpClient=e,this._entityRequire=t,this._entityHttp=s,this._featureValues=r}_useRequire(){return this._featureValues?.UseRequireEntitySchema8x??!1}getEntity(e){var t=this;return(0,S.A)(function*(){return t._useRequire()?t._entityRequire.getEntity(e):t._entityHttp.getEntity(e)})()}getEntities(e){var t=this;return(0,S.A)(function*(){return t._useRequire()?t._entityRequire.getEntities(e):t._entityHttp.getEntities(e)})()}static#e=this.\u0275fac=function(t){return new(t||Zs)(c.\u0275\u0275inject(D.HttpClient),c.\u0275\u0275inject(Js),c.\u0275\u0275inject(lt),c.\u0275\u0275inject(W,8))};static#t=this.\u0275prov=c.\u0275\u0275defineInjectable({token:Zs,factory:Zs.\u0275fac,providedIn:"root"})}class Ge{constructor(e,t,s,r){this.httpClient=e,this._userInfo=t,this._schemaLoader=s,this._entityHttp=r,this._entitySchemaServiceRequests=new Map,this._destroyed$=new o.Subject}_convertToEntitySchema(e){const t=new wc;return t.uId=e.uId,t.name=e.name,t.caption=this._getCaptionElement(e),t.extendParent=e.extendParent,t.packageUId=e.packageUId,t.administratedByColumns=e.administratedByColumns,t.administratedByOperations=e.administratedByOperations,t.administratedByRecords=e.administratedByRecords,t.description=e.description,t.isDBView=e.isDBView,t.isTrackChangesInDB=e.isTrackChangesInDB,t.isVirtual=e.isVirtual,t.masterRecordSchemaName=e.masterRecordSchemaName,t.primaryColumnUId=e.primaryColumnUId,t.primaryDisplayColumnUId=e.primaryDisplayColumnUId,t.primaryColorColumnUId=e.primaryColorColumnUId,t.hierarchyColumnUId=e.hierarchyColumnUId,t.createdOnColumnUId=e.createdOnColumnUId,t.createdByColumnUId=e.createdByColumnUId,t.modifiedOnColumnUId=e.modifiedOnColumnUId,t.modifiedByColumnUId=e.modifiedByColumnUId,t.useMasterRecordRights=e.useMasterRecordRights,t.parentUId=e.parentUId,t.columns=Object.values(e.columns.Items).map(s=>{const r=new _i;return r.uId=s.uId,r.name=s.name,r.caption=this._getCaptionElement(s),r.dataValueType=s.dataValueType,r.usageType=s.usageType,r.referenceSchemaUId=s.referenceSchemaUId,r.referenceSchemaName=s.referenceSchemaName,r.isRequired=s.isRequired,r.isValueCloneable=s.isValueCloneable,r.isMasked=s.isMasked,r.isFormatValidated=s.isFormatValidated,r.isSensitiveData=s.isSensitiveData,r.isValueMasked=s.isValueMasked,r.valueMaskingSettings=s.valueMaskingSettings,r.defaultValueSchema=s.defValue,r.lookupMode=s.isSimpleLookup?an.List:an.SelectionWindow,r}),t}_getCaptionElement(e){return e.caption[this._userInfo.cultureInfo.sysCultureName]||e.caption[_d.dJ]}_createEntitySchemaColumnFromInformationObject(e){const t=new _i;return t.uId=e.columnUId,t.name=e.columnName,t.caption=e.columnCaption,t.dataValueType=e.columnDataValueType,t.usageType=e.columnUsageType,t.referenceSchemaUId=e.referenceSchemaUId,t.referenceSchemaName=e.referenceSchemaName,t.columnCaptionPath=e.columnCaptionPath,t}_getEntitySchemaFromEndpoint(e,t){return this.httpClient.post(e,t).pipe((0,u.mergeMap)(s=>s.schema?(0,o.of)({success:!0,entitySchema:this._convertToEntitySchema(s.schema)}):(0,o.throwError)({success:!1,entitySchema:null,errorInfo:s.errorInfo})))}_getEntitySchemaColumnByPath(e,t,s="."){const r=`${e}_${s}_${t}`;if(this._entitySchemaServiceRequests.has(r))return this._entitySchemaServiceRequests.get(r);const i=this.httpClient.post(this._entityHttp.getSchemaDesignerServiceEndpoint(),{getSchemaColumnInformation:{entitySchemaUId:e,schemaColumnPath:t,schemaColumnCaptionPathDelimiter:s}}).pipe((0,u.tap)(({success:a})=>{if(!a)throw new Error("SchemaDesignerService request has failed")}),(0,u.map)(({getSchemaColumnInformationResponse:a})=>this._createEntitySchemaColumnFromInformationObject(a)),(0,u.tap)(()=>this._entitySchemaServiceRequests.delete(r)),(0,u.share)());return this._entitySchemaServiceRequests.set(r,i),i}_combineEntitySchemaColumnInformationRequestsWithPaths(e,t){return t.reduce((s,r)=>({...s,[r]:this._getEntitySchemaColumnByPath(e,r)}),{})}getEntitySchemaByUId(e,t){const s=`${e}_${t}`;if(this._entitySchemaServiceRequests.has(s))return this._entitySchemaServiceRequests.get(s);const r=t?this._entityHttp.getEntitySchemaServiceEndpoint():this._entityHttp.getRuntimeEntitySchemaServiceEndpoint(),i={uId:e};t&&(i.packageUId=t);const a=this._getEntitySchemaFromEndpoint(r,i).pipe((0,u.tap)(()=>this._entitySchemaServiceRequests.delete(s)),(0,u.share)());return this._entitySchemaServiceRequests.set(s,a),a}getEntitySchemaByName(e){if(this._entitySchemaServiceRequests.has(e))return this._entitySchemaServiceRequests.get(e);const t=(0,o.from)(this._schemaLoader.getEntity(e)).pipe((0,u.map)(s=>({success:s.success,entitySchema:s.schema?this._convertToEntitySchema(s.schema):null,errorInfo:s.errorInfo})),(0,u.tap)(()=>this._entitySchemaServiceRequests.delete(e)),(0,u.share)(),(0,u.catchError)(s=>(this._entitySchemaServiceRequests.delete(e),(0,o.throwError)(()=>s))));return this._entitySchemaServiceRequests.set(e,t),t}getEntitySchemes(e){const t=JSON.stringify(e);if(this._entitySchemaServiceRequests.has(t))return this._entitySchemaServiceRequests.get(t);const s=(0,o.from)(this._schemaLoader.getEntities(e)).pipe((0,u.map)(r=>({success:r.success,schemes:r.schemes.map(i=>this._convertToEntitySchema(i)),notFoundSchemes:r.notFoundSchemes})),(0,u.tap)(()=>this._entitySchemaServiceRequests.delete(t)),(0,u.share)(),(0,u.catchError)(r=>(0,o.throwError)(()=>r)));return this._entitySchemaServiceRequests.set(t,s),s}getEntitySchemaColumnsInformationByMetaPath(e,t){const s={getSchemaColumnsInformation:{entitySchemaUId:e,schemaColumnMetaPaths:t}};return this.httpClient.post(this._entityHttp.getSchemaDesignerServiceEndpoint(),s).pipe((0,u.tap)(({success:r})=>{if(!r)throw new Error("SchemaDesignerService request is failed")}),(0,u.map)(({getSchemaColumnsInformationResponse:r})=>r.map(i=>({column:this._createEntitySchemaColumnFromInformationObject(i),columnMetaPath:i.columnMetaPath,columnPath:i.columnPath,columnCaptionPath:i.columnCaptionPath}))))}getEntitySchemaColumnsInformationByPath(e,t,s){return this._getEntitySchemaColumnByPath(e,t,s)}getEntitySchemaColumnsInformationByPathsArray(e,t){return(0,o.forkJoin)(this._combineEntitySchemaColumnInformationRequestsWithPaths(e,t))}getColumnCaptionPathByMetaPath(e){const t={getColumnCaptionPathByMetaPath:e};return this.httpClient.post(this._entityHttp.getSchemaDesignerServiceEndpoint(),t).pipe((0,u.tap)(({success:s})=>{if(!s)throw new Error("SchemaDesignerService request is failed")}),(0,u.map)(({columnCaptionPath:s})=>s))}ngOnDestroy(){this._destroyed$.next(),this._destroyed$.complete()}static#e=this.\u0275fac=function(t){return new(t||Ge)(c.\u0275\u0275inject(D.HttpClient),c.\u0275\u0275inject(Me.oq),c.\u0275\u0275inject(Zs),c.\u0275\u0275inject(lt))};static#t=this.\u0275prov=c.\u0275\u0275defineInjectable({token:Ge,factory:Ge.\u0275fac,providedIn:"root"})}class Xs{constructor(e){this._entitySchemaService=e,this.schemaType=Us.EntitySchema}_getSchema(e){return e.pipe((0,u.switchMap)(t=>t.success===!0?(0,o.of)(t):(0,o.throwError)(()=>new Error(t.errorInfo.message))),(0,u.map)(t=>t.entitySchema))}_getScheme(e){return e.pipe((0,u.switchMap)(t=>t.success===!0?(0,o.of)(t):(0,o.throwError)(()=>new Error(t.errorInfo.message))),(0,u.map)(t=>t.schemes))}getSchemaByUId(e){const t=this._entitySchemaService.getEntitySchemaByUId(e);return this._getSchema(t)}getSchemaByName(e){const t=this._entitySchemaService.getEntitySchemaByName(e);return this._getSchema(t)}getSchemes(e){const t=this._entitySchemaService.getEntitySchemes(e);return this._getScheme(t)}static#e=this.\u0275fac=function(t){return new(t||Xs)(c.\u0275\u0275inject(Ge))};static#t=this.\u0275prov=c.\u0275\u0275defineInjectable({token:Xs,factory:Xs.\u0275fac,providedIn:"root"})}class Te extends Ws{constructor(e,t){super(t),this.provider=e,this.schemaChangeListener=t}_checkPath(e){if(!e||e.length===0)throw new Error("Path is null or empty")}_checkLookupColumn(e,t){if(!e.isLookupType)throw new Error(`Column '${e.name}' for schema '${t.name}' is not lookup`)}_getEntitySchemaColumn(e,t){const s=e.columns.find(r=>r.name===t);if(!s)throw new Error(`Can not find column '${t}' in schema '${e.name}'`);return s}_findEntitySchemesByPath(e,t){this._checkPath(t);const s=[...t],r=this.getCachedSchema(e);if(!r)return null;const i=s.shift(),a=nn.getPathItemInfo(i);let l=[];if(a.isBackReference)l=this._findEntitySchemesByPath(a.referenceSchemaName,s);else{const h=this._getEntitySchemaColumn(r,a.columnName);if(s.length===0)return[r];this._checkLookupColumn(h,r),l=this._findEntitySchemesByPath(h.referenceSchemaName,s)}if(!l)return null;const d=l.filter(h=>h.name!==r.name);return[r,...d]}_getAreSchemesCached(e){for(const t of e){const s=this.getCachedSchema(t.name);if(!s)return!1;const r=s.columns.filter(a=>a.isLookupType).every(a=>this.getIsSchemaCached(a.referenceSchemaName));if(t.loadLookupColumns&&!r)return!1;const i=t.forwardReferencePaths??[];for(const a of i){const l=a.split(".");if(!this.findEntitySchemaColumnByPath(t.name,l))return!1}}return!0}_addSchemaIfNotExists(e,t){e.has(t.name)||e.set(t.name,t)}_addSchemesIfNotExists(e,t){t.forEach(s=>{this._addSchemaIfNotExists(e,s)})}_getCachedSchemes(e){const t=new Map;return e.forEach(s=>{const r=this.getCachedSchema(s.name);if(!r)return;if(this._addSchemaIfNotExists(t,r),s.loadLookupColumns){const a=r.columns.filter(l=>l.isLookupType).map(l=>this.getCachedSchema(l.referenceSchemaName)).filter(l=>l!=null);this._addSchemesIfNotExists(t,a)}(s.forwardReferencePaths??[]).forEach(a=>{const l=a.split("."),d=this._findEntitySchemesByPath(s.name,l);d&&this._addSchemesIfNotExists(t,d)})}),[...t.values()]}getSchemes(e){if(this._getAreSchemesCached(e))return(0,o.of)(this._getCachedSchemes(e));const t={requests:e,cachedSchemesNames:this.getCachedSchemesNames()};return this.provider.getSchemes(t).pipe((0,u.tap)(s=>s.forEach(r=>this.add(r))),(0,u.map)(()=>this._getCachedSchemes(e)))}findEntitySchemaByPath(e,t){this._checkPath(t);const s=this.getCachedSchema(e);if(!s)return null;const r=[...t],i=r.shift(),a=nn.getPathItemInfo(i);if(a.isBackReference)return this.findEntitySchemaByPath(a.referenceSchemaName,r);const l=this._getEntitySchemaColumn(s,a.columnName);return r.length===0?s:(this._checkLookupColumn(l,s),this.findEntitySchemaByPath(l.referenceSchemaName,r))}findEntitySchemaColumnByPath(e,t){const s=this.findEntitySchemaByPath(e,t);if(!s)return null;const r=[...t].pop(),i=nn.getPathItemInfo(r);return this._getEntitySchemaColumn(s,i.columnName)}static#e=this.\u0275fac=function(t){return new(t||Te)(c.\u0275\u0275inject(Xs),c.\u0275\u0275inject(xt))};static#t=this.\u0275prov=c.\u0275\u0275defineInjectable({token:Te,factory:Te.\u0275fac,providedIn:"root"})}class Si{}class Ke{get attributes(){return this._parent?[...this._parent.attributes,...this._attributes]:[...this._attributes]}get parent(){return this._parent}constructor(e){if(e!=null){this.name=e.name,this.type=e.type,e.caption&&(this.caption=typeof e.caption=="string"?e.caption:{...e.caption}),this.primaryAttributeName=e.primaryAttributeName,this.primaryDisplayAttributeName=e.primaryDisplayAttributeName,this.primaryColorAttributeName=e.primaryColorAttributeName,this.hierarchyAttributeName=e.hierarchyAttributeName,this.createdByAttributeName=e.createdByAttributeName,this.createdOnAttributeName=e.createdOnAttributeName,this.modifiedByAttributeName=e.modifiedByAttributeName,this.modifiedOnAttributeName=e.modifiedOnAttributeName,e.dataSourceConfig&&(this.dataSourceConfig={...e.dataSourceConfig,config:{...e.dataSourceConfig.config}}),this._parent=e.parent;const t=e.attributes??[];this._attributes=[],t.forEach(s=>{if(this._parent){this._parent.findAttributeByName(s.name)||this._attributes.push(s.clone());return}this._attributes.push(s.clone())})}else this._attributes=[]}clearAttributes(){this._attributes=[]}addAttribute(e){if(this._parent){this._parent.findAttributeByName(e.name)||this._attributes.push(e);return}this._attributes.push(e)}findAttributeByName(e){return this.attributes.find(t=>t.name===e)??null}getPrimaryAttributesNames(){return[this.primaryAttributeName]}getPrimaryLoadAttributes(){const e=[];return this.primaryAttributeName&&e.push(this.primaryAttributeName),this.primaryDisplayAttributeName&&e.push(this.primaryDisplayAttributeName),e}clone(){return new Ke(this)}createChild(){const e=new Ke;return e.name=this.name,e.type=this.type,this.caption&&(e.caption=typeof this.caption=="string"?this.caption:{...this.caption}),e.primaryAttributeName=this.primaryAttributeName,e.primaryDisplayAttributeName=this.primaryDisplayAttributeName,e.primaryColorAttributeName=this.primaryColorAttributeName,e.hierarchyAttributeName=this.hierarchyAttributeName,e.createdByAttributeName=this.createdByAttributeName,e.createdOnAttributeName=this.createdOnAttributeName,e.modifiedByAttributeName=this.modifiedByAttributeName,e.modifiedOnAttributeName=this.modifiedOnAttributeName,this.dataSourceConfig&&(e.dataSourceConfig={...this.dataSourceConfig,config:{...this.dataSourceConfig.config}}),e._attributes=[],e._parent=this,e}}class Pc extends Error{get isCritical(){return!0}constructor(e,t){super(t),this.dataSource=e}}class Ci extends Pc{constructor(e,t){super(e,t)}}class bd extends Pc{get isCritical(){return!1}constructor(e,t){super(e,t)}}class Ai{constructor(e,t){this.dataSourceName=e,this.injector=t,this._errors=[],this._supportTransactions=!1}get supportTransactions(){return this._supportTransactions}get scope(){return this._scope}get hasErrors(){return this._errors.length!==0}get hasCriticalErrors(){return this._errors.some(e=>e.isCritical)}get affectedAttributes(){return[]}get isForceUpdateUnchangedData(){return!1}getLastError(){return this.hasErrors?this._errors[this._errors.length-1]:null}get isAggregate(){return!1}getEmptySchema(){return new Ke}init(e,t){return this.initialConfig=e,this._scope=t,(0,o.of)(this)}load(e,t,s){return this.innerLoad(e,t,s)}save(e,t){return this.innerSave(e,t)}insert(e){return this.innerInsert(e)}delete(e){return this.innerDelete(e)}getSchema(){return this.dataSchema?(0,o.of)(this.dataSchema):this.innerGetSchema().pipe((0,u.tap)(e=>{this.dataSchema=e}))}getLookupDataSchema(e){return this.innerGetLookupDataSchema(e)}getDefaultValues(){return this.innerGetDefaultValues()}canEdit(e){return this.innerCanEdit(e)}canDelete(e){return this.innerCanDelete(e)}canCreate(e){return this.innerCanCreate(e)}getOwnLoadParameters(){return null}getAllowCopyingRecords(){return!1}}const Dc="crt.EntityDataSource",Tc="crt.PageParametersDataSource",Vm="PageParameters";function Re(n){return function(e,t,s){const r=function(...i){return ie.instance.process({type:n?.requestType?n.requestType:this.requestType,method:n?.methodName?n.methodName:t,args:i})};s?s.value=r:e[t]=r}}class cn{}const Sd=Symbol("CreateModelFrom");class We extends cn{constructor(e){super(),this.requestType="crt.ModelGenerator",this._crtModel=e}static get instance(){return this._instance||(this._instance=new We),this._instance}get name(){return this._crtModel?.name}static[Sd](e){return new We(e)}static create(e){var t=this;return(0,S.A)(function*(){const s=yield t.instance._create({type:"crt.EntityDataSource",config:{entitySchemaName:e}},"");return new We(s)})()}getSchema(){return this._crtModel._getAsyncResult(this._crtModel.getSchema())}load(e){return e?.loadOptions&&!e?.options&&(e.options=e.loadOptions),this._crtModel._getAsyncResult(this._crtModel.load(e))}insert(e){return this._crtModel._getAsyncResult(this._crtModel.insert(e))}update(e,t){return this._crtModel._getAsyncResult(this._crtModel.update(e,t))}copy(e,t={}){return this._crtModel._getAsyncResult(this._crtModel.copy(e,t))}create(e={}){return this._crtModel._getAsyncResult(this._crtModel.create(e))}delete(e){return this._crtModel._getAsyncResult(this._crtModel.delete(e))}canSave(e){return this._crtModel._getAsyncResult(this._crtModel.canSave(e))}canDelete(e){return this._crtModel._getAsyncResult(this._crtModel.canDelete(e))}}(0,m.__decorate)([Re({methodName:"generateOne"}),(0,m.__metadata)("design:type",Function)],We.prototype,"_create",void 0);const Cd=new c.InjectionToken("COPILOT_INTENT_REPOSITORY_TOKEN");class ae extends cn{constructor(){super(...arguments),this.requestType="crt.SysSettingsService"}}(0,m.__decorate)([Re(),(0,m.__metadata)("design:type",Function)],ae.prototype,"getByCodes",void 0),(0,m.__decorate)([Re(),(0,m.__metadata)("design:type",Function)],ae.prototype,"getByCode",void 0),(0,m.__decorate)([Re(),(0,m.__metadata)("design:type",Function)],ae.prototype,"update",void 0),(0,m.__decorate)([Re(),(0,m.__metadata)("design:type",Function)],ae.prototype,"updateMany",void 0);class Nc{static#e=this._codeCharactersRegex=new RegExp("^[A-Za-z0-9\\s_]*$");static#t=this._wordsMatchRegex=new RegExp(/\w+/g);static generateCode(e,t=-1){const r=(e.match(this._wordsMatchRegex)||[]).filter(i=>i.length!==0).map(i=>i[0].toUpperCase()+i.substring(1)).join("");return t>=0?r.slice(0,t):r}static isTextUsableForCodeGeneration(e){return this._codeCharactersRegex.test(e)}}class Ys{constructor(){this._sysSettingsService=(0,c.inject)(ae),this._defaultCodeMaxLength=41}_checkCodeIsUnique(e,t){return e?!e.includes(t):!0}_generateCode(e){const{prefix:t,options:s,generateFromName:r,name:i}=e,{codeMaxLength:a,defaultNewCode:l}=s;if(r){if(!Nc.isTextUsableForCodeGeneration(i))return null;const d=t+l,h=(a??this._defaultCodeMaxLength)-d.length,p=Nc.generateCode(i,h);return d+p}return Xo.generateUnique(l,t)}generate(e,t,s){const r={generateFromName:!!t,name:t,prefix:null,options:s};return(0,o.from)(this._sysSettingsService.getByCode("SchemaNamePrefix")).pipe((0,o.map)(i=>i.value),(0,o.tap)(i=>r.prefix=i),(0,o.repeat)(r.generateFromName?1:void 0),(0,o.map)(()=>this._generateCode(r)),(0,o.filter)(i=>this._checkCodeIsUnique(e,i)),(0,o.take)(1),(0,o.defaultIfEmpty)(null))}static#e=this.\u0275fac=function(t){return new(t||Ys)};static#t=this.\u0275prov=c.\u0275\u0275defineInjectable({token:Ys,factory:Ys.\u0275fac})}class Qs{constructor(){this._designItems=new Map}getDesignItem(e){return this._designItems.get(e)}getDesignItems(){return Array.from(this._designItems.values())}setDesignItem(e){this._designItems.set(e.UId,e)}static#e=this.\u0275fac=function(t){return new(t||Qs)};static#t=this.\u0275prov=c.\u0275\u0275defineInjectable({token:Qs,factory:Qs.\u0275fac})}class dt{constructor(){this._repository=(0,c.inject)(Cd),this._copilotCodeGenerator=(0,c.inject)(Ys),this._designRepository=(0,c.inject)(Qs)}_loadIntentUIdByActionUId(e){return(0,o.from)(We.create("CopilotAction")).pipe((0,o.switchMap)(t=>t.load({attributes:["Intent"],parameters:[{type:P.Filter,value:new ue(j.Equal,new k({columnPath:"Id"}),new $({value:e}))}]})),(0,o.map)(t=>{const s=t[0]||{};return(0,v.isEmpty)(s)?null:s.Intent?.value}))}_applyActionToIntent(e,t){const r=(e.Actions||[]).findIndex(a=>a.Id===t.Id);if(r===-1)return!1;const i=e.Actions[r];return e.Actions.splice(r,1,{...i,...t}),!0}_applyParameterToIntent(e,t){const s=t.SourceCollection==="InputParameters"?e.InputParameters:e.OutputParameters,r=s.findIndex(i=>i.UId===t.UId);return r!==-1?(s.splice(r,1,{...s[r],...t}),!0):!1}_getSuccessResponse(){return{success:!0}}_getSuccessResponseObservable(){return(0,o.of)(this._getSuccessResponse())}_getDesignIntent(e){return(0,o.of)(this._designRepository.getDesignItem(e))}_getDesignIntents(){return Array.from(this._designRepository.getDesignItems())}_setDesignIntent(e){this._designRepository.setDesignItem(e)}_getIntentByParameterUId(e){for(const t of this._getDesignIntents()){if(t.InputParameters.find(i=>i.UId===e))return(0,o.of)({intent:t,sourceCollection:"InputParameters"});if(t.OutputParameters.find(i=>i.UId===e))return(0,o.of)({intent:t,sourceCollection:"OutputParameters"})}return(0,o.of)({})}getIntent(e){return this._repository.get(e).pipe((0,o.tap)(t=>{this._setDesignIntent(t)}))}getAllSkills(){return this._repository.getAllCodes("CopilotIntent")}getAllAgents(){return this._repository.getAllCodes("CopilotAgent")}getIntentParameter(e){return this._getIntentByParameterUId(e).pipe((0,o.map)(({intent:t,sourceCollection:s})=>s==="InputParameters"?t.InputParameters:t.OutputParameters),(0,o.map)(t=>t.find(s=>s.UId===e)))}getIntentParameters(e,t){return this._getDesignIntent(e).pipe((0,o.map)(s=>t==="InputParameters"?s.InputParameters:s.OutputParameters))}updateIntentParameter(e){return this._getIntentByParameterUId(e.UId).pipe((0,o.switchMap)(({intent:t,sourceCollection:s})=>(e.SourceCollection=s,this._applyParameterToIntent(t,e)?this._getSuccessResponseObservable():this._getSuccessResponseObservable())))}createIntentParameter(e){return this._getDesignIntent(e.Intent.value).pipe((0,o.map)(t=>((e.SourceCollection==="InputParameters"?t.InputParameters:t.OutputParameters).push(e),this._getSuccessResponse())))}deleteIntentParameter(e){return this._getIntentByParameterUId(e).pipe((0,o.map)(({intent:t,sourceCollection:s})=>{const r=s==="InputParameters"?t?.InputParameters:t?.OutputParameters,i=(r??[]).findIndex(a=>a.UId===e);return i!==-1&&r.splice(i,1),t}),(0,o.switchMap)(t=>this._repository.update(t)))}createIntent(e){return this._repository.create(e.UId).pipe((0,o.map)(t=>(Object.assign(t,e),t)),(0,o.switchMap)(t=>this._repository.update(t)))}updateIntent(e){return(0,o.forkJoin)([this._getDesignIntent(e.UId),this._repository.get(e.UId)]).pipe((0,o.map)(([t,s])=>{const r={...s,...t,...e};return this._setDesignIntent(r),r}),(0,o.switchMap)(t=>this._repository.update(t)))}createAction(e){return this._repository.get(e.Intent.value).pipe((0,o.map)(t=>(t.Actions.push(e),t)),(0,o.switchMap)(t=>this._repository.update(t)))}createSubIntent(e,t){return(0,o.forkJoin)([this._repository.get(e),this._repository.get(t)]).pipe((0,o.map)(([s,r])=>(s.SubIntents??=[],s.SubIntents.push(r),s)),(0,o.switchMap)(s=>this._repository.update(s)))}deleteSubIntent(e,t){return(0,o.forkJoin)([this._repository.get(e),this._repository.get(t)]).pipe((0,o.map)(([s,r])=>{const i=s.SubIntents?.findIndex(a=>a.UId===r.UId);return i>-1&&s.SubIntents.splice(i,1),s}),(0,o.switchMap)(s=>this._repository.update(s)))}getActionByUId(e){return this._loadIntentUIdByActionUId(e).pipe((0,o.switchMap)(t=>t?this._repository.get(t).pipe((0,o.map)(s=>s.Actions.filter(r=>r.Id===e)),(0,o.map)(s=>s[0])):(0,o.of)({})))}getIntentByActionUId(e){return this.getActionByUId(e).pipe((0,o.switchMap)(t=>t?.Intent?this.getIntent(t.Intent.value):(0,o.of)({})))}updateAction(e){return this._loadIntentUIdByActionUId(e.Id).pipe((0,o.switchMap)(t=>this._repository.get(t).pipe((0,o.switchMap)(s=>this._applyActionToIntent(s,e)?this._repository.update(s):(0,o.of)({})))))}generateActionCode(e,t=null){return this._copilotCodeGenerator.generate(e,t,{defaultNewCode:"Action"})}generateSkillCode(e,t=null){return this._copilotCodeGenerator.generate(e,t,{defaultNewCode:"Skill"})}generateAgentCode(e,t=null){return this._copilotCodeGenerator.generate(e,t,{defaultNewCode:"Agent"})}deleteAction(e,t){return this._repository.get(e).pipe((0,o.map)(s=>(s.Actions=s.Actions.filter(r=>r.Id!==t),s)),(0,o.switchMap)(s=>this._repository.update(s)))}static#e=this.\u0275fac=function(t){return new(t||dt)};static#t=this.\u0275prov=c.\u0275\u0275defineInjectable({token:dt,factory:dt.\u0275fac})}var vi;(function(n){n[n.None=0]="None",n[n.Self=1]="Self",n[n.ExplicitEntry=2]="ExplicitEntry",n[n.Delegated=4]="Delegated",n[n.FuncRoleFromOrgRole=8]="FuncRoleFromOrgRole",n[n.UpHierarchy=16]="UpHierarchy",n[n.AsManager=32]="AsManager",n[n.All=63]="All"})(vi||(vi={}));class Vc{constructor(e,t){this.operationType=e,this.rootSchemaName=t,N.checkArgumentEmpty("_operationType",e),N.checkArgumentEmpty("_rootSchemaName",t)}getMetadata(){return(0,X.classToPlain)(this,{exposeUnsetFields:!1,excludePrefixes:["_"]})}}class er extends Ae{static#e=this._instanceOfKey="devkit_BetweenFilter";static get _instanceOfKeys(){return[...Ae._instanceOfKeys,this._instanceOfKey]}constructor(e,t,s){super(Q.Between,j.Between,e),this.rightLessExpression=t?.clone(),this.rightGreaterExpression=s?.clone()}static fromJson(e,t,s){return new er(s.fromJson(e.leftExpression,t),s.fromJson(e.rightLessExpression,t),s.fromJson(e.rightGreaterExpression,t))}clone(){const e=new er(this.leftExpression,this.rightLessExpression,this.rightGreaterExpression);return e.isEnabled=this.isEnabled,e.trimDateTimeParameterToDate=this.trimDateTimeParameterToDate,e}toJson(){return{...super.toJson(),rightLessExpression:this.serializeItem(this.rightLessExpression),rightGreaterExpression:this.serializeItem(this.rightGreaterExpression)}}_getUsedColumns(){return[...super._getUsedColumns(),...this.rightLessExpression._getUsedColumns(),...this.rightGreaterExpression._getUsedColumns()]}}class ht extends Ae{static#e=this._instanceOfKey="devkit_ExistsFilter";static get _instanceOfKeys(){return[...Ae._instanceOfKeys,this._instanceOfKey]}constructor(e,t,s=j.Exists,r=!0){super(Q.Exists,s,e),this.subFilters=t?.clone(),this.isAggregative=r}static fromJson(e,t,s){const r=s.fromJson(e.leftExpression,t),i=e.subFilters;let a;return i&&(a=t.fromJson(e.subFilters)),new ht(r,a,e.comparisonType,e.isAggregative)}clone(){const e=new ht(this.leftExpression,this.subFilters,this.comparisonType,this.isAggregative);return e.isEnabled=this.isEnabled,e.trimDateTimeParameterToDate=this.trimDateTimeParameterToDate,e}toJson(){const e=super.toJson();return this.subFilters&&(e.subFilters=this.serializeItem(this.subFilters)),e}_getUsedColumns(){return[...super._getUsedColumns(),...this.subFilters?._getUsedColumns()??[]]}}class pt extends Ae{static#e=this._instanceOfKey="devkit_InFilter";static get _instanceOfKeys(){return[...Ae._instanceOfKeys,this._instanceOfKey]}constructor(e,t,s){super(Q.In,e,t),this.rightExpressions=s.map(r=>r?.clone())??[]}static fromJson(e,t,s){const r=e.rightExpressions??[];return new pt(e.comparisonType,s.fromJson(e.leftExpression,t),r.map(i=>s.fromJson(i,t)))}clone(){const e=new pt(this.comparisonType,this.leftExpression,this.rightExpressions);return e.isEnabled=this.isEnabled,e.trimDateTimeParameterToDate=this.trimDateTimeParameterToDate,e}toJson(){return{...super.toJson(),rightExpressions:this.rightExpressions.map(e=>this.serializeItem(e))}}_getUsedColumns(){const e=this.rightExpressions.map(t=>t._getUsedColumns()).flat();return[...super._getUsedColumns(),...e]}}class Ne extends Ae{static#e=this._instanceOfKey="devkit_IsNullFilter";static get _instanceOfKeys(){return[...Ae._instanceOfKeys,this._instanceOfKey]}constructor(e,t){[j.Is_null,j.Is_not_null].includes(e)||console.warn(`Invalid comparison type: ${j[e]} in IsNullFilter.`),super(Q.IsNull,Ne._getComparisonType(e),t),this.isNull=!0,this.isNull=this.comparisonType===j.Is_null}static _getComparisonType(e){return e===j.Is_not_null?e:j.Is_null}static fromJson(e,t,s){return new Ne(Ne._getComparisonType(e.comparisonType),s.fromJson(e.leftExpression,t))}clone(){const e=new Ne(Ne._getComparisonType(this.comparisonType),this.leftExpression);return e.isEnabled=this.isEnabled,e.trimDateTimeParameterToDate=this.trimDateTimeParameterToDate,e}}var Ot;(function(n){n[n.And=0]="And",n[n.Or=1]="Or"})(Ot||(Ot={}));var Lt;(function(n){n[n.None=0]="None",n[n.CurrentUser=1]="CurrentUser",n[n.CurrentUserContact=2]="CurrentUserContact",n[n.Yesterday=3]="Yesterday",n[n.Today=4]="Today",n[n.Tomorrow=5]="Tomorrow",n[n.PreviousWeek=6]="PreviousWeek",n[n.CurrentWeek=7]="CurrentWeek",n[n.NextWeek=8]="NextWeek",n[n.PreviousMonth=9]="PreviousMonth",n[n.CurrentMonth=10]="CurrentMonth",n[n.NextMonth=11]="NextMonth",n[n.PreviousQuarter=12]="PreviousQuarter",n[n.CurrentQuarter=13]="CurrentQuarter",n[n.NextQuarter=14]="NextQuarter",n[n.PreviousHalfYear=15]="PreviousHalfYear",n[n.CurrentHalfYear=16]="CurrentHalfYear",n[n.NextHalfYear=17]="NextHalfYear",n[n.PreviousYear=18]="PreviousYear",n[n.CurrentYear=19]="CurrentYear",n[n.PreviousHour=20]="PreviousHour",n[n.CurrentHour=21]="CurrentHour",n[n.NextHour=22]="NextHour",n[n.NextYear=23]="NextYear",n[n.NextNDays=24]="NextNDays",n[n.PreviousNDays=25]="PreviousNDays",n[n.NextNHours=26]="NextNHours",n[n.PreviousNHours=27]="PreviousNHours",n[n.PrimaryColumn=34]="PrimaryColumn",n[n.PrimaryDisplayColumn=35]="PrimaryDisplayColumn",n[n.PrimaryImageColumn=36]="PrimaryImageColumn",n[n.DayOfYearToday=37]="DayOfYearToday",n[n.DayOfYearTodayPlusDaysOffset=38]="DayOfYearTodayPlusDaysOffset",n[n.NextNDaysOfYear=39]="NextNDaysOfYear",n[n.PreviousNDaysOfYear=40]="PreviousNDaysOfYear",n[n.PrimaryColorColumn=41]="PrimaryColorColumn"})(Lt||(Lt={}));class un extends ve{static#e=this._instanceOfKey="devkit_FunctionExpression";static get _instanceOfKeys(){return[...ve._instanceOfKeys,this._instanceOfKey]}constructor(e){super(e),this.expressionType=ee.Function}}var re;(function(n){n[n.None=0]="None",n[n.Macros=1]="Macros",n[n.Aggregation=2]="Aggregation",n[n.DatePart=3]="DatePart",n[n.Length=4]="Length",n[n.Window=5]="Window",n[n.DateAdd=6]="DateAdd",n[n.DateDiff=7]="DateDiff"})(re||(re={}));class mt extends un{static#e=this._instanceOfKey="devkit_MacrosFunctionExpression";static get _instanceOfKeys(){return[...un._instanceOfKeys,this._instanceOfKey]}constructor(e){super(e),this.functionType=re.Macros,this.macrosType=e?.macrosType,this.functionArgument=e?.functionArgument}static fromJson(e,t,s){const r=t&&s&&e.functionArgument?s.fromJson(e.functionArgument,t):void 0;return new mt({functionArgument:r,macrosType:e.macrosType})}clone(){return new mt(this)}_getUsedColumns(){return this.functionArgument?._getUsedColumns()??[]}}class se extends js{static#e=this._instanceOfKey="devkit_FilterGroup";static get _instanceOfKeys(){return[...js._instanceOfKeys,this._instanceOfKey]}get items(){const e={};return this.filters.forEach((t,s)=>{e[s]=this.serializeItem(t)}),e}constructor(e=Ot.And,t){super(Q.FilterGroup),this.filters=new Map,this.logicalOperation=e,this.rootSchemaName=t}static fromJson(e,t){const s=e.logicalOperation,r=new se(s||Ot.And,e.rootSchemaName);return Object.entries(e.items).forEach(([i,a])=>{r.add(t.fromJson(a),i)}),r}toJson(){const e={};return e.filterType=this.filterType,e.isEnabled=this.isEnabled,e.logicalOperation=this.logicalOperation,e.trimDateTimeParameterToDate=this.trimDateTimeParameterToDate,e.items=this.items,this.rootSchemaName&&(e.rootSchemaName=this.rootSchemaName),e}_createParameterValueExpressions(e){return e.map(t=>new $({value:t}))}getItemByIndex(e){return this.items[Object.keys(this.items)[e]]}addSchemaColumnFilterWithParameter(e,t,s,r){const i=new k({columnPath:t}),a=new $({value:s}),l=new ue(e,i,a);this.add(l,r)}addSchemaColumnInFilterWithParameters(e,t,s,r){const i=new k({columnPath:t}),a=this._createParameterValueExpressions(s),l=new pt(e,i,a);this.add(l,r)}addPrimarySchemaColumnInFilter(e,t){const s=new mt({macrosType:Lt.PrimaryColumn}),r=this._createParameterValueExpressions(e),i=new pt(j.Equal,s,r);this.add(i,t)}addSchemaColumnIsNullFilter(e,t){const s=new k({columnPath:e}),r=new Ne(j.Is_null,s);this.add(r,t)}addSchemaColumnIsNotNullFilter(e,t){const s=new k({columnPath:e}),r=new Ne(j.Is_not_null,s);this.add(r,t)}addSchemaColumnBetweenFilterWithParameters(e,t,s,r){const i=new k({columnPath:e}),a=new $({value:t}),l=new $({value:s}),d=new er(i,a,l);this.add(d,r)}addExistsFilter(e,t,s){const r=new k({columnPath:e}),i=new ht(r,t);this.add(i,s)}addNotExistsFilter(e,t,s){const r=new k({columnPath:e}),i=new ht(r,t,j.Not_exists);this.add(i,s)}add(e,t){N.checkArgumentEmpty("filter",e);const s=t||O();this.filters.set(s,e)}clone(){const e=new se(this.logicalOperation,this.rootSchemaName);return this.filters.forEach((t,s)=>{e.filters.set(s,t.clone())}),e.isEnabled=this.isEnabled,e.trimDateTimeParameterToDate=this.trimDateTimeParameterToDate,e}_getUsedColumns(){const e=[];return this.filters.forEach(t=>{let s=t._getUsedColumns?t._getUsedColumns():[];s=s.map(r=>({path:r.path,schemaName:r.schemaName??this.rootSchemaName})),e.push(...s)}),e}}(0,m.__decorate)([(0,X.Exclude)(),(0,m.__metadata)("design:type",Object)],se.prototype,"filters",void 0),(0,m.__decorate)([(0,X.Expose)(),(0,m.__metadata)("design:type",Object),(0,m.__metadata)("design:paramtypes",[])],se.prototype,"items",null);class ln extends Vc{constructor(e,t){super(e,t),this.filters=new se}clearFilters(){this.filters.filters.clear()}getMetadata(){return{...super.getMetadata(),filters:this.filters.toJson()}}_getUsedColumns(){const e=this.filters._getUsedColumns();return e.forEach(t=>{t.schemaName||(t.schemaName=this.rootSchemaName)}),e}}(0,m.__decorate)([(0,X.Exclude)(),(0,m.__metadata)("design:type",Object)],ln.prototype,"filters",void 0);var Bt;(function(n){n[n.Select=0]="Select",n[n.Insert=1]="Insert",n[n.Update=2]="Update",n[n.Delete=3]="Delete"})(Bt||(Bt={}));class Ei extends ln{constructor(e){super(Bt.Update,e),this._columnValues=new Map,this.isForceUpdate=!1}get columnValues(){return{items:(0,X.classToPlain)(this._columnValues)}}addColumn(e,t,s){N.checkArgumentEmpty("columnName",e),this._columnValues.set(e,new $({value:t,dataValueType:s}))}}(0,m.__decorate)([(0,X.Expose)(),(0,m.__metadata)("design:type",Object),(0,m.__metadata)("design:paramtypes",[])],Ei.prototype,"columnValues",null);class Mi extends Vc{constructor(e){super(Bt.Insert,e),this._columnValues=new Map}get columnValues(){return{items:(0,X.classToPlain)(this._columnValues)}}addColumn(e,t,s){N.checkArgumentEmpty("columnName",e),this._columnValues.set(e,new $({value:t,dataValueType:s}))}}(0,m.__decorate)([(0,X.Expose)(),(0,m.__metadata)("design:type",Object),(0,m.__metadata)("design:paramtypes",[])],Mi.prototype,"columnValues",null);class xc extends ln{constructor(e){super(Bt.Delete,e)}}var Ve;(function(n){n.None="",n.Count="Count",n.Sum="Sum",n.Avg="Avg",n.Min="Min",n.Max="Max",n.TopOne="TopOne"})(Ve||(Ve={}));class Ad{constructor(){this._cache=new Map}setToCache(e,t){this._cache.set(e,t)}deleteFromCache(e){this._cache.delete(e)}getFromCache(e){return this._cache.get(e)}}class vd extends Ad{constructor(){super(...arguments),this.httpClient=(0,c.inject)(D.HttpClient)}_createCacheKey(e,t={}){return`${e}!${JSON.stringify(t)}`}_cacheRequest(e,t){const s=this.getFromCache(t);if((0,v.isUndefined)(s)){const r=e().pipe((0,o.shareReplay)({bufferSize:1,refCount:!1}));return this.setToCache(t,r),r}return s}_getMethodEndpoint(e){return`${this.serviceEndpoint.replace(/\/$/,"")}/${e}`}executePostRequestWithCache(e,t={}){const s=this._getMethodEndpoint(e),r=this._createCacheKey(e,t),i=()=>this.httpClient.post(s,t);return this._cacheRequest(i,r)}executeGetRequestWithCache(e){const t=this._getMethodEndpoint(e),s=this._createCacheKey(e),r=()=>this.httpClient.get(t);return this._cacheRequest(r,s)}resetCache(e,t={}){const s=this._createCacheKey(e,t);this.deleteFromCache(s)}}let Ii=class zr extends vd{constructor(){super(...arguments),this.serviceEndpoint="rest/RightsService"}_getSchemaDeleteRights(e){return this.executePostRequestWithCache("GetSchemaDeleteRights",e).pipe((0,u.map)(t=>({result:t&&t.GetSchemaDeleteRightsResult?.length===0,message:t?.GetSchemaDeleteRightsResult})))}_getCanDeleteByRecord(e){const t=`${this.serviceEndpoint}/GetCanDelete`;return this.httpClient.post(t,e).pipe((0,u.map)(s=>({result:s&&s.GetCanDeleteResult?.length===0,message:s?.GetCanDeleteResult})))}_getCanAddData(e){const t=e.map(r=>this.getFromCache(`GetCanAdd_${r}`)).filter(r=>!!r),s=e.filter(r=>!t.find(i=>i.schemaName===r));return{cachedResult:t,requestSchemaNames:s}}getCanExecuteOperation(e){return this.getCanExecuteOperations([e]).pipe((0,u.mergeMap)(t=>(0,o.of)((t||[])[0])))}getCanExecuteOperations(e){return(0,o.combineLatest)(e.map(t=>this.executePostRequestWithCache("GetCanExecuteOperation",{operation:t}).pipe((0,u.map)(s=>s?.GetCanExecuteOperationResult))))}getIsTechnicalUser(){const e=`${this.serviceEndpoint}/GetIsTechnicalUser`;return this.httpClient.post(e,null).pipe((0,u.map)(t=>t?.GetIsTechnicalUserResult))}getCanAdd(e){const t="GetCanAdd",{cachedResult:s,requestSchemaNames:r}=this._getCanAddData(e);if(!r.length)return(0,o.of)(s);const i=`${this.serviceEndpoint}/${t}`;return this.httpClient.post(i,r).pipe((0,u.map)(a=>a.map(l=>({schemaName:l.Key,result:(0,v.isEmpty)(l.Value),errorMessage:l.Value}))),(0,u.tap)(a=>a.forEach(l=>this.setToCache(`${t}_${l.schemaName}`,l))),(0,u.map)(a=>a.concat(s)))}getCanEdit(e){const t=`${this.serviceEndpoint}/GetCanEdit`;return this.httpClient.post(t,e).pipe((0,u.map)(s=>({result:s&&s.GetCanEditResult?.length===0,message:s?.GetCanEditResult})))}getCanDelete(e){if(e.primaryColumnValue)return this._getCanDeleteByRecord(e);const t={schemaName:e.schemaName};return this._getSchemaDeleteRights(t)}copyRights(e){const t=`${this.serviceEndpoint}/CopyRights`;return this.httpClient.post(t,e)}getCanEditColumns(e){return this.executePostRequestWithCache("GetCanEditColumns",e).pipe((0,u.map)(t=>{const s=t?.GetCanEditColumnsResult??[],r={};return s.forEach(i=>r[i.Key]=i.Value),r}))}getCanReadColumns(e){return this.executePostRequestWithCache("GetCanReadColumns",e).pipe((0,u.map)(t=>{const s=t?.GetCanReadColumnsResult??[],r={};return s.forEach(i=>r[i.Key]=i.Value),r}))}getCanExecuteEntityOperation(e,t){const s=`${this.serviceEndpoint}/GetCanExecuteEntityOperation`,r={entitySchemaName:e,entityOperationCode:t};return this.httpClient.post(s,r).pipe((0,u.mergeMap)(i=>(0,o.of)(i?.GetCanExecuteEntityOperationResult)))}getAclGranted(e){return(0,o.firstValueFrom)(this.executeGetRequestWithCache("GetReadDeniedEntityList")).then(t=>!t.GetReadDeniedEntityListResult.includes(e),t=>(console.error(`Error while making request to ReadDeniedEntityList: ${t}`),!0))}applyChanges(e){const t=`${this.serviceEndpoint}/ApplyChanges`;return(0,o.firstValueFrom)(this.httpClient.post(t,e)).then(()=>!0,s=>{throw console.error(`Error while making request to ApplyChanges: ${s}`),s})}getRecordRights(e){return(0,o.firstValueFrom)(this.executePostRequestWithCache("GetRecordRights",e)).then(t=>t,t=>{throw console.error(`Error while making request to GetRecordRights: ${t}`),t})}static#e=this.\u0275fac=(()=>{let e;return function(s){return(e||(e=c.\u0275\u0275getInheritedFactory(zr)))(s||zr)}})();static#t=this.\u0275prov=c.\u0275\u0275defineInjectable({token:zr,factory:zr.\u0275fac,providedIn:"root"})};Ii=(0,m.__decorate)([at({requestType:"crt.RightsService"})],Ii);class xe{static#e=this.\u0275fac=function(t){return new(t||xe)};static#t=this.\u0275prov=c.\u0275\u0275defineInjectable({token:xe,factory:xe.\u0275fac})}function xm(n){return n=n||new Date,new Date(n.getFullYear(),n.getMonth(),n.getDate())}function Om(n){return n=n||new Date,new Date(n.getFullYear(),n.getMonth(),n.getDate(),23,59,59,999)}function Oc(n){if(!n)return null;function e(){throw new Error(`String "${n}" is not a valid serialized date.`)}typeof n!="string"&&e();const[t,s]=n.split("T");if(s&&(s[s.length-1]==="Z"||s.indexOf("+")!==-1||s.indexOf("-")!==-1)){const i=Date.parse(n);return isNaN(i)&&e(),new Date(i)}try{const[i,a,l]=t.split("-"),[d,h,p]=s.split(":"),[f,C]=p.split(".");return new Date(parseInt(i),parseInt(a)-1,parseInt(l),parseInt(d),parseInt(h),parseInt(f),parseInt(C))}catch{e()}}function Lm(n,e){e==null&&(e=0),n.setSeconds(n.getSeconds()+e*3600)}function Bm(n,e,t){const s=t||{hour:"2-digit",minute:"2-digit"};return new Intl.DateTimeFormat(e.sysCultureName,s).format(n)}function Ri(n,e){switch(N.checkArgumentEmpty("dataValueType",e),e){case y.r.Date:case y.r.Time:case y.r.DateTime:return Oc(n);default:return n}}function Ed(n,e){if(ValidationUtilities.checkArgumentEmpty("columnValueTypes",e),!n)return n;const t={};return Object.keys(n).forEach(s=>{const r=n[s];t[s]=e[s]?Ri(r,e[s]):r}),t}function km(n,e){return ValidationUtilities.checkArgumentEmpty("columnValueTypes",e),n&&n.map(t=>t&&Ed(t,e))}var kt;(function(n){n.Entity="Entity",n.ClientUnit="ClientUnit",n.Intent="Intent"})(kt||(kt={}));class Je{constructor(){this._phoneUtil=null,this._phoneNumberType=null,this._phoneMaskOverrides=new Map([["id",["+{62} 000 000 000 000","+{62} 000 000 00"]]])}getAllPhoneMasks(e){let t=[];for(const r in this._phoneNumberType)if(isNaN(Number(r))){const i=this._phoneUtil.getExampleNumberForType(e,this._phoneNumberType[r]);if(!i)continue;const a=i.getCountryCode().toString(),l=this._phoneUtil.format(i,null),d=`+{${a.replace("0","\\0")}} ${l.replace(/-/g," ").replace(/\d/g,"0")}`;t.find(h=>h===d)||t.push(d)}const s=this._phoneMaskOverrides.get(e);return s&&(t.push(...s),t=Array.from(new Set(t))),t}initialize(){var e=this;return(0,S.A)(function*(){if(!(e._phoneUtil&&e._phoneNumberType))try{const t=yield b.e(1588).then(b.t.bind(b,1588,23));e._phoneUtil=t.PhoneNumberUtil.getInstance(),e._phoneNumberType=t.PhoneNumberType}catch(t){throw console.error("Error loading google-libphonenumber:",t),t}})()}isValidPhoneNumber(e){try{const t=this._phoneUtil.parse(e);return this._phoneUtil.isValidNumber(t)}catch{return!1}}static#e=this.\u0275fac=function(t){return new(t||Je)};static#t=this.\u0275prov=c.\u0275\u0275defineInjectable({token:Je,factory:Je.\u0275fac,providedIn:"root"})}const wi={ShortTextCaption:50,MediumTextCaption:250,LongTextCaption:500},dn={Integer:{max:2147483647,min:-2147483647},Float:{max:6999999999999999e-2,min:-6999999999999999e-2}};function Md(n){let e;switch(n){case y.r.SHORT_TEXT:e=wi.ShortTextCaption;break;case y.r.PHONE_TEXT:case y.r.MEDIUM_TEXT:e=wi.MediumTextCaption;break;case y.r.LONG_TEXT:case y.r.EMAIL_TEXT:e=wi.LongTextCaption;break;default:return}return{maxLength:e}}function Id(n){if([y.r.Float,y.r.FLOAT1,y.r.FLOAT2,y.r.FLOAT3,y.r.FLOAT4,y.r.FLOAT8,y.r.Money].includes(n))return{minValue:dn.Float.min,maxValue:dn.Float.max};if(n===y.r.Integer)return{minValue:dn.Integer.min,maxValue:dn.Integer.max}}class tr{get isDate(){return this.dataValueType===y.r.Date||this.dataValueType===y.r.DateTime||this.dataValueType===y.r.Time}get isImage(){return this.dataValueType===y.r.IMAGELOOKUP||this.dataValueType===y.r.Image}get isLookup(){return this.dataValueType===y.r.Lookup}set isSystem(e){this._isSystem=e}get isSystem(){return this._isSystem}get isAggregate(){return this.attributeType===x.AggregationAttribute?!0:this.attributeType===x.FunctionAttribute&&this.functionConfig?.type==="aggregation"}constructor(e){if(this._isSystem=!1,e!=null){this.name=e.name,this.caption=e.caption,this.path=e.path,this.dataValueType=e.dataValueType,e.validators&&(this.validators={...e.validators||{}});const t=e.defaultValue;t&&(t instanceof o.Observable?this.defaultValue=t.pipe((0,u.map)(s=>this._getConvertDefaultValue(s))):this.defaultValue=(0,o.of)(this._getConvertDefaultValue(t))),this.defaultValueSchema=e.defaultValueSchema,this.isValueCloneable=e.isValueCloneable,this.attributeType=e.attributeType,this.referenceSchemaName=e.referenceSchemaName,this.functionConfig=e.functionConfig,this.aggregationConfig=e.aggregationConfig,this.isMasked=e.isMasked,this.isFormatValidated=e.isFormatValidated,this.isSensitiveData=e.isSensitiveData,this.isValueMasked=e.isValueMasked,this.valueMaskingSettings=e.valueMaskingSettings,this.usageType=e.usageType,this.isRequired=e.isRequired,this.lookupMode=e.lookupMode,this.isSystem=!!e.isSystem}}_getConvertDefaultValue(e){if(this.isDate)if(e instanceof Date){const t=new Date;return t.setTime(e.getTime()),t}else return e;else return typeof e=="object"?{...e}:e}clone(){return new tr(this)}addDefaultValidators(){const e=this.validators??{};this.isRequired&&(e["crt.Required"]={type:"crt.Required"}),!this.validators&&Object.keys(e).length>0&&(this.validators=e)}}class Lc{constructor(e=null,t,s){e==null?this._dataSchema=new Ke:this._dataSchema=t?.useClone?e.clone():e.createChild(),this._phoneValidationService=s||c.Injector.create({providers:[{provide:Je,useClass:Je}]}).get(Je)}_createDataSchemaAttributeByConfig(e){const t=new tr;return t.name=e.name,t.caption=e.caption,t.path=e.path,t.dataValueType=e.dataValueType,t.validators={...e.validators||{}},t.defaultValue=(0,o.of)(typeof e.defaultValue=="object"?{...e.defaultValue}:e.defaultValue),t.defaultValueSchema=e.defaultValueSchema,t.isValueCloneable=e.isValueCloneable,t.attributeType=e.attributeType,t.referenceSchemaName=e.referenceSchemaName,t.functionConfig=e.functionConfig,t.aggregationConfig=e.aggregationConfig,t.usageType=e.usageType,t.isMasked=e.isMasked,t.isFormatValidated=e.isFormatValidated,t.isSensitiveData=e.isSensitiveData,t.isValueMasked=e.isValueMasked,t.valueMaskingSettings=e.valueMaskingSettings,t.isRequired=e.isRequired,t.lookupMode=e.lookupMode,t.isSystem=e.isSystem??!1,t}setEntitySchemaColumnValidators(e,t){return e.isRequired&&this.setAttributeRequiredValidator(t),this.setAttributeTextDataValueTypeValidator(t,e.dataValueType).setAttributeNumberDataValueTypeValidator(t,e.dataValueType).setAttributePhoneDataValueTypeValidator(t,e)}setAttributeValidator(e,t,s){const r=this._dataSchema.attributes.find(a=>a.name===e),i=r.validators||{};return i[t]=s,r.validators=i,this}setAttributeRequiredValidator(e){return this.setAttributeValidator(e,"crt.Required",{type:"crt.Required"})}setAttributeMaxLengthValidator(e,t){return this.setAttributeValidator(e,"crt.MaxLength",{type:"crt.MaxLength",params:{maxLength:t}})}setAttributeTextDataValueTypeValidator(e,t){const s=Md(t);return s?this.setAttributeMaxLengthValidator(e,s.maxLength):this}setAttributeMinValueValidator(e,t){return this.setAttributeValidator(e,"crt.Min",{type:"crt.Min",params:{min:t}})}setAttributeMaxValueValidator(e,t){return this.setAttributeValidator(e,"crt.Max",{type:"crt.Max",params:{max:t}})}setAttributeMinMaxValidator(e,t,s){return this.setAttributeMinValueValidator(e,t).setAttributeMaxValueValidator(e,s)}setAttributeNumberDataValueTypeValidator(e,t){const s=Id(t);return s&&this.setAttributeMinMaxValidator(e,s.minValue,s.maxValue),this}setAttributePhoneDataValueTypeValidator(e,t){return[y.r.PHONE_TEXT].includes(t.dataValueType)&&t.isMasked&&(this._phoneValidationService.initialize().then(),this.setAttributeValidator(e,"crt.PhoneNumber",{type:"crt.PhoneNumber"})),this}setAttributesDefaultValue(e){return this._dataSchema.attributes.forEach(t=>{t.defaultValue=e.pipe((0,u.map)(s=>s[t.name]))}),this}addAttribute(e,t){const{name:s,caption:r,dataValueType:i,isValueCloneable:a,referenceSchemaName:l,isMasked:d,isFormatValidated:h,usageType:p,isRequired:f,isSensitiveData:C,isValueMasked:B,valueMaskingSettings:ne}=e,I=new tr;return I.name=t.attributeName||s,I.path=t.attributePath||s,I.caption=r,I.dataValueType=i,I.isValueCloneable=!!a,I.attributeType=t.attributeType||x.OwnAttribute,I.referenceSchemaName=l,I.validators={},I.isMasked=d,I.isFormatValidated=h,I.isSensitiveData=C,I.isValueMasked=B,I.valueMaskingSettings=ne,I.usageType=p,I.isRequired=f,I.defaultValueSchema=e.defaultValueSchema,I.lookupMode=e.lookupMode,I.isSystem=(0,v.compact)([this._dataSchema.createdByAttributeName,this._dataSchema.createdOnAttributeName,this._dataSchema.modifiedByAttributeName,this._dataSchema.modifiedOnAttributeName,this._dataSchema.primaryAttributeName,"ProcessListeners"]).includes(I.name),this._dataSchema.addAttribute(I),t.attributeType===x.OwnAttribute&&this.setEntitySchemaColumnValidators(e,I.name),t.attributeType===x.AggregationAttribute&&(I.aggregationConfig=t.aggregationConfig),t.attributeType===x.FunctionAttribute&&(I.functionConfig=t.functionConfig),this}addOwnAttribute(e){return this.addAttribute(e,{attributeType:x.OwnAttribute})}setEntitySchema(e){return this._dataSchema.dataSourceConfig={type:"crt.EntityDataSource",config:{entitySchemaName:e.name}},this._dataSchema.name=e.name,this._dataSchema.type=kt.Entity,this._dataSchema.primaryAttributeName=e.getPrimaryColumn()?.name,this._dataSchema.primaryDisplayAttributeName=e.getPrimaryDisplayColumn()?.name,this._dataSchema.primaryColorAttributeName=e.getPrimaryColorColumn()?.name,this._dataSchema.hierarchyAttributeName=e.getHierarchyColumn()?.name,this._dataSchema.caption=e.caption,this._dataSchema.createdByAttributeName=e.columns.find(t=>t.uId===e.createdByColumnUId)?.name,this._dataSchema.createdOnAttributeName=e.columns.find(t=>t.uId===e.createdOnColumnUId)?.name,this._dataSchema.modifiedByAttributeName=e.columns.find(t=>t.uId===e.modifiedByColumnUId)?.name,this._dataSchema.modifiedOnAttributeName=e.columns.find(t=>t.uId===e.modifiedOnColumnUId)?.name,this._dataSchema.clearAttributes(),e.columns.forEach(t=>{this.addOwnAttribute(t)}),this}setDataSchemaConfig(e){return this._dataSchema.name=e.name,this._dataSchema.type=e.type,this._dataSchema.caption=typeof e.caption=="string"?e.caption:{...e.caption},this._dataSchema.primaryAttributeName=e.primaryAttributeName,this._dataSchema.primaryDisplayAttributeName=e.primaryDisplayAttributeName,this._dataSchema.dataSourceConfig={...e.dataSourceConfig,config:{...e.dataSourceConfig?.config}},(e.attributes||[]).forEach(s=>{const r=this._createDataSchemaAttributeByConfig(s);this._dataSchema.addAttribute(r)}),this}build(){return this._dataSchema.clone()}}class Rd extends Ci{get entitySchemaName(){return this._entitySchemaName}constructor(e,t){super(e,`Entity schema with name '${t}' not found.`),this._entitySchemaName=t}}class wd extends Ci{constructor(e){super(e,`Entity schema name for data source ${e.dataSourceName} is not provided`)}}class Pd extends Error{constructor(e){super(`Item with key '${e}' does not exist.`)}}var Ft;(function(n){n[n.None=0]="None",n[n.Asc=1]="Asc",n[n.Desc=2]="Desc"})(Ft||(Ft={}));class Oe{constructor(e){this.orderDirection=Ft.None,this.orderPosition=-1,this.isVisible=!0,this.expression=e}withOrdering(e,t){return N.checkArgumentEmpty("orderDirection",e),N.checkArgumentEmpty("orderPosition",t),N.checkArgumentOutOfRange("orderPosition",t,{begin:-1}),this.orderDirection=e,this.orderPosition=t,this}withOptions(e){return N.checkArgumentEmpty("options",e),this.isVisible=e.isVisible??!0,this}withCaption(e){return N.checkArgumentEmpty("caption",e),this.caption=e,this}_getUsedColumns(){return this.expression._getUsedColumns()}}class Dd extends Oe{constructor(e){super(new k({columnPath:e}))}}class sr extends ve{static#e=this._instanceOfKey="devkit_SubQueryExpression";static get _instanceOfKeys(){return[...ve._instanceOfKeys,this._instanceOfKey]}constructor(e){super(e),this.expressionType=ee.SubQuery,this.columnPath=e?.columnPath;const t=e?.subFilters;typeof t?.clone=="function"?this.subFilters=t.clone():t?(this.subFilters=new se(t.logicalOperation,t.rootSchemaName),this.subFilters.isEnabled=t.isEnabled,Object.entries(t.items).forEach(([s,r])=>{this.subFilters.add(r,s)})):this.subFilters=t,this.subOrderDirection=e.subOrderDirection,this.subOrderColumn=e.subOrderColumn}static fromJson(e,t){return new sr({columnPath:e.columnPath,subFilters:t.fromJson(e.subFilters),subOrderDirection:e.subOrderDirection,subOrderColumn:e.subOrderColumn})}clone(){return new sr(this)}toJson(){const e=super.toJson();return this.subFilters&&(e.subFilters=this.serializeItem(this.subFilters)),e}_getUsedColumns(){return[{path:this.columnPath},...this.subFilters?._getUsedColumns()??[]]}}class rr extends sr{static#e=this._instanceOfKey="devkit_AggregationSubQueryExpression";static get _instanceOfKeys(){return[...sr._instanceOfKeys,this._instanceOfKey]}constructor(e){super(e),this.aggregationType=e?.aggregationType,this.functionType=e?.functionType}static fromJson(e,t){const s=super.fromJson(e,t);return new rr({aggregationType:e.aggregationType,functionType:e.functionType,...s})}clone(){return new rr(this)}}class Td extends Oe{constructor(e,t,s,r,i){super(new rr({aggregationType:t,columnPath:e,subFilters:s,subOrderDirection:r,subOrderColumn:i}))}}class Nd extends Oe{constructor(e,t){super(new $({value:e,dataValueType:t}))}}class nr extends ve{static#e=this._instanceOfKey="devkit_ArithmeticExpression";static get _instanceOfKeys(){return[...ve._instanceOfKeys,this._instanceOfKey]}constructor(e){super(e),this.expressionType=ee.ArithmeticOperation,this.arithmeticOperation=e?.arithmeticOperation,this.leftArithmeticOperand=e?.leftArithmeticOperand.clone(),this.rightArithmeticOperand=e?.rightArithmeticOperand.clone()}static fromJson(e,t,s){const r=s?.fromJson(e.leftArithmeticOperand,t),i=s?.fromJson(e.rightArithmeticOperand,t),a={leftArithmeticOperand:r,rightArithmeticOperand:i,arithmeticOperation:e.arithmeticOperation,isBlock:e.isBlock};return new nr(a)}clone(){return new nr(this)}_getUsedColumns(){return[...this.leftArithmeticOperand._getUsedColumns(),...this.rightArithmeticOperand._getUsedColumns()]}}class Vd extends Oe{constructor(e,t,s){super(new nr({arithmeticOperation:e,leftArithmeticOperand:t,rightArithmeticOperand:s}))}}class xd extends Oe{constructor(e){super(new mt({macrosType:e}))}}class Ze extends un{static#e=this._instanceOfKey="devkit_ArgumentFunctionExpression";static get _instanceOfKeys(){return[...un._instanceOfKeys,this._instanceOfKey]}constructor(e){super(e),this.functionArgument=e?.functionArgument?.clone()}toJson(){const e=super.toJson();return this.functionArgument&&(e.functionArgument=this.serializeItem(this.functionArgument)),e}_getUsedColumns(){return this.functionArgument?._getUsedColumns()??[]}}class ft extends Ze{static#e=this._instanceOfKey="devkit_DatePartFunctionExpression";static get _instanceOfKeys(){return[...Ze._instanceOfKeys,this._instanceOfKey]}constructor(e){super(e),this.functionType=re.DatePart,this.datePartType=e?.datePartType}static fromJson(e,t,s){const r=s?.fromJson(e.functionArgument,t),i=e.datePartType;return new ft({functionArgument:r,datePartType:i,isBlock:e.isBlock})}clone(){return new ft(this)}}class Od extends Oe{constructor(e,t){super(new ft({datePartType:e,functionArgument:t}))}get datePartType(){return this.expression?.datePartType}}class ir extends Ze{static#e=this._instanceOfKey="devkit_AggregationFunctionExpression";static get _instanceOfKeys(){return[...Ze._instanceOfKeys,this._instanceOfKey]}constructor(e){super(e),this.functionType=re.Aggregation,this.aggregationType=e?.aggregationType,this.aggregationEvalType=e?.aggregationEvalType}static fromJson(e,t,s){const r=s?.fromJson(e.functionArgument,t),i=e.aggregationType,a=e.aggregationEvalType;return new ir({functionArgument:r,aggregationType:i,aggregationEvalType:a,isBlock:e.isBlock})}clone(){return new ir(this)}}class Ld extends Oe{constructor(e,t,s){super(new ir({aggregationType:e,aggregationEvalType:t,functionArgument:s}))}}class ar extends Ze{static#e=this._instanceOfKey="devkit_LengthFunctionExpression";static get _instanceOfKeys(){return[...Ze._instanceOfKeys,this._instanceOfKey]}constructor(e){super(e),this.functionType=re.Length}static fromJson(e,t,s){const r=s?.fromJson(e.functionArgument,t);return new ar({functionArgument:r,isBlock:e.isBlock})}clone(){return new ar(this)}}class Bd extends Oe{constructor(e){super(new ar({functionArgument:e}))}}class or extends Ze{static#e=this._instanceOfKey="devkit_WindowFunctionExpression";static get _instanceOfKeys(){return[...Ze._instanceOfKeys,this._instanceOfKey]}constructor(e){super(e),this.functionType=re.Window}static fromJson(e,t,s){const r=s?.fromJson(e.functionArgument,t);return new or({functionArgument:r,isBlock:e.isBlock})}clone(){return new or(this)}}class kd extends Oe{constructor(e){super(new or({functionArgument:e}))}}var gt;(function(n){n[n.None=0]="None",n[n.All=1]="All",n[n.Distinct=2]="Distinct"})(gt||(gt={}));class cr extends ln{constructor(e){super(Bt.Select,e),this._columns=new Map,this.isDistinct=!1,this.rowCount=-1,this.rowsOffset=-1,this.useLocalization=!0,this.useRecordDeactivation=!1,this._getIsPageable=()=>this.rowCount>0&&this.rowsOffset>-1}_internalAddColumn(e,t){this._columns.has(e)||this._columns.set(e,t)}getColumn(e){if(!this._columns.has(e))throw new Pd(e);return this.findColumn(e)}findColumn(e){return this._columns.get(e)}getMetadata(){return{...super.getMetadata(),columns:{items:(0,X.classToPlain)(this._columns,{exposeUnsetFields:!1,excludePrefixes:["_"]})},allColumns:!1,isDistinct:this.isDistinct,ignoreDisplayValues:!1,rowCount:this.rowCount,rowsOffset:this.rowsOffset,adminUnitRoleSources:this.adminUnitRoleSources,isPageable:this._getIsPageable(),conditionalValues:this.conditionalValues?this.conditionalValues:null,isHierarchical:!1,hierarchicalMaxDepth:0,hierarchicalColumnName:null,hierarchicalColumnValue:null,useLocalization:this.useLocalization,useRecordDeactivation:this.useRecordDeactivation}}addColumn(e,t){return this._internalAddColumn(t,e),e}addSchemaColumn(e,t){N.checkArgumentEmpty("columnPath",e);const s=new Dd(e);return this._internalAddColumn(t||e,s),s}addAggregationSubQueryColumn(e,t,s,r){const i=new Td(e,t,s.filter,s.sortByDirection,s.sortByColumn);return this._internalAddColumn(r||e,i),i}addParameterColumn(e,t,s){const r=new Nd(e,t);return this._internalAddColumn(s,r),r}addArithmeticColumn(e,t,s,r){const i=new Vd(e,t,s);return this._internalAddColumn(r,i),i}addMacrosFunctionColumn(e,t){const s=new xd(e);return this._internalAddColumn(t,s),s}addDatePartFunctionColumn(e,t,s){const r=new k({columnPath:e}),i=new Od(t,r);return this._internalAddColumn(s,i),i}addAggregationFunctionColumn(e,t,s,r=gt.None){const i=new k({columnPath:e}),a=new Ld(t,r,i);return this._internalAddColumn(s,a),a}addLengthFunctionColumn(e,t){const s=new k({columnPath:e}),r=new Bd(s);return this._internalAddColumn(t,r),r}addWindowFunctionColumn(e,t,s,r=gt.None){const i=new ir({aggregationType:t,aggregationEvalType:r,functionArgument:new k({columnPath:e})}),a=new kd(i);return this._internalAddColumn(s,a),a}_getUsedColumns(){const e=[];return this._columns.forEach(t=>{e.push(...t._getUsedColumns())}),e.forEach(t=>{t.schemaName||(t.schemaName=this.rootSchemaName)}),[...e,...super._getUsedColumns()]}}function Fd(n){switch(n){case"asc":return Ft.Asc;case"desc":return Ft.Desc;default:return Ft.None}}const Bc=new c.InjectionToken("A factory of entity schema column appender"),kc=new c.InjectionToken("A factory of data schema to data source attribute converter");class jd{_getExpressionColumnPath(e,t){const s="[{referenceSchemaName}:{referenceAttributeName}:{attributeName}]",r=e.relationData.map(h=>ze.String.format(s,h)).join("."),i=e.attributePath.split("."),a=i.length>1?"{ownColumnPath}.{relationString}.{columnPath}":"{relationString}.{columnPath}";i.pop();const d={ownColumnPath:i.join("."),relationString:r,columnPath:t};return ze.String.format(a,d)}_updateFilterLeftExpression(e,t){switch(e.expressionType){case ee.SchemaColumn:e.columnPath=this._getExpressionColumnPath(t,e.columnPath);break;case ee.SubQuery:e.columnPath=this._getExpressionColumnPath(t,e.columnPath);break;case ee.Function:e.functionType!==re.Macros&&this._updateFilterLeftExpression(e.functionArgument,t);break}}_updateRelatedFilterGroup(e,t){e instanceof se?this._updateRelatedFilterGroupInstance(e,t):this._updateRelatedFilterGroupObject(e,t)}_updateRelatedFilterGroupObject(e,t){Object.values(e.items).forEach(s=>{this._updateRelatedFilter(s,t)})}_updateRelatedFilterGroupInstance(e,t){e.filters.forEach(s=>this._updateRelatedFilter(s,t))}_updateRelatedFilter(e,t){if(e.filterType!==Q.FilterGroup){const s=e.leftExpression;s&&this._updateFilterLeftExpression(s,t)}else this._updateRelatedFilterGroup(e,t)}convertToRelatedFilter(e,t=[]){if(!e)return e;let s;if(e instanceof js)s=e.clone();else{const r=JSON.stringify(e);s=JSON.parse(r)}return[...t].reverse().forEach(r=>{r.relationData&&r.relationData.length!==0&&this._updateRelatedFilter(s,r)}),s}}const $d="invalidate-data-schema-cache";class Le{constructor(e,t){this._entitySchemaRepository=e,this._broadcastChannelFactory=t,this._dataSchemas=new Map,this._subscribeOnChangesInDesigner()}_subscribeOnChangesInDesigner(){this._broadcastChannelFactory.createInstance($d).messages$.subscribe(({schemaName:e})=>{this._removeCachedSchema(e)})}_createEntityDataSchema(e){const t=new Lc;return t.setEntitySchema(e),(0,o.of)(t.build())}_getEntityDataSchema(e){return this._entitySchemaRepository.getSchemaByName(e).pipe((0,u.switchMap)(t=>this._createEntityDataSchema(t)))}_removeCachedSchema(e){this._dataSchemas.has(e)&&(this._dataSchemas.delete(e),this._entitySchemaRepository.clearSchemaCacheByName(e))}get(e){return this._dataSchemas.has(e)?(0,o.of)(this._dataSchemas.get(e)):this._getEntityDataSchema(e).pipe((0,u.tap)(t=>this._dataSchemas.set(e,t)))}getByEntitySchema(e){const t=e.name;return this._dataSchemas.has(t)?(0,o.of)(this._dataSchemas.get(t)):this._createEntityDataSchema(e).pipe((0,u.tap)(s=>this._dataSchemas.set(t,s)))}static#e=this.\u0275fac=function(t){return new(t||Le)(c.\u0275\u0275inject(Te),c.\u0275\u0275inject(wt))};static#t=this.\u0275prov=c.\u0275\u0275defineInjectable({token:Le,factory:Le.\u0275fac,providedIn:"platform"})}class ur{constructor(e,t){this._dataSchemaRepository=e,this._featureValues=t}_getDataSchema(e){var t=this;return(0,S.A)(function*(){const s=yield(0,o.firstValueFrom)(t._dataSchemaRepository.get(e));if(!s)throw new Error(`Can not find DataSchema with name '${e}'`);return s})()}_getDataSchemaAttribute(e,t){var s=this;return(0,S.A)(function*(){const r=e instanceof Ke?e:yield s._getDataSchema(e),i=r.findAttributeByName(t);if(!i)throw new Error(`Can not find column '${t}' in Schema '${r.name}'`);return i})()}_getDataSchemaPrimaryAttribute(e){var t=this;return(0,S.A)(function*(){const s=yield t._getDataSchema(e);return t._getDataSchemaAttribute(s,s.primaryAttributeName)})()}_createRelationPathItemFromForwardPathItem(e,t){var s=this;return(0,S.A)(function*(){const r=yield s._getDataSchemaAttribute(e,t);let i=null,a=null;const l=r.dataValueType===y.r.Lookup;return l&&(i=r.referenceSchemaName,a=(yield s._getDataSchema(i)).primaryAttributeName),{isJoin:l,referenceSchemaName:i,referenceAttributeName:a,ownSchemaAttributeName:t,ownSchemaName:e}})()}_createRelationPathItemFromJoinPathItem(e,t,s,r){var i=this;return(0,S.A)(function*(){const a=s?yield i._getDataSchemaAttribute(t,s):yield i._getDataSchemaPrimaryAttribute(t);return{isJoin:!0,referenceSchemaName:t,referenceAttributeName:a.name,ownSchemaAttributeName:r,ownSchemaName:e}})()}_createRelationPathItem(e,t){const r=/(?<joinType>.*)\[(?<refSchema>.*?):(?<ownColumn>.*?)(?::(?<refColumn>.*))?]/.exec(t);if(r){const i=r.groups;return this._createRelationPathItemFromJoinPathItem(e,i.refSchema,i.refColumn,i.ownColumn)}return this._createRelationPathItemFromForwardPathItem(e,t)}_getReverseRelationPath(e){const t=[...e],s=[];let r;for(;(r=t.pop())!=null;)s.push({isJoin:!0,ownSchemaName:r.referenceSchemaName,ownSchemaAttributeName:r.referenceAttributeName,referenceSchemaName:r.ownSchemaName,referenceAttributeName:r.ownSchemaAttributeName});return s}_buildRelationPath(e,t){var s=this;return(0,S.A)(function*(){const r=t.split("."),i=[];let a=e;for(const l of r){const d=yield s._createRelationPathItem(a,l);a=d.referenceSchemaName,i.push(d)}return i})()}_getRelationPathToSourceSchema(e,t,s){var r=this;return(0,S.A)(function*(){const i=[...t],a=i.pop(),l=s.split("."),h=(yield r._buildRelationPath(e,s)).pop(),p={isJoin:!0,ownSchemaName:a.isJoin?a.referenceSchemaName:a.ownSchemaName,ownSchemaAttributeName:a.isJoin?a.referenceAttributeName:a.ownSchemaAttributeName,referenceSchemaName:h.ownSchemaName,referenceAttributeName:l.pop()},f=[...i,...a.isJoin?[a]:[],p];return r._featureValues.DisableDsDepsJoinOptimization||f.length===1?f:f.filter(C=>{if(!C.isJoin)return!0;const B=C.ownSchemaName===C.referenceSchemaName,ne=C.ownSchemaAttributeName===C.referenceAttributeName;return!(B&&ne)})})()}_buildRelationDataFromPath(e){return e.map(t=>({attributeName:t.ownSchemaAttributeName,referenceAttributeName:t.referenceAttributeName,referenceSchemaName:t.referenceSchemaName}))}_getDataSourceParameterRelationData(e,t){var s=this;return(0,S.A)(function*(){const r=yield s._buildRelationPath(t.dataSchemaName,t.relationPath),i=yield s._getRelationPathToSourceSchema(e,r,t.attributePath),a=s._getReverseRelationPath(i);return s._buildRelationDataFromPath(a)})()}_convertEntityDataSourceParameter(e,t){var s=this;return(0,S.A)(function*(){if(!t.relationsConfigs||t.relationsConfigs.length===0)return t;let r=e.name;const i=[];for(const a of t.relationsConfigs){const l=yield s._getDataSourceParameterRelationData(r,a);r=l[l.length-1].referenceSchemaName,i.push({...a,relationData:l})}return{...t,relationsConfigs:i}})()}convert(e,t,s=!1){return t.length===0?Promise.resolve([]):s?Promise.resolve(t):Promise.all(t.map(r=>this._convertEntityDataSourceParameter(e,r)))}static#e=this.\u0275fac=function(t){return new(t||ur)(c.\u0275\u0275inject(Le),c.\u0275\u0275inject(W))};static#t=this.\u0275prov=c.\u0275\u0275defineInjectable({token:ur,factory:ur.\u0275fac,providedIn:"root"})}class jt{constructor(e,t){this._dataSchemaRepository=e,this._parametersConverter=t}_createPrimaryColumnValueFilter(e,t){const i=(t.relationsConfigs||[])[0]?.dataSchemaName??e;return this._dataSchemaRepository.get(i).pipe((0,o.map)(a=>{const l=new k({columnPath:a.primaryAttributeName}),d=new $({value:t.value});return new ue(j.Equal,l,d)}))}_createColumnValueFilter(e){const t=e.value.attributePath,s=e.value.attributeValue,r=new k({columnPath:t}),i=new $({value:s}),a=new ue(j.Equal,r,i);return(0,o.of)(a)}_createPrimaryDisplayValueFilter(e,t){const i=(t.relationsConfigs||[])[0]?.dataSchemaName??e;return this._dataSchemaRepository.get(i).pipe((0,o.map)(a=>{const l=new k({columnPath:a.primaryDisplayAttributeName}),d=new $({value:t.value});return new ue(t.comparisonType,l,d)}))}_createCustomFilter(e){let t={};return e.value&&(t=typeof e.value=="string"?JSON.parse(e.value):e.value),(0,o.of)(t)}_createEmptyParameterFiler(e){const t=e.relationsConfigs||[];if(t.length===0)return(0,o.of)({});const s=t[0];return this._dataSchemaRepository.get(s.dataSchemaName).pipe((0,o.map)(r=>r.primaryAttributeName),(0,o.map)(r=>{const i=new k({columnPath:r});return new ht(i,null)}))}_createEsqFilter(e,t){switch(t.type){case P.PrimaryColumnValue:return this._createPrimaryColumnValueFilter(e,t);case P.ColumnValue:return this._createColumnValueFilter(t);case P.PrimaryDisplayValueFilter:return this._createPrimaryDisplayValueFilter(e,t);case P.Filter:return this._createCustomFilter(t);case P.Empty:return this._createEmptyParameterFiler(t)}}applyParameters(e,t){if(e.length===0)return(0,o.of)(t);const s=e.map(r=>this._createEsqFilter(t.rootSchemaName,r).pipe((0,o.map)(i=>new jd().convertToRelatedFilter(i,r.relationsConfigs))));return(0,o.forkJoin)(s).pipe((0,o.tap)(r=>{r.forEach(i=>{(0,v.isEmpty)(i)||t.filters.add(i)})}),(0,o.map)(()=>t))}convertToEntityDataSourceParameters(e,t,s=!1){return(0,o.from)(this._parametersConverter.convert(e,t,s))}static#e=this.\u0275fac=function(t){return new(t||jt)(c.\u0275\u0275inject(Le),c.\u0275\u0275inject(ur))};static#t=this.\u0275prov=c.\u0275\u0275defineInjectable({token:jt,factory:jt.\u0275fac,providedIn:"root"})}class $t{constructor(e,t,s){this.entitySchemaQueryUtils=e,this._entitySchemaColumnAppenderFactory=t,this._dataSchemaToDataSourceAttributeConverter=s}_addPagingToEsq(e,t){t&&(e.rowsOffset=t.rowsOffset,e.rowCount=t.rowCount)}_addSortingToEsq(e,t){t&&t.columns.forEach((s,r)=>{const i=e.findColumn(s.columnName),a=Fd(s.direction);i?i.withOrdering(a,r):e.addSchemaColumn(s.columnName).withOrdering(a,r)})}_addIsDistinctToEsq(e,t){t&&(e.isDistinct=!0)}_addColumnToEsq(e,t){t.filter(Boolean).forEach(s=>{this._entitySchemaColumnAppenderFactory.create(s).addColumn(e,s)})}_prepareAttributePairsForLoad(e,t){return t.map(s=>{if(typeof s=="string"){const r=s,i=e.attributes.find(a=>a.name===r);return i?this._dataSchemaToDataSourceAttributeConverter.create(i.attributeType).convert(i):{name:r,path:r}}else return s})}build(e,t,s,r){if(s.some(i=>i.type===P.Never))throw new Error('Failed to build entity schema query: parameters contains "Never" model parameter.');return(0,o.forkJoin)([this.entitySchemaQueryUtils.convertToEntityDataSourceParameters(e,s),(0,o.of)(this._prepareAttributePairsForLoad(e,t))]).pipe((0,o.map)(([i,a])=>({esq:new cr(e.name),esqParameters:i,dataSourceAttributes:a})),(0,o.tap)(({esq:i,dataSourceAttributes:a})=>this._addColumnToEsq(i,a)),(0,o.tap)(({esq:i})=>this._addSortingToEsq(i,r?.sortingConfig)),(0,o.tap)(({esq:i})=>this._addPagingToEsq(i,r?.pagingConfig)),(0,o.tap)(({esq:i})=>this._addIsDistinctToEsq(i,r?.isDistinct)),(0,o.switchMap)(({esq:i,esqParameters:a})=>this.entitySchemaQueryUtils.applyParameters(a,i)))}static#e=this.\u0275fac=function(t){return new(t||$t)(c.\u0275\u0275inject(jt),c.\u0275\u0275inject(Bc),c.\u0275\u0275inject(kc))};static#t=this.\u0275prov=c.\u0275\u0275defineInjectable({token:$t,factory:$t.\u0275fac,providedIn:"root"})}const Pi=n=>{switch(n){case y.r.Guid:return y.r.Guid;case y.r.Text:case y.r.SHORT_TEXT:case y.r.PHONE_TEXT:case y.r.WEB_TEXT:case y.r.EMAIL_TEXT:case y.r.MEDIUM_TEXT:case y.r.MAXSIZE_TEXT:case y.r.LONG_TEXT:case y.r.HASH_TEXT:case y.r.SECURE_TEXT:case y.r.RICH_TEXT:return y.r.Text;case y.r.Integer:case y.r.Enum:return y.r.Integer;case y.r.Float:case y.r.FLOAT1:case y.r.FLOAT2:case y.r.FLOAT3:case y.r.FLOAT4:case y.r.FLOAT8:case y.r.Money:return y.r.Float;case y.r.DateTime:case y.r.Date:case y.r.Time:return y.r.DateTime;case y.r.Lookup:case y.r.IMAGELOOKUP:return y.r.Lookup;case y.r.Boolean:return y.r.Boolean;case y.r.Blob:return y.r.Blob;case y.r.Image:return y.r.Image;case y.r.Color:return y.r.Color;default:throw new Error(`Type ${n} not implemented`)}};function Fm(n,e=null,t=DataValueType.Float){if(!n||n.length===0)return e;if(n.length===1)return n[0];let s=n.map(r=>Pi(r)).map(r=>DataValueTypeGroup.Number.includes(r)?t:r);return s=[...new Set(s)],s.length===1?s[0]:e}class Ud extends Ai{constructor(){super(...arguments),this._supportTransactions=!1}}class lr extends Ud{get isForceUpdateUnchangedData(){return!!this.initialConfig?.isForceUpdateUnchangedData}get affectedAttributes(){return[...this._affectedAttributes]}get isAggregate(){return this.dataSchema?this.dataSchema.attributes.some(t=>t.isAggregate):!1}constructor(e,t){super(e,t),this.dataSourceName=e,this.injector=t,this._affectedAttributes=[],this._errorReferenceAttributes=[],this._supportTransactions=!0,this.type=Dc,this._featureValues=t.get(W),this._queryExecutor=t.get(xe),this._entitySchemaService=t.get(Ge),this._httpClient=this.injector.get(D.HttpClient),this._rightsService=this.injector.get(Ii),this.dataSchemaRepository=this.injector.get(Le),this._entitySchemaRepository=this.injector.get(Te),this._entitySchemaQueryBuilder=this.injector.get($t),this._entitySchemaQueryUtils=this.injector.get(jt),this._window=this.injector.get(pe),this._measurePerformanceService=this.injector.get(te);const s=this.injector.get(Me.oq);this._entityDefaultValuesUrl=s.isSSP?"/ssp/rest/EntitySchemaService/GetEntityDefaultValues":"/rest/EntitySchemaService/GetEntityDefaultValues",this.translateService=this.injector.get(T.TranslateService)}_buildSelectEsq(e,t,s){return this.getSchema().pipe((0,u.switchMap)(r=>this._entitySchemaQueryBuilder.build(r,e,t,s)),(0,u.map)(r=>(this._featureValues["DataSource-DisableRecordDeactivation"]!==!0&&(r.useRecordDeactivation=this.initialConfig.useRecordDeactivation),r.adminUnitRoleSources=this._getEsqAdminUnitRoleSources(),r)))}_getEsqAdminUnitRoleSources(){let e;const t=this.initialConfig.adminUnitRoleSources;return(0,v.isNumber)(t)?t:((0,v.isArray)(t)&&t.forEach(s=>{const r=vi[s];(0,v.isNumber)(r)&&(e=e|r)}),e)}_normalizeValue(e,t){switch(t){case y.r.Lookup:return e||null;case y.r.Date:case y.r.Time:case y.r.DateTime:return e instanceof Date?bc(e):typeof e=="string"&&Date.parse(e)>0?`"${e}"`:e;default:return e}}_buildUpdateEsq(e,t){return this.getSchema().pipe((0,u.switchMap)(s=>this._entitySchemaQueryUtils.convertToEntityDataSourceParameters(s,e,!0)),(0,u.map)(s=>({updateQuery:new Ei(this._entitySchemaName),esqParameters:s})),(0,u.tap)(({updateQuery:s})=>{s.isForceUpdate=!!this.initialConfig.isForceUpdate,Object.keys(t).forEach(r=>{const i=this._findEntitySchemaColumn(r);if(!i)throw new Error(`Column ${r} not found`);const a=t[r];this._isEntityColumnValue(a)&&s.addColumn(i.name,this._normalizeValue(a,i.dataValueType),Pi(i.dataValueType))})}),(0,u.switchMap)(({updateQuery:s,esqParameters:r})=>this._entitySchemaQueryUtils.applyParameters(r,s)),(0,u.catchError)(s=>(0,o.throwError)(()=>s)))}_buildInsertEsq(e){const t=new Mi(this._entitySchemaName);return Object.keys(e).forEach(s=>{const r=this._findEntitySchemaColumn(s);if(!r)throw new Error(`Column ${s} not found`);const i=e[s];this._isEntityColumnValue(i)&&t.addColumn(r.name,this._normalizeValue(i,r.dataValueType),Pi(r.dataValueType))}),t}_buildDeleteEsq(e){return this.getSchema().pipe((0,u.switchMap)(t=>this._entitySchemaQueryUtils.convertToEntityDataSourceParameters(t,e,!0)),(0,u.switchMap)(t=>{const s=new xc(this._entitySchemaName);return this._entitySchemaQueryUtils.applyParameters(t,s)}))}_checkOwnAttributes(e){return this.getSchema().pipe((0,u.switchMap)(t=>{const s=t.attributes.filter(r=>r.attributeType!==x.OwnAttribute).filter(r=>!(0,v.isUndefined)(e[r.name]));return s.length!==0?(0,o.throwError)(()=>new Error(`Not valid attributes for this data source: ${s.map(r=>r.name).join(",")}`)):(0,o.of)(null)}))}_findEntitySchemaColumn(e){return this._entitySchema.columns.find(t=>t.name===e)}_isEntityColumnValue(e){const t=s=>typeof s=="object"&&(s===null||"value"in s);return typeof e=="string"||typeof e=="number"||typeof e=="boolean"||typeof e=="bigint"||e instanceof Date||t(e)}_parseDefaultValues(e,t){const s=new Map(e.attributes.map(r=>[r.name,r.dataValueType]));return t.reduce((r,i)=>{const{defaultValue:a,name:l}=i;if((0,v.isNil)(a.value))return r;if(a.displayValue)return{...r,[l]:a};const d=Ri(a.value,s.get(l));return{...r,[l]:d}},{})}_getDefaultValues(e){const t=`${this._entityDefaultValuesUrl}?entityName=${e}`;return this._httpClient.get(t).pipe((0,u.catchError)(s=>this._catchErrorResponse(s)),(0,u.map)(s=>s.GetEntityDefaultValuesResult),(0,u.mergeMap)(s=>this.getSchema().pipe((0,u.tap)(r=>{let i=this._window.defaultValueStorage;const a=s?.find(l=>l.name===r.primaryAttributeName)?.defaultValue?.value;if(i=i||{},a){const l=`${e}_${a}`;i[l]=s,this._window.defaultValueStorage=i}}),(0,u.map)(r=>this._parseDefaultValues(r,s)))))}_catchErrorResponse(e){return console.log(e),(0,o.of)({GetEntityDefaultValuesResult:[]})}_requestEntitySchemaColumnsInfo(e){const t=e.map(s=>s.attributePath);return this._entitySchemaService.getEntitySchemaColumnsInformationByPathsArray(this._entitySchema.uId,t).pipe((0,u.map)(s=>e.map(r=>({column:s[r.attributePath],config:r}))))}_getEntitySchemaForwardReferenceColumnsInfo(e){const t={name:this._entitySchemaName,loadLookupColumns:!1,forwardReferencePaths:e.map(s=>s.attributePath)};return this._entitySchemaRepository.getSchemes([t]).pipe((0,u.map)(()=>e.map(s=>{const r=s.attributePath.split("."),i=this._entitySchemaRepository.findEntitySchemaColumnByPath(this._entitySchemaName,r);return{column:new _i(i),config:s}})))}_createReferenceAttributes(e,t){return t.length===0?(0,o.of)(e):(0,o.of)(this._featureValues["DataSource-DontUseOneRequestForEntitySchemes"]).pipe((0,u.switchMap)(s=>s?this._requestEntitySchemaColumnsInfo(t):this._getEntitySchemaForwardReferenceColumnsInfo(t))).pipe((0,u.tap)(s=>{s.forEach(({column:r,config:i})=>{i.attributeType===x.AggregationAttribute&&i.aggregationConfig?.aggregationFunction===Ve.Count&&(r.dataValueType=y.r.Integer),e.addAttribute(r,i)})}),(0,u.map)(()=>e))}_createAttributesFromInitialConfig(e,t={}){const s=[];return Object.entries(t).forEach(([r,i])=>{const a=i;a.type===x.ForwardReferenceAttribute&&s.push({attributeName:r,attributeType:x.ForwardReferenceAttribute,attributePath:a.path}),a.type===x.AggregationAttribute&&s.push({attributeName:r,attributeType:x.AggregationAttribute,attributePath:a.path,aggregationConfig:a.aggregationConfig}),a.type===x.FunctionAttribute&&s.push({attributeName:r,attributeType:x.FunctionAttribute,attributePath:a.path,functionConfig:a.functionConfig})}),this._createReferenceAttributes(e,s).pipe((0,u.catchError)(r=>{const i=r.message&&r.toString(),a=new bd(this,i);return this._errors.push(a),s.forEach(l=>{this._errorReferenceAttributes.push(l)}),(0,o.of)(e)}))}_shouldSkipLoad(e){return e.some(t=>t.type===P.Never)}_setValidValuesForLookupAttributes(e,t){return Object.keys(t).forEach(s=>{const r=e.attributes.find(i=>i.name===s);r&&(r.dataValueType===y.r.Lookup||r.dataValueType===y.r.IMAGELOOKUP)&&t[s]===""&&(t[s]=null)}),t}_throwErrorResponse(e){const t=typeof e=="string"?e:e?.message;return(0,o.throwError)(()=>({success:!1,rowsAffected:0,errorInfo:t}))}_mapOperationResult(e){return{success:e.success,rowsAffected:e.rowsAffected}}_getIsAffectedAttributeStored(e){return this._affectedAttributes.some(t=>t.path===e.path&&t.schemaName===e.schemaName)}_collectUsedAttributes(e){let t=e._getUsedColumns();t=t.filter(s=>!this._getIsAffectedAttributeStored(s)),this._affectedAttributes.push(...t)}_findErrorReferenceAttribute(e){const t=typeof e=="string"?e:e.name;return this._errorReferenceAttributes.find(s=>s.attributeName===t)}_load(e,t,s,r){if(this.hasErrors){if(this.hasCriticalErrors)return(0,o.throwError)(()=>this.getLastError());if(e.length!==0&&e.every(a=>this._findErrorReferenceAttribute(a)!=null))return(0,o.throwError)(()=>this.getLastError())}return this._shouldSkipLoad(t)?(0,o.of)([]):this._buildSelectEsq(e,t,s||{}).pipe((0,u.tap)(i=>this._collectUsedAttributes(i)),(0,u.switchMap)(i=>this._queryExecutor.executeSelectQuery(i,{throttled:s?.throttled},r?.transactionId).pipe(this._measurePerformanceService.measure$(`EntityDataSource.load.executeSelectQuery.${this.dataSourceName}`),(0,u.catchError)(()=>(0,o.throwError)(()=>new Error(this.translateService.instant("BaseViewModel.LoadingModelErrorMessage")))))),(0,u.map)(i=>i),(0,u.mergeMap)(i=>this.getSchema().pipe((0,u.map)(a=>(a.attributes&&i.forEach(l=>{this._setValidValuesForLookupAttributes(a,l)}),i)))))}_save(e,t,s){return this.hasCriticalErrors?(0,o.throwError)(()=>this.getLastError()):this._checkOwnAttributes(t).pipe((0,u.switchMap)(()=>this._buildUpdateEsq(e,t)),(0,u.switchMap)(r=>this._queryExecutor.executeUpdateQuery(r,s?.transactionId)),(0,u.map)(r=>this._mapOperationResult(r)),(0,u.catchError)(r=>this._throwErrorResponse(r)))}_insert(e,t){return this.hasCriticalErrors?(0,o.throwError)(()=>this.getLastError()):this._checkOwnAttributes(e).pipe((0,u.map)(()=>this._buildInsertEsq(e)),(0,u.switchMap)(s=>(0,o.forkJoin)({response:this._queryExecutor.executeInsertQuery(s,t?.transactionId),dataSchema:this.getSchema()})),(0,u.map)(({response:s,dataSchema:r})=>({...this._mapOperationResult(s),primaryAttributes:[{[r.primaryAttributeName]:s.id}]})),(0,u.catchError)(s=>this._throwErrorResponse(s)))}_delete(e,t){return this.hasCriticalErrors?(0,o.throwError)(()=>this.getLastError()):this._buildDeleteEsq(e).pipe((0,u.switchMap)(s=>this._queryExecutor.executeDeleteQuery(s,t?.transactionId)),(0,u.map)(s=>this._mapOperationResult(s)),(0,u.catchError)(s=>this._throwErrorResponse(s)))}innerLoad(e,t,s){return this._load(e,t,s)}innerSave(e,t){return this._save(e,t)}innerInsert(e){return this._insert(e)}innerDelete(e){return this._delete(e)}innerGetSchema(){return this.hasCriticalErrors?(0,o.throwError)(()=>this.getLastError()):this.dataSchemaRepository.get(this._entitySchemaName).pipe((0,u.map)(e=>new Lc(e)),(0,u.switchMap)(e=>this._createAttributesFromInitialConfig(e,this.initialConfig.attributes)),(0,u.tap)(e=>{const t=this._getDefaultValues(this._entitySchemaName).pipe((0,u.shareReplay)({bufferSize:1,refCount:!0}));e.setAttributesDefaultValue(t)}),(0,u.map)(e=>e.build()))}innerGetLookupDataSchema(e){if(this.hasCriticalErrors)return(0,o.throwError)(()=>this.getLastError());const s=e.split(".")[0],r=this._findEntitySchemaColumn(s);return r?r.dataValueType!==y.r.Lookup?(0,o.throwError)(()=>new Error(`DataValueType for column '${s}' isn't lookup`)):r.referenceSchemaName?this.dataSchemaRepository.get(r.referenceSchemaName):(0,o.throwError)(()=>new Error(`referenceSchemaName for column '${s}' is absent`)):(0,o.throwError)(()=>new Error(`Can't find column with name '${s}'`))}innerGetDefaultValues(){return this.hasCriticalErrors?(0,o.throwError)(()=>this.getLastError()):this._getDefaultValues(this._entitySchemaName)}innerCanDelete(e){return this.hasCriticalErrors?(0,o.of)({result:!1}):this._rightsService.getCanDelete({schemaName:this.initialConfig.entitySchemaName,primaryColumnValue:e.primaryColumnValue})}innerCanCreate(e){if(this.hasCriticalErrors)return(0,o.of)({result:!1});const t={isNew:!0,schemaName:this.initialConfig.entitySchemaName};return this._rightsService.getCanEdit(t)}innerCanEdit(e){if(this.hasCriticalErrors)return(0,o.of)({result:!1});const t={primaryColumnValue:e.primaryColumnValue,isNew:!1,schemaName:this.initialConfig.entitySchemaName};return this._rightsService.getCanEdit(t)}getEmptySchema(){return this._entitySchemaName?new Ke({name:this._entitySchemaName}):super.getEmptySchema()}init(e,t){return super.init(e,t).pipe((0,u.mergeMap)(s=>{if(!this.initialConfig.entitySchemaName){const r=new wd(this);return this._errors.push(r),(0,o.throwError)(()=>r)}return(0,o.of)(s)}),(0,u.tap)(()=>this._entitySchemaName=this.initialConfig.entitySchemaName),(0,u.mergeMap)(s=>this._entitySchemaRepository.getSchemaByName(this.initialConfig.entitySchemaName).pipe((0,u.tap)(r=>this._entitySchema=r),(0,u.catchError)(()=>{this._entitySchema=new wc,this._entitySchema.name=this._entitySchemaName,this._entitySchema.columns=[];const r=new Rd(this,this._entitySchemaName);return this._errors.push(r),(0,o.throwError)(()=>r)}),(0,u.map)(()=>s))))}getOwnLoadParameters(){return this.initialConfig?.loadParameters}getAllowCopyingRecords(){return this.initialConfig?.allowCopyingRecords}loadInTransaction(e,t,s,r){return this._load(t,s,r,e)}saveInTransaction(e,t,s){return this._save(t,s,e)}insertInTransaction(e,t){return this._insert(t,e)}deleteInTransaction(e,t){return this._delete(t,e)}}class qd extends lr{constructor(e,t){super(e,t),this.dataSourceName=e,this.injector=t,this.type="crt.CopilotActionDataSource",this._intentManager=this.injector.get(dt)}_getActionUId(e){return e.filter(s=>s.type===P.PrimaryColumnValue)[0]?.value}innerDelete(e){return(0,o.of)(void 0)}innerInsert(e){const t=e;return(0,o.forkJoin)([this._intentManager.createAction(t),this.getSchema()]).pipe((0,o.map)(([s,r])=>({success:s.success,rowsAffected:1,errorInfo:s.errorInfo?.message,primaryAttributes:s.success?[{[r.primaryAttributeName]:t.Id}]:null})))}innerLoad(e,t,s){const r=this._getActionUId(t);return r?this._intentManager.getActionByUId(r).pipe((0,o.map)(i=>[i])):(0,o.of)([])}innerSave(e,t){const s=this._getActionUId(e),r=t;return r.Id=s,this._intentManager.updateAction(r).pipe((0,o.map)(i=>({success:i.success,rowsAffected:1,errorInfo:i.errorInfo?.message})))}}class dr{constructor(e){this._entitySchemaService=e}_loadPrimaryColumns(e){return this._entitySchemaService.getEntitySchemaByName(e).pipe((0,u.map)(t=>{const s=t.entitySchema.getPrimaryColumn(),r=t.entitySchema.getPrimaryDisplayColumn();if((0,v.isEmpty)(r))throw new Error(`Entity ${e} should have primary display column`);return{primaryColumnName:s.name,primaryDisplayColumnName:r?.name}}))}getColumnLookupValues(e){if((0,v.isEmpty)(e))return(0,o.of)(null);const t=this._loadPrimaryColumns(e),s=(0,o.from)(We.create(e));return(0,o.forkJoin)([t,s]).pipe((0,u.switchMap)(([r,i])=>(0,o.from)(i.load({attributes:[r.primaryColumnName,r.primaryDisplayColumnName]})).pipe((0,u.map)(l=>l.map(d=>({value:d[r.primaryColumnName],displayValue:d[r.primaryDisplayColumnName]}))))))}static#e=this.\u0275fac=function(t){return new(t||dr)(c.\u0275\u0275inject(Ge))};static#t=this.\u0275prov=c.\u0275\u0275defineInjectable({token:dr,factory:dr.\u0275fac,providedIn:"root"})}const Hd="CopilotIntentStatus",zd=new Map([["InDevelopment","4670b068-ad03-4364-9350-6cc61efd1b7f"],["Active","1d73b111-07a9-49e2-aa15-c9415cce7470"],["Deactivated","2c547e71-7a05-42e1-8b65-2bf63f200156"]]),Gd="CopilotIntentMode",Kd={Chat:"Chat",Api:"API"},Wd=new Map([["Chat","326bba59-302a-4a5e-857c-2576e1a38ab0"],["API","5f2dc095-4543-4972-b6bc-6599bf6bc3fd"]]),Fc={System:{value:"35f3b644-4fa3-4d1e-8e62-5c3fdc4d3e52",displayValue:"System",primaryColorValue:"#22AC14"},Skill:{value:"6d940b75-21c8-4a90-89ab-9867e6e4a045",displayValue:"Skill",primaryColorValue:"#7848EE"},Agent:{value:"a8fbe253-be1b-4ec4-bc58-65b8047013da",displayValue:"Agent",primaryColorValue:"#E67E22"}};function Jd(){return(0,o.of)(Object.values(Fc))}class hr{constructor(e){this._intentStatuses=zd,this._intentModes=Wd,this._columnLookupValuesService=e.get(dr)}convertToDataSourceModel(e){return(0,o.combineLatest)([this._columnLookupValuesService.getColumnLookupValues(Hd),this._columnLookupValuesService.getColumnLookupValues(Gd),Jd()]).pipe((0,o.map)(([t,s,r])=>{const i=this._intentStatuses.get(e.Status),a=t.find(C=>C.value===i),l=this._intentModes.get(e.Mode)??this._intentModes.get(Kd.Chat),d=s.find(C=>C.value===l),h=r.find(C=>C.displayValue===e.Type),p={Id:e.UId,Code:e.Code,Description:e.Description,Prompt:e.Prompt,Type:h,Name:e.Title,Status:a,PackageUId:e.PackageUId};return e.Type==="Agent"?{...p,Restrictions:e.Restrictions,RoleDescription:e.RoleDescription}:{...p,Mode:d}}))}convertToModel(e){const t={};return Object.entries(e).forEach(([s,r])=>{s==="Name"&&(s="Title"),s==="Id"&&(s="UId"),s==="Status"&&(r=[...this._intentStatuses].filter(([,i])=>i===e.Status.value).map(([i])=>i).shift()),s==="Mode"&&(r=[...this._intentModes].filter(([,i])=>i===e.Mode.value).map(([i])=>i).shift()),s==="Type"&&(r=Object.values(Fc).filter(i=>i.value===e.Type.value).map(i=>i.displayValue).shift()),t[s]=r}),t}static#e=this.\u0275fac=function(t){return new(t||hr)(c.\u0275\u0275inject(c.Injector))};static#t=this.\u0275prov=c.\u0275\u0275defineInjectable({token:hr,factory:hr.\u0275fac,providedIn:"root"})}class Zd extends lr{constructor(e,t){super(e,t),this.dataSourceName=e,this.injector=t,this._defaultValuesMap=new Map,this.type="crt.CopilotIntentDataSource",this._intentManager=this.injector.get(dt),this._copilotIntentDataSourceModelConvertor=this.injector.get(hr),this._initDefaultValuesMap()}_initDefaultValuesMap(){this._defaultValuesMap.set("CopilotIntent",{UId:O(),Status:"Active",Mode:"Chat",Type:"Skill",Prompt:this.translateService.instant("CopilotIntentDataSource.DefaultValues.Prompt")}),this._defaultValuesMap.set("CopilotAgent",{UId:O(),Status:"Active",Type:"Agent"})}innerGetDefaultValues(){const e=this.initialConfig.entitySchemaName,t=this._defaultValuesMap.get(e);return this._copilotIntentDataSourceModelConvertor.convertToDataSourceModel(t)}innerInsert(e){const t=this._copilotIntentDataSourceModelConvertor.convertToModel({...e});return(0,o.forkJoin)([this._intentManager.createIntent(t),this.getSchema()]).pipe((0,o.map)(([s,r])=>({success:s.success,rowsAffected:s.success?1:0,errorInfo:s.errorInfo?.message,primaryAttributes:[{[r.primaryAttributeName]:s.schemaUid}]})),(0,u.switchMap)(s=>s.success?(0,o.of)(s):(0,o.throwError)(()=>s)))}innerLoad(e,t,s){const r=t.filter(i=>i.type===P.PrimaryColumnValue);if(r.length)return this._intentManager.getIntent(r[0].value).pipe((0,u.switchMap)(i=>this._copilotIntentDataSourceModelConvertor.convertToDataSourceModel(i).pipe((0,o.map)(a=>[a]))))}innerSave(e,t){const r=e.filter(a=>a.type===P.PrimaryColumnValue)[0].value,i=this._copilotIntentDataSourceModelConvertor.convertToModel({...t});return i.UId=r,this._intentManager.updateIntent(i).pipe((0,o.map)(a=>({success:a.success,rowsAffected:a.success?1:0,errorInfo:a.errorInfo?.message})),(0,u.switchMap)(a=>a.success?(0,o.of)(a):(0,o.throwError)(()=>a)))}}class Xd{static fromJson(e){throw new Error("not implemented")}}class Yd{static resolve(e){return{[Q.Compare]:ue,[Q.FilterGroup]:se,[Q.In]:pt,[Q.IsNull]:Ne,[Q.Exists]:ht,[Q.Between]:er}[e]}}class Qd{static fromJson(e,t){throw new Error("not implemented")}}class eh{static resolve(e){return{[re.Macros]:mt,[re.Length]:ar,[re.Window]:or,[re.DatePart]:ft,[re.DateAdd]:ft,[re.DateDiff]:ft}[e.functionType]}}class th{static resolve(e,t){return{[ee.SchemaColumn]:k,[ee.Parameter]:$,[ee.SubQuery]:rr,[ee.ArithmeticOperation]:nr,[ee.Function]:eh.resolve(t)}[e]}}class Di extends Qd{static fromJson(e,t){const s=e.expressionType;return th.resolve(s,e).fromJson(e,t,Di)}}class hn extends Xd{static fromJson(e){const t=e.filterType,s=e.isEnabled,r=e.trimDateTimeParameterToDate,i=Yd.resolve(t).fromJson(e,hn,Di);return i.isEnabled=s!==!1,i.trimDateTimeParameterToDate=r===!0,i}}class pr{convertToDataSourceModel(e){return(0,o.of)({Id:e.UId,Intent:e.Intent,Code:e.Code,Name:e.Name,Description:e.Description,SourceCollection:e.SourceCollection,DataValueTypeUId:e.DataValueTypeUId})}convertToModel(e){const t={};return Object.entries(e).forEach(([s,r])=>{s==="Id"&&(s="UId"),t[s]=r}),t}static#e=this.\u0275fac=function(t){return new(t||pr)};static#t=this.\u0275prov=c.\u0275\u0275defineInjectable({token:pr,factory:pr.\u0275fac,providedIn:"root"})}class sh extends lr{constructor(e,t){super(e,t),this.dataSourceName=e,this.injector=t,this.type="crt.CopilotIntentParameterDataSource",this._intentManager=this.injector.get(dt),this._modelConvertor=this.injector.get(pr)}_getPrimaryColumnParameter(e){return e.find(t=>t.type===P.PrimaryColumnValue&&Yo(t.value))}_getIsIntentUIdParameter(e){return(e.relationsConfigs??[]).some(t=>t.dataSchemaName==="CopilotIntent"&&t.attributePath==="Intent")}_getSourceCollectionFilterValue(e){const t=e.find(i=>i.type===P.Filter);if(!t?.value)return null;const s=hn.fromJson(t.value);let r;return s.filters.forEach(i=>{i instanceof ue&&i.leftExpression instanceof k&&i.leftExpression.columnPath==="SourceCollection"&&i.rightExpression instanceof $&&(r=i.rightExpression.value)}),r}innerGetDefaultValues(){return this._modelConvertor.convertToDataSourceModel({UId:O()})}innerInsert(e){const t=this._modelConvertor.convertToModel({...e});return this._intentManager.createIntentParameter(t).pipe((0,o.map)(s=>({success:s.success,rowsAffected:s.success?1:0,errorInfo:s.errorInfo?.message,primaryAttributes:[{Id:t.UId}]})),(0,o.switchMap)(s=>s.success?(0,o.of)(s):(0,o.throwError)(()=>s)))}innerLoad(e,t,s){const r=this._getPrimaryColumnParameter(t),i=this._getSourceCollectionFilterValue(t)??"InputParameters";return r?(this._getIsIntentUIdParameter(r)?this._intentManager.getIntentParameters(r.value,i):this._intentManager.getIntentParameter(r.value).pipe((0,o.map)(l=>[l]))).pipe((0,o.mergeMap)(l=>(0,o.from)(l).pipe((0,o.mergeMap)(d=>this._modelConvertor.convertToDataSourceModel(d)),(0,o.toArray)())),(0,o.catchError)(()=>(0,o.of)([]))):(0,o.of)([])}innerSave(e,t){const s=this._getPrimaryColumnParameter(e)?.value,r=this._modelConvertor.convertToModel({...t});return r.UId=s,this._intentManager.updateIntentParameter(r).pipe((0,o.map)(i=>({success:i.success,rowsAffected:i.success?1:0,errorInfo:i.errorInfo?.message})),(0,o.switchMap)(i=>i.success?(0,o.of)(i):(0,o.throwError)(()=>i)))}innerDelete(e){const t=this._getPrimaryColumnParameter(e)?.value;return this._intentManager.deleteIntentParameter(t).pipe((0,o.map)(s=>({success:s.success,rowsAffected:s.success?1:0,errorInfo:s.errorInfo?.message})),(0,o.switchMap)(s=>s.success?(0,o.of)(s):(0,o.throwError)(()=>s)))}}class rh extends lr{innerDelete(e){return(0,o.of)(null)}innerInsert(e){return(0,o.of)(null)}innerLoad(e,t){return(0,o.of)([])}innerSave(e,t){return(0,o.of)(null)}innerGetLookupDataSchema(e){return(0,o.of)(null)}innerGetDefaultValues(){return(0,o.of)(null)}innerCanDelete(e){return(0,o.of)(null)}innerCanEdit(e){return(0,o.of)(null)}innerCanCreate(e){return(0,o.of)(null)}}function jm(n){const e=Object.keys(DataValueTypeGroup).find(t=>DataValueTypeGroup[t].includes(n));return DataValueTypeGroup[e]}function $m(n){return n===DataValueType.Lookup||n===DataValueType.Guid}function Um(n){return DataValueTypeItems[n]?.icon||null}function Ti(n){return Object.values(on.Q).find(e=>e.name===n)?.type}function nh(n){return!(n&&!n?.value)}var fe;(function(n){n.Create="create",n.Update="update",n.Delete="delete"})(fe||(fe={}));const Ni=window;class mr{constructor(){this._event$=new o.Subject}static get instance(){return Ni.__modelEventNotificationService||(Ni.__modelEventNotificationService=new mr),Ni.__modelEventNotificationService}get event$(){return this._event$.asObservable()}notify(e){this._event$.next(e)}}class fr{constructor(){this.changedValues$=new o.Subject,this._valuesStore={}}setValues(e){if(e){const t={};Object.entries(e).forEach(([s,r])=>{const i=this._valuesStore[s]!==r;this._valuesStore[s]=(0,v.cloneDeep)(r),i&&(t[s]=this._valuesStore[s])}),(0,v.isEmpty)(t)||this.changedValues$.next(t)}}get values(){return this._valuesStore}static#e=this.\u0275fac=function(t){return new(t||fr)};static#t=this.\u0275prov=c.\u0275\u0275defineInjectable({token:fr,factory:fr.\u0275fac})}const jc="PrimaryValue",$c="DisplayValue",Vi="PrimaryColorValue";class gr{constructor(e,t){this._queryExecutor=e,this._entitySchemaRepository=t}_getInFilter(e){const t=new mt({macrosType:Lt.PrimaryColumn});return new pt(j.Equal,t,e.map(s=>new $({value:s})))}_getEsq(e,t){const s=new cr(e);return this._entitySchemaRepository.getSchemaByName(e).pipe((0,u.map)(r=>{s.addMacrosFunctionColumn(Lt.PrimaryColumn,jc),s.addMacrosFunctionColumn(Lt.PrimaryDisplayColumn,$c);const i=r.getPrimaryColorColumn();i&&s.addSchemaColumn(i.name,Vi);const a=this._getInFilter(t);return s.filters.add(a),s}))}_getSchemaLookupData(e,t){const s={};for(let r=0;r<t.length;r++){const i=t[r],[a,l]=e[r];s[a]={};for(const d of l){const h=i.find(p=>p[jc]===d);if(h){const p=[h[$c]];h[Vi]&&p.push(h[Vi]),s[a][d]=h?p:null}}}return s}load(e){const t=Object.entries(e);return(0,o.forkJoin)(t.map(([s,r])=>this._getEsq(s,r))).pipe((0,o.switchMap)(s=>this._queryExecutor.executeBatchSelectQuery(s).pipe((0,u.map)(r=>this._getSchemaLookupData(t,r)))))}static#e=this.\u0275fac=function(t){return new(t||gr)(c.\u0275\u0275inject(xe),c.\u0275\u0275inject(Te))};static#t=this.\u0275prov=c.\u0275\u0275defineInjectable({token:gr,factory:gr.\u0275fac,providedIn:"root"})}class ih extends Ai{constructor(e,t){super(e,t),this.dataSourceName=e,this._injector=t,this.type=Tc,this._schemaParametersStore=this._injector.get(fr),this._lookupDataLoadService=this._injector.get(gr),this._featureValues=this._injector.get(W),this._featureValues.DisableCommunicationBetweenSchemas||this._subscribeParametersChanged()}_subscribeParametersChanged(){this._schemaParametersStore.changedValues$.subscribe(e=>{mr.instance.notify({modelId:O(),dataSchemaName:this.dataSchema.name,type:fe.Update,payload:{primaryAttributesValues:null,changedAttributes:Object.keys(e)}})})}_getCanSuccessfullyExecuteOperationResult(){return(0,o.of)({result:!0})}_fillLookupValues(e,t,s){Object.entries(s).forEach(([r,[i,a]])=>{(t[r]||[]).forEach(d=>{e[d]=a?{value:r,displayValue:i,primaryColorValue:a}:{value:r,displayValue:i}})})}_fillSchemaParameterValueNameMap(e,t,s,r){const i=r;let a=e[t];a||(a={},e[t]=a);let l=a[i];l||(l=[],a[i]=l),l.push(s)}_fillSchemaNamePrimaryValuesMap(e,t,s){const r=s;let i=e[t];i||(i=[],e[t]=i),i.push(r)}_isLookupValue(e){return!!e?.value}_shouldFillSchemaLookupValueMaps(e,t){return e&&t&&t.referenceSchemaName&&!this._isLookupValue(e)}_load(e,t){const s={},r=this._schemaParametersStore.values,i=t.attributes,a={},l={};for(const h of e){const p=r[h],f=i.find(C=>C.name===h);if(this._shouldFillSchemaLookupValueMaps(p,f)){this._fillSchemaNamePrimaryValuesMap(l,f.referenceSchemaName,p),this._fillSchemaParameterValueNameMap(a,f.referenceSchemaName,h,p);continue}s[h]=p??null}return Object.keys(l).length===0?(0,o.of)([s]):this._lookupDataLoadService.load(l).pipe((0,o.map)(h=>{for(const[p,f]of Object.entries(h)){const C=a[p];this._fillLookupValues(s,C,f)}return[s]}))}_getValuesForStore(e){const t={};return Object.entries(e).forEach(([s,r])=>{const i=this.initialConfig.parameters[s];if(!i)return;Ti(i.dataValueTypeName)===y.r.Lookup?t[s]=r?.value:t[s]=r}),t}innerLoad(e,t,s){return this.getSchema().pipe((0,o.switchMap)(r=>this._load(e,r)))}innerSave(e,t){const s=this._getValuesForStore(t);return this._schemaParametersStore.setValues(s),(0,o.of)({success:!0,rowsAffected:1})}innerInsert(e){const t=this._getValuesForStore(e);return this._schemaParametersStore.setValues(t),(0,o.of)({success:!0,rowsAffected:1,primaryAttributes:[]})}innerDelete(e){return(0,o.of)({success:!0,rowsAffected:1})}innerGetSchema(){const e=[],t=this.initialConfig.parameters;return t&&Object.entries(t).forEach(([s,r])=>{const i=new tr({name:s,caption:r.caption,dataValueType:Ti(r.dataValueTypeName),attributeType:x.OwnAttribute,path:s,isRequired:!!r.isRequired,referenceSchemaName:r.referenceSchemaName,isMasked:!1,isFormatValidated:!0});i.addDefaultValidators(),e.push(i)}),(0,o.of)(new Ke({name:this.initialConfig.schemaName,type:kt.ClientUnit,attributes:e}))}innerGetLookupDataSchema(e){return(0,o.of)(null)}innerGetDefaultValues(){return(0,o.of)({})}innerCanEdit(e){return this._getCanSuccessfullyExecuteOperationResult()}innerCanDelete(e){return this._getCanSuccessfullyExecuteOperationResult()}innerCanCreate(e){return this._getCanSuccessfullyExecuteOperationResult()}}class ah extends Ai{constructor(){super(...arguments),this.type="crt.WebServiceDataSource"}innerLoad(e,t,s){throw new Error("Method not implemented.")}innerSave(e,t){throw new Error("Method not implemented.")}innerInsert(e){throw new Error("Method not implemented.")}innerDelete(e){throw new Error("Method not implemented.")}innerGetSchema(){throw new Error("Method not implemented.")}innerGetLookupDataSchema(e){throw new Error("Method not implemented.")}innerGetDefaultValues(){throw new Error("Method not implemented.")}innerCanDelete(e){throw new Error("Method not implemented.")}innerCanEdit(e){throw new Error("Method not implemented.")}innerCanCreate(e){throw new Error("Method not implemented.")}}class Ut{resolve(e){let t=null;switch(e){case Dc:t=lr;break;case Tc:t=ih;break;case"crt.WebServiceDataSource":t=ah;break;case"crt.CopilotIntentDataSource":t=Zd;break;case"crt.CopilotIntentParameterDataSource":t=sh;break;case"crt.CopilotActionDataSource":t=qd;break;case"crt.DashboardDataSource":t=rh;break}return(0,o.of)(t)}static#e=this.\u0275fac=function(t){return new(t||Ut)};static#t=this.\u0275prov=c.\u0275\u0275defineInjectable({token:Ut,factory:Ut.\u0275fac})}class Xe{constructor(e,t){this.injector=e,this.resolver=t}create(e,t,s){const{type:r,scope:i,config:a}=t;return this.resolver.resolve(r).pipe((0,u.switchMap)(d=>d?new d(e,s||this.injector).init(a,i):(0,o.throwError)(()=>new Error(`Data source type '${r}' not supported.`))),(0,u.catchError)(d=>d instanceof Ci?(0,o.of)(d.dataSource):(0,o.throwError)(()=>d)))}static#e=this.\u0275fac=function(t){return new(t||Xe)(c.\u0275\u0275inject(c.Injector),c.\u0275\u0275inject(Ut))};static#t=this.\u0275prov=c.\u0275\u0275defineInjectable({token:Xe,factory:Xe.\u0275fac})}var A;(function(n){n.Init="init",n.Create="create",n.Update="update",n.Copy="copy",n.Delete="delete",n.Unknown="unknown"})(A||(A={}));class oh{}var q;(function(n){n.LoadNext="loadNext",n.Load="load",n.Reload="reload"})(q||(q={}));function ch(n){return n.endsWith("/")||(n+="/"),n}function uh(n){return n.replace(/(^([/\\])+)|(([/\\])+$)/,"")}function lh(n){return n=n.replace(location.hash,""),n.replace(location.search,"")}function dh(n){return`${hh()}/Navigation/Navigation.aspx?schemaName=${n}`}function qm(){return"/"}function _t(){let n=location.pathname;const e=n.match(/.*?\/\d\/?/);return e&&e.length===1?n=ch(e[0]):n="",ph(location.origin,n)}function Uc(){let n=location.href.replace(_t(),"");return n=lh(n),n||"/"}function Hm(){const n=Uc(),e=_t(),t=n.split("/").filter(Boolean)[0];return t?`${e}${t}/`:e}function pn(){let e=_t().replace(location.origin,"");return e.endsWith("/")&&(e=e.substring(0,e.length-1)),e}function hh(){return _t().replace(/\/0\/?$|\/+$/,"")}function ph(...n){return n.map(e=>uh(e)).join("/")}function zm(n,e){return`${dh(n)}&recordId=${e}`}function Gm(n,e){function t(a,l){return a.toLowerCase().replace(l,"").split("/").filter(d=>d).join("/")}const s=_t().toLowerCase(),r=t(n,s),i=t(e,s);return r===i}function Km(n){return n?pn()+imageServiceUrl+n:null}function Wm(){return pn()+esqServiceUrl}function Jm(n){const{uId:e,name:t,packageUId:s}=n;if(!e&&!t)throw new Error("uId or name is required");const r=_t(),i=Uc();let a=`${r}${i}#/InterfaceDesigner/${e||t}`;return s&&(a+=`?packageUId=${s}`),a}function qc(n,e,t){return!n||!e||!t}function Hc(n,e){return`/img/entity/hash/${n}/${e}/`}function zc(n,e="SysImage",t="Data"){if(qc(n,e,t))return"";const s=Hc(e,t);return`${pn()}${s}${n}`}function Zm(n,e="SysImage",t="Data"){return qc(n,e,t)?"":`${Hc(e,t)}${n}`}function mh(n){let e="";if(typeof n=="string"){const s=new TextEncoder().encode(n);e=String.fromCharCode(...s)}else if(n instanceof ArrayBuffer){const t=new Uint8Array(n);for(let s=0;s<t?.byteLength;s++)e+=String.fromCharCode(t[s])}return window.btoa(e)}function Xm(n){const e=new DOMParser().parseFromString(n,"text/html"),t=e?.querySelectorAll("svg");return t.length>0&&t.forEach(s=>{const r=e.createElement("img"),i=mh(s.outerHTML);r.src=`data:image/svg+xml;base64,${i}`,s?.parentNode.replaceChild(r,s)}),e?.body.innerHTML||n}class G{static _setImageLookupTypeUrl(e,t){const s=e[t],r=s?.value;r&&(s.url=zc(r))}static _setBlobTypeUrl(e,t,s){const r=t[s];if(r){const i=t.Id;t[s]={value:r,url:zc(i,e,s)}}}static _addImageUrl(e,t,s){t.forEach(r=>{switch(r.dataValueType){case y.r.IMAGELOOKUP:{this._setImageLookupTypeUrl(s,r.name);break}case y.r.Image:{this._setBlobTypeUrl(e,s,r.name);break}default:break}})}static serializeRecordPrimaryAttributesValues(e){return e.map(t=>`${t.name}:${t.value}`).join(";")}static getModelPrimaryAttributeValues(e,t){const s=e.getPrimaryAttributesNames();return t.map(r=>s.map(i=>({name:i,value:r[i]})))}static getOwnColumnsValues(e,t){const s=t??{};if(e.attributes.length){const r=e.attributes.filter(i=>i.attributeType===x.OwnAttribute).map(i=>i.name).filter(i=>!(0,v.isUndefined)(s[i])).map(i=>[i,s[i]]);return Object.fromEntries(r)}else return s}static getPrimaryAttributeValuesFromParameters(e,t){const s=t.filter(r=>r.type===P.PrimaryColumnValue);return s.length?s.map(r=>({[e.primaryAttributeName]:r.value})):[]}static getPrimaryAttributeValuesFromData(e,t){const s=e.getPrimaryAttributesNames();return s.length?s.filter(r=>t[r]).map(r=>({[r]:t[r]})):[]}static getPrimaryAttributeValues(e,t,s){const r=this.getPrimaryAttributeValuesFromData(e,t);return r.length?r:this.getPrimaryAttributeValuesFromParameters(e,s)}static getDataSourceLoadOptions(e){const t={loadType:e?.loadType||q.Load};return e?.pagingConfig&&(t.pagingConfig=e.pagingConfig),e?.sortingConfig&&(t.sortingConfig=e.sortingConfig),e?.isDistinct&&(t.isDistinct=e.isDistinct),t}static getImageAttributes(e,t){const s=[];return(t||[]).forEach(r=>{const i=e.findAttributeByName(r);i?.isImage&&s.push(i)}),s}static processImageData(e,t,s){const r=G.getImageAttributes(e,s);return r.length>0&&t.forEach(i=>this._addImageUrl(e.name,r,i)),t}static removeNotRequestedData(e,t){return Object.keys(t).forEach(s=>{e.includes(s)||delete t[s]}),t}static getLoadRequestSignature(e,t,s,r){return JSON.stringify(e)+JSON.stringify(t)+JSON.stringify(s)+JSON.stringify(r)}}const fh={[A.Init]:[A.Create,A.Copy,A.Update,A.Delete],[A.Copy]:[A.Delete,A.Update],[A.Create]:[A.Copy,A.Delete,A.Update],[A.Delete]:[A.Copy,A.Create,A.Update,A.Init],[A.Update]:[A.Delete],[A.Unknown]:[]};function xi(n){const e={success:!1,rowsAffected:0,errorInfo:""};return typeof n=="string"?Object.assign(e,{errorInfo:n}):n instanceof Error?Object.assign(e,{errorInfo:n.message}):Object.assign(e,typeof n=="object"?n:{errorInfo:n})}class _r{get _children(){return this._children$.value}static get instance(){return this._instance||(this._instance=new _r(null,null)),this._instance}constructor(e,t){this._injector=e,this.dataSource=t,this._lookupDataSourceName="lookupDataSource",this._id=O(),this._modeChanges=new o.Subject,this._destroyed$=new o.Subject,this._children$=new o.BehaviorSubject([]),this._childrenDirty$=new o.BehaviorSubject(!1),this._childrenModes$=new o.BehaviorSubject([]),this._isCollectionModel=!1,this._isCollectionItemModel=!1,this._mode=A.Init,this._isInitialized=!1,this._isLoaded=!1,this._dirtyAttributes=new Set,this._newLoadingRequestArrived=new o.Subject,this._attributesMap=[],this._selfDirty$=new o.BehaviorSubject(!1),this._isLoading=!1,this._destroyed=!1,this._doNotAllowCancelRequest=!1,this._dirty$=(0,o.combineLatest)([this._selfDirty$,this._childrenDirty$,this._childrenModes$]).pipe((0,u.map)(([s,r,i])=>s||r||i.includes(A.Copy)||i.includes(A.Create)),(0,u.distinctUntilChanged)()),this._loadedData=new Set,this._injector&&(this._dataSourceFactory=this._injector.get(Xe),this._lifecycleHookNotificationService=this._injector.get(oh,null,{optional:!0}),this._measurePerformanceService=this._injector.get(te,null,{optional:!0}),this._doNotAllowCancelRequest=this._injector.get(W,null,{optional:!0})?.DoNotAllowCancelRequest)}static create(e){return(0,o.from)(this.instance._create({type:"crt.EntityDataSource",config:{entitySchemaName:e}},""))}get name(){return this.dataSource?this.dataSource.dataSourceName:""}get mode(){return this._isCollectionModel?A.Unknown:this._mode}get _modeChanges$(){return this._modeChanges.asObservable()}get _isChanged(){return!!this._dirtyAttributes?.size}set _isCollection(e){this._isCollectionModel=e,this._isCollectionModel&&(this._mode=A.Unknown)}get isLoaded(){return this._isLoaded}get event$(){return mr.instance.event$.pipe((0,u.filter)(()=>this._isInitialized),(0,u.filter)(()=>!this._isCollectionItemModel),(0,u.filter)(({dataSchemaName:e})=>e===this._dataSchemaName),(0,u.tap)(({type:e,modelId:t,payload:s})=>this._updateLoadedData(e,t,s)),(0,u.filter)(({modelId:e})=>e!==this._id&&!this._isChild(e)),(0,u.map)(e=>({event:e,ownPrimaryAttributesValues:e.payload?.primaryAttributesValues?.filter(t=>{const s=G.serializeRecordPrimaryAttributesValues(t);return this._loadedData.has(s)})})),(0,u.filter)(({event:e,ownPrimaryAttributesValues:t})=>e.type===fe.Update||e.type===fe.Delete?!t||t.length!==0:!0),(0,u.map)(({event:e,ownPrimaryAttributesValues:t})=>({event:e,primaryAttributesValues:e.type===fe.Create?e.payload.primaryAttributesValues:t})),(0,u.map)(({event:e,primaryAttributesValues:t})=>({modelId:e.modelId,dataSchemaName:e.dataSchemaName,type:e.type,payload:{...e.payload,primaryAttributesValues:t}})),(0,u.takeUntil)(this._destroyed$))}get dataSchemaName(){return this._dataSchemaName}get allowSync(){return!this._disableSync}get disableSync(){return this._disableSync}set disableSync(e){this._disableSync=e}get isLoading(){return this._isLoading}get hasErrors(){return this.dataSource?this.dataSource.hasErrors:!0}get hasCriticalErrors(){return this.dataSource?this.dataSource.hasCriticalErrors:!0}get affectedAttributes(){return this.dataSource?this.dataSource.affectedAttributes:[]}get isAggregate(){return this.dataSource?this.dataSource.isAggregate:!1}get isCollectionItemModel(){return this._isCollectionItemModel}get isInitialized(){return this._isInitialized}_isChild(e){return this._children.some(t=>t?._id===e)}_subscribeChildrenModeChanges(){this._children$.pipe((0,u.map)(e=>e.map(t=>(0,o.merge)((0,o.of)(t.mode),t._modeChanges$))),(0,u.switchMap)(e=>e?.length?(0,o.combineLatest)(e):(0,o.of)([])),(0,u.tap)(e=>this._childrenModes$.next(e)),(0,u.takeUntil)(this._destroyed$)).subscribe()}_subscribeChildrenDirtyChanges(){this._children$.pipe((0,u.map)(e=>e.map(t=>t._dirty$)),(0,u.switchMap)(e=>e?.length?(0,o.combineLatest)(e):(0,o.of)([])),(0,u.map)(e=>e.some(t=>t)),(0,u.tap)(e=>this._childrenDirty$.next(e)),(0,u.takeUntil)(this._destroyed$)).subscribe()}_updateLoadedData(e,t,s){this._isCollectionModel&&e===fe.Create&&this._isChild(t)&&s.primaryAttributesValues.forEach(r=>{const i=G.serializeRecordPrimaryAttributesValues(r);this._loadedData.add(i)})}_setMode(e){if(this._mode===e)return;if(!fh[this._mode]?.includes(e))throw Error(`Unable to mark model with '${this._mode}' mode for '${e}'.`);const s=this._mode;this._mode=e,e===A.Delete&&this._selfDirty$.next(s!==A.Create)}_markForNotCollection(e){this._isCollectionModel||this.markFor(e)}_registerPrimaryAttributeValues(e){e.forEach(t=>{this._loadedData.add(G.serializeRecordPrimaryAttributesValues(t))})}_getDependentAttributesNames(e){return this._attributesMap.filter(t=>e.includes(t.name)).filter(t=>t.dependentAttributes.length!==0).map(t=>t.dependentAttributes).flat()}_getDefaultLoadAttributes(){return this.getSchema().pipe((0,u.map)(e=>e.getPrimaryLoadAttributes()))}_checkAttributesInDataSchema(e){return this.getSchema().pipe((0,u.tap)(t=>{const s=e.filter(r=>t.findAttributeByName(r)==null);if(s.length>0)throw new Error(`data has unknown attributes names: ${s.join(", ")}`)}))}_createDataSource(e,t,s=null){const r=s??t.dataSourceConfig;return this._dataSourceFactory.create(e,r)}_notifyEventByParameters(e,t){return this.getSchema().pipe((0,u.map)(s=>G.getPrimaryAttributeValuesFromParameters(s,e)),(0,u.mergeMap)(s=>this._notifyDataChange(s,t)))}_notifyDataChange(e,t){return this.getSchema().pipe((0,u.map)(s=>G.getModelPrimaryAttributeValues(s,e)),(0,u.tap)(s=>{mr.instance.notify({modelId:this._id,dataSchemaName:this._dataSchemaName,type:t,payload:{primaryAttributesValues:s}})}),(0,u.map)(()=>null))}_mapSaveResult(e,t,s){return this.getSchema().pipe((0,u.map)(r=>({result:e,actionType:fe.Update,data:G.getPrimaryAttributeValues(r,t,s)})))}_mapInsertResult(e){return{data:e.primaryAttributes??[],result:e,actionType:fe.Create}}_getLoadAttributes(e){if(e&&e.length!==0){let t=null;if(e.every(r=>(0,v.isString)(r)))return t=this._getDependentAttributesNames(e),(0,o.of)([...e,...t]);{const r=e.map(i=>i.name);return t=this._getDependentAttributesNames(r),this.getSchema().pipe((0,u.map)(i=>(t=t.map(a=>i.findAttributeByName(a)).map(a=>({name:a.name,path:a.path,caption:a.caption,dataValueType:a.dataValueType,aggregationConfig:a.aggregationConfig})),[...e,...t])))}}return this._getDefaultLoadAttributes()}_getChangedAttributesValues(e){return this._persistedState?Object.entries({...this._persistedState,...e}).filter(([t])=>this._dirtyAttributes.has(t)).reduce((t,[s,r])=>Object.assign(t,{[s]:r}),{}):e}_load(e,t,s,r,i=A.Update){const a={attributes:t,parameters:s,options:r,mode:i},l=(0,v.cloneDeep)(this._lastRequestPayload),d=(0,v.isEqual)((0,v.omit)(a,"options.loadType"),(0,v.omit)(l,"options.loadType"));return this._loadingRequest&&d?this._loadingRequest:(this._lastRequestPayload&&!d&&(this._newLoadingRequestArrived.next(null),this._newLoadingRequestArrived=new o.Subject),this._lastRequestPayload=a,this._loadingRequest=this._getLoadAttributes(t).pipe(ot(()=>this._onBeforeLoad(a,l)),(0,u.switchMap)(h=>e(h,s,r)),(0,u.takeUntil)(this._newLoadingRequestArrived),(0,u.tap)(()=>this._markForNotCollection(i)),Jo(()=>this.getSchema()),(0,u.tap)(([h,p])=>{this._registerPrimaryAttributeValues(G.getModelPrimaryAttributeValues(p,h))}),(0,u.tap)(()=>this._persistedState={}),(0,u.map)(([h,p])=>G.processImageData(p,h,t)),(0,u.tap)(()=>this._isLoaded=!0),ot(()=>this._onAfterLoad(a,l)),(0,u.catchError)(h=>(this._isLoaded=!1,(0,o.throwError)(()=>h))),(0,u.tap)(()=>{this._dirtyAttributes.size===0&&this._markAsPristine(),this._loadingRequest=null}),(0,u.share)()),(0,o.iif)(()=>!this._doNotAllowCancelRequest,this._loadingRequest.pipe((0,u.takeUntil)(this._destroyed$)),this._loadingRequest))}_updateAttributesDependencies(){this._attributesMap.forEach(t=>t.dependentAttributes=[]),this._attributesMap.filter(t=>t.attributeType!==x.OwnAttribute).forEach(t=>{const s=t.path.split(".");if(s.length===1)return;const r=s.shift(),i=this._attributesMap.find(a=>a.path===r);i?.dependentAttributes.push(t.name)})}_buildAttributesMap(e){const t=e.attributes??[];this._attributesMap=t.map(s=>({name:s.name,path:s.path,attributeType:s.attributeType,dependentAttributes:[],isSchemaAttribute:!0})),this._updateAttributesDependencies()}_loadDependentDataForCreate(e){return this.getSchema().pipe((0,u.map)(t=>t.attributes.filter(s=>s.dataValueType===y.r.Lookup).filter(s=>s.name in e).map(s=>s.name)),(0,u.switchMap)(t=>{if(t.length===0)return(0,o.of)([]);const s=t.map(r=>this.reloadDependentData(r,e[r]));return(0,o.forkJoin)(s)}),(0,u.map)(t=>{let s={};return t.forEach(r=>{s={...s,...r[0]||{}}}),{...s,...e}}))}_getDependentAttributesInfo(e){return this.getSchema().pipe((0,u.map)(t=>e.map(s=>{const r=t.findAttributeByName(s),i=r?.path??s,a=r?.name??s,l=r?.aggregationConfig??null,d=r?.dataValueType??null,h=r?.attributeType??null,p=i.split(".");p.shift();const f=p.length===1?p[0]:a;let C;return h===x.AggregationAttribute?C=x.AggregationAttribute:C=p.length===1?x.OwnAttribute:x.ForwardReferenceAttribute,{alias:f,attributeName:a,config:{path:p.join("."),aggregationConfig:l,dataValueType:d,type:C},type:C}})))}_markAsPristine(){this._selfDirty$.next(!1)}_onBeforeLoad(e,t){return this._lifecycleHookNotificationService?.onBeforeLoad?(0,o.from)(this._lifecycleHookNotificationService.onBeforeLoad({model:this,payload:{attributes:e?.attributes,options:e?.options,parameters:e?.parameters},previousPayload:{attributes:t?.attributes,options:t?.options,parameters:t?.parameters}})).pipe((0,u.map)(s=>{if(s===!1)throw Error('Loading is disallowed by a "OnBeforeLoad" model lifecycle event')})):(0,o.of)(void 0)}_onAfterLoad(e,t){return this._lifecycleHookNotificationService?.onAfterLoad?(0,o.from)(this._lifecycleHookNotificationService.onAfterLoad({model:this,payload:{attributes:e?.attributes,options:e?.options,parameters:e?.parameters},previousPayload:{attributes:t?.attributes,options:t?.options,parameters:t?.parameters}})):(0,o.of)(void 0)}_onBeforeInsert(e){return this._lifecycleHookNotificationService?.onBeforeInsert?this.getSchema().pipe((0,u.map)(t=>G.getModelPrimaryAttributeValues(t,[e])),(0,u.map)(t=>t.pop()),(0,u.switchMap)(t=>this._lifecycleHookNotificationService.onBeforeInsert({model:this,payload:{data:e,primaryAttributesValues:t}})),(0,u.map)(t=>{if(t===!1)throw Error('Inserting is disallowed by a "OnBeforeInsert" model lifecycle event')})):(0,o.of)(void 0)}_insert(e,t){return t(e).pipe((0,u.map)(s=>this._mapInsertResult(s)),(0,u.tap)(()=>this._persistedState={}),(0,u.tap)(()=>this._markAsPristine()),(0,u.tap)(()=>this._markForNotCollection(A.Update)),Jo(()=>this.getSchema()),(0,u.tap)(([,s])=>{this._registerPrimaryAttributeValues(G.getModelPrimaryAttributeValues(s,[e]))}),(0,u.map)(([s])=>s),ti(({data:s,actionType:r})=>this._notifyDataChange(s,r)),(0,u.map)(({result:s})=>s))}_onAfterInsert(e){return this._lifecycleHookNotificationService?.onAfterInsert?(0,o.from)(this._lifecycleHookNotificationService.onAfterInsert({model:this,payload:{data:e}})):(0,o.of)(void 0)}_onBeforeUpdate(e,t){return this._lifecycleHookNotificationService?.onBeforeUpdate?(0,o.from)(this._lifecycleHookNotificationService.onBeforeUpdate({model:this,payload:{data:e,parameters:t}})).pipe((0,u.map)(s=>{if(s===!1)throw Error('Updating is disallowed by a "OnBeforeUpdate" model lifecycle event')})):(0,o.of)(void 0)}_update(e,t,s){return s(t,e).pipe((0,u.mergeMap)(r=>this._mapSaveResult(r,e,t)),ti(()=>this._notifyEventByParameters(t,fe.Update)),(0,u.map)(({result:r})=>r),(0,u.tap)(()=>this.setLoadedState()))}_onAfterUpdate(e,t){return this._lifecycleHookNotificationService?.onAfterUpdate?(0,o.from)(this._lifecycleHookNotificationService.onAfterUpdate({model:this,payload:{data:e,parameters:t}})):(0,o.of)(void 0)}_onBeforeDelete(e){return this._lifecycleHookNotificationService?.onBeforeDelete?(0,o.from)(this._lifecycleHookNotificationService.onBeforeDelete({model:this,payload:{parameters:e}})).pipe((0,u.map)(t=>{if(t===!1)throw Error('Deleting is disallowed by a "OnBeforeDelete" model lifecycle event')})):(0,o.of)(void 0)}_delete(e,t){return t(e).pipe((0,u.tap)(()=>this._markAsPristine()),(0,u.tap)(()=>this._markForNotCollection(A.Init)),ti(()=>this._notifyEventByParameters(e,fe.Delete)))}_onAfterDelete(e){return this._lifecycleHookNotificationService?.onAfterDelete?(0,o.from)(this._lifecycleHookNotificationService.onAfterDelete({model:this,payload:{parameters:e}})):(0,o.of)(void 0)}innerInsert(e,t){const r=this.getSchema().pipe((0,u.map)(i=>({dataSchema:i,data:{...this._persistedState??{},...t}})),(0,u.map)(({data:i,dataSchema:a})=>G.getOwnColumnsValues(a,i))).pipe(ot(i=>this._onBeforeInsert(i)),Zo(i=>this._insert(i,e)),ot(([i])=>this._onAfterInsert(i)),(0,u.map)(([,i])=>i),(0,u.tap)(()=>{this._isLoaded=!0}),(0,u.catchError)(i=>(0,o.of)(xi(i))));return(0,o.iif)(()=>!this._doNotAllowCancelRequest,r.pipe((0,u.takeUntil)(this._destroyed$)),r)}innerUpdate(e,t,s){const i=this.getSchema().pipe((0,u.map)(a=>G.getOwnColumnsValues(a,t)),(0,u.map)(a=>this._getChangedAttributesValues(a))).pipe(ot(a=>this._onBeforeUpdate(a,s)),Zo(a=>this._update(a,s,e)),ot(([a])=>this._onAfterUpdate(a,s)),(0,u.map)(([,a])=>a),(0,u.catchError)(a=>(0,o.of)(xi(a))));return(0,o.iif)(()=>!this._doNotAllowCancelRequest,i.pipe((0,u.takeUntil)(this._destroyed$)),i)}innerDelete(e,t){return this._onBeforeDelete(t).pipe((0,u.switchMap)(()=>this._delete(t,e)),ot(()=>this._onAfterDelete(t)),(0,u.catchError)(s=>(0,o.of)(xi(s))))}innerLoad(e,t){if(this._destroyed)return(0,o.of)([]);this._isLoading=!0;const s=t?.attributes,r=t?.parameters||[],i=G.getDataSourceLoadOptions(t?.options),a=this._load(e,s,r,i).pipe((0,u.tap)(()=>this._isLoading=!1),(0,u.catchError)(l=>(this._isLoading=!1,(0,o.throwError)(()=>l))));return(0,o.iif)(()=>!this._doNotAllowCancelRequest,a.pipe((0,u.takeUntil)(this._destroyed$)),a)}init(){return this.getSchema().pipe((0,u.tap)(e=>this._dataSchemaName=e.name),(0,u.tap)(e=>this._buildAttributesMap(e)),(0,u.map)(()=>this),(0,u.tap)(()=>this._isInitialized=!this.hasCriticalErrors),(0,u.tap)(()=>{this._subscribeChildrenModeChanges(),this._subscribeChildrenDirtyChanges()}),(0,u.take)(1))}getSchema(){if(!this.dataSource)return(0,o.of)(null);if(this.hasCriticalErrors)return(0,o.of)(this.dataSource.getEmptySchema());const e=this.dataSource.getSchema();return this._measurePerformanceService?e.pipe(this._measurePerformanceService.measure$(`model.getSchema.${this.name}`)):e}getDataSource(){return this.dataSource}load(e){return this.innerLoad((t,s,r)=>this.dataSource.load(t,s,r),e)}updateDependentAttributes(e){this._attributesMap=this._attributesMap.filter(r=>r.isSchemaAttribute);const t=this._attributesMap.map(r=>r.name),s=e.filter(r=>!t.includes(r.path)).map(r=>({name:r.path,path:r.path,attributeType:r.type??x.ForwardReferenceAttribute,dependentAttributes:[],isSchemaAttribute:!1}));this._attributesMap.push(...s),this._updateAttributesDependencies()}canReloadDependentData(e){return this._getDependentAttributesNames([e]).length!==0}getDependentAttributesNames(e){return this._getDependentAttributesNames([e])}reloadDependentData(e,t){const s=this._getDependentAttributesNames([e]);if(s.length===0)return(0,o.of)([]);if(t==null)return(0,o.of)([Object.fromEntries(s.map(a=>[a,null]))]);const r=[{type:P.PrimaryColumnValue,value:t}],i=new Map;return(0,o.forkJoin)([this._getDependentAttributesInfo(s),this.dataSource.getLookupDataSchema(e)]).pipe((0,u.switchMap)(([a,l])=>{const d=a.filter(p=>p.type!==x.OwnAttribute).map(p=>[p.alias,p.config]),h={type:l.dataSourceConfig.type,config:{...l.dataSourceConfig.config,attributes:Object.fromEntries(d)}};return a.forEach(p=>{i.set(p.alias,p.attributeName)}),this._createDataSource(`${this.name}_reloadData`,l,h)}),(0,u.switchMap)(a=>a.load([...i.keys()],r,{throttled:!0})),(0,u.map)(a=>a.map(l=>{const d={};return i.forEach((h,p)=>{d[h]=l[p]}),d})))}create(e={}){return this._isLoading=!0,this.getSchema().pipe((0,u.map)(t=>G.getOwnColumnsValues(t,e)),(0,u.switchMap)(t=>(0,o.forkJoin)([(0,o.of)(t),this.dataSource.getDefaultValues()])),(0,u.tap)(()=>this._markForNotCollection(A.Create)),(0,u.map)(([t,s])=>(this._persistedState={...s,...t},this._persistedState)),(0,u.switchMap)(t=>this._loadDependentDataForCreate(t)),(0,u.tap)(()=>this._isLoading=!1))}copy(e,t={}){return this._isLoading=!0,this.getSchema().pipe((0,u.map)(s=>({schema:s,attributes:s.attributes.filter(r=>r.attributeType===x.OwnAttribute&&r.isValueCloneable).map(r=>r.name),parameters:typeof e=="string"?[{type:P.PrimaryColumnValue,value:e}]:s.getPrimaryAttributesNames().filter(r=>e[r]).map(r=>({type:P.PrimaryColumnValue,value:{[r]:e[r]}}))})),(0,u.mergeMap)(({schema:s,attributes:r,parameters:i})=>this._load((a,l,d)=>this.dataSource.load(a,l,d),r,i,{},A.Copy).pipe((0,u.tap)(()=>{this._isLoaded=!1}),(0,u.tap)(a=>{if(a.length>1)throw new Error("More than one record loaded for copy");if(a.length===0)throw new Error("No records loaded for copy")}),(0,u.map)(a=>G.removeNotRequestedData(r,{...a[0]})),(0,u.map)(a=>{s.getPrimaryAttributesNames().forEach(d=>delete a[d]);const l=G.getOwnColumnsValues(s,t);return{...a,...l}}),(0,u.switchMap)(a=>this.dataSource.getDefaultValues().pipe((0,u.map)(l=>({...l,...a})))),(0,u.tap)(a=>{this._persistedState={...a}}),(0,u.switchMap)(a=>this._loadDependentDataForCreate(a)),(0,u.tap)(()=>{this._isLoaded=!0,this._isLoading=!1}),(0,u.catchError)(a=>(this._isLoading=!1,this._markForNotCollection(A.Update),(0,o.throwError)(()=>new Error(a)))))))}insert(e){return this.innerInsert(t=>this.dataSource.insert(t),e)}update(e,t){return this.innerUpdate((s,r)=>this.dataSource.save(s,r),e,t)}insertOrUpdate(e,t){return this._mode===A.Update?this.update(e,t):this.insert(e)}delete(e){return this.innerDelete(t=>this.dataSource.delete(t),e)}setValue(e){const t=Object.keys(e);return this._checkAttributesInDataSchema(t).pipe((0,u.tap)(()=>{t.length>0&&(this._dirtyAttributes=new Set([...this._dirtyAttributes,...t]),this._persistedState={...this._persistedState??{},...e})}),(0,u.map)(()=>null))}_getPersistedState(){return{...this._persistedState??{}}}markFor(e){this.mode!==e&&(this._setMode(e),this._modeChanges.next(e))}resetMode(){this._mode!==A.Init&&(this._mode=A.Init,this._modeChanges.next(this._mode))}loadLookupList(e,t,s={}){if(!this.dataSource)throw Error("DataSource is null");const r=this.dataSource.getLookupDataSchema(e).pipe((0,u.switchMap)(i=>{const a=i.getPrimaryLoadAttributes();return this._createDataSource(this._lookupDataSourceName,i).pipe((0,u.switchMap)(l=>l.load(a,t,s)),(0,u.map)(l=>({primaryAttributeName:i.primaryAttributeName,primaryDisplayAttributeName:i.primaryDisplayAttributeName,data:l})))}));return(0,o.iif)(()=>!this._doNotAllowCancelRequest,r.pipe((0,u.takeUntil)(this._destroyed$)),r)}canDelete(e){return(0,o.lastValueFrom)(this.dataSource.canDelete(e),{defaultValue:null})}canSave(e){switch(this._mode){case A.Init:return Promise.resolve({result:!1});case A.Create:case A.Copy:return(0,o.lastValueFrom)(this.dataSource.canCreate(e),{defaultValue:null});case A.Update:return(0,o.lastValueFrom)(this.dataSource.canEdit(e),{defaultValue:null});case A.Delete:return this.canDelete(e);default:throw Error(`Unable to verify the possibility of operation executing: the '${this._mode}' is not supported.`)}}attributeChanged(e,t){t||this._selfDirty$.next(!0),this._dirtyAttributes.add(e)}setLoadedState(e=null){if(this._isCollectionModel||!e){this._dirtyAttributes.clear(),this._markAsPristine();return}e.forEach(t=>this._dirtyAttributes.delete(t)),this._dirtyAttributes.size||this._markAsPristine()}createCollectionItemModel(e){const t=new _r(this._injector,this.dataSource);return t._isCollectionItemModel=!0,t._isLoaded=!0,t._isInitialized=!0,t._persistedState={},t._dataSchemaName=this._dataSchemaName,t._attributesMap=this._attributesMap,e!=null&&(t._setMode(e),t._selfDirty$.next(!1)),this._children.push(t),t}childrenChange(){this._children$.next(this._children)}removeChild(e){const t=e?._id,s=this._children.findIndex(r=>r?._id===t);s!==-1&&this._children.splice(s,1)}_getAsyncResult(e){return(0,o.firstValueFrom)(e)}getLastError(){return this.dataSource?this.dataSource.getLastError():new Error("DataSource is null")}destroy(){this._isInitialized=!1,this._destroyed$.next(),this._destroyed$.complete(),this._selfDirty$.complete(),this._children$.complete(),this._childrenDirty$.complete(),this._childrenModes$.complete(),this._destroyed=!0}getOwnLoadParameters(){return this.dataSource.getOwnLoadParameters()}getAllowCopyingRecords(){return this.dataSource.getAllowCopyingRecords()}}(0,m.__decorate)([Re({requestType:"crt.ModelGenerator",methodName:"generateOne"}),(0,m.__metadata)("design:type",Function)],_r.prototype,"_create",void 0);let yr=class Jn{constructor(e,t,s,r){this.dataSourceFactory=e,this.entitySchemaRepository=t,this._featureValues=s,this._injector=r}_createModel(e=null,t=!1,s){const r=new _r(s||this._injector,e);return r.disableSync=t,r.init()}_validateModelConfig(e){if(e.primaryDataSourceName&&!e.dataSources[e.primaryDataSourceName])throw new Error(`Data source "${e.primaryDataSourceName}" cannot be primary data source. Data source "${e.primaryDataSourceName}" not found in model config.`);if(e.primaryDataSourceName&&e.dataSources[e.primaryDataSourceName]?.scope===Ee.ViewElement)throw new Error(`Data source "${e.primaryDataSourceName}" with scope "viewElement" cannot be primary. Only data sources with scope "page" can be primary`)}_getEntitySchemesRequest(e){return e.map(([,t])=>t).filter(t=>t.type==="crt.EntityDataSource").map(t=>t.config).filter(t=>!!t.entitySchemaName).map(t=>{let s=[];return t.attributes&&(s=Object.entries(t.attributes).filter(([,r])=>r.type===x.ForwardReferenceAttribute).map(([,r])=>r.path)),{name:t.entitySchemaName,loadLookupColumns:!0,forwardReferencePaths:s}})}_generateFromConfig(e,t){let s,r;const i=t?.get(te,null,{optional:!0});return i?(s=Object.entries(e?.dataSources||{}).filter(([a,l])=>l.type?!0:(console.warn(`Data source ${a} without type not supported.`),!1)),s.length===0?(0,o.of)([]):(this._validateModelConfig(e),r=s.map(([a,l])=>this.generateOne(l,a,t)),this.preInitializeDataSources(s).pipe(i.measure$("modelGenerator.generateFromConfig"),(0,o.switchMap)(()=>(0,o.forkJoin)(r))))):(s=Object.entries(e?.dataSources||{}).filter(([a,l])=>l.type?!0:(console.warn(`Data source ${a} without type not supported.`),!1)),s.length===0?(0,o.of)([]):(this._validateModelConfig(e),r=s.map(([a,l])=>this.generateOne(l,a,t)),this.preInitializeDataSources(s).pipe((0,o.switchMap)(()=>(0,o.forkJoin)(r)))))}preInitializeDataSources(e){if(this._featureValues["DataSource-DontUseOneRequestForEntitySchemes"])return(0,o.of)(null);const t=this._getEntitySchemesRequest(e);return this.entitySchemaRepository.getSchemes(t).pipe((0,u.catchError)(s=>(0,o.of)([])),(0,u.map)(s=>null))}generate(e,t){return this._generateFromConfig(e,t)}generateOne(e,t,s){const r=s?.get(te,null,{optional:!0});return r?this.dataSourceFactory.create(t,e,s).pipe(r.measure$(`modelGenerator.generateOne.${t}`),(0,u.mergeMap)(i=>this._createModel(i,e.disableSync,s))):this.dataSourceFactory.create(t,e,s).pipe((0,u.mergeMap)(i=>this._createModel(i,e.disableSync,s)))}static#e=this.\u0275fac=function(t){return new(t||Jn)(c.\u0275\u0275inject(Xe),c.\u0275\u0275inject(Te),c.\u0275\u0275inject(W),c.\u0275\u0275inject(c.Injector))};static#t=this.\u0275prov=c.\u0275\u0275defineInjectable({token:Jn,factory:Jn.\u0275fac})};yr=(0,m.__decorate)([at({requestType:"crt.ModelGenerator"}),(0,m.__metadata)("design:paramtypes",[Xe,Te,Si,c.Injector])],yr);class br{get contextService(){return this._contextService===void 0&&(this._contextService=this._injector.get(Sc,null)),this._contextService}constructor(e,t,s){this._modelGenerator=e,this._window=t,this._injector=s,this._schemaName="AcademyUrlData"}_createAcademyHelpUrlDataItem(e){return{configurationVersion:e.ConfigurationVersion,contextHelpCode:e.Code,contextHelpId:e.ContextHelpId,enableContextHelp:e.EnableContextHelp,lmsUrl:e.LMSUrl,productEdition:e.ProductEdition,useLmsDocumentation:e.UseLmsDocumentation}}_getSchemaColumns(){return["ContextHelpId","EnableContextHelp","Code","ProductEdition","ConfigurationVersion","UseLmsDocumentation","LMSUrl"]}_createDataSourceParameters(e){return[{type:P.Filter,value:this._getContextHelpCodeFilter(e)}]}_getContextHelpCodeFilter(e){return new ue(j.Equal,new k({columnPath:"Code"}),new $({value:e}))}_getAcademyHelpUrlData(e){return this._modelGenerator.generateOne({type:"crt.EntityDataSource",config:{entitySchemaName:this._schemaName}},"").pipe((0,u.switchMap)(t=>t.load({attributes:this._getSchemaColumns(),parameters:e})),(0,u.map)(t=>t.length===1?this._createAcademyHelpUrlDataItem(t[0]):null))}_buildUrl(e){let t="#";return e&&(t=e.useLmsDocumentation?this._getLmsDocumentationUrl(e):ze.String.empty),t}_getLmsDocumentationUrl(e){const t=[],s=e.productEdition;s&&t.push("product="+encodeURIComponent(s));const r=e.configurationVersion;r&&t.push("ver="+encodeURIComponent(r));const i=e.enableContextHelp,a=e.contextHelpId;return i&&a&&t.push("id="+encodeURIComponent(a)),`${e.lmsUrl}?${t.join("&")}`}getAcademyHelpUrl(e){if(e===ze.String.empty)return(0,o.of)(ze.String.empty);const t=this._createDataSourceParameters(e);return this._getAcademyHelpUrlData(t).pipe((0,u.map)(s=>s?this._buildUrl(s):ze.String.empty))}openContextHelp(){const e=this.contextService;if(!e)throw new Error(`${Sc.toString()} was not provided`);const t=e.getContextCode();this.getAcademyHelpUrl(t).subscribe(s=>{this._window.open(s)})}static#e=this.\u0275fac=function(t){return new(t||br)(c.\u0275\u0275inject(yr),c.\u0275\u0275inject(pe),c.\u0275\u0275inject(c.Injector))};static#t=this.\u0275prov=c.\u0275\u0275defineInjectable({token:br,factory:br.\u0275fac,providedIn:"root"})}class Ye{constructor(e,t,s,r){this._dialogService=e,this._translateService=t,this._academyHelpUrlService=s,this._domSanitizer=r,this._codeErrorDataSchema={columns:[new $l({name:"errorTypeIcon",formatter:(i,a)=>a.warning?ct.Warning:ct.Error}),{name:"fileName",caption:this._translateService.instant("ErrorListDialogService.FileNameColumn"),valueType:y.r.Text},{name:"errorText",caption:this._translateService.instant("ErrorListDialogService.ErrorTextColumn"),valueType:y.r.Text},{name:"errorNumber",caption:this._translateService.instant("ErrorListDialogService.ErrorNumberColumn"),valueType:y.r.Text},{name:"line",caption:this._translateService.instant("ErrorListDialogService.LineColumn"),valueType:y.r.Text}]},this._savePackagePropertiesErrorDataSchema={columns:[new ql({name:"itemType",caption:this._translateService.instant("ErrorListDialogService.ItemTypeColumn"),formatter:(i,a)=>this._getTypeIconName(a.itemType)},""),{name:"itemName",caption:this._translateService.instant("ErrorListDialogService.ItemNameColumn"),valueType:y.r.Text},{name:"message",caption:this._translateService.instant("ErrorListDialogService.DescriptionColumn"),valueType:y.r.Text},{name:"packageName",caption:this._translateService.instant("ErrorListDialogService.PackageNameColumn"),valueType:y.r.Text}]},this._codeValidationErrorDataSchema={columns:[{name:"source",caption:this._translateService.instant("ErrorListDialogService.SourceColumn"),valueType:y.r.Text},{name:"reference",caption:this._translateService.instant("ErrorListDialogService.ReferenceColumn"),valueType:y.r.Text},{name:"package",caption:this._translateService.instant("ErrorListDialogService.PackageColumn"),valueType:y.r.Text}]}}_getCompilationErrorsDialogData(e){return{title:this._translateService.instant("ErrorListDialogService.CodeErrorListDialogCaption"),dataSchema:this._codeErrorDataSchema,data:e,sortColumn:"fileName"}}_getPackagePropertiesErrorDialogData(e){return{title:this._translateService.instant("ErrorListDialogService.PackagePropertiesErrorDialogCaption"),additionalText:this._translateService.instant("ErrorListDialogService.PackagePropertiesErrorMessage"),dataSchema:this._savePackagePropertiesErrorDataSchema,data:e,sortColumn:"itemType"}}_getValidationErrorsDialogData(e,t){return{title:this._translateService.instant("ErrorListDialogService.CodeValidationErrorListDialogCaption"),dataSchema:this._codeValidationErrorDataSchema,data:t,sortColumn:"source",additionalText:e,helpLinkUrl:this._getHelpLinkUrl()}}_getTypeIconName(e){switch(e){case"Schema":return"workspace-item-entity-schema";case"Assembly":return"workspace-item-assembly";case"SqlScript":return"workspace-item-sql-script";case"SchemaData":return"workspace-item-schema-data";case"Package":return"workspace-item-package";default:return""}}_getHelpLinkUrl(){return{url:this._domSanitizer.bypassSecurityTrustUrl(this._academyUrl),caption:this._translateService.instant("ErrorListDialogService.AcademyHelpUrlCaption")}}_getAcademyHelpUrl(){return this._academyHelpUrlService.getAcademyHelpUrl("PackageHierarchyLoops")}showCompilationErrors(e){return this._dialogService.open(Dt,{data:this._getCompilationErrorsDialogData(e),panelClass:"compilation-error-dialog",disableClose:!0})}showValidationErrors(e,t,s=[]){return this._getAcademyHelpUrl().pipe((0,u.switchMap)(r=>(this._academyUrl=r,this._dialogService.open(Dt,{data:this._getValidationErrorsDialogData(e,t),panelClass:["validation-error-dialog",...s],disableClose:!0}))))}showSavePackagePropertiesErrors(e){return this._dialogService.open(Dt,{data:this._getPackagePropertiesErrorDialogData(e),panelClass:"save-package-properties-error-dialog",disableClose:!0})}static#e=this.\u0275fac=function(t){return new(t||Ye)(c.\u0275\u0275inject(ut),c.\u0275\u0275inject(T.TranslateService),c.\u0275\u0275inject(br),c.\u0275\u0275inject(_.DomSanitizer))};static#t=this.\u0275prov=c.\u0275\u0275defineInjectable({token:Ye,factory:Ye.\u0275fac})}class Sr{constructor(e){this._errorListDialogService=e,this._subscription=new o.Subscription}ngOnInit(){this.validationErrorsList?.length>0?this._subscription.add(this._errorListDialogService.showValidationErrors(this.validationErrorMessage,this.validationErrorsList).subscribe()):this._errorListDialogService.showCompilationErrors(this.errorsList)}ngOnDestroy(){this._subscription.unsubscribe()}static#e=this.\u0275fac=function(t){return new(t||Sr)(c.\u0275\u0275directiveInject(Ye))};static#t=this.\u0275cmp=c.\u0275\u0275defineComponent({type:Sr,selectors:[["ts-error-list-dialog-proxy"]],inputs:{errorsList:"errorsList",validationErrorsList:"validationErrorsList",validationErrorMessage:"validationErrorMessage"},decls:0,vars:0,template:function(t,s){},encapsulation:2})}const gh="DataService/json/SyncReply",_h="DataService/ssp/json/SyncReply",mn=new c.InjectionToken("DataServiceUri"),Gc={provide:mn,useFactory:n=>n?.isSSP?_h:gh,deps:[[new c.Optional,Me.oq]]};class qt{_getEntitySchemaColumnsDataValueTypesMap(e){return e.columns.reduce((t,s)=>(t[s.name]=s.dataValueType,t),{})}_getEntityColumnsDataValueTypesMap(e){return Object.keys(e).reduce((t,s)=>(t[s]=e[s].dataValueType,t),{})}_parseRawColumnValue(e,t){switch(t){case y.r.Date:case y.r.Time:case y.r.DateTime:return Oc(e);default:return e}}_parseRawEntityObject(e,t){const s={};return Object.keys(e).forEach(r=>{const i=e[r];s[r]=t[r]?this._parseRawColumnValue(i,t[r]):i}),s}deserializeEntity(e,t){N.checkArgumentEmpty("columnsConfig",e),N.checkArgumentEmpty("rawEntity",t);const s=this._getEntityColumnsDataValueTypesMap(e);return this._parseRawEntityObject(t,s)}deserializeEntities(e,t){N.checkArgumentEmpty("columnsConfig",e),N.checkArgumentEmpty("rawEntities",t);const s=this._getEntityColumnsDataValueTypesMap(e);return t.map(r=>this._parseRawEntityObject(r,s))}deserializeEntitySchemaRecord(e,t){N.checkArgumentEmpty("entitySchema",e),N.checkArgumentEmpty("rawEntities",t);const s=this._getEntitySchemaColumnsDataValueTypesMap(e);return this._parseRawEntityObject(t,s)}deserializeEntitySchemaRecords(e,t){N.checkArgumentEmpty("entitySchema",e),N.checkArgumentEmpty("rawEntities",t);const s=this._getEntitySchemaColumnsDataValueTypesMap(e);return t.map(r=>this._parseRawEntityObject(r,s))}static#e=this.\u0275fac=function(t){return new(t||qt)};static#t=this.\u0275prov=c.\u0275\u0275defineInjectable({token:qt,factory:qt.\u0275fac,providedIn:"root"})}class yh extends cr{}var Cr;(function(n){n[n.General=0]="General",n[n.Limited=1]="Limited"})(Cr||(Cr={}));var Oi;(function(n){n[n.Undefined=0]="Undefined",n[n.Filter=1]="Filter",n[n.FilterSummary=2]="FilterSummary"})(Oi||(Oi={}));var Li;(function(n){n[n.Session=0]="Session",n[n.Workspace=1]="Workspace",n[n.Application=2]="Application"})(Li||(Li={}));class bh{constructor(e=Li.Session,t="",s=""){this._cacheLevel=e,this._cacheGroup=t,this._cacheItemName=s}getMetadata(){return{cacheLevel:this._cacheLevel,cacheGroup:this._cacheGroup,cacheItemName:this._cacheItemName}}}class fn extends Error{constructor(e){const t=e?.error?.responseStatus?.Message||e?.responseStatus?.Message||e?.message;super(t),this.errorCode=e?.error?.responseStatus?.ErrorCode}}class Kc extends Error{constructor(e){super(`Query with config
${JSON.stringify(e.getMetadata())}
finished with error.`)}}let gn=class extends xe{constructor(e,t,s){super(),this._sysSettingsService=e,this._httpClient=t,this._dataServiceUri=s,this._defaultDebounceTime=200,this._debounceTimeSysSettingName="QueryExecutorDebounceTime",this._requests=new o.Subject,N.checkArgumentEmpty("_httpClient",t),N.checkArgumentEmpty("_dataServiceUri",s)}_executeWritableQuery(e,t){const r={...e.getMetadata(),queryKind:Cr.General};return this._httpClient.post(t,r).pipe((0,u.catchError)(i=>{throw new fn(i)}),(0,u.tap)(i=>{if(!(i&&i.success))throw new Kc(e)}))}_getQueryUri(e){if(e instanceof yh)return`${this._dataServiceUri}/SelectLocalizationQuery`;if(e instanceof cr)return`${this._dataServiceUri}/SelectQuery`;if(e instanceof Mi)return`${this._dataServiceUri}/InsertQuery`;if(e instanceof Ei)return`${this._dataServiceUri}/UpdateQuery`;if(e instanceof xc)return`${this._dataServiceUri}/DeleteQuery`;throw new Error("Unsupported query type")}_getBundleSettings(){var e=this;return(0,S.A)(function*(){return e._sysSettingsService?{executionDebounceTime:(yield e._sysSettingsService.getByCodes([e._debounceTimeSysSettingName])).values[e._debounceTimeSysSettingName]?.value||e._defaultDebounceTime}:Promise.resolve({executionDebounceTime:e._defaultDebounceTime})})()}_prepareDebouncedResponsesStream(){if(this._responses)return;let e=0;const t=(0,u.buffer)(this._requests.pipe((0,u.switchMap)(()=>(0,o.from)(this._getBundleSettings())),(0,u.tap)(s=>e=s.executionDebounceTime),(0,u.debounceTime)(e)));this._responses=this._requests.pipe(t,(0,u.filter)(s=>!!s.length),(0,u.mergeMap)(s=>{const r=s.map(a=>a.id),i=s.map(a=>a.query);return this.executeBatchSelectQuery(i).pipe((0,u.map)(a=>r.reduce((l,d,h)=>l.set(d,a[h]),new Map)))}),(0,u.share)())}_executeThrottled(e){this._prepareDebouncedResponsesStream();const t={id:O(),query:e},s=this._responses.pipe((0,u.filter)(r=>r.has(t.id)),(0,u.map)(r=>r.get(t.id)),(0,u.take)(1));return s.subscribe(),this._requests.next(t),s}_executeImmediate(e){N.checkArgumentEmpty("query",e);const t=this._getQueryUri(e),s=this._getQueryRequest(e);return this._httpClient.post(t,s).pipe((0,u.catchError)(r=>{throw new fn(r)}),(0,u.tap)(r=>{if(!r?.rows)throw new Kc(e)}),(0,u.map)(r=>this._toSelectQueryResponse(r)))}_toSelectQueryResponse(e){const t=this.getRowsFromResponse(e);return t.rowsAffected=e.rowsAffected,e.errorInfo&&(t.errorInfo=e.errorInfo),t}_getQueryRequest(e){const t=e.getMetadata();return e instanceof cr?{...t,queryKind:Cr.General,serverESQCacheParameters:new bh().getMetadata(),queryOptimize:!1,useMetrics:!1,querySource:Oi.Undefined}:{...t,queryKind:Cr.General}}getRowsFromResponse(e){return e.rows}executeSelectQuery(e,t={throttled:!1}){return t.throttled?this._executeThrottled(e):this._executeImmediate(e)}executeInsertQuery(e){return this.execute(e)}executeUpdateQuery(e){return this.execute(e)}executeDeleteQuery(e){return this.execute(e)}execute(e){N.checkArgumentEmpty("query",e);const t=this._getQueryUri(e);return this._executeWritableQuery(e,t)}executeBatchSelectQuery(e){if(N.checkArgumentEmpty("queries",e),e.length===0)return(0,o.of)([]);const t=`${this._dataServiceUri}/BatchQuery`,s={items:[]};return s.items=e.map(r=>({...this._getQueryRequest(r),__type:"Terrasoft.Nui.ServiceModel.DataContract.SelectQuery"})),this._httpClient.post(t,s).pipe((0,u.catchError)(r=>{throw new fn(r)}),(0,u.tap)(r=>{if(!r||r.hasErrors)throw new fn(r)}),(0,u.map)(r=>r.queryResults.map(i=>this._toSelectQueryResponse(i))))}commitTransaction(e){throw new Error("Method not implemented.")}rollbackTransaction(e){throw new Error("Method not implemented.")}};gn=(0,m.__decorate)([(0,m.__param)(0,(0,c.Optional)()),(0,m.__param)(2,(0,c.Inject)(mn)),(0,m.__metadata)("design:paramtypes",[ae,D.HttpClient,String])],gn);let Bi=class Zn extends gn{constructor(e,t,s,r){super(e,t,r),this._entityDeserializer=s}getRowsFromResponse(e){return this._entityDeserializer.deserializeEntities(e.rowConfig,e.rows)}static#e=this.\u0275fac=function(t){return new(t||Zn)(c.\u0275\u0275inject(ae,8),c.\u0275\u0275inject(D.HttpClient),c.\u0275\u0275inject(qt),c.\u0275\u0275inject(mn))};static#t=this.\u0275prov=c.\u0275\u0275defineInjectable({token:Zn,factory:Zn.\u0275fac})};Bi=(0,m.__decorate)([at({requestType:"crt.DataServiceQueryExecutor"}),(0,m.__metadata)("design:paramtypes",[ae,D.HttpClient,qt,String])],Bi);class Ar{static#e=this.\u0275fac=function(t){return new(t||Ar)};static#t=this.\u0275mod=c.\u0275\u0275defineNgModule({type:Ar});static#s=this.\u0275inj=c.\u0275\u0275defineInjector({providers:[Gc,{provide:xe,useClass:Bi}]})}class ki{static#e=this.\u0275fac=function(t){return new(t||ki)};static#t=this.\u0275mod=c.\u0275\u0275defineNgModule({type:ki});static#s=this.\u0275inj=c.\u0275\u0275defineInjector({providers:[Gc,{provide:xe,useFactory:(e,t,s)=>new gn(e,t,s),deps:[[new c.Optional,ae],D.HttpClient,mn]}]})}class vr{constructor(e){this.data=e}static#e=this.\u0275fac=function(t){return new(t||vr)(c.\u0275\u0275directiveInject(z.MAT_LEGACY_DIALOG_DATA))};static#t=this.\u0275cmp=c.\u0275\u0275defineComponent({type:vr,selectors:[["ts-info-with-header-dialog"]],decls:9,vars:10,consts:[[1,"header-message"],[1,"message"],[1,"action-button",3,"mat-dialog-close"]],template:function(t,s){t&1&&(c.\u0275\u0275elementStart(0,"div",0),c.\u0275\u0275text(1),c.\u0275\u0275pipe(2,"translate"),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementStart(3,"div",1),c.\u0275\u0275text(4),c.\u0275\u0275pipe(5,"translate"),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementStart(6,"button",2),c.\u0275\u0275text(7),c.\u0275\u0275pipe(8,"translate"),c.\u0275\u0275elementEnd()),t&2&&(c.\u0275\u0275advance(),c.\u0275\u0275textInterpolate(c.\u0275\u0275pipeBind1(2,4,s.data==null?null:s.data.headerMessage)),c.\u0275\u0275advance(3),c.\u0275\u0275textInterpolate(c.\u0275\u0275pipeBind1(5,6,s.data==null?null:s.data.message)),c.\u0275\u0275advance(2),c.\u0275\u0275property("mat-dialog-close",s.data==null||s.data.button==null?null:s.data.button.result),c.\u0275\u0275advance(),c.\u0275\u0275textInterpolate1(" ",c.\u0275\u0275pipeBind1(8,8,s.data==null||s.data.button==null?null:s.data.button.caption),`
`))},dependencies:[z.MatLegacyDialogClose,T.TranslatePipe],styles:[".header-message[_ngcontent-%COMP%]{margin-bottom:24px}.message[_ngcontent-%COMP%]{margin-bottom:40px;white-space:pre-wrap}.action-button[_ngcontent-%COMP%]{float:right;text-transform:none;border-radius:16px;padding:0 16px}"]})}class Ht{static#e=this.\u0275fac=function(t){return new(t||Ht)};static#t=this.\u0275mod=c.\u0275\u0275defineNgModule({type:Ht});static#s=this.\u0275inj=c.\u0275\u0275defineInjector({providers:[ut,{provide:ni.FocusTrapFactory,useClass:ni.ConfigurableFocusTrapFactory}],imports:[R.CommonModule,Fs.MatLegacyButtonModule,z.MatLegacyDialogModule,T.TranslateModule]})}(function(){(typeof ngJitMode>"u"||ngJitMode)&&c.\u0275\u0275setNgModuleScope(Ht,{declarations:[Nt,Vt,vr],imports:[R.CommonModule,Fs.MatLegacyButtonModule,z.MatLegacyDialogModule,T.TranslateModule],exports:[Nt,Vt,vr]})})();class Sh{handleRequest(e,t={}){let s=e;return s=this.processResponse(t,s),s.pipe((0,u.catchError)(r=>{let i;return r instanceof Error?i=r.message:(typeof r.error?.errorInfo=="object"&&(i=r.error.errorInfo.message),typeof r.error=="string"&&(i=r.error)),i||(i=JSON.stringify(r.message)),this.processErrorMessage(i),(0,o.throwError)(()=>new Error(i))}))}processResponse(e,t){return e.skipUnsuccessfulResponse||(t=t.pipe((0,u.tap)(s=>this.processUnsuccessfulResponse(s)))),t}processUnsuccessfulResponse(e){const{success:t,errorInfo:s}=e||{};!t&&s&&this.processErrorMessage(s.message)}}class Ch extends Sh{constructor(){super(...arguments),this._accumulatedErrorResponses=[]}_accumulateError(e){const t=(0,v.cloneDeep)(e);this._accumulatedErrorResponses.push(t)}_stopAccumulatingErrors(){this._accumulatedErrorResponses=[]}get accumulatedErrorResponses(){return this._accumulatedErrorResponses}processUnsuccessfulResponse(e){if(this._accumulateErrors&&this.canAccumulate(e)){this._accumulateError(e),this.processAccumulatedResponse(e);return}this.processSeparatedResponse(e)}handleRequestWithAccumulation(e,t){let s=!1;return this._accumulateErrors||(this._accumulateErrors=!0,s=!0),this.handleRequest(e,t).pipe((0,u.tap)(()=>{s&&(this.showAccumulatedErrors(),this._stopAccumulatingErrors())}),(0,u.catchError)(r=>{throw this._stopAccumulatingErrors(),r}))}}class Er extends Ch{constructor(e,t){super(),this._dialogService=e,this._errorListDialogService=t,this._subscription=new o.Subscription}_showValidationErrors(e,t){this._subscription.add(this._errorListDialogService.showValidationErrors(e,t).subscribe())}processAccumulatedResponse(e){const t=e;t.success=!0,delete t.errorInfo,delete t.validationErrors}canAccumulate(e){return e?.errorInfo?.errorCode==="AutoAddPackageDependenciesValidateException"}showAccumulatedErrors(){const e=(0,v.cloneDeep)(this.accumulatedErrorResponses),t=e.shift();if(e.forEach(s=>{const r=s,i=t.validationErrors??[],a=r.validationErrors,l=i.some(d=>a?.find(h=>(0,v.isEqual)(h,d)));!(0,v.isEmpty)(a)&&!l&&(t.validationErrors=[...i,...a])}),t){const s=t.errorInfo?.message;this._showValidationErrors(s,t.validationErrors)}}processSeparatedResponse(e){const{validationErrors:t,errorInfo:s}=e||{};t?.length>0?this._showValidationErrors(s.message,t):s&&s.message&&this.processErrorMessage(s.message)}processErrorMessage(e){this._dialogService.openInfoDialog(e)}ngOnDestroy(){this._subscription.unsubscribe()}static#e=this.\u0275fac=function(t){return new(t||Er)(c.\u0275\u0275inject(ut),c.\u0275\u0275inject(Ye))};static#t=this.\u0275prov=c.\u0275\u0275defineInjectable({token:Er,factory:Er.\u0275fac})}class zt{static#e=this.\u0275fac=function(t){return new(t||zt)};static#t=this.\u0275mod=c.\u0275\u0275defineNgModule({type:zt});static#s=this.\u0275inj=c.\u0275\u0275defineInjector({providers:[Ye,Er],imports:[R.CommonModule,Ht]})}(function(){(typeof ngJitMode>"u"||ngJitMode)&&c.\u0275\u0275setNgModuleScope(zt,{imports:[R.CommonModule,Ht]})})();var ge=b(56711);class Mr extends cn{constructor(){super(...arguments),this.requestType="crt.FeatureService"}}(0,m.__decorate)([Re(),(0,m.__metadata)("design:type",Function)],Mr.prototype,"getFeatureState",void 0),(0,m.__decorate)([Re(),(0,m.__metadata)("design:type",Function)],Mr.prototype,"getFeaturesState",void 0);function Wc(n){return e=>bl(n,e)}var Ah=b(40234);const vh={name:"crt-shell-db",version:3,objectStoresMeta:[{store:"images",storeConfig:{keyPath:"id",autoIncrement:!0},storeSchema:[{name:"key",keypath:"key",options:{unique:!0}},{name:"dataUrl",keypath:"dataUrl",options:{unique:!1}}]},{store:"business-rules",storeConfig:{keyPath:"id",autoIncrement:!0},storeSchema:[{name:"key",keypath:"key",options:{unique:!0}},{name:"data",keypath:"data",options:{unique:!1}}]},{store:"common",storeConfig:{keyPath:"id",autoIncrement:!0},storeSchema:[{name:"key",keypath:"key",options:{unique:!0}},{name:"data",keypath:"data",options:{unique:!1}}]}],isDefault:!0};class Gt{constructor(e){this.dbService=e,this._cache=new Map,this._dbReady=!0}_getLocalCache(e){return this._cache.has(e)||this._cache.set(e,new Map),this._cache.get(e)}_clearLocalCache(e){this._getLocalCache(e).clear()}_setItemToLocalCache(e,t,s){this._getLocalCache(e).set(t,s)}_getItemFromLocalCache(e,t){return this._getLocalCache(e).get(t)}_hasItemInLocalCache(e,t){return this._getLocalCache(e).has(t)}_handleError(){return this._dbReady&&(indexedDB.deleteDatabase(vh.name),console.warn("IndexedDB has been refreshed"),this._dbReady=!1),(0,o.of)(void 0)}_executeIndexedDBOperation(e,t){return this._dbReady?e():(0,o.of)(t)}add(e,t){return this._executeIndexedDBOperation(()=>this.dbService.add(e,t),void 0).pipe((0,o.catchError)(()=>this._handleError()),(0,o.tap)(s=>this._setItemToLocalCache(e,t.key,s??t)))}getByKey(e,t){return this._hasItemInLocalCache(e,t)?(0,o.of)(this._getItemFromLocalCache(e,t)):this._executeIndexedDBOperation(()=>this.dbService.getByIndex(e,"key",t),null).pipe((0,o.catchError)(()=>this._handleError()),(0,o.tap)(s=>this._setItemToLocalCache(e,t,s)))}clear(e){return this._executeIndexedDBOperation(()=>this.dbService.clear(e),!1).pipe((0,o.catchError)(()=>this._handleError()),(0,o.tap)(()=>this._clearLocalCache(e)))}update(e,t){return this._executeIndexedDBOperation(()=>this.dbService.update(e,t),void 0).pipe((0,o.catchError)(()=>this._handleError()),(0,o.tap)(s=>this._setItemToLocalCache(e,t.key,s??t)))}static#e=this.\u0275fac=function(t){return new(t||Gt)(c.\u0275\u0275inject(Ah.NgxIndexedDBService))};static#t=this.\u0275prov=c.\u0275\u0275defineInjectable({token:Gt,factory:Gt.\u0275fac})}function Eh(n){return(0,S.A)(function*(){const e=n.get(Ks,null),t=n.get(Gt,null);if(!e||!t){console.warn("ApplicationInfoService or CrtIndexedDBService not provided for businessRulesDBInitializerFactory");return}try{const r=(yield(0,o.lastValueFrom)(e.loadApplicationInfo())).applicationInfo?.configurationContentHash,i="business-rules";if(r){const a="business-rules-hash",l="common",d=yield(0,o.firstValueFrom)(t.getByKey(l,a));d?.data!==r&&(yield(0,o.lastValueFrom)(t.clear(i)),d?yield(0,o.lastValueFrom)(t.update(l,{id:d.id,key:a,data:r})):yield(0,o.lastValueFrom)(t.add(l,{key:a,data:r})))}else yield(0,o.lastValueFrom)(t.clear(i))}catch(s){console.error("Error initializing business rules cache db",s)}})}var H;(function(n){n.ChangeAttributeValue="ChangeAttributeValue",n.ChangeAttributeProperty="ChangeAttributeProperty",n.DataLoaded="DataLoaded",n.ContextReady="ContextReady"})(H||(H={}));var _e;(function(n){n.Model="Model",n.ViewModel="ViewModel"})(_e||(_e={}));var Qe;(function(n){n.Unknown="Unknown",n.Init="Init",n.Create="Create",n.Copy="Copy",n.Update="Update"})(Qe||(Qe={}));const Jc=new Map([[0,H.ChangeAttributeValue],[1,H.ChangeAttributeProperty],[2,H.DataLoaded]]);function Fi(n){return Jc.has(n)?Jc.get(n):H.DataLoaded}class Kt{canExecute(e,t,s){const r=s.map(i=>i.triggers).flat();return r.length===0?!1:r.some(i=>{const a=Fi(i.type);if(a===H.DataLoaded&&e.scopeType===_e.Model)return e.triggers.some(d=>d.type===H.DataLoaded);if(!i.scopeId)return e.triggers.some(d=>d.name===i.name&&d.type===a);const l=t.find(d=>d.scopeId===i.scopeId);return l==null?!1:l.triggers.some(d=>d.name===i.name&&d.type===a)})}static#e=this.\u0275fac=function(t){return new(t||Kt)};static#t=this.\u0275prov=c.\u0275\u0275defineInjectable({token:Kt,factory:Kt.\u0275fac})}const Mh="Terrasoft.Core.BusinessRules.Models.Conditions.BusinessRuleGroupCondition";function Zc(n){return n&&"path"in n?n.path:""}function Ih(n){const e=[];return n.conditions&&n.conditions.forEach(t=>{const s=Xc(t);e.push(...s)}),e}function Xc(n){if(Yc(n))return Ih(n);const e=n;return[Zc(e.leftExpression),Zc(e.rightExpression)].filter(t=>t)}function Rh(n,e){return n.flatMap(t=>e.get(t).getRequiredItems()).map(t=>t.name)}function Yc(n){return n.typeName===Mh}function Qc(n){return n.map(e=>Xc(e)).flat().filter(e=>e!=null)}function wh(n,e){return n.flatMap(t=>t.cases.flatMap(s=>Rh(s.actions,e)))}function Ph(n){return!n.cases||n.cases.length===0?[]:n.cases.map(e=>e.condition).filter(e=>e!=null)}function eu(n){return n.map(e=>Ph(e)).flat()}var Wt;(function(n){n.Const="Const",n.SysValue="SysValue",n.SysSetting="SysSetting",n.AttributeValue="AttributeValue",n.AttributeProperty="AttributeProperty",n.Formula="Formula"})(Wt||(Wt={}));const Dh=[Wt.Const,Wt.SysValue,Wt.SysSetting],Th=new Set(Dh);function tu(n){return n?!!n.type&&Th.has(n.type):!0}function Nh(n){return n.conditions?n.conditions.every(e=>su(e)):!1}function su(n){if(!n)return!1;if(Yc(n))return Nh(n);const e=n;return(0,v.isNil)(e.leftExpression)&&(0,v.isNil)(e.rightExpression)?!1:tu(e.leftExpression)&&tu(e.rightExpression)}function ru(n){return n.some(e=>e.type===H.ContextReady)}function Vh(n,e){return ru(n)?e.some(t=>su(t)):!1}function xh(n,e){return ru(n)?e.some(t=>t.cases?.some(s=>!s.condition)):!1}class Jt{_canExecuteByConditionsAttributePaths(e,t){const s=e.filter(i=>i.type!==H.DataLoaded).map(i=>i.name);if(!s||s.length===0)return!1;const r=new Set(Qc(t));return s.some(i=>r.has(i))}canExecute(e,t){if(!t||t.length===0)return!1;const s=eu(t),r=Vh(e.triggers,s),i=xh(e.triggers,t);return r||i?!0:this._canExecuteByConditionsAttributePaths(e.triggers,s)}static#e=this.\u0275fac=function(t){return new(t||Jt)};static#t=this.\u0275prov=c.\u0275\u0275defineInjectable({token:Jt,factory:Jt.\u0275fac})}class Be{static#e=this._actionAppliers=new Map;static register(e,t){Be._actionAppliers.set(e,t)}get(e){const t=Be._actionAppliers.get(e.typeName);if(!t)throw new Error(`Business rule applier for change type ${e.typeName} not found.`);return new t(e)}static#t=this.\u0275fac=function(t){return new(t||Be)};static#s=this.\u0275prov=c.\u0275\u0275defineInjectable({token:Be,factory:Be.\u0275fac})}class Zt{constructor(e){this._actionApplierFactory=e}_applyBusinessRuleAction(e,t,s){const r=this._actionApplierFactory.get(s);return(0,o.firstValueFrom)(r.apply(e,t))}_applyBusinessRule(e,t){var s=this;return(0,S.A)(function*(){const r={id:t.scopeId,name:t.scopeName,type:t.scopeType,triggers:t.triggers};if(t.actions.length===0)return Promise.resolve(null);const i=[];for(const a of t.actions){const l=yield s._applyBusinessRuleAction(e,r,a);i.push(l)}return i})()}_applyBusinessRules(e,t){var s=this;return(0,S.A)(function*(){const r=[];for(const i of t){const a=yield s._applyBusinessRule(e,i);r.push(a)}return r})()}applyRules(e,t){return t&&t.length>0?(0,o.from)(this._applyBusinessRules(e,t)):(0,o.of)(null)}static#e=this.\u0275fac=function(t){return new(t||Zt)(c.\u0275\u0275inject(Be))};static#t=this.\u0275prov=c.\u0275\u0275defineInjectable({token:Zt,factory:Zt.\u0275fac})}class nu{constructor(e){this.typeName="Terrasoft.Core.BusinessRules.Models.BusinessRuleAction",this.enabled=!0,this.uId=e?.uId||O(),e&&(this.enabled=e.enabled)}toMetadata(){return{typeName:this.typeName,uId:this.uId,enabled:this.enabled}}getTypeName(){return this.typeName}getApplicability(){return[]}isValid(){return!0}onDataSourceAttributeNameChanged(e,t,s){}isAttributeUsed(e,t){return!1}getAffectedItems(){return[]}getRequiredItems(){return[]}}const Oh="businessRuleActionDesignerType";function le(n){return function(e){Reflect.defineMetadata(Oh,n,e)}}class yt{get dataValueTypeName(){return this._dataValueTypeName}set dataValueTypeName(e){this._dataValueTypeName=e}get isLookup(){return this.dataValueTypeName===on.Q[y.r.Lookup].name}get referenceSchemaName(){return this._referenceSchemaName}set referenceSchemaName(e){this._referenceSchemaName!==e&&(this._referenceSchemaName=e)}constructor(e){this.typeName="Terrasoft.Core.BusinessRules.Models.Expressions.BusinessRuleExpression",this._dataValueTypeName="",this._referenceSchemaName="",this.type=Wt.Const,this.uId=e?.uId||O(),e&&(this._dataValueTypeName=e.dataValueTypeName??"",this.type=e.type||this.type,this._referenceSchemaName=e.referenceSchemaName??"")}toMetadata(){return{typeName:this.typeName,uId:this.uId,type:this.type,dataValueTypeName:this.dataValueTypeName,referenceSchemaName:this.referenceSchemaName}}copy(){return new yt({...this.toMetadata(),uId:O()})}isValid(){return!!this.uId}onDataSourceAttributeNameChanged(e,t,s){}getAffectedItem(){return null}clear(){throw new Error(`clear not implemented for BusinessRuleDesignExpression ${this.constructor.name}`)}setValue(e){throw new Error(`setValue not implemented for BusinessRuleDesignExpression ${this.constructor.name}`)}getValue(){throw new Error(`getValue not implemented for BusinessRuleDesignExpression ${this.constructor.name}`)}isEmpty(){throw new Error(`isEmpty not implemented for BusinessRuleDesignExpression ${this.constructor.name}`)}isAttributeUsed(e,t){return!1}}class _n{static#e=this._expressionsTypes=new Map;static register(e,t){this._expressionsTypes.set(e,t)}static _getExpressionType(e){return this._expressionsTypes.get(e)??null}get(e){if(!e)return new yt;const t=_n._getExpressionType(e.typeName);return t?new t(e):new yt(e)}}function Lh(n,e){return!!e?.find(s=>!s.scopeId&&s.triggers.find(r=>r.name===n.name))}function Bh(n,e){return!!e?.find(s=>s.scopeName===n.scopeName&&s.triggers?.find(r=>r.name===n.name))}function kh(n,e,t){if(e.scopeName===n){if(Lh(e,t))return!1}else if(Bh(e,t))return!1;return!0}function iu(n,e){return n===e||au(n)&&au(e)}function au(n){return!n||n==="null"}function ji(n){return function(e){_n.register(n.typeName,e)}}var $i;let Ui=$i=class extends yt{constructor(e){super(e),this.typeName="Terrasoft.Core.BusinessRules.Models.Expressions.BusinessRuleAttributeExpression",this.path="",this.scopeId="",e&&(this.path=e.path,this.scopeId=e.scopeId==="null"?"":e.scopeId)}toMetadata(){return{...super.toMetadata(),path:this.path,scopeId:this.scopeId}}copy(){return new $i({...this.toMetadata(),uId:O()})}isValid(){return super.isValid()&&!!this.path}onDataSourceAttributeNameChanged(e,t,s){this.scopeId===e&&this.path===t&&(this.path=s)}getAffectedItem(){return{name:this.path}}isAttributeUsed(e,t){return this.path===t&&iu(this.scopeId,e)}};Ui=$i=(0,m.__decorate)([ji({typeName:"Terrasoft.Core.BusinessRules.Models.Expressions.BusinessRuleAttributeExpression"}),(0,m.__metadata)("design:paramtypes",[Object])],Ui);var yn;let et=yn=class extends nu{constructor(e){super(e),this._expressionFactory=new _n,this.typeName="Terrasoft.Core.BusinessRules.Models.BusinessRuleAction",this.executorName="",e&&(this.executorName=e.executorName,this.expression=new Ui(e.expression),e.value&&(this.value=this._expressionFactory.get(e.value)))}getExpressionAffectedItems(){const e=this.expression?.getAffectedItem()??null;return e?[e]:[]}toMetadata(){return{...super.toMetadata(),executorName:this.executorName,expression:this.expression?.toMetadata(),value:this.value?.toMetadata()}}clone(){return new yn(this.toMetadata())}copy(){const e=new yn({...this.toMetadata(),uId:O()});return e.expression=this.expression?.copy(),e.value=this.value?.copy(),e}getApplicability(){if(!this.expression?.path)return[];const t=this.expression.path.split(".").shift();return t?[{path:t}]:[]}isValid(){return super.isValid()&&!!this.expression?.isValid()&&!!this.value?.isValid()}getAffectedItems(){const e=this.getExpressionAffectedItems();return[...super.getAffectedItems(),...e]}};et=yn=(0,m.__decorate)([le("BusinessRuleDesignAction"),(0,m.__metadata)("design:paramtypes",[Object])],et);class Fh extends nu{constructor(){super(...arguments),this.typeName="Terrasoft.Core.BusinessRules.Models.Actions.BusinessRuleActionSetProperty"}}class Xt extends Fh{constructor(e){super(e),this.items=[],e&&(Array.isArray(e.items)?this.items=e.items:this.items=e.items?.length>0?e.items.split(","):[])}_getAffectedItems(){return(this.items??[]).map(t=>({name:t}))}toMetadata(){return{...super.toMetadata(),items:this.items?.length>0?this.items.join(","):""}}getApplicability(){return this.isValid()?this.items.map(e=>({path:e})):[]}isValid(){return super.isValid()&&this.items?.length>0}getAffectedItems(){return[...super.getAffectedItems(),...this._getAffectedItems()]}isAttributeUsed(e,t){return this.items.includes(t)}}var bn;const jh="Terrasoft.Core.BusinessRules.Models.Actions.BusinessRuleActionEditableElement";let qi=bn=class extends Xt{constructor(){super(...arguments),this.typeName=jh}clone(){return new bn(this.toMetadata())}copy(){return new bn({...this.toMetadata(),uId:O()})}};qi=bn=(0,m.__decorate)([le("BusinessRuleEditableElementDesignAction")],qi);var Hi;let Sn=Hi=class extends yt{constructor(e){super(e),this.typeName="Terrasoft.Core.BusinessRules.Models.Expressions.BusinessRuleFilterLookupExpression",this.path="",this.filterExpression="",e&&(this.path=e.path,this.filterExpression=e.filterExpression==="null"?"":e.filterExpression)}toMetadata(){return{...super.toMetadata(),path:this.path,filterExpression:this.filterExpression}}copy(){return new Hi({...this.toMetadata(),uId:O()})}isValid(){return super.isValid()&&!!this.path&&!!this.filterExpression}getAffectedItem(){return{name:this.path}}isAttributeUsed(e,t){return this.path===t}};Sn=Hi=(0,m.__decorate)([ji({typeName:"Terrasoft.Core.BusinessRules.Models.Expressions.BusinessRuleFilterLookupExpression"}),(0,m.__metadata)("design:paramtypes",[Object])],Sn);var Cn;let zi=Cn=class extends et{constructor(e){super(e),this.typeName="Terrasoft.Core.BusinessRules.Models.Actions.BusinessRuleActionFilterLookup",this.clearValue=!1,this.populateValue=!1,e?(this.clearValue=e.clearValue??!1,this.populateValue=e.populateValue??!1):(this.clearValue=!0,this.populateValue=!0),this._processMetadata(e)}_isOldMetadataFormat(e){const t=!!e.expression?.path&&e.expression.path!=="null",s=e.value,r=!!s?.value&&s.value!=="null";return t&&r}_convertOldMetadata(e){const t={...e},s=e.expression?.path||"",i=e.value?.value,a={path:i,filterExpression:""},l={path:s,filterExpression:""};if(i.includes(".")){const[d,...h]=i.split(".");a.path=d,a.filterExpression=h.join(".")}return{...t,leftExpression:a,rightExpression:l}}_processMetadata(e){e&&(this._isOldMetadataFormat(e)&&(e=this._convertOldMetadata(e)),delete this.expression,delete this.value,this.leftExpression=new Sn(e?.leftExpression),this.rightExpression=new Sn(e?.rightExpression))}toMetadata(){return{...super.toMetadata(),leftExpression:this.leftExpression?.toMetadata(),rightExpression:this.rightExpression?.toMetadata(),clearValue:this.clearValue,populateValue:this.populateValue}}clone(){return new Cn({...this.toMetadata()})}copy(){return new Cn({...super.copy().toMetadata(),leftExpression:this.leftExpression?.toMetadata(),rightExpression:this.rightExpression?.toMetadata(),clearValue:this.clearValue,populateValue:this.populateValue})}getApplicability(){return this.leftExpression?.path?[{path:this.leftExpression.path}]:[]}isValid(){return!!this.leftExpression?.isValid()&&!!this.rightExpression?.path}getAffectedItems(){const e=this.leftExpression?.getAffectedItem()??null,t=[...super.getAffectedItems()];return e&&t.push(e),t}getRequiredItems(){return[this.rightExpression?.getAffectedItem()].filter(e=>e)}isAttributeUsed(e,t){return this.leftExpression.isAttributeUsed(e,t)||this.rightExpression.isAttributeUsed(e,t)}};zi=Cn=(0,m.__decorate)([le("BusinessRuleFilterLookupAction"),(0,m.__metadata)("design:paramtypes",[Object])],zi);var An;let Gi=An=class extends Xt{constructor(){super(...arguments),this.typeName="Terrasoft.Core.BusinessRules.Models.Actions.BusinessRuleActionHideElement"}clone(){return new An(this.toMetadata())}copy(){return new An({...this.toMetadata(),uId:O()})}};Gi=An=(0,m.__decorate)([le("BusinessRuleHideElementDesignAction")],Gi);var vn;const ou="Terrasoft.Core.BusinessRules.Models.Actions.BusinessRuleActionOptionalElement";let Ki=vn=class extends Xt{constructor(){super(...arguments),this.typeName=ou}clone(){return new vn(this.toMetadata())}copy(){return new vn({...this.toMetadata(),uId:O()})}};Ki=vn=(0,m.__decorate)([le("BusinessRuleOptionalElementDesignAction")],Ki);var En;const $h="Terrasoft.Core.BusinessRules.Models.Actions.BusinessRuleActionReadonlyElement";let Wi=En=class extends Xt{constructor(){super(...arguments),this.typeName=$h}clone(){return new En(this.toMetadata())}copy(){return new En({...this.toMetadata(),uId:O()})}};Wi=En=(0,m.__decorate)([le("BusinessRuleReadOnlyElementDesignAction")],Wi);var Mn;const cu="Terrasoft.Core.BusinessRules.Models.Actions.BusinessRuleActionRequiredElement";let Ji=Mn=class extends Xt{constructor(){super(...arguments),this.typeName=cu}clone(){return new Mn(this.toMetadata())}copy(){return new Mn({...this.toMetadata(),uId:O()})}};Ji=Mn=(0,m.__decorate)([le("BusinessRuleRequiredElementDesignAction")],Ji);class uu{static _getPrimaryDisplayAttributeName(e){return(0,S.A)(function*(){return(yield e.getSchema()).primaryDisplayAttributeName})()}static getLookupValue(e,t){var s=this;return(0,S.A)(function*(){const r=yield We.create(e),i=yield r.getSchema(),a=[i.primaryAttributeName,i.primaryDisplayAttributeName];i.primaryColorAttributeName&&a.push(i.primaryColorAttributeName);const l=yield r.load({parameters:[{type:P.PrimaryColumnValue,value:t}],attributes:a});if(!l||l.length===0)throw new Error(`Can't find value for '${t}'`);if(l.length>1)throw new Error(`Load more than 1 data row for '${t}'`);const d=l[0],h=yield s._getPrimaryDisplayAttributeName(r),p={value:t,displayValue:d[h]};return i.primaryColorAttributeName&&(p.primaryColorValue=d[i.primaryColorAttributeName]),p})()}}var Zi;let Xi=Zi=class extends yt{get value(){return this._value}set value(e){this._value!==e&&(this._displayValueInitialized=!1,this._value=e)}get referenceSchemaName(){return super.referenceSchemaName}set referenceSchemaName(e){this.referenceSchemaName!==e&&(super.referenceSchemaName=e,this._displayValueInitialized=!1)}get displayValue(){return this.isLookup&&this.referenceSchemaName?this._displayValueInitialized?this._displayValue:null:(this._displayValue=this.value,this._displayValueInitialized=!0,this._displayValue)}set displayValue(e){this._displayValue=e??"",this._displayValueInitialized=e!=null}get dataValueTypeName(){return super.dataValueTypeName}set dataValueTypeName(e){this.dataValueTypeName!==e&&(super.dataValueTypeName=e,this._displayValueInitialized=!1)}constructor(e){super(e),this.typeName="Terrasoft.Core.BusinessRules.Models.Expressions.BusinessRuleValueExpression",this._value="",this._displayValue="",this._displayValueInitialized=!1,e&&(this._value=e.value)}initDisplayValue(){var e=this;return(0,S.A)(function*(){if(e._displayValueInitialized)return Promise.resolve(e._displayValue);if(e.isLookup&&e.referenceSchemaName&&e._value){const t=yield uu.getLookupValue(e.referenceSchemaName,e._value);e._displayValue=t.displayValue}else e._displayValue=e.value;return e._displayValueInitialized=!0,Promise.resolve(e._displayValue)})()}toMetadata(){return{...super.toMetadata(),value:this.value}}copy(){return new Zi({...this.toMetadata(),uId:O()})}isValid(){return super.isValid()?this.isLookup?Yo(this.value):this.value!=null&&this.value!=="":!1}clear(){this._value="",this._displayValue="",this._displayValueInitialized=!1}setValue(e){e?(this.value=e.value,this.displayValue=e.displayValue):this.clear()}getValue(){return{value:this.value,displayValue:this.displayValue}}isEmpty(){return!this.value}};Xi=Zi=(0,m.__decorate)([ji({typeName:"Terrasoft.Core.BusinessRules.Models.Expressions.BusinessRuleValueExpression"}),(0,m.__metadata)("design:paramtypes",[Object])],Xi);var In;let Yi=In=class extends et{constructor(e){super(e),this.typeName="Terrasoft.Core.BusinessRules.Models.Actions.BusinessRuleActionSetFilter",e&&(this.value=new Xi(e.value))}clone(){return new In(this.toMetadata())}copy(){return new In(super.copy().toMetadata())}getApplicability(){return this.expression?.path?[{path:this.expression.path}]:[]}isAttributeUsed(e,t){return this.expression.isAttributeUsed(e,t)}};Yi=In=(0,m.__decorate)([le("BusinessRuleSetFilterAction"),(0,m.__metadata)("design:paramtypes",[Object])],Yi);var Rn;let Qi=Rn=class extends et{constructor(){super(...arguments),this.typeName="Terrasoft.Core.BusinessRules.Models.Actions.BusinessRuleActionSetValue"}clone(){return new Rn(this.toMetadata())}copy(){return new Rn(super.copy().toMetadata())}};Qi=Rn=(0,m.__decorate)([le("BusinessRuleSetValueDesignAction")],Qi);var ea;(function(n){n.DataSource="DataSource",n.Page="Page"})(ea||(ea={}));var wn;let ta=wn=class extends et{constructor(e){super(e),this.typeName="Terrasoft.Core.BusinessRules.Models.Expressions.BusinessRuleSetValueItem",this.scope=e?.scopeId??"",this.scope==="null"&&(this.scope="")}clone(){return new wn(this.toMetadata())}copy(){return new wn({...super.copy().toMetadata(),scopeId:this.scope})}toMetadata(){return{...super.toMetadata(),scopeId:this.scope}}getApplicability(){if(!this.expression?.path)return[];const t=this.expression.path.split(".").shift();if(!t)return[];const s={path:t};return this.scope!==""&&(s.applicability=ea.DataSource,s.scope=this.scope),[s]}isAttributeUsed(e,t){return this.expression.path===t&&iu(this.scope,e)}};ta=wn=(0,m.__decorate)([le("BusinessRuleSetValueItem"),(0,m.__metadata)("design:paramtypes",[Object])],ta);var Pn;let sa=Pn=class extends et{constructor(e){super(e),this.typeName="Terrasoft.Core.BusinessRules.Models.Actions.BusinessRuleActionSetValues",this.items=[],e&&(this.items=e.items?.map(t=>new ta(t)))}getExpressionAffectedItems(){return[]}clone(){return new Pn(this.toMetadata())}copy(){return new Pn({...super.copy().toMetadata(),items:this.items.map(e=>e.toMetadata())})}toMetadata(){const e={...super.toMetadata(),items:this.items?.length>0?this.items.map(t=>t.toMetadata()):[]};return this.items?.length>0&&(delete e.expression,delete e.value),e}getApplicability(){return this.items?.length?this.items.flatMap(e=>e.getApplicability()):[]}isValid(){return this.items?.length>0&&this.items.every(e=>e.isValid())}getAffectedItems(){const t=(this.items??[]).map(s=>s.getAffectedItems()).flat();return[...super.getAffectedItems(),...t]}getRequiredItems(){return this.getAffectedItems()}isAttributeUsed(e,t){return this.items.some(s=>s.isAttributeUsed(e,t))}};sa=Pn=(0,m.__decorate)([le("BusinessRuleSetValuesDesignAction"),(0,m.__metadata)("design:paramtypes",[Object])],sa);var Dn;let ra=Dn=class extends Xt{constructor(){super(...arguments),this.typeName="Terrasoft.Core.BusinessRules.Models.Actions.BusinessRuleActionShowElement"}clone(){return new Dn(this.toMetadata())}copy(){return new Dn({...this.toMetadata(),uId:O()})}};ra=Dn=(0,m.__decorate)([le("BusinessRuleShowElementDesignAction")],ra);class Yt{get(e){return e.typeName==="Terrasoft.Core.BusinessRules.Models.Actions.BusinessRuleActionShowElement"?new ra(e):e.typeName==="Terrasoft.Core.BusinessRules.Models.Actions.BusinessRuleActionHideElement"?new Gi(e):e.typeName==="Terrasoft.Core.BusinessRules.Models.Actions.BusinessRuleActionReadonlyElement"?new Wi(e):e.typeName==="Terrasoft.Core.BusinessRules.Models.Actions.BusinessRuleActionEditableElement"?new qi(e):e.typeName===ou?new Ki(e):e.typeName===cu?new Ji(e):e.typeName==="Terrasoft.Core.BusinessRules.Models.Actions.BusinessRuleActionFilterLookup"?new zi(e):e.typeName==="Terrasoft.Core.BusinessRules.Models.Actions.BusinessRuleActionSetFilter"?new Yi(e):e.typeName==="Terrasoft.Core.BusinessRules.Models.Actions.BusinessRuleActionSetValue"?new Qi(e):e.typeName==="Terrasoft.Core.BusinessRules.Models.Actions.BusinessRuleActionSetValues"?new sa(e):new et(e)}static#e=this.\u0275fac=function(t){return new(t||Yt)};static#t=this.\u0275prov=c.\u0275\u0275defineInjectable({token:Yt,factory:Yt.\u0275fac,providedIn:"root"})}var Tn;(function(n){n[n.Condition=0]="Condition",n[n.Action=1]="Action",n[n.Trigger=2]="Trigger",n[n.Context=3]="Context",n[n.Unknown=4]="Unknown"})(Tn||(Tn={}));class Uh{}class Qt extends Uh{constructor(e,t){super(),this._httpClient=e,this.dbService=t,this._cachedLoadScopesRequests=new Map,this.serviceEndpoint="/ServiceModel/BusinessRulesManagerService.svc/",this.getBusinessRulesConfigMethodName="GetBusinessRules"}_getCachedBusinessRulesScopes(e){const t=e.map(s=>{const r=this._getContextCacheKey(s.scopeType,s.scopeName);return this.dbService.getByKey("business-rules",r).pipe((0,o.map)(i=>i?{rules:i.data,scopeName:s.scopeName,scopeType:s.scopeType}:null))});return t.length?(0,o.forkJoin)(t):(0,o.of)([])}_getScopeType(e){return e==="Model"?_e.Model:_e.ViewModel}_mapResponseToBusinessRules(e){return!e?.businessRules||e.businessRules.length===0?[]:e.businessRules.map(t=>{const s=JSON.parse(t.businessRulesConfig);return{scopeName:t.schemaName,scopeType:this._getScopeType(t.type),rules:s}})}_getContextsScopeNames(e){return e.map(t=>t.scopeName)}_getContextCacheKey(e,t){return`Type:#${e}#-Name:#${t}#`}_getContextsScopeNamesRequestKey(e){return e.map(s=>this._getContextCacheKey(s.scopeType,s.scopeName)).join("_")}_getCachedLoadScopesRequest(e){const t=e.map(r=>this._getContextCacheKey(r.scopeType,r.scopeName)),s=[...this._cachedLoadScopesRequests.keys()].find(r=>t.every(i=>r.includes(i)));return this._cachedLoadScopesRequests.get(s)}_getNotLoadedBusinessRulesScopes(e){if(e.length===0)return(0,o.of)([]);const t=this._getContextsScopeNames(e),s=this._getCachedLoadScopesRequest(e);if(s)return s.request$.pipe((0,o.map)(l=>l.filter(d=>t.includes(d.scopeName))));const r=`${this.serviceEndpoint}${this.getBusinessRulesConfigMethodName}`,i={scopes:e.map(l=>({name:l.scopeName,type:l.scopeType,modelType:l.modelType}))},a=this._httpClient.post(r,i).pipe((0,o.map)(l=>this._mapResponseToBusinessRules(l)),(0,o.switchMap)(l=>{const d=l.map(h=>{const p=this._getContextCacheKey(h.scopeType,h.scopeName);return this.dbService.add("business-rules",{data:h.rules,key:p})});return d.length?(0,o.forkJoin)(d).pipe((0,o.map)(()=>l)):(0,o.of)(l)}),(0,o.tap)(()=>{const l=this._getContextsScopeNamesRequestKey(e);this._cachedLoadScopesRequests.delete(l)}),(0,o.share)());return this._cachedLoadScopesRequests.set(this._getContextsScopeNamesRequestKey(e),{request$:a,scopeNames:t}),a}getBusinessRulesByContexts(e){const t=e.filter(s=>s.scopeName&&s.modelType!=="crt.PageParametersDataSource");return this._getCachedBusinessRulesScopes(t).pipe((0,o.switchMap)(s=>{const r=t.filter(a=>!s?.some(l=>l?.scopeName===a.scopeName&&l.scopeType===a.scopeType));return this._getNotLoadedBusinessRulesScopes(r).pipe((0,o.map)(a=>[...s,...a].filter(Boolean)),(0,o.catchError)(a=>{const l=t?.map(d=>d.scopeName).join(", ");return console.warn(`An error occurred during getting business rules execution for scopes: ${l}.`,a),(0,o.of)([])}))}))}clearCachedBusinessRules(){return this.dbService.clear("business-rules")}static#e=this.\u0275fac=function(t){return new(t||Qt)(c.\u0275\u0275inject(D.HttpClient),c.\u0275\u0275inject(Gt,8))};static#t=this.\u0275prov=c.\u0275\u0275defineInjectable({token:Qt,factory:Qt.\u0275fac,providedIn:"root"})}class Ir{constructor(e,t){this._businessRulesManager=e,this._businessRuleDesignActionFactory=t,this._scopeAttributes=[]}_filterTriggers(e,t){const s=t.filter(a=>a.scopeName===e.parentScopeId),i=t.find(a=>a.scopeName===e.scopeName&&a.scopeType===e.scopeType)?.rules.map(a=>a.triggers).flat();return e.triggers.filter(a=>{if(a.type===H.ContextReady||a.type===H.DataLoaded)return!0;const l=i?.some(p=>p&&p.name===a.name&&Fi(p.type)===a.type),h=s.flatMap(p=>p.rules.flatMap(f=>f.triggers)).some(p=>p.name===a.name&&Fi(p.type)===a.type);return l||h})}_filterAttributes(e){const s=this._scopeAttributes.filter(a=>a.scopeName===e.scopeName).map(a=>a.attributes).flat(),r=this._scopeAttributes.filter(a=>a.scopeName!==e.scopeName).flatMap(a=>[...a.attributes]);return e.attributes.filter(a=>s.includes(a.attributeName)||r.includes(a.attributeName)||a.isSignificant)}_cacheUsedAttributes(e){e.forEach(t=>{if(!this._scopeAttributes.find(s=>s.scopeName===t.scopeName&&s.scopeType===t.scopeType)){const s=eu(t.rules),r=Qc(s),i=wh(t.rules,this._businessRuleDesignActionFactory),a=t.rules.flatMap(l=>l.triggers?.map(d=>d.name)).filter(Boolean);this._scopeAttributes.push({scopeName:t.scopeName,scopeType:t.scopeType,attributes:[...r,...i,...a]})}})}_hasActiveRules(e,t){return(t.find(a=>a.scopeName===e.scopeName&&a.scopeType===e.scopeType)?.rules??[]).filter(a=>a.enabled===!0).length>0}clearCachedScopeAttributes(){this._scopeAttributes=[]}filter(e){return this._businessRulesManager.getBusinessRulesByContexts(e).pipe((0,o.tap)(t=>this._cacheUsedAttributes(t)),(0,o.map)(t=>e.map(r=>({...r,attributes:this._filterAttributes(r),triggers:this._filterTriggers(r,t)})).filter(r=>this._hasActiveRules(r,t)?!0:r.attributes.length>0)))}static#e=this.\u0275fac=function(t){return new(t||Ir)(c.\u0275\u0275inject(Qt),c.\u0275\u0275inject(Yt))};static#t=this.\u0275prov=c.\u0275\u0275defineInjectable({token:Ir,factory:Ir.\u0275fac,providedIn:"root"})}class es{constructor(e,t,s,r,i,a,l){this._businessRulesManager=e,this._businessRulesTriggerExecutor=t,this._businessRulesConditionExecutor=s,this._httpClient=r,this._messageChannelService=i,this._featureService=a,this._contextFilter=l,this._businessRulesResponseEventName="BusinessRuleExecutionResponse",this._serviceUrl="ServiceModel/BusinessRulesEngineService.svc/Execute",this._businessRulesRequestEventName="BusinessRuleExecutionRequest",this._businessRuleDesignActionFactory=new Yt,this._configurationStructureChangedSubscribe()}_configurationStructureChangedSubscribe(){this._messageChannelService.getMessages("ConfigurationStructureChanged").pipe((0,u.switchMap)(()=>(this._contextFilter.clearCachedScopeAttributes(),this._businessRulesManager.clearCachedBusinessRules()))).subscribe()}_featureStates(){return(0,o.from)(this._featureService.getFeaturesState(["BRules-UseWebSocketChannel","BRules-DisableContextOptimization"])).pipe((0,u.map)(([e,t])=>({useHttpChannel:!e,disableContextOptimization:t})))}_sendWebSocketMessage(e){const t=O();return e.businessRulesSessionId=t,new o.Observable(s=>{const r=this._messageChannelService.messageEvent$.pipe((0,u.map)(i=>i.body),(0,u.filter)(i=>i!=null),(0,u.filter)(i=>i.eventName===this._businessRulesResponseEventName),(0,u.filter)(i=>i.businessRulesSessionId===t),(0,u.map)(i=>i.payload)).subscribe({next:i=>{r.unsubscribe(),i.success?s.next(i.businessRulesResponse):(console.error("An error occurred during business rules execution. "+i.errorInfo.errorCode+": "+i.errorInfo.message),s.next([])),s.complete()},error:i=>{r.unsubscribe(),console.error("An error occurred during business rules execution. "+i.errorCode+": "+i.message),s.next([]),s.complete()},complete:()=>{r.unsubscribe(),s.error("WebSocket channel closed")}});this._messageChannelService.sendMessage(e,qs.PTP).pipe((0,o.take)(1)).subscribe()})}_createWebSocketRequest(e){return{eventName:this._businessRulesRequestEventName,contexts:e}}_executeUsingWebSocket(e){const t=this._createWebSocketRequest(e);return this._sendWebSocketMessage(t)}_logErrorMessageAndReturnDefBusinessRuleResponse(e){return console.error("An error occurred during business rules execution. "+e.errorCode+": "+e.message),(0,o.of)([])}_executeUsingHttp(e){return this._httpClient.post(this._serviceUrl,{contexts:e},{headers:new D.HttpHeaders({"Content-Type":"application/json"})}).pipe((0,u.mergeMap)(t=>t.success?(0,o.of)(t.businessRulesResponse):this._logErrorMessageAndReturnDefBusinessRuleResponse(t.errorInfo)),(0,u.catchError)(t=>this._logErrorMessageAndReturnDefBusinessRuleResponse(t)))}_canExecuteBusinessRulesByContexts(e){return this._businessRulesManager.getBusinessRulesByContexts(e).pipe((0,u.map)(t=>{const s=t.filter(r=>r.rules&&r.rules.length>0);return s.length===0?!1:s.some(r=>{const i=e.find(h=>h.scopeName===r.scopeName&&h.scopeType===r.scopeType),a=e.filter(h=>h.parentScopeId===i.scopeId),l=this._businessRulesTriggerExecutor.canExecute(i,a,r.rules),d=this._businessRulesConditionExecutor.canExecute(i,r.rules);return l||d})}))}_getContextsWithScope(e){return e.filter(t=>t.scopeName&&t.scopeId)}_getBusinessRuleActions(e){return e.cases.map(t=>t.actions).flat().filter(t=>t.enabled).map(t=>this._businessRuleDesignActionFactory.get(t))}_getBusinessRuleAffectedAttributes(e){return this._getBusinessRuleActions(e).map(s=>s.getAffectedItems()).flat()}_getAffectedAttributes(e){let t=e.rules.filter(s=>s.enabled).map(s=>this._getBusinessRuleAffectedAttributes(s)).flat();return t=this._getUniqueAffectedAttributes(t),t.forEach(s=>{s.scopeName=e.scopeName}),t}_getUniqueAffectedAttributes(e){const t=e.map(r=>[r.name,r]);return[...new Map(t).values()]}_execute(e){return this._featureStates().pipe((0,u.switchMap)(({useHttpChannel:t,disableContextOptimization:s})=>(0,o.forkJoin)({useHttpChannel:(0,o.of)(t),executionContexts:s?(0,o.of)(e):this._contextFilter.filter(e)})),(0,u.switchMap)(({useHttpChannel:t,executionContexts:s})=>(t?this._executeUsingHttp(s):this._executeUsingWebSocket(s)).pipe((0,u.map)(r=>({executionResults:r,executionContexts:s})))),(0,u.switchMap)(({executionResults:t,executionContexts:s})=>this._logUnsuccessfulBusinessRulesExecution(t,s).pipe((0,u.map)(()=>t))))}_logUnsuccessfulBusinessRulesExecution(e,t){const s=e?.filter(r=>r?.errors?.length>0).map(r=>r.errors).flat();return s?.length===0?(0,o.of)(void 0):(0,o.from)(this._featureService.getFeatureState("BRules-ShowChildRules")).pipe((0,u.switchMap)(r=>this._businessRulesManager.getBusinessRulesByContexts(t).pipe((0,u.map)(i=>i.map(a=>a.rules).flat()),(0,u.tap)(i=>{s.map(a=>this._getUnsuccessfulBusinessRuleExecutionMessage(a,i,r)).forEach(a=>{console.error(a)})}),(0,u.map)(()=>{}))))}_getUnsuccessfulBusinessRuleExecutionMessage(e,t,s){const r="Business rule execution error: ",i=`Error message: "${e.message}"`,a=e.type===Tn.Unknown?"":`The error occurred in the business rule ${Tn[e.type]?.toLocaleLowerCase()}s.`;let l=t.find(C=>C.uId===e.businessRuleId);if(!l)return`${r}Rule id - "${e.businessRuleId}". ${i}. ${a}`;!dl(l.parentUId)&&!s&&(l=t.find(C=>C.uId===l.parentUId));const d=l.caption||"",h=l.name,p=`Rule Title - "${d}"`,f=`Rule Code - "${h}"`;return`${r}${p}, ${f}. ${i}. ${a}`}execute(e){const t=this._getContextsWithScope(e);return t.length===0?(0,o.of)([]):this._canExecuteBusinessRulesByContexts(e).pipe((0,u.switchMap)(s=>s?this._execute(t):(0,o.of)([])),(0,u.catchError)(s=>(console.warn(`An error occurred during business rules execution for scopes: ${e?.map(r=>r.scopeName).join(", ")}.`,s),(0,o.of)([]))))}getAffectedAttributes(e){var t=this;return(0,S.A)(function*(){if(e.length===0)return[];const s=e.filter(a=>a.scopeName!=null),i=(yield(0,o.firstValueFrom)(t._businessRulesManager.getBusinessRulesByContexts(s))).filter(a=>a.rules&&a.rules.length>0);return i.length===0?[]:i.map(a=>t._getAffectedAttributes(a)).flat()})()}static#e=this.\u0275fac=function(t){return new(t||es)(c.\u0275\u0275inject(Qt),c.\u0275\u0275inject(Kt),c.\u0275\u0275inject(Jt),c.\u0275\u0275inject(D.HttpClient),c.\u0275\u0275inject(rn),c.\u0275\u0275inject(Mr),c.\u0275\u0275inject(Ir))};static#t=this.\u0275prov=c.\u0275\u0275defineInjectable({token:es,factory:es.\u0275fac})}function ts(n){return function(e){Ce(n.type,"BusinessRulesActionApplierTypeName"),Ls(n.type),Be.register(n.type,e)}}class Nn{constructor(e){this.action=e}_logError(e){return console.error("Error when applying business rule",this.action),console.error(e),(0,o.of)(null)}apply(e,t){let s;try{s=this.innerApply(e,t)}catch(r){return this._logError(r)}return s.pipe((0,o.catchError)(r=>this._logError(r)))}}function qh(n){return`${n}_List`}function Hh(n){return`${n}_BusinessRule_Filter`}function lu(n,e){return na.apply(this,arguments)}function na(){return na=(0,S.A)(function*(n,e){let t=yield n[e];return t instanceof se||(t=new se,n[e]=t),t}),na.apply(this,arguments)}function zh(n,e,t){return ia.apply(this,arguments)}function ia(){return ia=(0,S.A)(function*(n,e,t){return(yield lu(n,e)).filters.get(t)||new se(Ot.And)}),ia.apply(this,arguments)}function Gh(n,e,t,s){return aa.apply(this,arguments)}function aa(){return aa=(0,S.A)(function*(n,e,t,s){const r=yield lu(n,e);r.add(s,t),n[e]=r}),aa.apply(this,arguments)}function Kh(n,e,t){return(n.getViewModelAttributePaths(e,t)??[]).map(i=>qh(i)).map(i=>Hh(i))}function oa(n,e,t,s,r,i){return ca.apply(this,arguments)}function ca(){return ca=(0,S.A)(function*(n,e,t,s,r,i){const a=Kh(n,e,t);for(const l of a){const d=yield zh(n,l,r);d.add(s,i),yield Gh(n,l,r,d)}}),ca.apply(this,arguments)}let ua=class extends Nn{_createLookupFilterGroup(e,t){const s=new se(Ot.And),r=new ue(j.Equal,new k({columnPath:e}),new $({value:t}));return s.add(r,"lookupFilter"),s}_setFilterForScope(e,t){const s=this.action,r=s.path;if(s.value){const{leftExpression:i,rightExpression:a}=s.value,l=this._createLookupFilterGroup(i,a.value);return oa(e,t,r,l,s.businessRuleUId,s.actionUId)}return oa(e,t,r,new se,s.businessRuleUId,s.actionUId)}innerApply(e,t){const s=this._setFilterForScope(e,t.id);return(0,o.from)(s)}};ua=(0,m.__decorate)([ts({type:"crt.FilterLookup"})],ua);let la=class extends Nn{_getFilter(e){if(e){const t=e.value,s=JSON.parse(t);return hn.fromJson(s)}else return new se}innerApply(e,t){const s=this.action,r=this._getFilter(s.value),i=oa(e,t.id,s.path,r,s.businessRuleUId,s.actionUId);return(0,o.from)(i)}};la=(0,m.__decorate)([ts({type:"crt.SetFilter"})],la);let da=class extends Nn{_getValue(e){const t=e.value,s=t.value;if(s==null)return(0,o.of)(s);const r=t.dataValueTypeName,a=Object.values(on.Q).find(d=>d.name===r)?.type??y.r.Text,l=Ri(s,a);return a===y.r.Lookup?(0,o.from)(uu.getLookupValue(t.referenceSchemaName,t.value)):(0,o.of)(l)}_setValue(e,t,s){const r=this.action.path,i=e.getViewModelAttributePath(t,r);return i?e.setValue({[i]:s}):e.setModelValues(t,{[r]:s})}innerApply(e,t){const s=this.action,r=s.value;return s.skip===!0?(0,o.of)(null):this._getValue(s).pipe((0,o.switchMap)(i=>{if(t.type===_e.Model)return this._setValue(e,t.id,i);if(r.scope)return this._setValue(e,r.scope,i);const a=e.getAttributeNameByViewItemName(s.path);return a?e.setValue({[a]:i}):e.setValue({[s.path]:i})}))}};da=(0,m.__decorate)([ts({type:"crt.SetValue"})],da);const Wh=n=>n.replace(/\./g,"")+"_PropertiesBindingAttribute";class ha extends Nn{_getAttributeNames(e,t,s){if(t.type===_e.Model)return e.getViewModelAttributePaths(t.id,s);let r=e.getAttributeNameByViewItemName(s);return r||(r=Wh(s)),[r]}setAttributePropertyValue(e,t,s){e.setAttributePropertyValue(t,this.propertyName,s)}resetAttributePropertyValue(e,t){e.resetAttributePropertyValue(t,this.propertyName)}innerApply(e,t){const s=this.action.path;if(!s)return(0,o.of)(!0);const i=s.split(":")[0],a=this._getAttributeNames(e,t,i);return a&&a.forEach(l=>{this.action.resetToDefault?this.resetAttributePropertyValue(e,l):this.setAttributePropertyValue(e,l,this.action.value)}),(0,o.of)(!0)}}let pa=class extends ha{constructor(){super(...arguments),this.propertyName="readonly"}_getPropertyName(e,t){return e.getInvariabilityPropertyName(t)??this.propertyName}setAttributePropertyValue(e,t,s){const r=this._getPropertyName(e,t);e.setAttributePropertyValue(t,r,s)}resetAttributePropertyValue(e,t){const s=this._getPropertyName(e,t);e.resetAttributePropertyValue(t,s)}};pa=(0,m.__decorate)([ts({type:"crt.SetReadonlyPropertyActionApplier"})],pa);let ma=class extends ha{constructor(){super(...arguments),this.propertyName="required"}};ma=(0,m.__decorate)([ts({type:"crt.SetRequiredPropertyActionApplier"})],ma);let fa=class extends ha{constructor(){super(...arguments),this.propertyName="visible"}};fa=(0,m.__decorate)([ts({type:"crt.SetVisibilityPropertyActionApplier"})],fa);function Jh(){const n=[ua,la,da,pa,ma,fa]}Jh();class Rr{static#e=this.\u0275fac=function(t){return new(t||Rr)};static#t=this.\u0275mod=c.\u0275\u0275defineNgModule({type:Rr});static#s=this.\u0275inj=c.\u0275\u0275defineInjector({providers:[es,Zt,Be,Kt,Jt,{provide:c.APP_INITIALIZER,useFactory:Eh,deps:[c.Injector],multi:!0}]})}var ss;(function(n){n.string="Strings",n.image="Images"})(ss||(ss={}));const wr="Resources";class Pr extends Array{constructor(e){super(),Object.setPrototypeOf(this,Object.create(Pr.prototype)),Array.isArray(e)&&this._fillFromSource(e)}_fillFromSource(e){e.filter(t=>t?.cultureName!=null).forEach(t=>{this.setValueLocalizableString(t.cultureName,t.value)})}getValue(e){const t=this.getLocalizableString(e);return t?t.value:""}hasCultureValue(e,t=!1){const s=this.getLocalizableString(e);return t?(s?.value||null)!=null:s?.value!=null}getLocalizableString(e){return this.find(t=>t.cultureName===e)||null}setValueLocalizableString(e,t){const s=this.getLocalizableString(e);return s?s.value=t:this.push({cultureName:e,value:t}),this}setValues(e,t=!1){return e.forEach(s=>{this.hasCultureValue(s.cultureName)&&t||this.setValueLocalizableString(s.cultureName,s.value)}),this}clone(){return new Pr(this)}}class rs{constructor(e){this.userInfo=e,this._resourceMacrosRegExpPattern="(?<macrosBody>#ResourceString\\((?<macrosArgs>[^)]*)\\)#)",this._viewModelAttributeRegExpPattern=`\\$${wr}.${ss.string}.(?<macrosArgs>[\\S\\s]*)`,this._sysCultureName=this.userInfo.cultureInfo.sysCultureName,this._defCultureName=this.userInfo.defCultureInfo.sysCultureName}_getLczResource(e){const t={};return e.forEach(s=>t[s.cultureName]=s.value),t}_getResourceValueMatches(e){const t=new RegExp(this._resourceMacrosRegExpPattern,"g"),s=new RegExp(this._viewModelAttributeRegExpPattern,"g");let r=[...(e??"").matchAll(s)];return r.length||(r=[...(e??"").matchAll(t)]),r}_findStringPropertyResource(e,t){const{resourceName:s,useMacrosTemplate:r}=this.findResourcesName(e);if(s)return{path:t,resourceName:s,useMacrosTemplate:r}}_findArrayPropertyResources(e,t=""){return e.flatMap((s,r)=>this.findPropertyResources(s,t?`${t}.${r}`:`${r}`))}_findObjectPropertyResources(e,t=""){return Object.entries(e).flatMap(([s,r])=>this.findPropertyResources(r,t?`${t}.${s}`:s))}findLocalizableValue(e){if(typeof e=="string")return e;if(!e||typeof e!="object")return null;let t;return Array.isArray(e)?t=e?.filter(s=>s.value).reduce((s,r)=>Object.assign(s,{[r.cultureName]:r.value}),{}):t=e,(t[this._sysCultureName]??t[this._defCultureName])?.toString()??null}findResourcesName(e){const s=this._getResourceValueMatches(e)[0]?.groups.macrosArgs,r=e?.startsWith("#MacrosTemplateString");return{resourceName:s,useMacrosTemplate:r}}findLocalizationFromResourceString(e,t,s=""){const{resourceName:r}=this.findResourcesName(e),i=r!==void 0&&t.strings[r];if(i){const d=Object.entries(i).map(([h,p])=>({cultureName:h,value:p}));return new Pr(d)}const a=r===void 0&&e||s,l=this._sysCultureName||this._defCultureName;return new Pr([{cultureName:l,value:a}])}findValueFromResource(e,t){const s=this.findLocalizationFromResourceString(e,t),r=this._getLczResource(s);return this.findLocalizableValue(r)}findViewModelResourceValue(e,t,s){var r=this;return(0,S.A)(function*(){const{resourceName:i}=r.findResourcesName(e);let a;return i&&(a=yield t.Strings[i]),a||s||e})()}findPropertyResources(e,t=""){return e?Array.isArray(e)?this._findArrayPropertyResources(e,t):typeof e=="object"?this._findObjectPropertyResources(e,t):typeof e=="string"?[this._findStringPropertyResource(e,t)].filter(Boolean):[]:[]}static#e=this.\u0275fac=function(t){return new(t||rs)(c.\u0275\u0275inject(Me.oq))};static#t=this.\u0275prov=c.\u0275\u0275defineInjectable({token:rs,factory:rs.\u0275fac,providedIn:"root"})}var tt;(function(n){n.Root="root",n.Angular="angular"})(tt||(tt={}));const Zh=new c.InjectionToken("CrtNavigationLock");class ga{static#e=this.instance=new ga;wait(e){return e()}}class st{static#e=this.\u0275fac=function(t){return new(t||st)};static#t=this.\u0275mod=c.\u0275\u0275defineNgModule({type:st});static#s=this.\u0275inj=c.\u0275\u0275defineInjector({imports:[R.CommonModule]})}(function(){(typeof ngJitMode>"u"||ngJitMode)&&c.\u0275\u0275setNgModuleScope(st,{imports:[R.CommonModule]})})();function Xh(n){return n?function(e){const t=typeof n=="string"?n:n.type;Ce(t,"converterTypeName"),Al({type:t,typeRef:e},e)}:e=>{}}let _a=class{convert(e,t){const s={type:"crt.ExecuteExpressionRequest",$context:t,metadata:e};return ie.instance.process(s).then(r=>r).catch(r=>({success:!1,result:null,errorInfo:r}))}};_a=(0,m.__decorate)([Xh({type:"crt.ToExpressionResult"})],_a);class V{}class bt{static#e=this._requestsMap=new Map;static#t=this._requestsRegistrationInfos=new Map;static get requestsRegistrationInfos(){return this._requestsRegistrationInfos}static register(e,t){const s=e.type;bt._requestsMap.set(s,t),bt._requestsRegistrationInfos.set(s,e)}static get(e){const t=bt._requestsMap.get(e);return Vl(e,t),t&&new t}}function M(n){return function(e){Ce(n.type,"RequestTypeName"),Ls(n.type),bt.register(n,e)}}function oe(n){return n?function(e){Ce(n.type,"RequestHandlerTypeName"),Ls(n.type),vl(n,e)}:e=>{}}class ns{_getDataValueTypeName(e){switch(e){case y.r.FLOAT1:return"Float1";case y.r.FLOAT2:return"Float2";case y.r.FLOAT3:return"Float3";case y.r.FLOAT4:return"Float4";case y.r.FLOAT8:return"Float8";case y.r.CUSTOM_OBJECT:return"Object";case y.r.COMPOSITE_OBJECT_LIST:return"CompositeObjectList";default:return y.r[e]}}_getRequestParameterValueDto(e){const t=e.value;if(Array.isArray(t)){const s=t[0];return Array.isArray(s)?t.map(r=>r.map(i=>({...i,value:this._encodeValue(i.value,i.dataValueType),dataValueType:this._getDataValueTypeName(i.dataValueType)}))):t.map(r=>({...r,value:this._encodeValue(r.value,r.dataValueType),dataValueType:this._getDataValueTypeName(r.dataValueType)}))}return this._encodeValue(t,e.dataValueType)}_encodeValue(e,t){return[y.r.Date,y.r.Time,y.r.DateTime].includes(t)?mi(e):e}decodeValue(e,t){return[y.r.Date,y.r.Time,y.r.DateTime].includes(t)?new Date(e):e}getExecutionMetadata(e){const t=e.parameters.map(r=>({...r,dataValueType:this._getDataValueTypeName(r.dataValueType),value:this._getRequestParameterValueDto(r)})),s=e.expressionVariables.map(r=>({...r,dataValueType:this._getDataValueTypeName(r.dataValueType)}));return JSON.stringify({...e,parameters:t,expressionVariables:s,resultDataValueType:this._getDataValueTypeName(e.resultDataValueType)})}static#e=this.\u0275fac=function(t){return new(t||ns)};static#t=this.\u0275prov=c.\u0275\u0275defineInjectable({token:ns,factory:ns.\u0275fac,providedIn:"root"})}class is{constructor(e,t,s,r){this._httpClient=e,this._featureService=t,this._sysSettingsService=s,this._expressionMetadataAdapter=r,this._expressionEngineEndpoint="ServiceModel/ExpressionService.svc/Execute",this._expressionsEngineEndpoint="ServiceModel/ExpressionService.svc/ExecuteMany",this._expressionEngineValidationEndpoint="ServiceModel/ExpressionService.svc/Validate",this._defaultDebounceTime=200,this._defaultBundleCount=20,this._debounceTimeSysSettingName="ExpressionEngineDebounceTime",this._bundleCountSysSettingName="ExpressionEngineBundleCount",this._requests=new o.Subject}_executeImmediate(e){const t={metadata:e};return(0,o.lastValueFrom)(this._httpClient.post(this._expressionEngineEndpoint,t,{headers:new D.HttpHeaders({"Content-Type":"application/json"})}))}_getBundleSettings(){var e=this;return(0,S.A)(function*(){const{values:t}=yield e._sysSettingsService.getByCodes([e._debounceTimeSysSettingName,e._bundleCountSysSettingName]),s=t[e._debounceTimeSysSettingName]?.value||e._defaultDebounceTime,r=t[e._bundleCountSysSettingName]?.value||e._defaultBundleCount;return{executionDebounceTime:s,bundleCount:r}})()}_prepareDebouncedResponsesStream(){var e=this;return(0,S.A)(function*(){const{executionDebounceTime:t,bundleCount:s}=yield e._getBundleSettings();if(e._responses)return;const r=new o.BehaviorSubject(0),i=(0,o.merge)(r.pipe((0,o.filter)(a=>a>=s)),e._requests.pipe((0,o.tap)(()=>{r.next(r.value+1)}),(0,o.debounceTime)(t)));e._responses=e._requests.pipe((0,o.buffer)(i),(0,o.filter)(({length:a})=>!!a),(0,o.mergeMap)(a=>(r.next(0),e._httpClient.post(e._expressionsEngineEndpoint,a,{headers:new D.HttpHeaders({"Content-Type":"application/json"})}))),(0,o.share)())})()}_executeThrottled(e){var t=this;return(0,S.A)(function*(){yield t._prepareDebouncedResponsesStream();const s=O(),r=(0,o.firstValueFrom)(t._responses.pipe((0,o.filter)(i=>i.some(a=>a.executionId===s)),(0,o.map)(i=>i.find(a=>a.executionId===s).result)));return t._requests.next({executionId:s,metadata:e}),r})()}safeExecute(e,t={immediate:!1}){var s=this;return(0,S.A)(function*(){try{return yield s.execute(e,t)}catch(r){return{success:!1,errorInfo:r instanceof D.HttpErrorResponse?{errorCode:r.name,message:r.message,stackTrace:r.url}:r,result:null}}})()}execute(e,t={immediate:!1}){var s=this;return(0,S.A)(function*(){let r;const i=s._expressionMetadataAdapter.getExecutionMetadata(e),a=yield s._featureService.getFeatureState("ExpressionEngineDisableBundling");return t.immediate||a?r=yield s._executeImmediate(i):r=yield s._executeThrottled(i),r.success?{...r,result:s._expressionMetadataAdapter.decodeValue(r.result,e.resultDataValueType)}:Promise.reject(r.errorInfo)})()}validate(e){const t={metadata:this._expressionMetadataAdapter.getExecutionMetadata(e)};return(0,o.lastValueFrom)(this._httpClient.post(this._expressionEngineValidationEndpoint,t))}static#e=this.\u0275fac=function(t){return new(t||is)(c.\u0275\u0275inject(D.HttpClient),c.\u0275\u0275inject(Mr),c.\u0275\u0275inject(ae),c.\u0275\u0275inject(ns))};static#t=this.\u0275prov=c.\u0275\u0275defineInjectable({token:is,factory:is.\u0275fac,providedIn:"root"})}let du=class extends V{constructor(){super(...arguments),this.type="crt.ExecuteExpressionRequest"}};du=(0,m.__decorate)([M({type:"crt.ExecuteExpressionRequest"})],du);let ya=class extends Z{constructor(e){super(),this._engine=e}handle(e){return this._engine.safeExecute(e.metadata)}};ya=(0,m.__decorate)([oe({type:"crt.ExecuteExpressionHandler",requestType:"crt.ExecuteExpressionRequest"}),(0,m.__metadata)("design:paramtypes",[is])],ya);let as=class zo{static#e=this.\u0275fac=function(t){return new(t||zo)};static#t=this.\u0275mod=c.\u0275\u0275defineNgModule({type:zo});static#s=this.\u0275inj=c.\u0275\u0275defineInjector({providers:[is,ns],imports:[R.CommonModule,st,st]})};as=(0,m.__decorate)([Wc({converters:[_a],requestHandlers:[ya]})],as),function(){(typeof ngJitMode>"u"||ngJitMode)&&c.\u0275\u0275setNgModuleScope(as,{imports:[R.CommonModule,st],exports:[st]})}();class ba{convert(e){const{name:t,path:s,caption:r,dataValueType:i}=e||{};return{name:t,path:s||t,caption:r,dataValueType:i}}}class os extends ba{convert(e){const{aggregationConfig:t}=e||{};return{...super.convert(e),type:"aggregation",aggregationConfig:{filter:t?.filter,aggregationFunction:t?.aggregationFunction,sortByColumn:t?.sortByColumn,sortByDirection:t?.sortByDirection}}}static#e=this.\u0275fac=(()=>{let e;return function(s){return(e||(e=c.\u0275\u0275getInheritedFactory(os)))(s||os)}})();static#t=this.\u0275prov=c.\u0275\u0275defineInjectable({token:os,factory:os.\u0275fac,providedIn:"root"})}class cs extends ba{convert(e){const{functionConfig:t}=e||{};return{...super.convert(e),type:"function",functionConfig:t}}static#e=this.\u0275fac=(()=>{let e;return function(s){return(e||(e=c.\u0275\u0275getInheritedFactory(cs)))(s||cs)}})();static#t=this.\u0275prov=c.\u0275\u0275defineInjectable({token:cs,factory:cs.\u0275fac,providedIn:"root"})}class us extends ba{convert(e){return{...super.convert(e),type:"default"}}static#e=this.\u0275fac=(()=>{let e;return function(s){return(e||(e=c.\u0275\u0275getInheritedFactory(us)))(s||us)}})();static#t=this.\u0275prov=c.\u0275\u0275defineInjectable({token:us,factory:us.\u0275fac,providedIn:"root"})}const Yh=Vs.create({token:kc,mappings:[{predicate:x.AggregationAttribute,injectable:os},{predicate:x.FunctionAttribute,injectable:cs}],default:{injectable:us}});var ke;(function(n){n[n.None=0]="None",n[n.Count=1]="Count",n[n.Sum=2]="Sum",n[n.Avg=3]="Avg",n[n.Min=4]="Min",n[n.Max=5]="Max",n[n.TopOne=6]="TopOne"})(ke||(ke={}));function hu(n){switch(n){case Ve.Count:return ke.Count;case Ve.Sum:return ke.Sum;case Ve.Avg:return ke.Avg;case Ve.Min:return ke.Min;case Ve.Max:return ke.Max;case Ve.TopOne:return ke.TopOne;default:return ke.None}}function Ym(n){switch(n){case AggregationType.Count:return AggregationFunction.Count;case AggregationType.Sum:return AggregationFunction.Sum;case AggregationType.Avg:return AggregationFunction.Avg;case AggregationType.Min:return AggregationFunction.Min;case AggregationType.Max:return AggregationFunction.Max;case AggregationType.TopOne:return AggregationFunction.TopOne;default:return AggregationFunction.None}}function Qh(n){switch(n){case"all":return gt.All;case"distinct":return gt.Distinct;default:return gt.None}}function Qm(n){switch(n){case AggregationEvalType.All:return"all";case AggregationEvalType.Distinct:return"distinct";default:return"none"}}class Vn{addColumnCaption(e,t){const{name:s,caption:r}=t;if(!r)return;const i=e.findColumn(s);i&&i.withCaption(r)}addColumn(e,t){!e||!t||(this.addColumnInternal(e,t),this.addColumnCaption(e,t))}}class ls extends Vn{addColumnInternal(e,t){const{name:s,path:r,aggregationConfig:i}=t;e.addAggregationSubQueryColumn(r,hu(i?.aggregationFunction),i,s)}static#e=this.\u0275fac=(()=>{let e;return function(s){return(e||(e=c.\u0275\u0275getInheritedFactory(ls)))(s||ls)}})();static#t=this.\u0275prov=c.\u0275\u0275defineInjectable({token:ls,factory:ls.\u0275fac,providedIn:"root"})}class ds extends Vn{addColumnInternal(e,t){const{name:s,path:r}=t||{},i=t?.functionConfig;e.addAggregationFunctionColumn(r,hu(i?.aggregation),s,Qh(i?.aggregationEval))}static#e=this.\u0275fac=(()=>{let e;return function(s){return(e||(e=c.\u0275\u0275getInheritedFactory(ds)))(s||ds)}})();static#t=this.\u0275prov=c.\u0275\u0275defineInjectable({token:ds,factory:ds.\u0275fac,providedIn:"root"})}var we;(function(n){n[n.None=0]="None",n[n.Day=1]="Day",n[n.Week=2]="Week",n[n.Month=3]="Month",n[n.Year=4]="Year",n[n.WeekDay=5]="WeekDay",n[n.Hour=6]="Hour",n[n.HourMinute=7]="HourMinute"})(we||(we={}));function ep(n){switch(n){case"minute":return we.HourMinute;case"hour":return we.Hour;case"day":return we.Day;case"weekday":return we.WeekDay;case"week":return we.Week;case"month":return we.Month;case"year":return we.Year;default:return we.None}}function ef(n){switch(n){case DatePartType.HourMinute:return"minute";case DatePartType.Hour:return"hour";case DatePartType.Day:return"day";case DatePartType.WeekDay:return"weekday";case DatePartType.Week:return"week";case DatePartType.Month:return"month";case DatePartType.Year:return"year";default:return"none"}}class hs extends Vn{addColumnInternal(e,t){const{name:s,path:r}=t||{},i=t?.functionConfig;e.addDatePartFunctionColumn(r,ep(i?.datePart),s)}static#e=this.\u0275fac=(()=>{let e;return function(s){return(e||(e=c.\u0275\u0275getInheritedFactory(hs)))(s||hs)}})();static#t=this.\u0275prov=c.\u0275\u0275defineInjectable({token:hs,factory:hs.\u0275fac,providedIn:"root"})}class ps extends Vn{addColumnInternal(e,t){e.addSchemaColumn(t.path,t.name)}static#e=this.\u0275fac=(()=>{let e;return function(s){return(e||(e=c.\u0275\u0275getInheritedFactory(ps)))(s||ps)}})();static#t=this.\u0275prov=c.\u0275\u0275defineInjectable({token:ps,factory:ps.\u0275fac,providedIn:"root"})}const tp=Vs.create({token:Bc,mappings:[{predicate:n=>n.type==="aggregation",injectable:ls},{predicate:n=>n.type==="function"&&n.functionConfig?.type==="aggregation",injectable:ds},{predicate:n=>n.type==="function"&&n.functionConfig?.type==="datePart",injectable:hs}],default:{injectable:ps}});function pu(n){Object.values(n.controls||{}).forEach(e=>{e instanceof ge.FormGroup||e instanceof ge.FormArray?pu(e):e.updateValueAndValidity({onlySelf:!0})})}function Sa(n){n?.markAsPristine(),n?.markAsUntouched(),n?.updateValueAndValidity()}function tf(n){return Object.values(n?.errors||{}).map(e=>e?.message).filter(Boolean)}function mu(n){return n.statusChanges.pipe((0,u.startWith)(n.status),(0,u.first)(()=>n.status.toLowerCase()!=="pending"),(0,u.map)(()=>{}))}let Ca=class extends Z{constructor(e){super(),this._ngZone=e}_validateRequest(e){const{$context:t,collectionAttributeName:s}=e;if(!t)throw new Error('The "$context" request property is not specified.');if(!s)throw new Error('The "collectionAttributeName" request property is not specified.');const r=t._attributeConfigs[s];if(!(("viewModelConfig"in r||"viewModelName"in r)&&r.isCollection))throw new Error(`There is no view model collection for the specified "${s}" attribute.`)}_canCancelPrimaryDataChanges(e,t){var s=this;return(0,S.A)(function*(){if(!t)return!0;const r=yield s._getPrimaryAttributeValue(e);return t.includes(r)})()}_getPrimaryAttributeValue(e){return(0,S.A)(function*(){const t=yield e.getPrimaryModelName(),s=yield e.getPrimaryDataSchema(),r=e.getViewModelAttributePath(t,s.primaryAttributeName);return e[r]})()}_resetFormApiModel(e){this._ngZone.run((0,S.A)(function*(){const t=yield e.getPrimaryModelName();e.getBoundDataSourceAttributeControls(t)?.forEach(r=>{Sa(r)})}))}_cancelPrimaryDataChanges(e){var t=this;return(0,S.A)(function*(){try{const s={type:"crt.CancelPrimaryDataChangesRequest",$context:e};return yield t.handlerChain.process(s)}catch(s){return[{success:!1,errorInfo:s?.message}]}})()}handle(e){var t=this;return(0,S.A)(function*(){t._validateRequest(e);const{$context:s,collectionAttributeName:r,primaryAttributeValues:i}=e??{},a=yield s.attributes[r],l=a.getChangedItems(),d=[];for(const p of l)(yield t._canCancelPrimaryDataChanges(p,i))&&d.push(t._cancelPrimaryDataChanges(p));for(const p of a)l.includes(p)||t._resetFormApiModel(p);return(yield Promise.all(d)).flat()})()}};Ca=(0,m.__decorate)([oe({type:"crt.CancelCollectionPrimaryDataHandler",requestType:"crt.CancelCollectionPrimaryDataChangesRequest"}),(0,m.__metadata)("design:paramtypes",[c.NgZone])],Ca);let Aa=class extends Z{_validateRequest(e){const{$context:t}=e;if(!t)throw new Error('The "$context" request property is not specified.')}_cancelCurrentDataChanges(e){var t=this;return(0,S.A)(function*(){const s=e.getPrimaryModelMode();if(s===A.Create){const r=yield e.getPrimaryModelName();return e.getModelByName(r).getDataSource().scope===Ee.ViewElement&&e.markPrimaryModelFor(A.Delete),Promise.resolve({success:!0})}return s===A.Delete&&e.markPrimaryModelFor(A.Update),(yield e.IsChanged)?t._reloadCurrentDataChanges(e):Promise.resolve({success:!0})})()}_reloadCurrentDataChanges(e){var t=this;return(0,S.A)(function*(){try{return yield t._loadPrimaryData(e),yield t._onSuccessCancelPrimaryData(e),{success:!0}}catch(s){const r=s?.message;return t._onFailCancelPrimaryData(e,r),{success:!1,errorInfo:r}}})()}_loadPrimaryData(e){var t=this;return(0,S.A)(function*(){const s=yield e.getPrimaryModelName(),r=yield e.getPrimaryDataSchema(),i=e.getViewModelAttributePath(s,r.primaryAttributeName);yield t.handlerChain.process({type:"crt.LoadDataRequest",$context:e,dataSourceName:s,parameters:[{type:P.PrimaryColumnValue,value:i}]})})()}_onFailCancelPrimaryData(e,t){e.formApiModel.setErrors({cancel:{message:t}})}_onSuccessCancelPrimaryData(e){return(0,S.A)(function*(){const t=yield e.getPrimaryModelName();e.getBoundDataSourceAttributeControls(t)?.forEach(r=>{Sa(r)})})()}_cancelNestedDataChanges(e){var t=this;return(0,S.A)(function*(){const s=[],r=Object.entries(e._attributeConfigs);for(const[a,l]of r)if(!(!("viewModelConfig"in l)&&!("viewModelName"in l)))if(l.isCollection)s.push(t._cancelPrimaryDataSafely(()=>t._cancelCollectionPrimaryDataChanges(e,a)));else{const d=yield e[a];s.push(t._cancelPrimaryDataSafely(()=>t._cancelPrimaryDataChanges(d)))}return(yield Promise.all(s)).flat()})()}_cancelPrimaryDataChanges(e){var t=this;return(0,S.A)(function*(){const s={type:"crt.CancelPrimaryDataChangesRequest",$context:e};return yield t.handlerChain.process(s)})()}_cancelCollectionPrimaryDataChanges(e,t){var s=this;return(0,S.A)(function*(){const r={type:"crt.CancelCollectionPrimaryDataChangesRequest",$context:e,collectionAttributeName:t};return yield s.handlerChain.process(r)})()}_cancelPrimaryDataSafely(e){return e().catch(t=>[{success:!1,errorInfo:t?.message}])}handle(e){var t=this;return(0,S.A)(function*(){t._validateRequest(e);const s=e.$context,r=yield t._cancelNestedDataChanges(s);return[yield t._cancelCurrentDataChanges(s),...r]})()}};Aa=(0,m.__decorate)([oe({type:"crt.CancelPrimaryDataChangesHandler",requestType:"crt.CancelPrimaryDataChangesRequest"})],Aa);let fu=class extends V{};fu=(0,m.__decorate)([M({type:"crt.LoadLookupListRequest"})],fu);let va=class extends Z{handle(e){const t={control:e.valueAttributeName,items:e.itemsAttributeName},s=e.filterValue??null,r=[{type:P.PrimaryDisplayValueFilter,value:"@requestPayload.lookupFilterValue"},...e.parameters||[]],i={...e.payload,lookupFilterValue:s};return e.$context.loadLookupList(t,r,i),Promise.resolve()}};va=(0,m.__decorate)([oe({type:"crt.LoadLookupListHandler",requestType:"crt.LoadLookupListRequest"})],va);const sf="crtInput:",rf="crtOutput:",nf="crtValidationInput:",sp="crtInject:";function gu(n){return function(e,t,s){Reflect.defineMetadata(sp+s,n,e)}}const rp="DisableShowSuccessMessageAfterLoadDataRequest";class St extends V{}var Ea;(function(n){n.RefreshAll="RefreshAll",n.RefreshSpecific="RefreshSpecific"})(Ea||(Ea={}));let Ma=class extends St{};Ma=(0,m.__decorate)([M({type:"crt.LoadDataRequest",title:"InterfaceDesigner.PropertiesPages.ViewElementEventPropertiesPanel.Requests.LoadDataRequest",propertiesPanelComponentTypeName:"crt.LoadDataRequestPropertiesPanel",position:500})],Ma);let Ia=class extends Z{constructor(e,t){super(),this._translateService=e,this._featureValues=t}_isDynamicDS(e){const t=e.config||{};return!!(t.dataSourceConfig&&t.attributeName)}_loadDynamicDS(e){const t=e.$context,s=e.config;return(0,o.lastValueFrom)(t.load(s),{defaultValue:null})}_load(e){if(!e.dataSourceName)return;const t=e.$context;let s=e.parameters;s=this._addPrimaryDisplayValueFilterIfNeed(e,s);const r=e.config;return this._trySubscribeToLoadedData(e),(0,o.lastValueFrom)(t.load(e.dataSourceName,s,r),{defaultValue:null})}_trySubscribeToLoadedData(e){e?.showSuccessMessage&&this._subscribeToLoadedData(e,[e.dataSourceName])}_subscribeToLoadedData(e,t){if(this._featureValues[rp]||t.length===0)return;const s=e.$context,r=t.map(d=>s._modelsMap.get(d)),i=new Set(t);r.forEach(d=>{const h=d.affectedAttributes.map(f=>f.path);s._getDependentModelsForLoad(d,h).forEach(f=>{i.add(f)})});const a=new Set,l=s._modelLoaded$.subscribe(d=>{if(i.has(d)&&a.add(d),a.size===i.size){l.unsubscribe();const h={$context:e.$context,type:"crt.NotificationRequest",message:this._translateService.instant("LoadDataRequest.SuccessMessage")};this.handlerChain.process(h)}})}_addPrimaryDisplayValueFilterIfNeed(e,t){return e.primaryDisplayFilterValue?(t=t||[],[...t,{type:P.PrimaryDisplayValueFilter,value:e.primaryDisplayFilterValue}]):t}_isDynamicModel(e,t){return e._dynamicModelNames.has(t)}_refreshData(e){const t=e.refreshDataConfig,s=e.$context;let r;if(t.mode===Ea.RefreshAll){const a=t.excludedDataSourceNames||[];r=[...s._modelsMap.values()].map(l=>l.name).filter(l=>!a.includes(l)).filter(l=>!this._isDynamicModel(s,l)).filter(l=>s._getDependOnModelsNames(l).length===0)}else if(r=t.targetDataSourceNames||[],r.length===0)throw new Error("'RefreshSpecific' option requires at least one target data source name");r=r.filter(a=>{const l=s._getDependOnModelsNames(a);return!r.some(d=>l.includes(d))}),r=[...new Set(r)];const i=r.map(a=>({$context:e.$context,type:e.type,showSuccessMessage:!1,dataSourceName:a,config:{loadType:q.Reload,useLastLoadParameters:!0}}));return e.showSuccessMessage===!0&&this._subscribeToLoadedData(e,r),Promise.all(i.map(a=>this.handlerChain.process(a)))}handle(e){if(!e.$context)throw new Error("Property '$context' should be specified");return e.refreshDataConfig?this._refreshData(e):this._isDynamicDS(e)?this._loadDynamicDS(e):this._load(e)}};Ia=(0,m.__decorate)([oe({type:"crt.LoadDataSourceHandler",requestType:"crt.LoadDataRequest"}),(0,m.__param)(1,(0,c.Inject)(W)),(0,m.__param)(1,gu(W)),(0,m.__metadata)("design:paramtypes",[T.TranslateService,Si])],Ia);let _u=class extends St{};_u=(0,m.__decorate)([M({type:"crt.LoadDefaultValuesRequest"})],_u);let Ra=class extends Z{handle(e){const t=e.$context;return(0,o.lastValueFrom)(t.loadDefaultValues(e.dataSourceName),{defaultValue:null})}};Ra=(0,m.__decorate)([oe({type:"crt.LoadDefaultValuesHandler",requestType:"crt.LoadDefaultValuesRequest"})],Ra);let yu=class extends St{};yu=(0,m.__decorate)([M({type:"crt.SaveDataRequest"})],yu);let wa=class extends Z{handle(e){const t=e.$context,{dataSourceName:s,options:r,parameters:i}=e,a=t.save(s,i,r);return(0,o.lastValueFrom)(a,{defaultValue:null})}};wa=(0,m.__decorate)([oe({type:"crt.SaveDataHandler",requestType:"crt.SaveDataRequest"})],wa);let Pa=class extends Z{_validateRequest(e){const{$context:t,collectionAttributeName:s}=e;if(!t)throw new Error('The "$context" request property is not specified.');if(!s)throw new Error('The "collectionAttributeName" request property is not specified.');const r=t._attributeConfigs[s];if(!(("viewModelConfig"in r||"viewModelName"in r)&&r.isCollection))throw new Error(`There is no view model collection for the specified "${s}" attribute.`)}_canSavePrimaryData(e,t){var s=this;return(0,S.A)(function*(){if(!t)return!0;const r=yield s._getPrimaryAttributeValue(e);return t.includes(r)})()}_getPrimaryAttributeValue(e){return(0,S.A)(function*(){const t=yield e.getPrimaryModelName(),s=yield e.getPrimaryDataSchema(),r=e.getViewModelAttributePath(t,s.primaryAttributeName);return e[r]})()}_savePrimaryData(e){var t=this;return(0,S.A)(function*(){try{const s={type:"crt.SavePrimaryDataRequest",$context:e};return yield t.handlerChain.process(s)}catch(s){return[{success:!1,rowsAffected:0,errorInfo:s?.message}]}})()}handle(e){var t=this;return(0,S.A)(function*(){t._validateRequest(e);const{$context:s,collectionAttributeName:r,primaryAttributeValues:i}=e??{},l=s.attributes[r].getChangedItems(),d=[];for(const h of l)(yield t._canSavePrimaryData(h,i))&&d.push(yield t._savePrimaryData(h));return d.flat()})()}};Pa=(0,m.__decorate)([oe({type:"crt.SaveCollectionPrimaryDataHandler",requestType:"crt.SaveCollectionPrimaryDataRequest"})],Pa);function bu(n,e){const t=e.map(s=>{const r=n._attributeConfigs[s];return r&&r.caption?Promise.resolve(r.caption):n[wr][ss.string][s].then(i=>i||s)});return Promise.all(t)}class ms{constructor(e){this._translateService=e}_getFirstValidationError(e){const t=Object.entries(e??{});if(t.length===0)return null;const s=t[0][1];return Object.entries(s)[0]}getValidationErrorMessage(e,t){var s=this;return(0,S.A)(function*(){const r=s._getFirstValidationError(t);if(!r)return"";const i=r[0],a=r[1].message,d=Object.entries(t).filter(([f,C])=>Object.keys(C).includes(i)).map(([f,C])=>f),h=(yield bu(e,d)).map(f=>`"${f}"`),p=d.length===1?s._translateService.instant("BaseViewModel.ValidationErrorMessageSingleErrorField"):s._translateService.instant("BaseViewModel.ValidationErrorMessageSeveralErrorFields");return ze.String.format(p,h.join(", "),a)})()}static#e=this.\u0275fac=function(t){return new(t||ms)(c.\u0275\u0275inject(T.TranslateService))};static#t=this.\u0275prov=c.\u0275\u0275defineInjectable({token:ms,factory:ms.\u0275fac})}var L;(function(n){n.None="None",n.OneToMany="OneToMany",n.ManyToOne="ManyToOne",n.ManyToMany="ManyToMany",n.CircularDependency="CircularDependency"})(L||(L={}));function Su(n,e){return!!n?.some(t=>t.relationPath.split(".").shift()===e)}function Cu(n){return n.dataValueType===y.r.Guid}function Au(n,e){return Cu(e)&&n.primaryAttributeName===e.name}function Da(n,e,t,s){const r=t.findAttributeByName(s),i=n.findAttributeByName(e);return(i.isLookup||Cu(i))&&Au(t,r)?L.OneToMany:Au(n,i)&&r.isLookup?L.ManyToOne:L.ManyToMany}class fs{constructor(){}_getDataSchema(e,t){return e.dataSchemas[t]}_getRelationData(e,t){const s=t.attributePath;if(s.split(".").length!==1)throw new Error(["Transition relation is not allowed.",`Model name: '${e}', attribute path: '${s}'`].join(" "));const r=t.relationPath.split(".");if(r.length!==2)throw new Error(["Transition relation is not allowed.",`Model name: '${e}', relation path: '${t.relationPath}'`].join(" "));const[i,a]=r;return{modelAttributeName:s,dependOnModelName:i,dependOnModelAttributeName:a}}_mergeRelationTypes(e,t){if(e===L.None)return t;if(t===L.None)return e;if(e===L.CircularDependency||t===L.CircularDependency)return L.CircularDependency;if(e===t)return e;if(e===L.OneToMany&&t===L.ManyToOne||e===L.ManyToOne&&t===L.OneToMany)return L.CircularDependency;if(e===L.ManyToMany||t===L.ManyToMany)return L.ManyToMany}_saveBefore(e,t,s){const r=s.find(i=>i.name===t);r.dependsOn.includes(e)||r.dependsOn.push(e)}_saveAfter(e,t,s){const r=s.find(i=>i.name===e);r.dependsOn.includes(t)||r.dependsOn.push(t)}_sort(e,t){const s=t.map(r=>({name:r,dependsOn:[]}));return t.forEach(r=>{const i=e._getModelDependencies(r);if(!i||i.length===0)return;const a=new Map;for(const l of i){const{modelAttributeName:d,dependOnModelName:h,dependOnModelAttributeName:p}=this._getRelationData(r,l),f=Da(this._getDataSchema(e,r),d,this._getDataSchema(e,h),p);let C=a.get(h)??L.None;C=this._mergeRelationTypes(C,f),a.set(h,C)}a.forEach((l,d)=>{switch(l){case L.ManyToOne:this._saveBefore(r,d,s);break;case L.OneToMany:this._saveAfter(r,d,s);break;case L.ManyToMany:throw new Error("Many-to-many relation is not supported");case L.CircularDependency:throw new Error("Circular dependency detected")}})}),nc(s)}sort(e,t){return t.every(r=>e.getModelMode(r)===A.Update)?t:this._sort(e,t).flat()}static#e=this.\u0275fac=function(t){return new(t||fs)};static#t=this.\u0275prov=c.\u0275\u0275defineInjectable({token:fs,factory:fs.\u0275fac})}function vu(n){return n.replace(/\.+/g,"").replace(/\[+/g,"").replace(/\]+/g,"").replace(/:+/g,"")}const np="DS",ip="DYN";function xn(n){for(;n?.parent;)n=n.parent;return n}function Ct(n){return n?.getDataSource()?.scope===Ee.Page}function ap(n){const e=[];return n?._modelsMap.forEach((t,s)=>{Ct(t)&&e.push(s)}),e}class gs{static#e=this._dataCache=new WeakMap;static _getDataSourceColumns(e){const t={};let s=!1;for(const[r,i]of Object.entries(e.dataSourceConfig.config.attributes)){const a=i.path;t[vu(r)]=a,a==="Id"&&(s=!0)}return!s&&e.includePrimaryAttributes!==!1&&(t.Id="Id"),t}static _createAttributesConfigMap(e,t,s,r,i){const a={},l=this.getAttributeDataSourceOldName(e,r);for(const[d]of Object.entries(t)){const h=i.config?.useOriginalAttributesName?`${d}`:`${l}_${d}`,p=i.config.attributes[d],f={path:`${s}.${d}`,type:p?.type,functionConfig:p?.functionConfig,aggregationConfig:p?.aggregationConfig};a[h]={modelConfig:f}}return a}static _createAttributePagingConfig(e){return e.pagingConfig||{rowCount:30}}static _createAttributeSortingConfig(e){return e.sortingConfig||{attributeName:e.attributeName+"Sorting"}}static _createAttributeFiltersConfig(e){return e.filtersConfig?.map(t=>{const s={...t};return delete s.value,s})||[]}static _getDataSourceNameForDynamicModel(e,t){return e.getBoundDataSourceNameByAttributePath(t)||this._getAttributeDataSourceDefaultName(t)}static _getDynamicDataSourceNamePrefix(){return`${ip}_`}static _isDynamicDataSourceName(e){return e.startsWith(this._getDynamicDataSourceNamePrefix())}static _getAttributeDataSourceDefaultName(e){return`${e}${np}`}static _getLoadData(e,t,s,r){let i;return this._dataCache.has(e)?i=this._dataCache.get(e):(i=t.load(s,[]).pipe((0,u.share)(),(0,u.tap)(()=>this._dataCache.delete(e))),this._dataCache.set(e,i)),(0,o.lastValueFrom)(i.pipe((0,o.map)(()=>r())),{defaultValue:null})}static createAttributeConfig(e,t,s){const r=s.attributeName,i=s.dataSourceConfig,a=this._getDataSourceColumns(s),l=this._createAttributesConfigMap(e,a,t,r,i),d=this._createAttributePagingConfig(s),h=this._createAttributeSortingConfig(s),p=this._createAttributeFiltersConfig(s);return{isCollection:!0,modelConfig:{path:t,pagingConfig:d,sortingConfig:h,filterAttributes:p},viewModelConfig:{attributes:l}}}static getAttributeDataSourceOldName(e,t){let s=this._getDataSourceNameForDynamicModel(e,t);return(!s||this._isDynamicDataSourceName(s))&&(s=this._getAttributeDataSourceDefaultName(t)),s}static createDynamicDataSourceNameFromAttributeName(e,t){const s=this._getDynamicDataSourceNamePrefix(),r=this._getDataSourceNameForDynamicModel(e,t);return this._isDynamicDataSourceName(r)?r:`${s}${r}`}static defineAsyncAttribute(e,t,s,r,i){const a=s.modelConfig?.path?.split(".")[0],l=e.getModelByName(a),d="isLookup"in s&&s.isLookup,h="isCollection"in s&&s.isCollection;Object.defineProperty(e,t,{get:()=>l&&h&&!d&&!l?.isLoaded?this._getLoadData(l,e,a,r):Promise.resolve(r()),set:i,configurable:!0})}static deferUpdatingValueAndValidity(e,t,s){if(s?.["ViewModel.DontDeferUpdatingValueAndValidity"])return t();const r=e.formApiModel.updateValueAndValidity;if(r.callbackCount)r.callbackCount++;else{const l=sl();l.callbackCount=1,l.originalFn=r.bind(e.formApiModel),e.formApiModel.updateValueAndValidity=l}const i=t(),a=()=>{const l=e.formApiModel.updateValueAndValidity;l.callbackCount===1?(e.formApiModel.updateValueAndValidity=l.originalFn,e.formApiModel.updateValueAndValidity()):l.callbackCount--};return i instanceof Promise?i.finally(a):i.pipe((0,u.finalize)(a))}}let Ta=class extends Z{constructor(e,t,s,r){super(),this._baseViewModelProcessValidationResultService=e,this.modelSaveOrderSorterService=t,this._featureValues=s,this._translateService=r}_validateRequest(e){const{$context:t}=e;if(!t)throw new Error('The "$context" request property is not specified.')}_saveModel(e,t){var s=this;return(0,S.A)(function*(){const r=e.dataSchemas[t],i=e.getViewModelAttributePath(t,r.primaryAttributeName);try{const a=yield s._saveData(e,t,i);return a.success&&s._onSuccessSaveRootData(e,t,a),a}catch(a){const l=a?.message;return s._createFailedSaveResult(l)}})()}_validateModel(e,t){var s=this;return(0,S.A)(function*(){if(!(yield e.isValid(t))){const i=yield e.validate(t),a=yield s._baseViewModelProcessValidationResultService.getValidationErrorMessage(e,i);return s._createFailedSaveResult(a)}return null})()}_getModels(e){var t=this;return(0,S.A)(function*(){const s=yield e.getPrimaryModelName();let r=ap(e);return r=r.filter(i=>e.getModelMode(i)!==A.Init),s&&!r.includes(s)&&r.unshift(s),t._featureValues.DisableMultipleDataSources?r:t.modelSaveOrderSorterService.sort(e,r)})()}_canSaveDataResult(e,t){var s=this;return(0,S.A)(function*(){const r=e.dataSchemas[t],i=e.getViewModelAttributePath(t,r.primaryAttributeName),a=yield s._canSaveData(e,t,i);if(a&&!a?.result)return s._createFailedSaveResult(a.message)})()}_checkPdsGroupValidationResults(e,t){var s=this;return(0,S.A)(function*(){const r=yield Promise.all(t.map(a=>s._validateModel(e,a)));if(r.some(a=>a&&!a.success))return r;const i=yield Promise.all(t.map(a=>s._canSaveDataResult(e,a)));return i.some(a=>a&&!a.success)?i:[]})()}_saveModelChanges(e,t){var s=this;return(0,S.A)(function*(){let r;return(yield s._shouldSkipSavingUnchangedPageModel(e,t))||(r=yield s._saveModel(e,t)),r})()}_saveRootData(e){var t=this;return(0,S.A)(function*(){const s=yield t._getModels(e),r=yield e.getPrimaryModelName();let i=[...r?[r]:[],...s.filter(p=>Su(e._getModelDependencies(p),r))];t._featureValues.DisableMultipleDataSources&&(i=[]);const a=(yield Promise.all(i.map(function(){var p=(0,S.A)(function*(f){return(yield t._shouldSkipValidationAndSavingPageModel(e,f))?null:f});return function(f){return p.apply(this,arguments)}}()))).filter(Boolean);let l=yield t._checkPdsGroupValidationResults(e,a);if(!l.length)for(const p of a)l.push(yield t._saveModelChanges(e,p));const d=s.filter(p=>!i.includes(p));for(const p of d){const f=yield t._validateModel(e,p),C=yield t._canSaveDataResult(e,p);!f&&!C?l.push(yield t._saveModelChanges(e,p)):l.push(f||C)}l=l.filter(Boolean);const h=l.filter(p=>!p.success).map(p=>p.errorInfo);return h.length&&t._onFailSaveRootData(e,h.join(", ")),l})()}_shouldSkipSavingUnchangedPageModel(e,t){var s=this;return(0,S.A)(function*(){if(s._featureValues.DisableMultipleDataSources)return!1;const r=e.getModelByName(t),i=e._getModelDependencies(t),a=!i?.length,l=r?._isChanged,d=yield e.getPrimaryModelName();return a?t!==d&&!l:r?.getDataSource()?.isForceUpdateUnchangedData?!1:Su(i,d)&&!l})()}_canSaveData(e,t,s){return(0,S.A)(function*(){const i={primaryColumnValue:yield e[s]};return e.canSave(t,i)})()}_saveData(e,t,s){var r=this;return(0,S.A)(function*(){const i={type:"crt.SaveDataRequest",$context:e,parameters:[{type:P.PrimaryColumnValue,value:s}],dataSourceName:t};return yield r.handlerChain.process(i)})()}_onFailSaveRootData(e,t){e.formApiModel.setErrors({save:{message:t}})}_updateAttributesOnSaveResult(e,t,s){if(s?.primaryAttributes?.length)for(const r of s.primaryAttributes)for(const[i,a]of Object.entries(r)){const l=e.getViewModelAttributePath(t,i);e[l]=a}}_onSuccessSaveRootData(e,t,s){this._updateAttributesOnSaveResult(e,t,s),e.getBoundDataSourceAttributeControls(t)?.forEach(i=>{Sa(i)})}_saveNestedData(e,t){var s=this;return(0,S.A)(function*(){const r=[],i=Object.entries(e._attributeConfigs);for(const[l,d]of i)if(!(!("viewModelConfig"in d)&&!("viewModelName"in d)))if(d.isCollection)r.push(s._saveDataSafely(()=>s._saveInnerViewModelCollection(e,l,t)));else{const h=yield e[l];r.push(s._saveDataSafely(()=>s._saveInnerViewModel(h)))}return(yield Promise.all(r)).flat()})()}_saveInnerViewModel(e){var t=this;return(0,S.A)(function*(){const s={type:"crt.SavePrimaryDataRequest",$context:e};return yield t.handlerChain.process(s)})()}_saveInnerViewModelCollection(e,t,s){var r=this;return(0,S.A)(function*(){const i={type:"crt.SaveCollectionPrimaryDataRequest",$context:e,collectionAttributeName:t,scopes:s};return yield r.handlerChain.process(i)})()}_saveDataSafely(e){return e().catch(t=>[this._createFailedSaveResult(t?.message)])}_createFailedSaveResult(e){return{success:!1,rowsAffected:0,errorInfo:e}}_shouldSkipValidationAndSavingPageModel(e,t){var s=this;return(0,S.A)(function*(){const r=yield e.getPrimaryModelName();if(t===r)return!1;const i=e._getModelDependencies(t);if(!i?.length)return!1;const[{relationPath:a,attributePath:l}]=i,[,d]=a.split("."),h=Da(e.dataSchemas[t],l,e.dataSchemas[r],d);if(h===L.OneToMany)return!1;if(h===L.ManyToOne){const p=e.getViewModelAttributePaths(r,d);if(!p.length)return!0;if(!(yield e[p[0]])){if(!e.getBoundDataSourceAttributeControls(t).every(ne=>ne.value===null)){const ne=yield bu(e,[p[0]]),I={type:"crt.NotificationRequest",$context:e,message:s._translateService.instant("BaseViewModel.ErrorMessageOnEmptyRelationColumn",{caption:ne})};yield s.handlerChain.process(I)}return!0}}return!1})()}handle(e){var t=this;return(0,S.A)(function*(){t._validateRequest(e);const s=e.$context,r=yield t._saveRootData(s);if(r.some(a=>!a.success))return r;const i=yield t._saveNestedData(s,e.scopes);return[...r,...i]})()}};Ta=(0,m.__decorate)([oe({type:"crt.SavePrimaryDataHandler",requestType:"crt.SavePrimaryDataRequest"}),(0,m.__param)(2,(0,c.Inject)(W)),(0,m.__param)(2,gu(W)),(0,m.__metadata)("design:paramtypes",[ms,fs,Si,T.TranslateService])],Ta);let Eu=class extends St{};Eu=(0,m.__decorate)([M({type:"crt.DeleteDataRequest"})],Eu);let Na=class extends Z{handle(e){const t=e.$context;return(0,o.lastValueFrom)(t.delete(e.dataSourceName,e.parameters,e.config),{defaultValue:null})}};Na=(0,m.__decorate)([oe({type:"crt.DeleteDataHandler",requestType:"crt.DeleteDataRequest"})],Na);let Mu=class extends St{};Mu=(0,m.__decorate)([M({type:"crt.CopyDataRequest"})],Mu);let Va=class extends Z{handle(e){const t=e.$context,{dataSourceName:s,recordId:r,copiedValues:i}=e;return(0,o.lastValueFrom)(t.copy(s,r,i),{defaultValue:null})}};Va=(0,m.__decorate)([oe({type:"crt.CopyDataHandler",requestType:"crt.CopyDataRequest"})],Va);let Iu=class extends St{};Iu=(0,m.__decorate)([M({type:"crt.SortDataRequest"})],Iu);let xa=class extends Z{handle(e){const t=e.$context;return(0,o.lastValueFrom)(t.setSorting(e.dataSourceName,e.config),{defaultValue:null})}};xa=(0,m.__decorate)([oe({type:"crt.SortDataHandler",requestType:"crt.SortDataRequest"})],xa);let Ru=class extends St{};Ru=(0,m.__decorate)([M({type:"crt.GetDataSourceLoadFiltersRequest"})],Ru);let Oa=class extends Z{constructor(e){super(),this._entitySchemaQueryBuilder=e}handle(e){var t=this;return(0,S.A)(function*(){const s=e.$context;if(!s)throw new Error("Property '$context' should be specified");const r=e.dataSourceName;if(!r)throw new Error("Property 'dataSourceName' should be specified");const i=s.dataSchemas[r];if(!i)throw new Error(`Schema for data source with name ${r} not found`);const a=yield s.getDataSourceLoadParameters(r);return a.parameters.some(l=>l.type===P.Never)?null:(0,o.lastValueFrom)(t._entitySchemaQueryBuilder.build(i,[],a.parameters).pipe((0,o.map)(l=>l.getMetadata().filters)))})()}};Oa=(0,m.__decorate)([oe({type:"crt.GetDataSourceLoadFiltersHandler",requestType:"crt.GetDataSourceLoadFiltersRequest"}),(0,m.__metadata)("design:paramtypes",[$t])],Oa);const On=new c.InjectionToken("SCOPE_NAME"),wu=new c.InjectionToken("VIEW_EVENT_ZONE_NAME"),op=new c.InjectionToken("INJECTION_CONTEXT");class _s{selectData(){return null}static#e=this.\u0275fac=function(t){return new(t||_s)};static#t=this.\u0275prov=c.\u0275\u0275defineInjectable({token:_s,factory:_s.\u0275fac,providedIn:"root"})}class ys extends _s{constructor(){super(...arguments),this._elon={FirstName:"Elon",Account:{Name:"SpaceX",Ships:[{Id:"Falcon 9"},{Id:"Falcon Heavy"}],Employee:{Name:"Mask",Age:49}},Employees:["Elon"]}}selectData(){return(0,o.of)(this._elon).pipe((0,u.delay)(50))}static#e=this.\u0275fac=(()=>{let e;return function(s){return(e||(e=c.\u0275\u0275getInheritedFactory(ys)))(s||ys)}})();static#t=this.\u0275prov=c.\u0275\u0275defineInjectable({token:ys,factory:ys.\u0275fac,providedIn:"root"})}class Ln{constructor(e){this.injector=e}}function de(n){return n?function(e){Ce(n.type,"ValidatorTypeName");const t={...n,typeRef:e};Cl(t,e)}:e=>{}}class La{static#e=this._instanceOfKey="devkit_BaseValidator";get isAsync(){return this.async}get validateFn(){return this.validate.bind(this)}static[Symbol.hasInstance](e){return e?.constructor?._instanceOfKey===La._instanceOfKey}}let ce=class extends La{constructor(e){super(),this.injector=e}defaultValidationError(e){const t=this.injector?.get(T.TranslateService),s=e??{},r=t?.instant(this.i18nMessageKey,s);return{message:e?.message||r||""}}};ce=(0,m.__decorate)([de(),(0,m.__metadata)("design:paramtypes",[c.Injector])],ce);let Ba=class extends ce{constructor(){super(...arguments),this.i18nMessageKey="Validators.Required.Message",this.async=!1}validateLczValue(e){return e?!!e.find(t=>t.value&&t.value.trim()):!1}validate(e,t){const s=e.value;return(typeof s=="string"?!!(e&&e.value?.trim()):this.validateLczValue(s))?null:{required:this.defaultValidationError(t)}}};Ba=(0,m.__decorate)([de({type:"crt.EmptyOrWhiteSpace"})],Ba);let ka=class extends ce{constructor(){super(...arguments),this.i18nMessageKey="Validators.Max.Message",this.async=!1}validate(e,t){const r=ge.Validators.max(t.max)(e);return r?{max:this.defaultValidationError({...t,...r.max})}:null}};ka=(0,m.__decorate)([de({type:"crt.Max"})],ka);function Pu(n){return typeof n=="string"}function cp(n){const e=n.substring(1,n.length-1);return parseInt(e,10)}function af(n,e){return n.replace(/{[0-9]}/g,t=>{const s=cp(t);return e[s]?e[s].toString():""})}function of(n){return n.charAt(0).toUpperCase()+n.slice(1)}function cf(n){return n.charAt(0).toLowerCase()+n.slice(1)}function uf(n){let e=0;if(!Pu(n)||n.length===0)return e;for(let t=0;t<n.length;t++)e=n.charCodeAt(t)+(e<<5)-e,e=e&e;return e}class ye{static _trimValueIfNeeded(e,t){return t?.trimValue&&!ye.isEmptyInputValue(e)&&Pu(e)?e.trim():e}static isEmptyInputValue(e){return e==null||(typeof e=="string"||Array.isArray(e))&&e.length===0}static hasValidLength(e){return e!=null&&typeof e.length=="number"}static getControlValueAndTrimIfNeeded(e,t){return ye._trimValueIfNeeded(e.value,t)}}let Fa=class extends ce{constructor(){super(...arguments),this.i18nMessageKey="Validators.MaxLength.Message",this.async=!1}_maxLengthValidator(e,t){return ye.hasValidLength(e)&&e.length>t.maxLength?{maxlength:this.defaultValidationError({...t,requiredLength:t.maxLength,actualLength:e.length})}:null}validate(e,t){const s=ye.getControlValueAndTrimIfNeeded(e,t);return this._maxLengthValidator(s,t)}};Fa=(0,m.__decorate)([de({type:"crt.MaxLength"})],Fa);let ja=class extends ce{constructor(){super(...arguments),this.i18nMessageKey="Validators.Min.Message",this.async=!1}validate(e,t){const r=ge.Validators.min(t.min)(e);return r?{min:this.defaultValidationError({...t,...r.min})}:null}};ja=(0,m.__decorate)([de({type:"crt.Min"})],ja);let $a=class extends ce{constructor(){super(...arguments),this.i18nMessageKey="Validators.MinLength.Message",this.async=!1}_minLengthValidator(e,t){return ye.isEmptyInputValue(e)||!ye.hasValidLength(e)?null:e.length<t.minLength?{minlength:this.defaultValidationError({...t,requiredLength:t.minLength,actualLength:e.length})}:null}validate(e,t){const s=ye.getControlValueAndTrimIfNeeded(e,t);return this._minLengthValidator(s,t)}};$a=(0,m.__decorate)([de({type:"crt.MinLength"})],$a);let Bn=class extends ce{constructor(){super(...arguments),this.i18nMessageKey="Validators.RegExp.Message",this.async=!1}validate(e,t){typeof t.regex=="string"&&(t.regex=new RegExp(t.regex));const s=t.regex.test(e.value);return this.i18nMessageKey=t.message||this.i18nMessageKey,s?null:{[t.errorCode]:this.defaultValidationError({...t})}}};Bn=(0,m.__decorate)([de({type:"crt.RegExp"})],Bn);let Ua=class extends ce{constructor(e){super(e),this.injector=e,this.async=!1,this.i18nMessageKey="Validators.PhoneNumber.Message",this._phoneValidationService=e.get(Je)}validate(e,t){return!e.value||this._phoneValidationService.isValidPhoneNumber(e.value)?null:{invalidPhoneNumber:this.defaultValidationError(t)}}};Ua=(0,m.__decorate)([de({type:"crt.PhoneNumber"}),(0,m.__metadata)("design:paramtypes",[c.Injector])],Ua);let qa=class extends ce{constructor(){super(...arguments),this.i18nMessageKey="Validators.Required.Message",this.async=!1}_requiredValidator(e,t){return ye.isEmptyInputValue(e)?{required:this.defaultValidationError(t)}:null}validate(e,t){const s=ye.getControlValueAndTrimIfNeeded(e,t);return this._requiredValidator(s,t)}};qa=(0,m.__decorate)([de({type:"crt.Required"})],qa);let Ha=class extends ce{constructor(e){super(e),this.injector=e,this._messageKey="Validators.SchemaNamePrefix.",this.async=!0,this._sysSettingsService=e.get(ae)}_getSchemaNamePrefix(){var e=this;return(0,S.A)(function*(){return(yield e._sysSettingsService.getByCode("SchemaNamePrefix")).value})()}validate(e,t){var s=this;return(0,S.A)(function*(){if((0,v.isObject)(e.value))return null;const r=ye.getControlValueAndTrimIfNeeded(e,{trimValue:!0}),i=yield s._getSchemaNamePrefix();if(i){const a=!r?.startsWith(i);if(a||r===i)return s.i18nMessageKey=a?s._messageKey+"NoSchemaNamePrefixMessage":s._messageKey+"OnlySchemaNamePrefixMessage",{namePrefixError:s.defaultValidationError({...t,schemaNamePrefix:i})}}return null})()}};Ha=(0,m.__decorate)([de({type:"crt.SchemaNamePrefix"}),(0,m.__metadata)("design:paramtypes",[c.Injector])],Ha);let za=class extends Bn{constructor(){super(...arguments),this._params={regex:/^[a-zA-Z]+[a-zA-Z0-9-_]*$/,errorCode:"allowedSymbolsErrorCode"},this.i18nMessageKey="Validators.SchemaNameAllowedSymbols.Message",this.async=!1}validate(e){return super.validate(e,this._params)}};za=(0,m.__decorate)([de({type:"crt.SchemaNameAllowedSymbols"})],za);let Ga=class extends ce{constructor(){super(...arguments),this.i18nMessageKey="Validators.UniqueCodeColumnValue.Message",this.async=!1,this._windowCodeList="_copilotCodeList"}validate(e,t){const s=e.value;if(!s)return null;const r=window[this._windowCodeList];return r&&r.filter(a=>a===s).length>1?{uniqueColumnValue:this.defaultValidationError({...t,controlValue:s})}:null}};Ga=(0,m.__decorate)([de({type:"crt.UniqueCodeColumnValue"})],Ga);const Du="calculated";function up(n){let e=[];return typeof n=="string"&&(e=[n]),Array.isArray(n)&&(e=n),e.map(t=>typeof t=="string"&&t?.trim()).filter(Boolean)}function lp(n){return(n??[]).filter(e=>Nu(e)||Tu(e))}function dp(n){const e=n.map(r=>bt.requestsRegistrationInfos.has(r)),t=e.includes(!0),s=e.includes(!1);return t&&s}function Tu(n){return!!n&&"attribute"in n&&!!n.attribute}function Nu(n){return!!n&&"request"in n&&!!n.request}function hp(n){const e=up(n.from),t=lp(n.triggers),{from:s,filter:r,converter:i,change:a,triggersOptions:l}=n;return e.length===0&&t.length===0?(console.error(`Both 'from' and 'triggers' properties of calculated attribute cannot be empty: ${JSON.stringify(n)}.`),null):e.length===0&&!i?(console.error(`Converter is required in a calculated attribute if there are 'triggers' and no 'from': ${JSON.stringify(n)}.`),null):dp(e)?(console.error(`Simultaneous specification of attributes and request in the "from" property of calculated attribute is not supported: ${JSON.stringify(n)}.`),null):(e.length===0&&r&&console.warn(`Filter is skipped in a calculated attribute if there are 'triggers' and no 'from': ${JSON.stringify(n)}.`),{from:e,originalFrom:s,filter:e.length?r:void 0,converter:i,triggers:t,triggersOptions:{debounce:l?.debounce??0},change:a})}const Vu=new c.InjectionToken("Represents a factory of calculated attribute source changes providers"),xu=new c.InjectionToken("Represents a factory of calculated attribute trigger providers"),pp=new c.InjectionToken("A factory of expression interpreter");class Fe{constructor(e){this._converterExpressionInterpreter=e?.create("converter")}_getConverterFn(e,t,s){if(!e||!this._converterExpressionInterpreter)return(0,o.of)(s);const r={viewModel$:(0,o.of)(t),parent:null};return this._converterExpressionInterpreter.evaluate(e,r)}evaluate(e){const{args:t,expression:s,context:r,defaultEvaluationFn:i}=e;return this._getConverterFn(s,r,i).pipe((0,u.switchMap)(a=>{const l=a(t);return l instanceof Promise?l:Promise.resolve(l)}))}static#e=this.\u0275fac=function(t){return new(t||Fe)(c.\u0275\u0275inject(pp,8))};static#t=this.\u0275prov=c.\u0275\u0275defineInjectable({token:Fe,factory:Fe.\u0275fac})}const mp=n=>!0,fp=n=>n;class bs{constructor(e,t,s,r){this._converterEvaluator=e,this._attributeSourcesChangesProviderFactory=t,this._attributeTriggerProviderFactory=s,this._measurePerformanceService=r}_createCalculateAttributeValueFn(e,t){const{viewModel:s,attribute:r,generateOptions:i}=e,{originalFrom:a,filter:l,converter:d}=t,h=Array.isArray(a);return p=>p.pipe((0,u.map)(f=>h?f:f?.[0]),ei(f=>this._converterEvaluator.evaluate({args:f,expression:l,context:s,defaultEvaluationFn:mp})),(0,u.filter)(([,f])=>!!f),(0,u.concatMap)(([f])=>this._converterEvaluator.evaluate({args:f,expression:d,context:s,defaultEvaluationFn:fp})),(0,u.map)(f=>{const C=s.attributes[r];return[(0,v.cloneDeep)(f),(0,v.cloneDeep)(C)]}),(0,u.filter)(([f,C])=>!(0,v.isEqual)(f,C)),(0,u.tap)(([f,C])=>{s.attributes[r]=f,i?.onChangeAttributeValue(r,f,C)}),(0,u.map)(([f])=>f))}_createGetAttributeValueFn(e){const{viewModel:t,attributeName:s,attributeConfig:r,calculateAttributeFn:i}=e;let a;const l=this._getAttributeSourcesStream(r,t);return()=>{const d=s in t.attributes;return a?d?(0,o.of)(t.attributes[s]):a:(a=i(l).pipe((0,u.shareReplay)({bufferSize:1,refCount:!0})),t._subscriptions.add(a.subscribe()),a)}}_getAttributeSourcesStream(e,t){const s=this._getAttributeTriggers(e,t),r=this._getAttributeSourcesChanges(e,t);if(!s)return r;const i=e.triggersOptions.debounce;return r?(0,o.merge)(s.pipe((0,u.debounceTime)(i)),r).pipe((0,u.withLatestFrom)(r),(0,u.map)(([,a])=>a)):s.pipe((0,u.startWith)(void 0),(0,u.debounceTime)(i))}_getAttributeTriggers(e,t){const{triggers:s}=e,r=s.map(i=>this._attributeTriggerProviderFactory.create(i)?.getTrigger(i,t)).filter(Boolean);return r.length===0?null:(0,o.merge)(...r)}_getAttributeSourcesChanges(e,t){const{from:s}=e;return s.length===0?null:this._attributeSourcesChangesProviderFactory.create(s).getChanges(s,e,t)}_defineCalculatedAttribute(e,t,s){Object.defineProperty(s,e,{get:()=>(0,o.firstValueFrom)(t(),{defaultValue:null}),configurable:!0})}defineAttribute(e){this._measurePerformanceService.measure(`CalculatedAttributeCreator.defineAttribute.${e.attribute}`,()=>{const{viewModel:t,attribute:s,attributeConfig:r}=e,i=hp(r);if(i===null)return;const a=this._createCalculateAttributeValueFn(e,i),l=this._createGetAttributeValueFn({attributeName:s,attributeConfig:i,calculateAttributeFn:a,viewModel:t});this._defineCalculatedAttribute(s,l,t)})}static#e=this.\u0275fac=function(t){return new(t||bs)(c.\u0275\u0275inject(Fe),c.\u0275\u0275inject(Vu),c.\u0275\u0275inject(xu),c.\u0275\u0275inject(te))};static#t=this.\u0275prov=c.\u0275\u0275defineInjectable({token:bs,factory:bs.\u0275fac,providedIn:"root"})}class Ss{constructor(e,t){this.ngZone=e,this.measurePerformanceService=t}innerDefineAttribute(e,t){this.measurePerformanceService.measure(`DefaultAttributeCreator.defineAttribute.${e.attribute}`,()=>{const s=e.viewModel,r=s.attributes,i=e.attribute,a=e.attributeConfig,l=e.control,d=p=>{r[i]=p,this.ngZone.run(()=>{const f=s._viewModelAttributeChangeEventOptions?.getAsSilent();l.setValue(p,f),t?.call(this,p)})},h=()=>l.value;gs.defineAsyncAttribute(s,i,a,h,d)})}defineAttribute(e){this.innerDefineAttribute(e)}static#e=this.\u0275fac=function(t){return new(t||Ss)(c.\u0275\u0275inject(c.NgZone),c.\u0275\u0275inject(te))};static#t=this.\u0275prov=c.\u0275\u0275defineInjectable({token:Ss,factory:Ss.\u0275fac,providedIn:"root"})}class Dr extends Ss{constructor(e,t){super(e,t)}defineAttribute(e){this.innerDefineAttribute(e,t=>{e?.viewModel?.setAttributePropertyValue(e?.attribute,"displayColor",t?.primaryColorValue)})}static#e=this.\u0275fac=function(t){return new(t||Dr)(c.\u0275\u0275inject(c.NgZone),c.\u0275\u0275inject(te))};static#t=this.\u0275prov=c.\u0275\u0275defineInjectable({token:Dr,factory:Dr.\u0275fac,providedIn:"root"})}const Ou=new c.InjectionToken("View model attribute creator factory"),gp=Vs.create({token:Ou,mappings:[{predicate:y.r.Lookup,injectable:Dr},{predicate:Du,injectable:bs}],default:{injectable:Ss}});class At{transform(e){return function(t){const{instance:s,params:r}=e,i={value:t.value};return s.validate(i,r)}}static#e=this.\u0275fac=function(t){return new(t||At)};static#t=this.\u0275prov=c.\u0275\u0275defineInjectable({token:At,factory:At.\u0275fac,providedIn:"root"})}class vt{resolveModelConfig(e){return null}static#e=this.\u0275fac=function(t){return new(t||vt)};static#t=this.\u0275prov=c.\u0275\u0275defineInjectable({token:vt,factory:vt.\u0275fac,providedIn:"root"})}class Tr{constructor(){this.account={attributes:{Name:{},Ships:{isCollection:!0,viewModelConfig:"ship"},Employee:{viewModelConfig:"employee"}}},this.ship={attributes:{Id:{}}},this.employee={attributes:{Name:{},Age:{}}}}resolveModelConfig(e){return(0,o.of)(this[e]).pipe((0,u.delay)(50))}static#e=this.\u0275fac=function(t){return new(t||Tr)};static#t=this.\u0275prov=c.\u0275\u0275defineInjectable({token:Tr,factory:Tr.\u0275fac,providedIn:"root"})}class Et{constructor(e){this.injector=e,this.initDependencies()}initDependencies(){this.repository=this.injector.get(vt),this.ngZone=this.injector.get(c.NgZone)}static#e=this.\u0275fac=function(t){return new(t||Et)(c.\u0275\u0275inject(c.Injector))};static#t=this.\u0275prov=c.\u0275\u0275defineInjectable({token:Et,factory:Et.\u0275fac})}class _p{create(e){const{validator:t,...s}=e,r=s.params.map(({name:i})=>i);return class extends ce{constructor(i){super(i),this.async=s.async}_getMessageFromParams(i){return{[s.type]:{message:i.message}}}_setParamsProxy(i){return new Proxy(i,{get(a,l){if(r.includes(l))return a[l];throw new Error(`Property ${l} is not defined in validator params config`)}})}_toPromise(i){let a;return i instanceof Promise?a=i:i instanceof o.Observable?a=(0,o.lastValueFrom)(i,{defaultValue:null}):a=Promise.resolve(i),a}validate(i,a){let l=a;a&&(l=this._setParamsProxy(a));const h=t(l)(i,l);return this.isAsync?this._toPromise(h).then(p=>p&&l?.message?this._getMessageFromParams(l):p):l?.message&&h?this._getMessageFromParams(l):h}}}}class lf{}const yp="ValidatorRegistry";class kn extends ii{static#e=this.registryKey=yp;static _hasWithAnotherTypeRef(e,t){const s=kn.items.get(e);return!s||s.lazy&&!s.typeRef?!1:s.typeRef!==t}static validate(e){if(Ce(e.type,"ValidatorTypeName"),e.typeRef&&kn._hasWithAnotherTypeRef(e.type,e.typeRef))throw new Error(`Error when register ${e.type}. Element with this type has already exist`)}static get items(){return this.store.typeInfos}static register(e){const t=this.items.get(e.type);this.items.set(e.type,{...t??{},...e})}}class Nr extends Ln{constructor(e){super(e)}getValidator(e,t){const s=kn.items.get(e);if(!s)throw new Error(`Validator '${e}' was not registered`);if(s.lazy&&!s.instantiate)throw new Error(`Lazy module with ${e} validator is not loaded`);return s.instantiate(t?.injectionContext)}static#e=this.\u0275fac=function(t){return new(t||Nr)(c.\u0275\u0275inject(c.Injector))};static#t=this.\u0275prov=c.\u0275\u0275defineInjectable({token:Nr,factory:Nr.\u0275fac})}var J;(function(n){n.ChangeAttributeValue="change-attribute-value",n.ModelDataLoaded="model-data-loaded-event",n.BeforeModelLoad="before-model-load",n.LoadDefaultValues="load-default-values",n.StartLoadModelAttributes="start-load-model-attributes",n.FinishLoadModelAttributes="finish-load-model-attributes",n.ViewEvent="view-event"})(J||(J={}));function Lu(n,e){if(!n||!e)return o.EMPTY;const t=e.events$.pipe((0,u.filter)(s=>s.type===J.ChangeAttributeValue),(0,u.filter)(s=>s.payload.attributeName===n),(0,u.switchMap)(()=>e[n]));return new o.Observable(s=>(n in e?(0,o.merge)((0,o.from)(e[n]),t):t).subscribe(s))}class Bu{}class Mt extends Bu{getChanges(e,t,s){const r=e.map(i=>Lu(i,s));return(0,o.combineLatest)(r)}static#e=this.\u0275fac=(()=>{let e;return function(s){return(e||(e=c.\u0275\u0275getInheritedFactory(Mt)))(s||Mt)}})();static#t=this.\u0275prov=c.\u0275\u0275defineInjectable({token:Mt,factory:Mt.\u0275fac})}function ku(n,e){if(!n||!e)return o.EMPTY;const t=new o.ReplaySubject(1),s=ie.instance.subscribe(r=>{r.type===n&&t.next(r)},e);return e._subscriptions.add(s),t}const bp=100;class Cs extends Bu{constructor(e){super(),this._converterEvaluator=e}_accumulateRequests(e,t,s){const r=new o.BehaviorSubject([]),i=this._accumulateRequestsCombinations(e,r,t,s).subscribe();return new o.Observable(a=>(r.complete(),i.unsubscribe(),this._findAcceptableRequestsCombination(r.value,t,s).pipe((0,u.switchMap)(l=>l?(0,o.merge)((0,o.of)(l),e):e)).subscribe(a)))}_accumulateRequestsCombinations(e,t,s,r){return e.pipe((0,u.map)(i=>[i,...t.value]),(0,u.switchMap)(i=>i.length<bp?(0,o.of)(i):this._findAcceptableRequestsCombination(i,s,r).pipe((0,u.map)(a=>a?[a]:[]))),(0,u.tap)(i=>t.next(i)),(0,u.map)(()=>{}))}_findAcceptableRequestsCombination(e,t,s){if(!e.length)return(0,o.of)(null);const{filter:r,originalFrom:i}=t;return(0,o.from)(e).pipe(ei(a=>this._converterEvaluator.evaluate({args:Array.isArray(i)?a:a[0],context:s,expression:r})),(0,u.first)(([,a])=>!!a,[null]),(0,u.map)(([a])=>a))}getChanges(e,t,s){const r=e.map(a=>ku(a,s)),i=(0,o.combineLatest)(r);return t.filter?this._accumulateRequests(i,t,s):i}static#e=this.\u0275fac=function(t){return new(t||Cs)(c.\u0275\u0275inject(Fe))};static#t=this.\u0275prov=c.\u0275\u0275defineInjectable({token:Cs,factory:Cs.\u0275fac})}const Sp=Vs.create({token:Vu,mappings:[{predicate:n=>n.every(e=>bt.requestsRegistrationInfos.has(e)),injectable:Cs}],default:{injectable:Mt}});class Cp{}class Fu extends Cp{constructor(e){super(),this._converterEvaluator=e}getTrigger(e,t){return this.getTriggerInternal(e,t).pipe(ei(s=>this._converterEvaluator.evaluate({args:s,expression:e?.filter,context:t,defaultEvaluationFn:()=>!0})),(0,u.filter)(([,s])=>!!s),(0,u.map)(()=>{}))}}class As extends Fu{constructor(e){super(e)}getTriggerInternal(e,t){return Lu(e?.attribute,t)}static#e=this.\u0275fac=function(t){return new(t||As)(c.\u0275\u0275inject(Fe))};static#t=this.\u0275prov=c.\u0275\u0275defineInjectable({token:As,factory:As.\u0275fac})}class vs extends Fu{constructor(e){super(e)}getTriggerInternal(e,t){return new o.Observable(s=>ku(e?.request,t).subscribe(s))}static#e=this.\u0275fac=function(t){return new(t||vs)(c.\u0275\u0275inject(Fe))};static#t=this.\u0275prov=c.\u0275\u0275defineInjectable({token:vs,factory:vs.\u0275fac})}const Ap=Vs.create({token:xu,mappings:[{predicate:Tu,injectable:As},{predicate:Nu,injectable:vs}]});class Vr{static#e=this.\u0275fac=function(t){return new(t||Vr)};static#t=this.\u0275mod=c.\u0275\u0275defineNgModule({type:Vr});static#s=this.\u0275inj=c.\u0275\u0275defineInjector({providers:[bs,Fe,As,vs,Mt,Cs,Sp,Ap]})}class ju{constructor(e,t,s=!1){this.name=e,this._value=t,this._locked=s,this._isValueInitialized=!1,this._pendingValue=void 0,this._onChanged=new c.EventEmitter,this._hasInitialValue=!1,t!=null&&(this._isValueInitialized=!0,this._hasInitialValue=!0,this._initialValue=t)}get onChanged(){return this._onChanged}get value(){return this.getValue()}set value(e){this.setValue(e)}get initialValue(){return this._initialValue}set initialValue(e){this.setInitialValue(e)}get hasInitialValue(){return this._hasInitialValue}get isLocked(){return this._locked}emitValueChanged(e){this.onChanged.emit(e)}areValuesEqual(e,t){return(0,v.isEqual)(e,t)}getValue(){return this._value}setValue(e,t=!1){if(this._locked||(this._isValueInitialized=!0,this._pendingValue=e,this.areValuesEqual(this._value,e)))return;const s=(0,v.cloneDeep)(this._value);this._value=(0,v.cloneDeep)(e),!t&&this.emitValueChanged({name:this.name,value:e,oldValue:s})}resetValue(){this.hasInitialValue&&this.setValue(this.initialValue)}setInitialValue(e){this._hasInitialValue=!0,this._initialValue=e,this._isValueInitialized||this.setValue(e,!0)}setPending(e){const t=typeof this._pendingValue>"u"?this.value:this._pendingValue;this.value=e,this._pendingValue=t}resetPending(){this.value=this._pendingValue,this._pendingValue=void 0}}class Ka extends ju{constructor(e,t,s,r,i=!1){super(e,t,i),this._validatorTypeResolver=s,this._injectionContext=r,this._onValidatorChanged=new c.EventEmitter}get onValidatorChanged(){return this._onValidatorChanged}_createValidatorInfo(){return{name:this.validatorTypeName,instance:this._validatorTypeResolver.getValidator(this.validatorTypeName,{injectionContext:this._injectionContext}),disabled:!0}}emitValueChanged(e){super.emitValueChanged(e),this.hasValidator&&this.updateValidator(e)&&this._onValidatorChanged.emit()}get hasValidator(){return!1}updateValidator(e){return!1}setValidatorInfo(e,t=!1){this.validatorInfo=e}initializeValidator(e,t=!1){if(!this.hasValidator||this._validatorTypeResolver==null)return[...e];let s=e.find(i=>i.name===this.validatorTypeName),r=!1;return s==null&&(s=this._createValidatorInfo(),r=!0),this.setValidatorInfo(s,t),r?[...e,s]:[...e]}}class $u{static#e=this._properties=new Map;static _get(e){if(!e)return Ka;if(this._properties.has(e))return this._properties.get(e);throw new Error(`CrtControlProperty with type ${e} doesn't registered`)}static register(e,t){this._properties.set(e,t)}static create(e){const t=this._get(e.typeName);return new t(e.name,e.value,e.validatorTypeResolver,e.injectionContext,e.locked===!0)}}function vp(n){return function(e){Ce(n.name,"PropertyName"),$u.register(n.name,e)}}let Wa=class extends Ka{constructor(){super(...arguments),this.validatorTypeName="crt.Required"}get hasValidator(){return!0}updateValidator(e){return this.validatorInfo&&(this.validatorInfo.disabled=!e.value),!0}setValidatorInfo(e,t=!1){super.setValidatorInfo(e,t),this.initialValue=!e.disabled,this.setValue(!e.disabled,t)}};Wa=(0,m.__decorate)([vp({name:"crt.Required"})],Wa);let Ja=class extends V{};Ja=(0,m.__decorate)([M({type:"crt.AddCommunicationOptionsRequest",title:"InterfaceDesigner.PropertiesPages.ViewElementEventPropertiesPanel.Requests.Add\u0421ommunicationOptionsRequest",propertiesPanelComponentTypeName:"crt.AddCommunicationOptionsRequestPropertiesPanel",position:740})],Ja);var be;(function(n){n.Selection="selection",n.Filtration="filtration"})(be||(be={}));class Uu extends V{}class qu extends Uu{}let Za=class extends qu{};Za=(0,m.__decorate)([M({type:"crt.AddRecordsInStaticFoldersRequest",title:"InterfaceDesigner.PropertiesPages.ViewElementEventPropertiesPanel.Requests.AddRecordsInStaticFoldersRequest",propertiesPanelComponentTypeName:"crt.AddRecordsInStaticFoldersRequestPropertiesPanel",position:706,compatibleAPIs:{[be.Selection]:!0}})],Za);class Ep extends V{}let Xa=class extends Ep{};Xa=(0,m.__decorate)([M({type:"crt.AddTagsInRecordRequest"})],Xa);let Ya=class extends V{};Ya=(0,m.__decorate)([M({type:"crt.ContinueInOtherPageRequest",title:"InterfaceDesigner.PropertiesPages.ViewElementEventPropertiesPanel.Requests.ContinueInOtherPageRequest",position:1e3})],Ya);let Qa=class extends V{};Qa=(0,m.__decorate)([M({type:"crt.CopilotActionRequest",title:"InterfaceDesigner.PropertiesPages.ViewElementEventPropertiesPanel.Requests.CopilotActionRequest",propertiesPanelComponentTypeName:"crt.CopilotActionRequestPropertiesPanelComponent",position:3001})],Qa);let eo=class extends V{};eo=(0,m.__decorate)([M({type:"crt.CreateRecordRequest",title:"InterfaceDesigner.PropertiesPages.ViewElementEventPropertiesPanel.Requests.CreateRecordRequest",propertiesPanelComponentTypeName:"crt.CreateRecordRequestPropertiesPanel",position:200})],eo);let to=class extends V{};to=(0,m.__decorate)([M({type:"crt.DeleteRecordsRequest",title:"InterfaceDesigner.PropertiesPages.ViewElementEventPropertiesPanel.Requests.DeleteRecordsRequest",propertiesPanelComponentTypeName:"crt.DeleteRecordsRequestPropertiesPanel",position:701,compatibleAPIs:{[be.Selection]:!0}})],to);let so=class extends V{};so=(0,m.__decorate)([M({type:"crt.ExportDataGridToExcelRequest",title:"InterfaceDesigner.PropertiesPages.ViewElementEventPropertiesPanel.Requests.ExportDataGridToExcelRequest",propertiesPanelComponentTypeName:"crt.ExportDataGridToExcelRequestPropertiesPanel",position:800,compatibleAPIs:{[be.Selection]:!0}})],so);let ro=class extends V{};ro=(0,m.__decorate)([M({type:"crt.ImportDataRequest",title:"InterfaceDesigner.PropertiesPages.ViewElementEventPropertiesPanel.Requests.ImportDataRequest",propertiesPanelComponentTypeName:"crt.ImportDataRequestPropertiesPanel",position:750})],ro);let no=class extends V{};no=(0,m.__decorate)([M({type:"crt.MoveSelectedItemsRequest",title:"InterfaceDesigner.PropertiesPages.ViewElementEventPropertiesPanel.Requests.MoveSelectedItemsRequest",propertiesPanelComponentTypeName:"crt.MoveSelectedItemsRequestPropertiesPanel",position:1e3,compatibleAPIs:{[be.Selection]:!0}})],no);var Hu;(function(n){n.Root="root",n.Item="item",n.Const="const"})(Hu||(Hu={}));class df{}let io=class extends V{};io=(0,m.__decorate)([M({type:"crt.OpenChangeLogRequest",title:"InterfaceDesigner.PropertiesPages.ViewElementEventPropertiesPanel.Requests.OpenChangeLogRequest",propertiesPanelComponentTypeName:"crt.OpenChangeLogRequestPropertiesPanel",position:370})],io);let ao=class extends V{};ao=(0,m.__decorate)([M({type:"crt.OpenDuplicatesPageRequest",title:"InterfaceDesigner.PropertiesPages.ViewElementEventPropertiesPanel.Requests.OpenDuplicatesPageRequest",propertiesPanelComponentTypeName:"crt.OpenDuplicatesPageRequestPropertiesPanel",position:360})],ao);let oo=class extends V{};oo=(0,m.__decorate)([M({type:"crt.OpenPageRequest",title:"InterfaceDesigner.PropertiesPages.ViewElementEventPropertiesPanel.Requests.OpenPageRequest",propertiesPanelComponentTypeName:"crt.OpenPageRequestPropertiesPanel",position:350})],oo);let co=class extends V{};co=(0,m.__decorate)([M({type:"crt.PrintablesRequest",title:"InterfaceDesigner.PropertiesPages.ViewElementEventPropertiesPanel.Requests.PrintablesRequest",propertiesPanelComponentTypeName:"crt.PrintablesRequestPropertiesPanel",position:3e3,compatibleAPIs:{[be.Selection]:!0}})],co);let uo=class extends qu{};uo=(0,m.__decorate)([M({type:"crt.RemoveRecordsInStaticFoldersRequest",title:"InterfaceDesigner.PropertiesPages.ViewElementEventPropertiesPanel.Requests.RemoveRecordsInStaticFoldersRequest",propertiesPanelComponentTypeName:"crt.RemoveRecordsInStaticFoldersRequestPropertiesPanel",position:705,compatibleAPIs:{[be.Selection]:!0}})],uo);class zu extends Uu{}let lo=class extends zu{};lo=(0,m.__decorate)([M({type:"crt.RemoveTagsInRecordsRequest",title:"InterfaceDesigner.PropertiesPages.ViewElementEventPropertiesPanel.Requests.RemoveTagsInRecordsRequest",propertiesPanelComponentTypeName:"crt.RemoveTagsInRecordsRequestPropertiesPanel",position:704,compatibleAPIs:{[be.Selection]:!0}})],lo);let ho=class extends V{};ho=(0,m.__decorate)([M({type:"crt.RunBusinessProcessRequest",title:"InterfaceDesigner.PropertiesPages.ViewElementEventPropertiesPanel.Requests.RunBusinessProcessRequest",propertiesPanelComponentTypeName:"crt.RunBusinessProcessRequestPropertiesPanel",position:700,compatibleAPIs:{[be.Selection]:!0}})],ho);let po=class extends V{};po=(0,m.__decorate)([M({type:"crt.SaveRecordRequest",title:"InterfaceDesigner.PropertiesPages.ViewElementEventPropertiesPanel.Requests.SaveRecordRequest",propertiesPanelComponentTypeName:"crt.SaveRecordRequestPropertiesPanel",position:400})],po);let mo=class extends V{};mo=(0,m.__decorate)([M({type:"crt.SelectLookupPageRequest",title:"InterfaceDesigner.PropertiesPages.ViewElementEventPropertiesPanel.Requests.SelectLookupPageRequest",propertiesPanelComponentTypeName:"crt.SelectLookupPageRequestPropertiesPanel",scopes:["BaseLookupPageTemplate"],position:2e3})],mo);let fo=class extends V{};fo=(0,m.__decorate)([M({type:"crt.SetRecordRightsRequest",title:"InterfaceDesigner.PropertiesPages.ViewElementEventPropertiesPanel.Requests.SetRecordRightsRequest",propertiesPanelComponentTypeName:"crt.SetRecordRightsRequestPropertiesPanel",position:800})],fo);let go=class extends V{};go=(0,m.__decorate)([M({type:"crt.ShowRelationshipsRequest",title:"InterfaceDesigner.PropertiesPages.ViewElementEventPropertiesPanel.Requests.ShowRelationshipsRequest",propertiesPanelComponentTypeName:"crt.ShowRelationshipsRequestPropertiesPanel",position:900})],go);let _o=class extends V{};_o=(0,m.__decorate)([M({type:"crt.UpdateRecordRequest",title:"InterfaceDesigner.PropertiesPages.ViewElementEventPropertiesPanel.Requests.UpdateRecordRequest",propertiesPanelComponentTypeName:"crt.UpdateRecordRequestPropertiesPanel",position:300})],_o);let yo=class extends V{};yo=(0,m.__decorate)([M({type:"crt.UploadFileRequest",title:"InterfaceDesigner.PropertiesPages.ViewElementEventPropertiesPanel.Requests.UploadFileRequest",propertiesPanelComponentTypeName:"crt.UploadFileRequestPropertiesPanel",position:702})],yo);let bo=class extends V{constructor(){super(...arguments),this.type="crt.CancelRecordChangesRequest"}};bo=(0,m.__decorate)([M({type:"crt.CancelRecordChangesRequest",title:"InterfaceDesigner.PropertiesPages.ViewElementEventPropertiesPanel.Requests.CancelRecordChangesRequest",position:500})],bo);let So=class extends V{constructor(){super(...arguments),this.type="crt.ClosePageRequest"}};So=(0,m.__decorate)([M({type:"crt.ClosePageRequest",title:"InterfaceDesigner.PropertiesPages.ViewElementEventPropertiesPanel.Requests.ClosePageRequest",position:600})],So);class rt extends V{}let Co=class extends rt{constructor(){super(...arguments),this.type="crt.HandleAfterModelDeleteRequest"}};Co=(0,m.__decorate)([M({type:"crt.HandleAfterModelDeleteRequest"})],Co);let Ao=class extends rt{constructor(){super(...arguments),this.type="crt.HandleAfterModelInsertRequest"}};Ao=(0,m.__decorate)([M({type:"crt.HandleAfterModelInsertRequest"})],Ao);let vo=class extends rt{constructor(){super(...arguments),this.type="crt.HandleAfterModelLoadRequest"}};vo=(0,m.__decorate)([M({type:"crt.HandleAfterModelLoadRequest"})],vo);let Eo=class extends rt{constructor(){super(...arguments),this.type="crt.HandleAfterModelUpdateRequest"}};Eo=(0,m.__decorate)([M({type:"crt.HandleAfterModelUpdateRequest"})],Eo);let Mo=class extends rt{constructor(){super(...arguments),this.type="crt.HandleBeforeModelDeleteRequest"}};Mo=(0,m.__decorate)([M({type:"crt.HandleBeforeModelDeleteRequest"})],Mo);let Io=class extends rt{constructor(){super(...arguments),this.type="crt.HandleBeforeModelInsertRequest"}};Io=(0,m.__decorate)([M({type:"crt.HandleBeforeModelInsertRequest"})],Io);let Ro=class extends rt{constructor(){super(...arguments),this.type="crt.HandleBeforeModelLoadRequest"}};Ro=(0,m.__decorate)([M({type:"crt.HandleBeforeModelLoadRequest"})],Ro);let wo=class extends rt{constructor(){super(...arguments),this.type="crt.HandleBeforeModelUpdateRequest"}};wo=(0,m.__decorate)([M({type:"crt.HandleBeforeModelUpdateRequest"})],wo);let Po=class extends zu{};Po=(0,m.__decorate)([M({type:"crt.AddTagsInRecordsRequest",title:"InterfaceDesigner.PropertiesPages.ViewElementEventPropertiesPanel.Requests.AddTagsInRecordsRequest",propertiesPanelComponentTypeName:"crt.AddTagsInRecordsRequestPropertiesPanel",position:703,compatibleAPIs:{[be.Selection]:!0}})],Po);function Mp(){const n=[Wa,Ja,Za,Xa,Ya,Qa,eo,to,so,ro,no,io,ao,oo,co,uo,lo,ho,po,mo,fo,go,_o,yo,bo,So,Ma,Co,Ao,vo,Eo,Mo,Io,Ro,wo,Po]}let Do=class extends V{constructor(e){super(),this.type="crt.HandleViewModelAttributeChangeRequest",this.attributeName=e.attributeName,this.value=e.value,this.oldValue=e.oldValue,this.silent=!!e.silent,this.preventAttributeChangeRequest=!!e.preventAttributeChangeRequest,this.preventStateChange=!!e.preventStateChange,this.preventRunBusinessRules=!!e.preventRunBusinessRules}};Do=(0,m.__decorate)([M({type:"crt.HandleViewModelAttributeChangeRequest"}),(0,m.__metadata)("design:paramtypes",[Object])],Do);var je;(function(n){n.DebouncingBusinessRules="DebouncingBusinessRules",n.RunningBusinessRules="RunningBusinessRules",n.ProcessingAttributeChangeRequest="ProcessingAttributeChangeRequest",n.AttributeLoading="AttributeLoading"})(je||(je={}));let To=class extends V{constructor(){super(...arguments),this.type="crt.HandleViewModelInitRequest"}};To=(0,m.__decorate)([M({type:"crt.HandleViewModelInitRequest"})],To);let No=class extends V{constructor(){super(...arguments),this.type="crt.HandleViewModelResumeRequest"}};No=(0,m.__decorate)([M({type:"crt.HandleViewModelResumeRequest"})],No);let Vo=class extends V{constructor(){super(...arguments),this.type="crt.HandleViewModelPauseRequest"}};Vo=(0,m.__decorate)([M({type:"crt.HandleViewModelPauseRequest"})],Vo);let xo=class extends V{constructor(){super(...arguments),this.type="crt.HandleViewModelDestroyRequest"}};xo=(0,m.__decorate)([M({type:"crt.HandleViewModelDestroyRequest"})],xo);class Ip{constructor(e={preventAttributeChangeRequest:!1,preventRunBusinessRules:!1,preventStateChange:!1}){this._preventAttributeChangeRequest=!1,this._preventStateChange=!1,this._preventRunBusinessRules=!1,this._setOptions(e)}_setUsingSilent(e){this._preventStateChange=e,this._preventRunBusinessRules=e,this._preventAttributeChangeRequest=!1}_setOptions(e){this._preventAttributeChangeRequest=e?.preventAttributeChangeRequest??this._preventAttributeChangeRequest,this._preventStateChange=e?.preventStateChange??this._preventStateChange,this._preventRunBusinessRules=e?.preventRunBusinessRules??this._preventRunBusinessRules}getAsSilent(){return this._preventRunBusinessRules&&this._preventStateChange}setOptions(e){if((0,v.isUndefined)(e?.silent)){const t=(0,v.pick)(e,"preventAttributeChangeRequest","preventStateChange","preventRunBusinessRules");this._setOptions(t)}else this._setUsingSilent(e?.silent)}getOptions(){return{preventAttributeChangeRequest:this._preventAttributeChangeRequest,preventRunBusinessRules:this._preventRunBusinessRules,preventStateChange:this._preventStateChange}}reset(){this._preventAttributeChangeRequest=!1,this._preventRunBusinessRules=!1,this._preventStateChange=!1}}var Es;(function(n){n.Reload="reload",n.Merge="merge"})(Es||(Es={}));var Oo;(function(n){n.EntityDataSource="crt.EntityDataSource",n.WebServiceDataSource="crt.WebServiceDataSource",n.PageParametersDataSource="crt.PageParametersDataSource"})(Oo||(Oo={}));var Fn;(function(n){n.AddTask="addTask",n.RemoveTask="removeTask"})(Fn||(Fn={}));class Gu extends V{constructor(e,t,s){super(),this.action=e,this.taskName=t,this.$context=s,this.type="crt.SchemaViewMaskRequest"}}class Lo extends cn{constructor(){super(...arguments),this.requestType="crt.MaskService"}showMask(e,t){return(0,S.A)(function*(){const s=new Gu(Fn.AddTask,e,t);yield ie.instance.process(s)})()}hideMask(e,t){return(0,S.A)(function*(){const s=new Gu(Fn.RemoveTask,e,t);yield ie.instance.process(s)})()}}(0,m.__decorate)([Re(),(0,m.__metadata)("design:type",Function)],Lo.prototype,"showBodyMask",void 0),(0,m.__decorate)([Re(),(0,m.__metadata)("design:type",Function)],Lo.prototype,"hideBodyMask",void 0);const Rp=new c.InjectionToken("DEVKIT_MASK_SERVICE",{providedIn:"root",factory:()=>new Lo});class Ku{constructor(e){this.ngZone=e}run(e,t,s){return this.ngZone.runOutsideAngular(e)}}class wp extends Ku{constructor(e){super(e)}run(e,t,s){return this.ngZone.run(e,t,s)}}var Bo;(function(n){n.Root="root",n.Angular="angular",n.ExecutionTracking="executionTracking"})(Bo||(Bo={}));var xr;(function(n){n[n.Busy=0]="Busy",n[n.Idle=1]="Idle"})(xr||(xr={}));var jn;(function(n){n.ReadyStateChange="readystatechange"})(jn||(jn={}));class Pp{constructor(e){this._trackedTasks=[],this._trackedEventTasks=[],this._enableDebugTracking=!1,this._disableWaits=!1,this._pendingFunctions=new Map,this.onStateChange$=new c.EventEmitter(!1),this._parentZone=Zone.current,this._rootZone=Zone.root,this._isBusy=!1,this._ignoredTaskSources=["setInterval","requestAnimationFrame"],this._eventTaskFilters=[t=>t.source.startsWith("XMLHttpRequest")&&t.source.endsWith(jn.ReadyStateChange)],this._zone=this._parentZone.fork({name:e,properties:{currentExecutionZone:this},onInvokeTask:this._onInvokeTask.bind(this),onCancelTask:this._onCancelTask.bind(this),onScheduleTask:this._onScheduleTask.bind(this),onHasTask:this._onHasTask.bind(this)})}wait(e){if(this._disableWaits)return e();this._isBusy||(this._isBusy=!0,this.onStateChange$.next(xr.Busy));const t=O();return this._pendingFunctions.set(t,this._enableDebugTracking?e:null),e().finally(()=>{this._pendingFunctions.delete(t),!this._pendingFunctions.size&&this._zone.run(()=>new Promise(s=>setTimeout(s)))}).catch(s=>{throw s})}_cancelXMLHttpRequestReadyStateChangeTaskOnRequestComplete(e,t){if(e.type==="eventTask"&&(e.state==="running"||e.state==="scheduled")){const s=e;s.eventName===jn.ReadyStateChange&&s.target.readyState===XMLHttpRequest.DONE&&t.cancelTask(s)}}_onInvokeTask(e,t,s,r,i,a){this._unTrackTask(r);let l;try{l=e.invokeTask(s,r,i,a),this._cancelXMLHttpRequestReadyStateChangeTaskOnRequestComplete(r,t)}catch(d){console.error(d),t.cancelTask(r)}return l}_onCancelTask(e,t,s,r){return this._unTrackTask(r),e.zone.runGuarded(()=>e.cancelTask(s,r))}_onScheduleTask(e,t,s,r){return this._getCanScheduleTask(r)?(this._trackTask(r),e.scheduleTask(s,r)):(r.cancelScheduleRequest(),this._parentZone.scheduleTask(r))}_onHasTask(e,t,s,r){e.hasTask(s,r);const i=r.eventTask||r.macroTask||r.microTask||this._pendingFunctions.size>0;this._isBusy!==i&&(this._rootZone.run(()=>this.onStateChange$.next(i?xr.Busy:xr.Idle)),this._isBusy=i)}_trackTask(e){this._enableDebugTracking&&(e.type==="eventTask"&&this._trackedEventTasks.push(e),this._trackedTasks.push(e))}_unTrackTask(e){if(!this._enableDebugTracking)return;const t=this._trackedTasks.indexOf(e);t>-1&&this._trackedTasks.splice(t,1)}_getCanScheduleTask(e){return e.type==="eventTask"?this._eventTaskFilters.some(t=>t(e)):this._ignoredTaskSources.indexOf(e.source)===-1}run(e,t,s){return this._zone.run(e,t,s)}}class Ms{constructor(e){this._ngZone=e}createDefaultZones(){return{root:new Ku(this._ngZone),angular:new wp(this._ngZone)}}createZone(e,t){if(t===Bo.ExecutionTracking)return new Pp(e);throw new Error(`Zone ${e} with type ${t} is not supported`)}static#e=this.\u0275fac=function(t){return new(t||Ms)(c.\u0275\u0275inject(c.NgZone))};static#t=this.\u0275prov=c.\u0275\u0275defineInjectable({token:Ms,factory:Ms.\u0275fac,providedIn:"root"})}let ko=class Xn{constructor(e){this._zoneProvider=e,this._zones=e.createDefaultZones()}init(e){var t=this;return(0,S.A)(function*(){t._disableExecutionTrackingZone=yield(0,o.lastValueFrom)(e("DisableExecutionTrackingZone"))})()}runInZone(e,t,s,r){return this._disableExecutionTrackingZone&&e!==tt.Angular&&(e=tt.Root),(this._zones[e]??this._zones[tt.Root]).run(t,s,r)}register(e,t){if(this._zones[e])throw new Error(`Zone ${e} already registered`);const s=this._zoneProvider.createZone(e,t);return this._zones[e]=s,s}get(e){return this._zones[e]}runOutside(e){return this.runInZone(tt.Root,e)}static#e=this.\u0275fac=function(t){return new(t||Xn)(c.\u0275\u0275inject(Ms))};static#t=this.\u0275prov=c.\u0275\u0275defineInjectable({token:Xn,factory:Xn.\u0275fac,providedIn:"root"})};ko=(0,m.__decorate)([at({requestType:"crt.ZoneService"}),(0,m.__metadata)("design:paramtypes",[Ms])],ko);const Wu=new c.InjectionToken("CRT_METADATA_PREPROCESSOR");class Dp{constructor(e,t){this.id=e,this._baseHostInjector=t,this._hostModuleTypes=[],this._hostModuleRefs=[],this._lazyModulesBySource=new Map,this._hostInjector=this._baseHostInjector}_createDynamicNgModule(e){const s=this._hostInjector.get(Wu,[]).map(a=>({provide:Wu,useValue:a,multi:!0})),r=(0,c.NgModule)({providers:s})(class{}),i=(0,c.NgModule)({imports:[r,...e]})(class{});return(0,c.createNgModule)(i,this._hostInjector)}inject(e){return this._hostInjector.get(e)}addLazyModule(e){const t=pc.get(e);if(!t)throw new Error("Module was not bootstrapped");const{source:s}=t;this._lazyModulesBySource.has(s)||this._lazyModulesBySource.set(s,new Set),this._lazyModulesBySource.get(s).add(e)}getLazyModules(e){return[...this._lazyModulesBySource.get(e)??[]]}connectHostLazyModules(){const e=this.getLazyModules("host");if((0,v.isEqual)(e,this._hostModuleTypes))return;const t=this._createDynamicNgModule(e);this._hostModuleTypes=e,this._hostModuleRefs.push(t),this._hostInjector=t.injector}destroy(){for(const e of this._hostModuleRefs)e.destroy();this._hostModuleRefs=[]}}var Fo=b(74975);class Is extends Fo.S{constructor(){super(...arguments),this._injectionContextsMap=new Map}createContext(e,t){const s=new Dp(e,t);return this._injectionContextsMap.set(e,s),s}injectFromContext(e,t){return this._injectionContextsMap.get(e).inject(t)}removeContext(e){return this._injectionContextsMap.get(e)?.destroy(),this._injectionContextsMap.delete(e)}static#e=this.\u0275fac=(()=>{let e;return function(s){return(e||(e=c.\u0275\u0275getInheritedFactory(Is)))(s||Is)}})();static#t=this.\u0275prov=c.\u0275\u0275defineInjectable({token:Is,factory:Is.\u0275fac,providedIn:"root"})}const Tp=new c.InjectionToken("IS_DESIGN_TIME"),Np=new c.InjectionToken("Terrasoft global object",{providedIn:"root",factory:()=>(0,v.get)((0,c.inject)(pe),["Terrasoft"])||{}}),Vp=new c.InjectionToken("Flag indicating that this is an angular host",{providedIn:"root",factory:()=>(0,v.get)((0,c.inject)(Np),["isAngularHost"])}),Ju=100;class Rs extends Fo.S{constructor(){super(...arguments),this._window=(0,c.inject)(pe),this._requestBuffer=[],this._requestIter=0,this._cachedRequestIter=0,this._compressedRequestIter=0}_onRequest(e){const t=e.getEntries();for(const s of t){if(!s.name.startsWith(this._window.location.origin))return;this._requestIter++,s.transferSize||this._cachedRequestIter++,s.encodedBodySize!==s.decodedBodySize&&this._compressedRequestIter++,s.fetchStart&&s.responseStart&&s.responseEnd&&this._requestBuffer.push({name:s.name,initiatorType:s.initiatorType,transferSize:s.transferSize,responseStart:s.responseStart,responseEnd:s.responseEnd,fetchStart:s.fetchStart})}}_calculateLatency(e,t){return e/(t/1e3)/1e3/1e3||0}_normalizeUrl(e,t){try{return(e+new URL(t)?.pathname.replace("/0/","/")).slice(0,Ju)}catch{return t?.slice(0,Ju)}}_reset(){this._resourcePerformanceObserver?.disconnect(),this._markPerformanceObserver?.disconnect(),this._requestBuffer=[],this._compressedRequestIter=0,this._cachedRequestIter=0,this._requestIter=0}_downlink(){let e=0,t=0;return this._requestBuffer.forEach(r=>{r.initiatorType==="xmlhttprequest"&&(e+=r.transferSize,t+=r.responseEnd-r.responseStart)}),+this._calculateLatency(e,t).toFixed(1)}_withCache(){return Math.round(this._cachedRequestIter/this._requestIter*100)||0}_withCompression(){return Math.round(this._compressedRequestIter/this._requestIter*100)||0}_topRequests(e){const t=[];for(let s=this._requestBuffer.length-1;s>=0;s--){const r=this._requestBuffer[s],i=Math.round(r.responseEnd-r.fetchStart);if(i>=e.topRequestThreshold&&t.length<e.topRequestCount){const a=this._normalizeUrl(i,r.name);if(t.push(a),t.length===e.topRequestThreshold)return t}}return t}start(){this._reset(),this._resourcePerformanceObserver=this._resourcePerformanceObserver??new PerformanceObserver(this._onRequest.bind(this)),this._resourcePerformanceObserver.observe({type:"resource",buffered:!this._firstStart}),this._firstStart=!0}measure(e={topRequestThreshold:400,topRequestCount:5}){const t={transferred:0};return this._requestBuffer.sort((s,r)=>s.fetchStart-r.fetchStart),t.duration=this._calculateDuration(),t.transferred=this._calculateTransferred(),t.downlink=this._downlink(),t.cache=this._withCache(),t.compression=this._withCompression(),t.topRequests=this._topRequests(e),this._reset(),t}_calculateDuration(){let e=this._requestBuffer[0]?.responseEnd,t=this._requestBuffer[0]?.responseEnd-this._requestBuffer[0]?.fetchStart;return this._requestBuffer.forEach(s=>{e<s.fetchStart?t+=s.responseEnd-s.fetchStart:e<s.responseEnd&&(t+=s.responseEnd-e),e=Math.max(e,s.responseEnd)}),Math.round(t)||0}_calculateTransferred(){let e=this._requestBuffer.reduce((t,s)=>t+s.transferSize,0);return e=Math.round(e/1e3)||0,e}ngOnDestroy(){this._reset()}static#e=this.\u0275fac=(()=>{let e;return function(s){return(e||(e=c.\u0275\u0275getInheritedFactory(Rs)))(s||Rs)}})();static#t=this.\u0275prov=c.\u0275\u0275defineInjectable({token:Rs,factory:Rs.\u0275fac,providedIn:"root"})}var Pe;(function(n){n.PageStartLoading="PageStartLoading",n.PageFinishLoading="PageFinishLoading"})(Pe||(Pe={}));class Or extends Fo.S{constructor(){super(),this._ngZone=(0,c.inject)(c.NgZone),this._window=(0,c.inject)(pe),this._featureValues=(0,c.inject)(W,{optional:!0}),this._isAngularHost=(0,c.inject)(Vp,{optional:!0}),this._performanceNetworkObserver=(0,c.inject)(Rs),this._measureName="PageLoadDuration",this._debounceTime=100,this._subscriptions=new o.Subscription,this._measurements=[],this._tasks=new Set,this._loadingStarted=!1,this._loadingStartedCount=new Set,this._loadingFinishedCount=new Set,this._tasksQueueSubject=new o.Subject,this._pageLoadLifeCycleSubject=new o.Subject,this._iterationCounter=0,this.pageLoadDuration$=new o.Subject,this._enableMeasurement=!!this._isAngularHost&&!this._featureValues?.DisablePerformancePageLoadMeasurement,this._initSubscriptions(),(0,v.set)(this._window,"creatio.performance.measurePerformancePageLoadService",this)}_initSubscriptions(){this._enableMeasurement&&(this._subscriptions.add(this._tasksQueueSubject.pipe((0,o.debounceTime)(this._debounceTime),(0,u.filter)(e=>this._loadingStartedCount.size===this._loadingFinishedCount.size&&this._loadingStarted&&e.size===1&&e.has(Pe.PageStartLoading))).subscribe({next:()=>this._pageLoadLifeCycleSubject.next(Pe.PageFinishLoading)})),this._subscriptions.add(this._pageLoadLifeCycleSubject.subscribe({next:e=>{this._ngZone.runOutsideAngular(()=>{e===Pe.PageStartLoading&&this._onStartPageLoadMeasure(),e===Pe.PageFinishLoading&&this._onEndPageLoadMeasure()})}})))}_onStartPageLoadMeasure(){this.addTask(Pe.PageStartLoading)}getMeasureDataOnTimeout$(){const e={start:this._startTime,end:this._window.performance.now(),detail:this._getMeasurementDetail(),timeout:!0};return this._measurements.push(()=>this._window.performance.measure(this._measureName,e)),this._reset(),(0,o.of)(e)}_getLocationInfo(){const e=this._window.location.hash,[t,s]=e.slice(1).split("/");return{moduleName:t,schemaName:s,hash:e}}_getMeasurementDetail(){const t=((0,v.get)(this._window,"creatio.performance")??{}).focusLossDuringLoad,s={iteration:this._iterationCounter++,location:this._getLocationInfo(),isReuse:!!this._isReuseMode,focusLossDuringLoad:!!t};return this._featureValues.DisablePerformancePageNetworkMeasurement||(s.network=this._performanceNetworkObserver.measure()),s}_onEndPageLoadMeasure(){this.removeTask(Pe.PageFinishLoading),this.removeTask(Pe.PageStartLoading);const e={start:this._startTime,detail:this._getMeasurementDetail(),end:this._window.performance.now()};this._measurements.push(()=>this._window.performance.measure(this._measureName,e)),this.pageLoadDuration$.next(e),this._reset()}_reset(){const e=(0,v.get)(this._window,"creatio.performance");e.initialLoad?e.initialLoad=!1:e.focusLossDuringLoad=null,this._startTime=null,this._tasks.clear(),this._loadingStarted=!1,this._loadingStartedCount.clear(),this._loadingFinishedCount.clear(),this._isReuseMode=null}setReuseMode(e){this._enableMeasurement&&this._isReuseMode===null&&(this._isReuseMode=e)}startPageLoadMeasure(e=performance.now()){this._enableMeasurement&&this._ngZone.runOutsideAngular(()=>{this._reset(),this._startTime=e,this._pageLoadLifeCycleSubject.next(Pe.PageStartLoading),this._featureValues.DisablePerformancePageNetworkMeasurement||this._performanceNetworkObserver.start()})}addTask(e,t={}){this._enableMeasurement&&this._ngZone.runOutsideAngular(()=>{t.targetTask&&(this._loadingStartedCount.add(e),this._loadingStarted=!0),this._tasks.add(e),this._tasksQueueSubject.next(this._tasks)})}removeTask(e,t={}){this._enableMeasurement&&this._ngZone.runOutsideAngular(()=>{t.targetTask&&this._loadingFinishedCount.add(e),this._tasks.delete(e),this._tasksQueueSubject.next(this._tasks)})}getMeasurements(){const e=this._measurements.map(t=>t());return this._measurements=[],e}ngOnDestroy(){this._reset(),this._subscriptions.unsubscribe(),this._tasksQueueSubject.complete(),this._pageLoadLifeCycleSubject.complete(),this.pageLoadDuration$.complete()}static#e=this.\u0275fac=function(t){return new(t||Or)};static#t=this.\u0275prov=c.\u0275\u0275defineInjectable({token:Or,factory:Or.\u0275fac,providedIn:"root"})}function xp(n){let e=!1;const t=[];return Object.keys(n).forEach(s=>{Zu(s,n)&&(e=!0,t.push(s))}),{hasCycles:e,cycledModelsNames:t}}function Zu(n,e,t=[]){if(!e[n])return!1;const s=Object.values(e[n]);return s.some(i=>t.includes(Xu(i)))?!0:(t.push(n),!s.every(i=>!Zu(Xu(i),e,t)))}function Xu(n){return n.relationPath.split(".")[0]}const ws=Symbol("InternalViewModelInjector");class $e extends Array{constructor(...e){return super(),this._itemsChanged=new o.Subject,this._itemAttributeChanged=new o.Subject,this._destroyed$=new o.Subject,this._changed=new o.Subject,this._trackChanges=!0,this._createdItems=[],this._deletedItems=[],this._isDestroyed=!1,typeof e[0]=="number"?new Array(e[0]):([this._viewModelGenerator,this._viewModelConfig={},this._model,this._host,this._hostAttributeName]=e,this._measurePerformanceService=this._host?.[ws]?.get(te,null,{optional:!0}),this._featureValues=this._host?.[ws]?.get(W,{},{optional:!0})??{},this._ngZone=this._host?.[ws]?.get(c.NgZone,null,{optional:!0}),Object.setPrototypeOf(this,Object.create($e.prototype)),this._subscribeItemsModelModesChanges(),this._subscribeItemsAttributesChanges(),new Proxy(this,{set:(t,s,r,i)=>{const a=t[s];return t[s]=r,this._trackChanges&&(s==="length"&&r!==a?this._onItemsChanged():isNaN(parseInt(s))||this._onItemsChanged()),!0}}))}get changed(){return this._changed.asObservable().pipe(cl(this._ngZone),(0,u.takeUntil)(this._destroyed$))}get itemAttributeChanged(){return this._itemAttributeChanged.asObservable().pipe((0,u.takeUntil)(this._destroyed$))}get isChanged(){return this.getChangedItems().length>0}get formApiModel(){return this._formApiModel||this._updateFormApiModelValues({emitEvent:!1}),this._formApiModel}_isItemPrimaryAttributeEqual(e,t){return(0,S.A)(function*(){if(!e)return!1;const s=yield e[e.primaryAttributeName];return t.includes(s)})()}_insertItem(e,t){typeof t!="number"&&(t=this.length),t=Math.max(t,0),t=Math.min(t,this.length),this.splice(t,0,e)}_generateItem(e){const t=()=>{const s=this._model?.createCollectionItemModel(A.Create),r=this._host?.[ws],i=this._viewModelGenerator.generate({viewModelConfig:this._viewModelConfig,modelConfig:s?{primaryDataSourceName:s.name}:void 0,models:s?[s]:void 0,parentViewModel:this._host,businessRulesActive:e.businessRulesActive??!1},r?c.Injector.create({providers:[{provide:On,useValue:null}],parent:r}):null).pipe((0,u.tap)(a=>{s?.name&&(a.dataSchemas[s.name]=this._host.dataSchemas[s.name])}),(0,u.switchMap)(a=>s?.name?a.create(s.name,e.initialModelValues).pipe((0,u.map)(()=>a)):(0,o.of)(a)),(0,u.tap)(a=>{Object.entries(e.initialAttributeValues??{}).forEach(([l,d])=>a[l]=d),a._markAsPristine(e.initialAttributeValues??{}),this._model?.childrenChange()}));return(0,o.lastValueFrom)(i)};return this._measurePerformanceService?this._measurePerformanceService.measureCallback("ViewModelCollection.generateItem",()=>t()):t()}_mergeItems(e,t){const s=()=>{const r=(e[0]||t[0])?.primaryAttributeName;for(const i of t){const a=e.findIndex(l=>{const d=l.attributes?.[r],h=i.attributes?.[r];return d&&d===h});a===-1?e.push(i):e.splice(a,1,i)}return e};return this._measurePerformanceService?this._measurePerformanceService.measure("ViewModelCollection.mergeItems",()=>s()):s()}_triggerChangesAfter(e){this._trackChanges=!1;const t=e.call(this);return this._trackChanges=!0,this._isDestroyed||this._onItemsChanged(),t}_onItemsChanged(){const e=this.map(t=>({item:t,itemModelMode:t?.getPrimaryModelMode?.()}));this._updateCollectionState(e,!0)}_subscribeItemsModelModesChanges(){this._itemsChanged.pipe((0,u.switchMap)(()=>this._getItemsModelModesChanges()),(0,u.tap)(e=>this._updateCollectionState([e],!1)),(0,u.takeUntil)(this._destroyed$)).subscribe()}_subscribeItemsAttributesChanges(){this._itemsChanged.pipe((0,u.switchMap)(()=>this._getItemsAttributesChanges()),(0,u.filter)(e=>!e.payload.silent),(0,u.tap)(()=>this._itemAttributeChanged.next()),(0,u.takeUntil)(this._destroyed$)).subscribe()}_getItemsAttributesChanges(){const e=this.map(t=>t?.events$?.pipe((0,u.filter)(s=>s.type===J.ChangeAttributeValue))).filter(Boolean);return e.length?(0,o.merge)(...e):o.EMPTY}_getItemsModelModesChanges(){const e=[...this,...this._deletedItems].map(t=>t?._getPrimaryModelModeChanges?.()?.pipe((0,u.map)(s=>({item:t,itemModelMode:s})))).filter(Boolean);return e.length?(0,o.merge)(...e):o.EMPTY}_updateCollectionState(e,t){this._trackChanges=!1;const s=e.map(r=>this._onItemModelModeChanged(r)).some(r=>!!r);this._trackChanges=!0,!(!t&&!s)&&(this._updateFormApiModelValues(),this._updateFormApiModelPristineState(),this._changed.next(),this._itemsChanged.next())}_onItemModelModeChanged(e){const{item:t,itemModelMode:s}=e;if(!t||s==null)return!1;switch(s){case A.Create:return this._onCreateItem(t);case A.Update:return this._onUpdateItem(t);case A.Delete:return this._onDeleteItem(t);default:return!1}}_onCreateItem(e){const t=this._deletedItems.indexOf(e);return t!==-1?(this._deletedItems.splice(t,1),!0):(this._createdItems.indexOf(e)===-1&&this._createdItems.push(e),!1)}_onUpdateItem(e){const t=this._createdItems.indexOf(e);if(t!==-1)return this._createdItems.splice(t,1),!1;const s=this._deletedItems.indexOf(e);if(s!==-1){const r=this._deletedItems.splice(s,1);super.push(...r)}return!0}_onDeleteItem(e){const t=this._createdItems.indexOf(e),s=this._deletedItems.indexOf(e);return t!==-1?this._createdItems.splice(t,1):s===-1&&this._deletedItems.push(e),super.splice(this.indexOf(e),1),!0}_updateFormApiModelValues(e){if(this._featureValues.DisableBaseViewModelCollectionOptimization){this._formApiModel??=new ge.FormArray([]),this._formApiModel.clear({emitEvent:!1}),this.filter(s=>s?.formApiModel).forEach(s=>{this._formApiModel.push(s.formApiModel,{emitEvent:!1})}),e?.emitEvent!==!1&&this._formApiModel.updateValueAndValidity();return}if(!this._formApiModel||!this._formApiModel.length){const s=new ge.FormArray(this.filter(r=>r?.formApiModel)?.map(r=>r.formApiModel));this._formApiModel||(this._formApiModel=s),this._formApiModel.length||this._host?.formApiModel?.setControl(this._hostAttributeName,s)}else this._formApiModel.clear({emitEvent:!1}),this.filter(s=>s?.formApiModel).forEach(s=>{this._formApiModel.push(s.formApiModel,{emitEvent:!1})}),e?.emitEvent!==!1&&this._formApiModel.updateValueAndValidity()}_updateFormApiModelPristineState(){const e=this.formApiModel.pristine,t=this.some(s=>s?.formApiModel?.dirty);if(t&&e){this.formApiModel.markAsDirty();return}!t&&!e&&this.formApiModel.markAsPristine()}_reload(e){const t=()=>{for(const i of[...this._deletedItems,...this])this.removeChildModel(i,{triggerNotification:!1});this._model?.childrenChange();const s=[],r=i=>s.push(i.destroy());return this._createdItems.forEach(r),this._createdItems.splice(0,this._createdItems.length),this._deletedItems.forEach(r),this._deletedItems.splice(0,this._deletedItems.length),this.forEach(r),this.splice(0,this.length,...e),(0,o.forkJoin)(s).pipe((0,u.defaultIfEmpty)(void 0),(0,u.map)(()=>{}))};return this._measurePerformanceService?this._measurePerformanceService.measure("ViewModelCollection.reload",()=>t()):t()}removeChildModel(e,t){const s=t?.triggerNotification??!0,r=this._model?.name,i=e.getModelByName(r);this._model?.removeChild(i),s&&this._model?.childrenChange()}copyWithin(e,t,s){return this._triggerChangesAfter(()=>super.copyWithin(e,t,s))}fill(e,t,s){return this._triggerChangesAfter(()=>super.fill(e,t,s))}push(...e){return this._triggerChangesAfter(()=>super.push(...e))}reverse(){return this._triggerChangesAfter(()=>super.reverse())}shift(){return this._triggerChangesAfter(()=>super.shift())}sort(e){return this._triggerChangesAfter(()=>super.sort(e))}splice(e,t,...s){return this._triggerChangesAfter(()=>super.splice(e,t,...s))}unshift(...e){return this._triggerChangesAfter(()=>super.unshift(...e))}getChangedItems(){const e=[...this._deletedItems];return this.filter(s=>{if(s.attributes.IsChanged)return!0;const r=s.getPrimaryModelMode();return r&&r!==A.Update}).concat(e)}createItem(e){var t=this;const s=function(){var r=(0,S.A)(function*(){const i=yield t._generateItem(e||{});return t._insertItem(i,e?.index),i});return function(){return r.apply(this,arguments)}}();return this._measurePerformanceService?this._measurePerformanceService.measureCallback("ViewModelCollection.createItem",()=>s()):s()}getPrimaryAttributeValues(){return Promise.all(this.map(e=>e?.[e?.primaryAttributeName]))}findByPrimaryAttribute(e){var t=this;return(0,S.A)(function*(){for(const s of t)if(yield t._isItemPrimaryAttributeEqual(s,[e]))return s})()}filterByPrimaryAttributes(e){var t=this;return(0,S.A)(function*(){const s=[];for(const r of t)(yield t._isItemPrimaryAttributeEqual(r,e))&&s.push(r);return s})()}merge(e){const t=()=>{this._triggerChangesAfter(()=>{const s=this._mergeItems([...this],e);super.splice(0,this.length,...s),this._createdItems.splice(0,this._createdItems.length),e instanceof $e&&this._mergeItems(this._deletedItems,e._deletedItems)})};return this._measurePerformanceService?this._measurePerformanceService.measure("ViewModelCollection.merge",()=>t()):t()}reload(e){return(0,o.lastValueFrom)(this._reload(e))}remove(e){const[t,s]=typeof e=="number"?[e,this[e]]:[this.indexOf(e),e];if(t>=0&&t<this.length)return this.splice(t,1),(0,o.lastValueFrom)(s.destroy())}clear(){return this.reload([])}moveTo(e,t){if(t>=this.length)throw new sn("Target index cannot be greater than collection length");const s=this.indexOf(e);s===t||t<0||this._triggerChangesAfter(()=>{super.splice(t,0,super.splice(s,1)[0])})}destroy(){this._isDestroyed=!0,this._host=null;const e=this._reload([]);return this._formApiModel.clear({emitEvent:!1}),this._itemAttributeChanged.complete(),this._itemsChanged.complete(),this._destroyed$.next(),this._destroyed$.complete(),(0,o.lastValueFrom)(e)}}var $n;(function(n){n.Readonly="READONLY_PROPERTY",n.Disabled="DISABLED_PROPERTY"})($n||($n={}));const Op="DataValueType";class Un extends ju{get propertiesConfig(){return[{name:"visible",defaultValue:!0},{name:"displayColor"},{name:"required",typeName:"crt.Required",defaultValue:!1}]}get formControl(){return this._formControl||(this._formControl=new ge.FormControl(this.value),this._subscribeOnFormControl(this._formControl)),this._formControl}set formControl(e){this._formControl=e,this._subscribeOnFormControl(this._formControl)}get properties(){return this._properties}get onPropertyChanged(){return this._onPropertyChanged}get visible(){return this.getPropertyByName("visible").getValue()}set visible(e){const t=this.getPropertyByName("visible");t.value=e}get required(){return this.getPropertyByName("required").getValue()}set required(e){const t=this.getPropertyByName("required");t.value=e}get displayColor(){return this.getPropertyByName("displayColor").getValue()}set displayColor(e){const t=this.getPropertyByName("displayColor");t.value=e}get isDirty(){return this.formControl.dirty}constructor(e=null,t=null,s=!1,r="",i=[],a,l,d,h){super(r,e),this.validationState=t,this.disabled=s,this._subscription=new o.Subscription,this._onPropertyChanged=new c.EventEmitter,this._crtControlStateAdapter=a,this._validatorTypeResolver=l,this._injectionContext=h,this._initProperties(i),this._subscribeOnPropertiesEvents(),this._initializeValidators(d??[],!0)}static create(e){return new Un(e.value,null,!1,e.name,e.propertiesConfig??[],e.crtControlStateAdapter,e.validatorTypeResolver,e.validatorInfo,e.injectionContext)}_subscribeOnFormControl(e){this._formControlSubscription?.unsubscribe(),this._formControlSubscription=e.valueChanges.pipe((0,u.startWith)(e.value),(0,u.distinctUntilChanged)((t,s)=>this.areValuesEqual(t,s))).subscribe(t=>{this.setValue(t)})}_initProperties(e){const t=[...this.propertiesConfig,...e];this._properties=new Map,t.forEach(s=>{const r=$u.create({typeName:s.typeName,name:s.name,value:s.defaultValue,locked:s.locked===!0,validatorTypeResolver:this._validatorTypeResolver,injectionContext:this._injectionContext});this._properties.set(s.name,r)})}_subscribeOnPropertyEvents(e){this._subscription.add(e.onChanged.subscribe(({name:t,value:s,oldValue:r})=>{this.onPropertyChanged.emit({name:t,value:s,oldValue:r})})),this._subscription.add(e.onValidatorChanged.subscribe(()=>{this._refreshValidators()}))}_subscribeOnPropertiesEvents(){this.properties.forEach(e=>{this._subscribeOnPropertyEvents(e)})}_initializeValidators(e,t=!1){this._validatorInfo=e,this._properties.forEach(s=>{this._validatorInfo=s.initializeValidator(this._validatorInfo,t)}),this._refreshValidators()}_getEnabledValidatorFns(e=!1){return this._validatorInfo.filter(t=>!t.disabled&&t.instance.isAsync===e).map(t=>this._crtControlStateAdapter.transform(t))??[]}_refreshValidators(){const e=this._getEnabledValidatorFns();this.formControl.setValidators(e);const t=this._getEnabledValidatorFns(!0);this.formControl.setAsyncValidators(t),this.formControl.updateValueAndValidity()}_updateValidator(e,t=!1){const s=this._validatorInfo.find(r=>r.name===e);if(!s)throw new Error(`Validator ${e} does not exist on ${this.name} attribute.`);s.disabled!==t&&(s.disabled=t,this._refreshValidators())}setValue(e,t){const s=this.formControl;this.areValuesEqual(e,s.value)||(s.dirty||s.markAsDirty(),s.setValue(e,{onlySelf:!!t})),super.setValue(e,t)}findPropertyByName(e){return this.properties.has(e)?this.properties.get(e):null}enableValidator(e){this._updateValidator(e,!1)}disableValidator(e){this._updateValidator(e,!0)}change(e){this.setValue(e)}getPropertyByName(e,t=!1){let s=this.findPropertyByName(e);return!s&&t&&(s=new Ka(e,null,this._validatorTypeResolver,this._injectionContext),this._properties.set(e,s),this._subscribeOnPropertyEvents(s)),s}hasPropertyValue(e){return!!this.getPropertyByName(e)}getPropertyValue(e){const t=this.getPropertyByName(e);return t?t.getValue():null}setPropertyValue(e,t,s=!1){this.getPropertyByName(e,!0).setValue(t,s)}setPropertyInitialValue(e,t){this.getPropertyByName(e,!0).setInitialValue(t)}getPropertyInitialValue(e){return this.getPropertyByName(e)?.initialValue}getValue(){return this._formControl?this._formControl.value:super.getValue()}destroy(){this._formControlSubscription?.unsubscribe(),this._subscription.unsubscribe()}getInvariabilityPropertyName(){const e=this.getPropertyValue($n.Readonly),t=this.getPropertyValue($n.Disabled);return e??t}toggle(e){const t=this.getInvariabilityPropertyName(),s=this.getPropertyByName(t);s&&(e?s.resetPending():s.setPending(!0))}}function hf(n){const e=n;return e?!!e?.modelConfig||!!e?.embeddedModel||!!e?.value:!1}function Yu(n){const e=n;return e?!!e.from||!!e.triggers:!1}const Lp=b(85088);class Lr{sort(e,t){const s=[];let r=[];Object.entries(e||{}).forEach(([a,l])=>{if(Yu(l)){let d=l.from;d=Array.isArray(d)?d:[d];const h=d.map(p=>[a,p]);r=r.concat(h)}else s.push(a)});const i=Lp(r).reverse();return[...s,...i].filter(Boolean).filter((a,l,d)=>d.indexOf(a)===l).map(a=>{const l=i.includes(a)?e[a]??t[a]:e[a];return[a,l]})}static#e=this.\u0275fac=function(t){return new(t||Lr)};static#t=this.\u0275prov=c.\u0275\u0275defineInjectable({token:Lr,factory:Lr.\u0275fac,providedIn:"root"})}class Br{constructor(e,t,s,r,i,a,l){this._crtControlStateAdapter=e,this._validatorTypeResolver=t,this._viewModelGenerator=s,this._attributeCreator=r,this._viewModelRepository=i,this._attributesTopologicalSorting=a,this._injector=l,this._featureValues=this._injector.get(W,null,{optional:!0}),this._measurePerformanceService=this._injector.get(te)}_generateAttributes(e,t,s){const r=this._attributesTopologicalSorting.sort(t,e._attributeConfigs);return Promise.all(r.map(([i,a])=>e._systemAttributes.includes(i)?(console.warn(`Overriding of system attributes is denied. Attribute name:"${i}"`),Promise.resolve()):(s.disableDefaultConfig||(a??={}),e._attributeConfigs[i]=a,a?"viewModelConfig"in a||"viewModelName"in a?a.isCollection?this._generateNestedModelCollectionAttribute(e,i,a,s):this._generateNestedModelAttribute(e,i,a,s):Yu(a)?this._generateCalculatedAttribute(e,i,a,s):this._generateModelAttribute(e,i,a,s):this._removeViewModelAttribute(e,i))))}_generateNestedModelCollectionAttribute(e,t,s,r){var i=this;return this._measurePerformanceService.measureCallback(`BaseViewModelAttributeGenerator.nestedCollectionAttribute.${t}`,(0,S.A)(function*(){const a=e.getBoundDataSourceNameByAttributePath(t),l=e.getModelByName(a),d="viewModelConfig"in s?s.viewModelConfig:yield(0,o.lastValueFrom)(i._viewModelRepository.resolveModelConfig(s.viewModelName)),h=new $e(i._viewModelGenerator,d,l,e,t);i._registerOrSetFormControl(e.formApiModel,t,h.formApiModel);const p=e.attributes[t];e.attributes[t]=h,i._defineNestedModelAttribute(e,t,s,r),i._subscribeOnCollectionChanged(e,t,h,r),p!==void 0&&r.onChangeAttributeValue(t,h,p)}))}_defineNestedModelAttribute(e,t,s,r){const i=l=>{const d=e.attributes[t];e.attributes[t]=l,d instanceof $e&&l instanceof $e&&this._subscribeOnCollectionChanged(e,t,l,r),r.onChangeAttributeValue(t,l,d)},a=()=>e.attributes[t];gs.defineAsyncAttribute(e,t,s,a,i)}_generateNestedModelAttribute(e,t,s,r){return this._measurePerformanceService.measureCallback(`BaseViewModelAttributeGenerator.nestedModelAttribute.${t}`,()=>{const i="viewModelConfig"in s?s.viewModelConfig:s.viewModelName,a=e?.[ws];return(0,o.lastValueFrom)(this._viewModelGenerator.generate({viewModelConfig:i,parentViewModel:e},a?c.Injector.create({providers:[{provide:On,useValue:null}],parent:a}):null).pipe((0,o.map)(l=>{this._registerOrSetFormControl(e.formApiModel,t,l.formApiModel);const d=e.attributes[t];e.attributes[t]=l,this._defineNestedModelAttribute(e,t,s,r),d!==void 0&&r.onChangeAttributeValue(t,l,d)})))})}_subscribeOnCollectionChanged(e,t,s,r){if(e._collectionSubscription.has(t)){const a=e._collectionSubscription.get(t);a.unsubscribe(),e._subscriptions.remove(a)}const i=new o.Subscription;i.add(s.changed.subscribe(()=>{r.onChangeAttributeValue(t,s,null)})),i.add(s.itemAttributeChanged.subscribe(()=>{r.onChangeAttributeValue(t,s,null)})),e._collectionSubscription.set(t,i),e._subscriptions.add(i)}_generateCalculatedAttribute(e,t,s,r){this._measurePerformanceService.measure(`BaseViewModelAttributeGenerator.generateCalculatedAttribute.${t}`,()=>{this._attributeCreator.create(Du)?.defineAttribute({viewModel:e,attribute:t,attributeConfig:s,generateOptions:r})})}_addDataValueTypePropertyConfig(e,t){t.dataValueTypeName&&e.push({name:Op,defaultValue:y.r[t.dataValueTypeName]})}_disableSystemAttributes(e,t,s){if(this._featureValues?.DisableBlockingSystemColumns===!0)return;if(e.getBoundDataSchemaAttributeByAttributePath(t)?.isSystem){let i=s.find(a=>a.name==="readonly");i||(i={name:"readonly"},s.push(i)),i.locked=!0,i.defaultValue=!0}}_getCrtControlPropertiesConfig(e,t,s){const r=Object.entries(s.properties??[]).map(([i,a])=>({name:i,defaultValue:a.defaultValue,locked:a.locked===!0}));return this._addDataValueTypePropertyConfig(r,s),this._disableSystemAttributes(e,t,r),r}_generateModelAttribute(e,t,s,r){this._measurePerformanceService.measure(`BaseViewModelAttributeGenerator.generateModelAttribute.${t}`,()=>{const i=e.attributes[t],a=s?.value,l=this._getCrtControlPropertiesConfig(e,t,s),d=Un.create({name:t,value:a,crtControlStateAdapter:this._crtControlStateAdapter,validatorTypeResolver:this._validatorTypeResolver,validatorInfo:e._validators[t],propertiesConfig:l,injectionContext:e._injectionContext??xn(e)?._injectionContext});e._subscriptions.add(d.onChanged.subscribe(f=>{e.attributes[t]=f.value,r.onChangeAttributeValue(f.name,f.value,f.oldValue)})),e._subscriptions.add(d.onPropertyChanged.subscribe(({name:f,value:C,oldValue:B})=>{r.onChangeAttributeValue(`${t}:${f}`,C,B)})),e._crtControls.set(t,d),this._registerOrSetFormControl(e.formApiModel,t,d.formControl),e.attributes[t]=a??null;const h=e._getDataSourceAttributeDataValueType(t);this._attributeCreator.create(h).defineAttribute({viewModel:e,attribute:t,attributeConfig:s,control:d}),i!==void 0&&r.onChangeAttributeValue(t,a,i)})}_registerOrSetFormControl(e,t,s){this._measurePerformanceService.measure(`BaseViewModelAttributeGenerator.registerOrSetFormControl.${t}`,()=>{if(this._featureValues?.DisableAttributeOnlyRegisteringControl){e.setControl(t,s);return}e.contains(t)?e.setControl(t,s):e.registerControl(t,s)})}_removeViewModelAttribute(e,t){return delete e._attributeConfigs[t],delete e.attributes[t],delete e[t],Promise.resolve()}generate(e,t,s){var r=this;return this._measurePerformanceService.measureCallback("BaseViewModelAttributeGenerator.generateAttributes",()=>gs.deferUpdatingValueAndValidity(e,(0,S.A)(function*(){yield r._generateAttributes(e,t,s),!r._featureValues?.DisableAttributeOnlyRegisteringControl&&e.formApiModel.updateValueAndValidity()}),this._featureValues))}static#e=this.\u0275fac=function(t){return new(t||Br)(c.\u0275\u0275inject(At),c.\u0275\u0275inject(Ln),c.\u0275\u0275inject(Et),c.\u0275\u0275inject(Ou),c.\u0275\u0275inject(vt),c.\u0275\u0275inject(Lr),c.\u0275\u0275inject(c.Injector))};static#t=this.\u0275prov=c.\u0275\u0275defineInjectable({token:Br,factory:Br.\u0275fac,providedIn:"root"})}class kr{_defineResourceAttribute(e,t,s,r,i){return new o.Observable(a=>{const l=e._getDataSourceAttributeCaption(r,i);if(this._defineResourceProperty(t,s,l),r.includes(".")){const d=r.split(".")[1];this._defineResourceProperty(t,d,l)}a.next(),a.complete()})}_defineResourceProperty(e,t,s){e[t]||Object.defineProperty(e,t,{get:()=>Promise.resolve(s??""),configurable:!0})}_getResourceNameByPath(e){const t=e.split(".");return t.length>1?t.join("_"):e}generate(e,t){return Object.entries(t||{}).map(([s,r])=>{const i=e[wr][ss.string],a=this._getResourceNameByPath(s);return this._defineResourceAttribute(e,i,a,s,r)})}static#e=this.\u0275fac=function(t){return new(t||kr)};static#t=this.\u0275prov=c.\u0275\u0275defineInjectable({token:kr,factory:kr.\u0275fac,providedIn:"root"})}const qn="HasUnsavedData",Fr="IsChanged",jo="PrimaryModelMode",$o="BusinessRulesActivated",Hn="State";var Uo;(function(n){n.Paused="Paused",n.Active="Active"})(Uo||(Uo={}));class jr{constructor(e,t,s){this._sysSettingsService=e,this._dataSchemaRepository=t,this._featureValues=s,this._searchComparisonTypeSysSettingCode="StringColumnSearchComparisonType"}_getParameterValue(e,t,s){if(typeof t=="string"){if(t.startsWith("@requestPayload")){const r=t.replace("@requestPayload.","");return(0,v.get)(s,r)}if(t.startsWith("$"))return e.attributes[t.substring(1)];if(e.attributes[t])return e.attributes[t]}return t}_applyFilterMacros(e,t){let s=null;switch(typeof t){case"object":s=JSON.stringify((0,X.classToPlain)(t));break;case"string":s=t;break;default:return t}const r=/##ViewModelMacro\.\$([^#]+)##/g;let i=!1;return[...s.matchAll(r)].forEach(a=>{const l=a[1],d=(0,v.get)(e.attributes,l);let h=d?.toString();typeof d=="object"&&(i=!0,h=JSON.stringify(d)),s=s.replace(a[0],h)}),typeof t=="object"||i?JSON.parse(s):s}_createPrimaryDisplayColumnValueFilter(e){var t=this;return(0,S.A)(function*(){const s=t._searchComparisonTypeSysSettingCode,i=(yield t._sysSettingsService.getByCode(s))?.value===1?j.Contain:j.Start_with;return{type:P.PrimaryDisplayValueFilter,value:e,comparisonType:i}})()}_createColumnValueFilter(e,t,s){const r=t;return Promise.resolve({type:P.ColumnValue,value:{attributePath:r.attributePath,attributeValue:this._getParameterValue(e,r.attributeValue,s)}})}_getOwnLoadParameters(e,t){return e.getModelByName(t)?.getOwnLoadParameters()}_getDataSourceFilteringParameters(e,t){const r=e._dataSourcesInfos.get(t).getFilteringConfig();return e._checkFilteringAttributes(t,r),r.length===0?Promise.resolve([]):Promise.all(r.map(i=>e[i.name])).then(i=>i.map(a=>({type:P.Filter,value:a})))}_getDataSourceOwnFilteringParameters(e,t){return this._getOwnLoadParameters(e,t)?.parameters??[]}_getPrimaryAttributeName(e,t){var s=this;return(0,S.A)(function*(){if(!t)return null;let r=Object.values(e.dataSchemas).find(i=>i.name===t);return r||(r=yield(0,o.lastValueFrom)(s._dataSchemaRepository.get(t))),r?.primaryAttributeName})()}_getParameterRelationsConfigs(e){return e.relationsConfigs||[]}_createRelationParameter(e,t){const s={...e},r=this._getParameterRelationsConfigs(s);return s.relationsConfigs=[{dataSchemaName:t.dataSchemaName,attributePath:t.attributePath,relationPath:t.relationPath},...r],s}_validateAllowedRelations(e,t,s){const i=s?.relationPath?.split(".")?.shift(),a=e.dataSchemas[t],l=a?.findAttributeByName(i);if(a&&l&&a.primaryAttributeName!==i&&l.dataValueType!==y.r.Lookup&&!this._featureValues.DataSourceAllowRelationsByNonLookupColumn){const d="Filtration of data sources by page data is currently supported by lookup and primaryAttribute fields only",h=new Error(`${d}, please see the console for more details`);throw h.stack=`${d} , data source name: ${t}, relation config: ${JSON.stringify(s)}`,h}}_createRelationParameterWithAttributeValue(e,t,s,r){var i=this;return(0,S.A)(function*(){const a={...s},l=i._getParameterRelationsConfigs(a),d=e.dataSchemas[t],h=r.relationPath.split("."),p=h.shift(),f=d.findAttributeByName(p);if(d.primaryAttributeName!==p&&f.dataValueType!==y.r.Lookup&&i._featureValues.DataSourceAllowRelationsByNonLookupColumn)return a.type=P.ColumnValue,a.value={attributePath:r.attributePath,attributeValue:r.value},a.relationsConfigs=l,a;const C={dataSchemaName:r.dataSchemaName,attributePath:r.attributePath,relationPath:r.relationPath};a.value=r.value,a.type=P.PrimaryColumnValue,d.primaryAttributeName!==p&&(C.dataSchemaName=f.referenceSchemaName);const B=d.type!==kt.Entity?C.dataSchemaName:r.dataSchemaName;return C.relationPath=h.length===0?yield i._getPrimaryAttributeName(e,B):h.join("."),a.relationsConfigs=[C,...l],a})()}_convertToRelationParameters(e,t,s,r){var i=this;return(0,S.A)(function*(){const a=[];i._validateAllowedRelations(e,t,r);for(const l of s){const d=r.useAttributeValue?yield i._createRelationParameterWithAttributeValue(e,t,l,r):i._createRelationParameter(l,r);a.push(d)}return a})()}getLoadParametersByRelation(e,t,s,r){const i=t.relationPath.split("."),a=i.shift(),l=e.dataSchemas[a],d={dataSchemaName:l.name,attributePath:t.attributePath,relationPath:i.join(".")},h=i.shift(),f=e._dataSourcesInfos.get(a).getMappedAttributeNames(h)?.[0]??null,C=e.getModelMode(a),B=r?.[a]?.[d.relationPath];if(e.getModelByName(s)?.getAllowCopyingRecords()&&B)d.value=B,d.useAttributeValue=!0;else{const I=e.getIsDirty(f)||C===A.Create||C===A.Copy||l.type!==kt.Entity;if(f&&I){d.useAttributeValue=!0;const K=e.attributes[f];d.value=K?.value?K.value:K}}return this._getModelLoadParameters(e,a,null,null,!0,!1).then(I=>this._convertToRelationParameters(e,a,I,d))}_getRelationParameters(e,t,s){var r=this;return(0,S.A)(function*(){const i=e._modelDependencies[t]||[];if(i.length===0)return Promise.resolve([]);const a=i.map(h=>r.getLoadParametersByRelation(e,h,t,s)),l=(yield Promise.all(a)).flat();if(r._featureValues.DisableDsDepsJoinOptimization)return l;const d=l.filter(h=>h.type!==P.Empty);return d.length===0?l:d.filter(h=>h.type===P.Filter?!!h.value:!0)})()}_getPagingConfigRowCount(e,t){return typeof t=="string"?(0,v.isNil)(e.attributes[t])?0:e.attributes[t]:t}_getPagingConfigRowsOffset(e,t,s,r){const i=e._dataSourcesInfos.get(r).collectionViewModelAttributeName,a=e.attributes[i]?.length??0;if(typeof t=="number")throw new Error("Rows offset parameter cannot be set to number");return!t&&s===q.LoadNext?a:!t&&s===q.Reload?0:(e.attributes[t]=(0,v.isNil)(e.attributes[t])?0:e.attributes[t],s===q.Reload?e.attributes[t]:e.attributes[t]+a)}_getModelPagingConfig(e,t,s,r){if(!t){const i=this._getOwnLoadParameters(e,r);return Promise.resolve(i?.options?.pagingConfig??null)}return Promise.resolve({rowCount:this._getPagingConfigRowCount(e,t.rowCount),rowsOffset:this._getPagingConfigRowsOffset(e,t.rowsOffset,s,r)})}_mergeSorting(e,t){return(0,v.unionBy)(e??[],t??[],"columnName")??null}_getModelSortingConfig(e,t,s){const i=this._getOwnLoadParameters(e,s)?.options?.sortingConfig,a=t?.attributeName;return!a||!e.attributes[a]?i?Promise.resolve(i):Promise.resolve(null):Promise.all(e.attributes[a].map(function(){var l=(0,S.A)(function*(d){return{columnName:yield d.columnName,direction:yield d.direction}});return function(d){return l.apply(this,arguments)}}())).then(l=>({columns:this._mergeSorting(l,i?.columns)}))}_updateLastEventLoadParameters(e,t,s,r){s&&s.length!==0?e._lastEventLoadParameters.set(t,s):r!==!0&&e._lastEventLoadParameters.set(t,[{type:P.Empty,value:""}])}_getModelLoadParameters(e,t,s,r,i,a,l){const d=this.getModelParameters(e,s,r).then(h=>(a!==!0&&this._updateLastEventLoadParameters(e,t,h,i),i!==!0?h:e._lastEventLoadParameters.get(t)||[{type:P.Never,value:""}]));return Promise.all([d,this._getDataSourceFilteringParameters(e,t),this._getDataSourceOwnFilteringParameters(e,t),this._getRelationParameters(e,t,l)]).then(([h,p,f,C])=>[...h,...f,...p,...C])}getModelParameters(e,t,s){if(s?.parameters&&(t=[...t,...s.parameters]),!t||t.length===0)return Promise.resolve([]);const r=t.map(i=>{switch(i.type){case P.PrimaryColumnValue:return Promise.resolve({type:i.type,value:this._getParameterValue(e,i.value,s)});case P.Filter:return Promise.resolve({type:i.type,value:this._applyFilterMacros(e,i.value)});case P.PrimaryDisplayValueFilter:return this._createPrimaryDisplayColumnValueFilter(this._getParameterValue(e,i.value,s));case P.ColumnValue:return this._createColumnValueFilter(e,i.value,s)}});return Promise.all(r)}getModelLoadParameters(e,t,s,r=q.Load,{payload:i,useLastLoadParameters:a,doNotUpdateLastLoadParameters:l,modelLoadConfiguration:d}={}){const h=t.name,p=r??q.Load,f=p===q.Load?null:t.getPagingConfig(),C=t.getSortingConfig();return Promise.all([this._getModelLoadParameters(e,h,s,i,a,l,d),this._getModelPagingConfig(e,f,p,h),this._getModelSortingConfig(e,C,h)])}static#e=this.\u0275fac=function(t){return new(t||jr)(c.\u0275\u0275inject(ae),c.\u0275\u0275inject(Le),c.\u0275\u0275inject(W))};static#t=this.\u0275prov=c.\u0275\u0275defineInjectable({token:jr,factory:jr.\u0275fac,providedIn:"root"})}class Ue{get attributesMap(){return this._attributesMap}get mappedViewModelAttributes(){return this._mappedViewModelAttributes}get isCollection(){return this._isCollection}get collectionViewModelAttributeName(){return this._collectionViewModelAttributeName}constructor(e){this._attributesMap=new Map,this._mappedViewModelAttributes=new Set,this.attributes=[],this.includePrimaryAttributes=!0,this.name=e}static _getDataSourceInfo(e,t){if(!e.has(t)){const s=new Ue(t);return e.set(t,s),s}return e.get(t)}static _extractViewModelAttributeMapInfo(e){const t=e.split(".");return{dataSourceName:t.shift(),dataSourceAttributePath:t.join(".")}}static _getByDefaultAttribute(e,t,s,r=""){const i=t.modelConfig;if(!i||!i.path)return;const a=this._extractViewModelAttributeMapInfo(i.path);if(!a.dataSourceAttributePath){this._getByViewModelCollectionAttribute(e,t,s);return}if(r&&r!==a.dataSourceName)throw new Error(`Attribute '${e}' mapped on a few DataSources`);const l=this._getDataSourceInfo(s,a.dataSourceName),d=i.aggregationConfig?.aggregationFunction?vu(a.dataSourceAttributePath):a.dataSourceAttributePath;l.attributes.push({path:d,type:i.type,functionConfig:i.functionConfig,aggregationConfig:i.aggregationConfig}),l._mappedViewModelAttributes.add(e),l._attributesMap.set(e,a.dataSourceAttributePath)}static _getByInlineViewModelAttribute(e,t,s,r=""){const i=t.viewModelConfig||{};Object.entries(i.attributes||{}).forEach(([a,l])=>{const d=`${e}.${a}`;this._processViewModelAttribute(d,l,s,r)})}static _getByViewModelCollectionAttribute(e,t,s){const r=t.modelConfig;if(!r||!r.path)return;const a=this._extractViewModelAttributeMapInfo(r.path).dataSourceName,l=this._getDataSourceInfo(s,a);l._isCollection=!0,l._collectionViewModelAttributeName=e,l._pagingConfig=r.pagingConfig,l._sortingConfig=r.sortingConfig,l._filteringConfig=r.filterAttributes,l.includePrimaryAttributes=r.includePrimaryAttributes===void 0?!0:r.includePrimaryAttributes;const d=t?.viewModelConfig;Object.entries(d?.attributes||{}).forEach(([h,p])=>{this._processViewModelAttribute(`${e}.${h}`,p,s,a)})}static _processViewModelAttribute(e,t,s,r=""){"viewModelConfig"in t||"viewModelName"in t?t.isCollection?this._getByViewModelCollectionAttribute(e,t,s):this._getByInlineViewModelAttribute(e,t,s,r):"from"in t||this._getByDefaultAttribute(e,t,s,r)}static getFromViewModelConfig(e,t=[]){const s=new Map;return Object.entries(e?.attributes||{}).forEach(([r,i])=>{this._processViewModelAttribute(r,i,s)}),t.filter(r=>!s.has(r.name)).forEach(({name:r})=>{const i=new Ue(r);s.set(r,i)}),s}static getLookupListDataSourceInfo(e,t){const s=new Ue("");return s._isCollection=!0,s._collectionViewModelAttributeName=e,Object.entries(t).forEach(([r,i])=>{s.attributes.push({path:i}),s._mappedViewModelAttributes.add(r),s._attributesMap.set(r,i)}),s}_getRowModelDto(e){const t=e.length>0?e[0]:{},s={};return Object.entries(t).forEach(([r,i])=>{this.getMappedAttributeNames(r).forEach(l=>{const d=l.split(".");this.isCollection&&d.length>1&&d.shift(),(0,v.set)(s,d.join("."),i)})}),s}_getCollectionModelDto(e){const t=this._collectionViewModelAttributeName,s=e.map(r=>this._getRowModelDto([r]));return{[t]:s}}getMappedAttributes(){return Array.from(this._mappedViewModelAttributes.values())}getMappedAttributeNames(e){return Array.from(this._attributesMap.entries()).filter(([,t])=>t===e).map(([t])=>t)}getDataSourceAttributePath(e){return this._attributesMap.has(e)?this._attributesMap.get(e):""}getIsMapOnCollection(e){return this._isCollection&&this._collectionViewModelAttributeName===e}getPagingConfig(){return this._pagingConfig}getSortingConfig(){return this._sortingConfig}getFilteringConfig(){return this._filteringConfig||[]}getModelDto(e){return this._isCollection?this._getCollectionModelDto(e):this._getRowModelDto(e)}addNewAttribute(e,t,s){const r=new Map;r.set(this.name,this),Ue._getByDefaultAttribute(e,t,r,s)}getIsDataSourceAttributePathExists(e){return this.attributes.find(t=>t.path===e)!==void 0}}class Bp{}function kp(n,e){return qo.apply(this,arguments)}function qo(){return qo=(0,S.A)(function*(n,e){const t=typeof e=="string"?e.split("."):e;let s=t.shift(),r=n;for(;s;)r=yield r[s],s=t.shift();return r}),qo.apply(this,arguments)}const Fp=500;class It{static#e=this._skippedProperties=["schedule","then"];constructor(e,t,s,r,i,a,l,d){this.viewModelGenerator=e,this.injector=t,this.viewModelConfig=s,this.resources=r,this._eventScopes=a,this._modelsInitConfig=l,this._defaultPrimaryAttributeName="Id",this._models$=new o.BehaviorSubject([]),this._businessRulesActive=!0,this._dropdownPageSizeSettingsCode="DropdownPageSize",this._dataSourcesInfos=new Map,this._attributesToDataSourceNameMap=new Map,this._dropdownPageSize=null,this._replayEvents$=new o.ReplaySubject,this._loadedDataSources=new Set,this._conflictedModels=[],this.__destroyed=!1,this._disableViewModelWaitingForAsyncTasks=!1,this._disableViewModelLoadUnblockingThread=!1,this._blockFieldsAffectedByBusinessRules=!1,this._asyncTasksExecutingSubject=new o.BehaviorSubject(new Set),this._modelsRequestedToLoad=new Set,this._attributesAffectedByBusinessRules=[],this._businessRulesAreActivated=!1,this._destroySubject=new o.Subject,this._modelSourceRecordId={},this._modelLoaded$=new o.Subject,this._viewModelAttributeChangeEventOptions=new Ip({preventAttributeChangeRequest:!1,preventStateChange:!0,preventRunBusinessRules:!0}),this._dynamicModelNames=new Set,this._attributeConfigs={},this._eventsSubject$=new o.Subject,this._collectionSubscription=new Map,this._crtControls=new Map,this._subscriptions=new o.Subscription,this._destroy$=this._destroySubject.asObservable(),this._businessRulesActivated$=new o.BehaviorSubject(!1),this.attributes={},this.dataSchemas={},this.events$=(0,o.merge)(this._eventsSubject$,this._replayEvents$),this._systemAttributes=[],this.getAttributeViewModelConfig=p=>this._attributeConfigs[p]?.viewModelConfig?.attributes,this.initDependencies(),this._subscribeModelsChanges(),this.handlerChain=ie.instance,i?this.formApiModel=i:this.formApiModel=this.formBuilder.group({}),this.parent=d;const h=this._appInfo?.isDebugEnabled?this._createProxy(this):this;return this._viewModelDataDelayerService&&!this.parent&&this._viewModelDataDelayerService.setViewModel(h),h}_createProxy(e){return new Proxy(e,{get(t,s){return!(typeof s=="string")||s in t||It._skippedProperties.includes(s)||console.debug(`Attribute ${s} not found.`),t[s]}})}get IsChanged(){return Promise.resolve(this.attributes[Fr])}set IsChanged(e){}get HasUnsavedData(){return Promise.resolve(this.attributes[qn])}set HasUnsavedData(e){}set BusinessRulesActivated(e){}get BusinessRulesActivated(){return Promise.resolve(this._businessRulesAreActivated)}get _isChanged(){return console.warn("Warning: The `_isChanged` property of the view-model is deprecated. It will be removed in future versions. Use `IsChanged` or `HasUnsavedData` attribute instead."),Object.keys(this._attributeConfigs).filter(e=>!(0,v.isEmpty)(this._attributeConfigs[e].modelConfig)).some(e=>this.formApiModel.controls[e]?.dirty)}get _scopes(){return[...this._eventScopes??[]]}get _injectionContext(){return this._context}get[ws](){return this.injector}get primaryAttributeName(){if(!this._primaryModelName)return this._defaultPrimaryAttributeName in this._attributeConfigs?this._defaultPrimaryAttributeName:null;const t=this.dataSchemas[this._primaryModelName].primaryAttributeName,s=this._dataSourcesInfos.get(this._primaryModelName);return this._getMappedAttributeName(s,t)}get PrimaryModelMode(){return this.getPrimaryModelMode()}get State(){return xn(this).attributes[Hn]}get _destroyed(){return this.__destroyed}get models(){return this._models$.value}_executeWithOptions(e,t){let s;try{return s=this._viewModelAttributeChangeEventOptions.getOptions(),this._viewModelAttributeChangeEventOptions.setOptions(t),e()}finally{this._viewModelAttributeChangeEventOptions.setOptions(s)}}_setSystemAttributeValue(e,t){const s=this.attributes[e];this.attributes[e]=t,this._executeWithOptions(()=>{this._fireChangeAttributeEvent({type:J.ChangeAttributeValue,payload:{attributeName:e,oldValue:s,value:t}})},{preventStateChange:!0,preventRunBusinessRules:!0})}_fireChangeAttributeEvent(e){e.payload.silent??=this._viewModelAttributeChangeEventOptions.getAsSilent(),Object.assign(e.payload,this._viewModelAttributeChangeEventOptions.getOptions()),this._eventsSubject$.next(e)}_getViewModelValidators(e){const t=this.viewModelConfig.attributes[e]??{};return("validators"in t&&t.validators)??{}}_initDataSourceValidators(){return this._measurePerformanceService?.measure(`ViewModel.initDataSourceValidators.${this._injectionContext?.id}.parent.${!!this.parent}`,()=>(this._validators={},this._dataSourcesInfos.forEach(e=>{e.attributesMap.forEach((t,s)=>{const r=this.viewModelConfig.attributes[s]??{};if("modelConfig"in r&&r.modelConfig?.ignoreValidators)return;this._validators[s]=this._validators[s]||[];const i=this._getDataSourceAttributeSchema(e,t);if(i?.validators){for(const[a,l]of Object.entries(i.validators))if(l?.type){const d=this._injectionContext??xn(this)?._injectionContext,h=this.validatorTypeResolver.getValidator(l.type,{validationParameters:l?.params,injectionContext:d}),p=this._getViewModelValidators(s),f=Object.values(p).find(C=>C.type===l.type);this._validators[s].push({name:a,instance:h,disabled:!!f?.disabled,params:l?.params})}}})}),(0,o.of)(null)))}_initSchemaValidators(e){this._measurePerformanceService.measure(`ViewModel.initSchemaValidators.${this._injectionContext?.id}.parent.${!!this.parent}`,()=>{Object.entries(e||{}).forEach(([t])=>{const s=this._getViewModelValidators(t);this._validators[t]=this._validators[t]||[];for(const[r,i]of Object.entries(s))if(i?.type){const a=this._injectionContext??xn(this)?._injectionContext,l=this.validatorTypeResolver.getValidator(i.type,{validationParameters:i.params,injectionContext:a});this._validators[t].push({name:r,instance:l,disabled:i.disabled,params:i?.params})}})})}_waitAsyncValidation(){return(0,o.from)(this.waitAsyncTasksFinish()).pipe((0,u.switchMap)(()=>this.formApiModel.statusChanges.pipe((0,u.startWith)(this.formApiModel.status),(0,u.filter)(e=>e.toLowerCase()!=="pending"),(0,u.first)(),(0,u.map)(()=>null))))}_getDataSourceAttributeCaption(e,t){let s=this.resourceFinderService.findLocalizableValue(t);const r=this._getDataSourceInfoByViewModelAttributePath(e);if(s==null&&r){const i=r.getDataSourceAttributePath(e),a=i?this._getDataSourceAttributeSchema(r,i):"";s=a?a.caption:this._translateService.instant("BaseViewModel.DataSourceAttributeRemoved")}return s}_getResourcesStrings(){const e=this.resources?.strings??{};return{...e,...this._getResourceStringsByAttributes(e)}}_getChangedResourcesStrings(e){const t=Object.entries(e).reduce((r,[i,a])=>{const l=this.resources?.strings[i]||{},d=a&&{...l,...a};return{...r,[i]:d}},{}),s={...this.resources?.strings,...t};return JSON.parse(JSON.stringify(s))}_generateResourceAttribute(){this[wr]={},this[wr][ss.string]={};const e=this._getResourcesStrings();return this._attributeResourceGenerator.generate(this,e)}_getBoundAttributeNames(){const e=new Set;return this._dataSourcesInfos.forEach(t=>{for(const s of t.mappedViewModelAttributes)e.add(s)}),Array.from(e.values())}_getDataSourceInfoByViewModelAttributePath(e){const t=this.getBoundDataSourceNameByAttributePath(e);return this._dataSourcesInfos.has(t)?this._dataSourcesInfos.get(t):null}_getResourceStringsByAttributes(e){const t=Object.keys(e);return this._getBoundAttributeNames().filter(r=>!t.includes(r)).reduce((r,i)=>(r[i]={},r),{})}_getDataSourceAttributeSchema(e,t){return this.dataSchemas[e.name]?.attributes?.find(s=>s.name===t)}_generatePrimaryAttributes(){return this._measurePerformanceService.measure(`ViewModel.generatePrimaryAttributes.${this._injectionContext?.id}.parent.${!!this.parent}`,()=>{const e=Array.from(this._dataSourcesInfos.values()).map(t=>{const s=t.name,r=this.dataSchemas[s],a=(t.includePrimaryAttributes?[r?.primaryAttributeName,r?.primaryDisplayAttributeName]:[]).filter(l=>l&&!t.getIsDataSourceAttributePathExists(l)).map(l=>{const d=O(),h=`${s}_${l}_${d}`,p=r.findAttributeByName(l),f={modelConfig:{path:`${s}.${l}`},dataValueTypeName:y.r[p.dataValueType]};return this._attributeConfigs[h]=f,t.addNewAttribute(h,f),this._attributeGenerate({[h]:f})});return a.length===0?(0,o.of)(null):(0,o.forkJoin)(a)});return e.length===0?(0,o.of)(null):(0,o.forkJoin)(e).pipe(this._measurePerformanceService.measure$(`ViewModel.generatePrimaryAttributes.forkJoin.${this._injectionContext?.id}.parent.${!!this.parent}`))})}_getDataSourceDto(e){const t={},s=this._dataSourcesInfos.get(e);return s.attributesMap.forEach((r,i)=>{if(!s.getIsMapOnCollection(i)){const a=this.attributes[i],l=this._getDataSourceAttributeSchema(s,r);!a&&l?.dataValueType===y.r.Lookup?t[r]=null:t[r]=a}}),(0,o.of)(t)}_checkFilteringAttributes(e,t){if(t.some(r=>(0,v.isNil)(r.name)))throw new Error(`Filtering attributes for ${e} are not valid!`)}_attributeGenerate(e,t){return this._attributeGenerator.generate(this,e,{...t,onChangeAttributeValue:(s,r,i)=>{this._fireChangeAttributeEvent({type:J.ChangeAttributeValue,payload:{attributeName:s,value:r,oldValue:i,silent:this._viewModelAttributeChangeEventOptions.getAsSilent()}})}})}_getDataSourceNamesAffectedByFilteringAttribute(e,t){return[...this._dataSourcesInfos.entries()].filter(([,s])=>s.isCollection).filter(([s])=>{const r=this.getModelByName(s);return t.has(r?.name)||r?.isLoaded||r?.isLoading}).filter(([s,r])=>{const i=r.getFilteringConfig(),a=i.some(l=>l?.name===e&&l?.loadOnChange);return a&&this._checkFilteringAttributes(s,i),a}).map(([s])=>s)}_createRequestsForReloadingDataSources(e){return e.map(t=>({type:"crt.LoadDataRequest",$context:this,dataSourceName:t,config:{loadType:q.Reload}}))}_dispatchStartLoadModelAttributes(e){const t=`${je.AttributeLoading}_${this._context?.id}_${Object.keys(e)}`;this._measurePerformancePageLoadService?.addTask(t,{targetTask:!0}),this._replayEvents$.next({type:J.StartLoadModelAttributes,payload:e})}_dispatchFinishLoadModelAttributes(e){const t=`${je.AttributeLoading}_${this._context?.id}_${Object.keys(e)}`;this._measurePerformancePageLoadService?.removeTask(t,{targetTask:!0}),this._replayEvents$.next({type:J.FinishLoadModelAttributes,payload:e})}_processEmptyLoadDataForCollection(e,t){var s=this;return(0,S.A)(function*(){if(!e.isCollection||!e.collectionViewModelAttributeName)return;const r=t.find(d=>d.type===P.PrimaryColumnValue);if(!r)return;const i=r.value?.value,a=s.attributes[e.collectionViewModelAttributeName];if(!i||!a)return;const l=yield a.findByPrimaryAttribute(i);l&&a.remove(l)})()}_loadDynamicModel(e){const t=e.attributeName,s=e.dataSourceConfig,r=e.dataSourceName||gs.createDynamicDataSourceNameFromAttributeName(this,t),i=gs.createAttributeConfig(this,r,e),a=this._createAndSetDataSourceInfo(r,t,i);return this._defineOrUpdateAttribute(t,i),this._setupSortingAttribute(e.sortingConfig),this._setupFiltersAttributes(e.filtersConfig),this._modelGenerator.generateOne(s,r).pipe((0,u.tap)(l=>this._markModelAsCollection(l,a)),(0,u.tap)(l=>this._dynamicModelNames.add(l.name)),(0,u.tap)(l=>this._upsertModel(r,l)),(0,u.tap)(l=>this._addModelDependencies(l,e.dependencies)),(0,u.switchMap)(l=>(0,o.forkJoin)([(0,o.of)(l),this._addDataSchemaToDataSchemas(l)])),(0,u.switchMap)(([l])=>(0,o.forkJoin)([(0,o.of)(l),(0,o.of)(this._replaceAttributesToDataSourceNameMap(a))])),(0,u.switchMap)(([l])=>(0,o.forkJoin)([(0,o.of)(l),this._reGenerateResourcesAttributes()])),(0,u.switchMap)(([l])=>this._loadModelData({model:l,dataSourceInfo:a,parametersConfig:[],loadType:q.Reload,useLastLoadParameters:e.useLastLoadParameters}).pipe(this._measurePerformanceService.measure$(`ViewModel.loadDynamicModel.${this._injectionContext?.id}.parent.${!!this.parent}.datasourceName.${e.dataSourceName}`))))}_defineOrUpdateAttribute(e,t){this.attributes[e]?this._attributeConfigs[e]=t:this._attributeGenerate({[e]:t})}_createAndSetDataSourceInfo(e,t,s){const i=Ue.getFromViewModelConfig({attributes:{[t]:s}}).get(e);return this._dataSourcesInfos.set(e,i),i}_setupSortingAttribute(e){if(!e?.default)return;const t=e.attributeName;this.attributes[t]=e.default}_setupFiltersAttributes(e){e?.forEach(t=>{if(!t.value)return;const s=t.name,r=t.value;this[s]=r.value||r})}_addModelDependencies(e,t){this._modelDependencies[e.name]=t||[]}_addDataSchemaToDataSchemas(e){return e.getSchema().pipe((0,u.tap)(t=>this.dataSchemas[e.name]=t))}_reGenerateResourcesAttributes(){return(0,o.forkJoin)([...this._generateResourceAttribute(),(0,o.of)(null)])}_replaceAttributesToDataSourceNameMap(e){const t=this._getDataSourceAttributesMap(e),s=[...Array.from(this._attributesToDataSourceNameMap.entries()),...t];this._initializeAttributesToDataSourceNameMap(s)}_getMappedAttributeName(e,t){if(!e)return"";const s=e.getMappedAttributeNames(t);return!s||s.length===0?"":s[0]}_getMappedAttributeNames(e,t){return e?e.getMappedAttributeNames(t):[]}_getModelAttributesToLoad(e,t){const s=this._dataSourcesInfos.get(e.name);if(t?.attributes){const r=t.attributes.filter(i=>{const a=this._getMappedAttributeName(s,i);return!this.getIsDirty(a)});return this._getModelDependentAttributes(e,r)}return s.attributes.map(r=>r.path)}_loadStaticModel(e,t,s,r,i,a){const l=this.getModelByName(e),d=this._dataSourcesInfos.get(l.name);return this._loadModelData({model:l,dataSourceInfo:d,parametersConfig:t,loadType:s,payload:r,useLastLoadParameters:i,doNotUpdateLastLoadParameters:a})}_waitDataDelay(e){return this._viewModelDataDelayerService?.shouldBeDelayed()?(0,o.of)(e).pipe((0,u.delayWhen)(()=>this._viewModelDataDelayerService.loadTrigger$)):(0,o.of)(e)}_updateTrackedAttributes(e){const t=this._modelDependencies[e.name];if(!t||!e.isAggregate)return;const s=/^.{0,2}\[\w+:\w+(:\w+)?]/;t.forEach(r=>{const i=r.relationPath.split(".")[0],a=this.getModelByName(i),l=e.affectedAttributes.filter(h=>h.schemaName===a.dataSchemaName).map(h=>h.path.split(".")[0]).filter(h=>!s.test(h)),d=new Set([...r.trackByAttributes??[],...l]);r.trackByAttributes=[...d.values()]})}_waitForModelLoad(e){var t=this;return(0,S.A)(function*(){const s=t.getModelByName(e);!s||s?.isLoaded||s.mode===A.Create||s.mode===A.Copy||(yield(0,o.firstValueFrom)(t._modelLoaded$.pipe((0,u.filter)(r=>r===e),(0,u.take)(1))))})()}_waitForModelsLoad(e){var t=this;return(0,S.A)(function*(){if(e.length===0||t._isDesignTime)return;const s=e.map(r=>t._waitForModelLoad(r));yield Promise.all(s)})()}_getAffectedAttributes(e,t,s){const i=this.dataSchemas[e].primaryAttributeName,a=[...t];return i&&!t.includes(i)&&s?.length>0&&s?.[0][i]&&a.push(i),a}_getModelLoadParameters(e,t,s,r,i,a){return this._modelParametersBuilder.getModelLoadParameters(this,e,t,s,{payload:r,useLastLoadParameters:i,doNotUpdateLastLoadParameters:a}).catch(l=>(console.error(l),this._showNotification({message:l.message}),[[{type:P.Never}],{},{}]))}_getRelationTypeForRootModel(e){if(this._featureValues.DisableMultipleDataSources||this._isDesignTime)return null;const t=this._modelDependencies[e],s=Ct(this.getModelByName(e));if(t?.length!==1||!this._primaryModelName||!s)return null;const r=this.dataSchemas[this._primaryModelName],i=t[0],a=i.relationPath.split("."),l=a.shift(),d=a.shift();return l!==this._primaryModelName?null:Da(this.dataSchemas[e],i.attributePath,r,d)}_isManyToOneRootModelRelation(e){return this._getRelationTypeForRootModel(e)===L.ManyToOne}_isOneToManyRootModelRelation(e){return this._getRelationTypeForRootModel(e)===L.OneToMany}_getOneToManyRelationDefaultValues(e){const t=this._modelDependencies[e]?.[0];if(!t)return{};const s=this.dataSchemas[this._primaryModelName],r=this.getViewModelAttributePaths(this._primaryModelName,s.primaryAttributeName)?.[0],i=this.getViewModelAttributePaths(this._primaryModelName,s.primaryDisplayAttributeName)?.[0];return{[t.attributePath]:{value:this.attributes[r],displayValue:this.attributes[i]}}}_getDependOnModelLoadConfiguration(e){const t=this._getDependOnModelsNames(e),s={};return t.forEach(r=>{this._modelSourceRecordId[r]&&(s[r]={[this.dataSchemas[r].primaryAttributeName??"Id"]:this._modelSourceRecordId[r]})}),s}_isPrimaryModel(e){return this._primaryModelName===e}_isIndependentRootModel(e){return Ct(e)?this._getDependOnModelsNames(e.name).length===0:!1}_checkAndProcessPageDataSourceData(e,t){if(this._featureValues.DisableMultipleDataSources||this._isDesignTime)return(0,o.of)(t);if(this._isManyToOneRootModelRelation(e.name)&&t.length===0)return this._clearModelValues(e.name),e.setLoadedState(),(0,o.of)(t);const r=this._isOneToManyRootModelRelation(e.name),i=this._isIndependentRootModel(e);if(!(r&&t.length===0||i&&t.length===0&&!this._isPrimaryModel(e.name)))return(0,o.of)(t);e.resetMode();const l=this._getOneToManyRelationDefaultValues(e.name);if(this.PrimaryModelMode===A.Copy){const d=this.dataSchemas[e.name].primaryAttributeName??"Id",h=this._getDependOnModelLoadConfiguration(e.name);return(0,o.from)(this.getDataSourceLoadParameters(e.name,h)).pipe((0,u.switchMap)(({parameters:p,options:f})=>e.load({attributes:[d],parameters:p,options:{loadType:q.Reload,pagingConfig:f.pagingConfig,sortingConfig:f.sortingConfig}})),(0,u.switchMap)(p=>{e.resetMode();const f=p?.length?p[0][d]:null;return f?this.copy(e.name,f,l):this.create(e.name,l)}),(0,u.map)(()=>t))}return this.create(e.name,l).pipe((0,u.map)(()=>t))}_loadModelData({model:e,dataSourceInfo:t,parametersConfig:s,loadType:r,payload:i,useLastLoadParameters:a,doNotUpdateLastLoadParameters:l}){const d=e.name;this._modelsRequestedToLoad.add(d);const h=this._getModelAttributesToLoad(e,i),p=i?.attributes;if(p&&h.length===0)return(0,o.of)([]);if(this._conflictedModels.includes(d))return(0,o.of)([]);const f=this._getDataSourceMappingAttributes(t,h),C=this._getLoadTypeForDataSource(t,r);if(C===q.LoadNext&&this._loadedDataSources.has(d))return(0,o.of)([]);this._dispatchStartLoadModelAttributes(f);const B=!this._isSyncForModelAllowed(e)||p===null||e.mode===A.Init,ne=this._getDependOnModelsNames(d);return this._checkAndLoadUnloadedDependOnModels(ne),(0,o.from)(this._waitForModelsLoad(ne)).pipe((0,u.switchMap)(I=>this._getModelLoadParameters(t,s,C,i,a,l)),(0,u.mergeMap)(I=>this._waitDataDelay(I)),(0,u.switchMap)(([I,K,Ho])=>e.load({attributes:h,parameters:I,options:{loadType:r,pagingConfig:K,sortingConfig:Ho}}).pipe(this._measurePerformanceService.measure$(`ViewModel.loadStaticModel.model.load.${this._injectionContext?.id}.parent.${!!this.parent}.modelName.${d}`),(0,u.catchError)(he=>this._handleLoadErrorResponse(he,[])),(0,u.tap)(()=>this._updateTrackedAttributes(e)),(0,u.tap)(he=>{he.length<K?.rowCount?this._loadedDataSources.add(d):this._loadedDataSources.delete(d)}),(0,u.tap)(he=>{he.length===0&&this._dispatchFinishLoadModelAttributes(f)}),(0,u.mergeMap)(he=>he.length===0?(0,o.from)(this._processEmptyLoadDataForCollection(t,I)).pipe((0,u.map)(()=>he)):(0,o.of)(he)),(0,u.switchMap)(he=>this._checkAndProcessPageDataSourceData(e,he)))),(0,u.map)(I=>({data:I,viewModelAttributes:t.getModelDto(I)})),(0,u.switchMap)(({data:I,viewModelAttributes:K})=>this.setValue(K,{collectionLoadType:C===q.Reload?Es.Reload:Es.Merge,silent:!0}).pipe((0,u.tap)(()=>{!t.isCollection||!K||Object.keys(K).forEach(Ho=>{this.attributes[Ho]?.forEach(qp=>{qp.formApiModel.updateValueAndValidity()})})}),(0,u.tap)(()=>this._markAsPristine(K)),(0,u.map)(()=>I))),(0,u.tap)(()=>this._modelLoaded$.next(d)),(0,u.switchMap)(I=>this._runBusinessRulesForModel(e,I)),(0,u.tap)(I=>{const K=this._getAffectedAttributes(d,h,I);this._reloadDependentModels(e,K,Ee.Page),B||this._reloadDependentModels(e,K,Ee.ViewElement)}),(0,u.tap)(I=>{const K=I[0]??{};e.setLoadedState(Object.keys(K)),this._dispatchFinishLoadModelAttributes(f)}))}_checkAndLoadUnloadedDependOnModels(e){const t=e.filter(s=>{const r=!this._modelsRequestedToLoad.has(s),i=!Ct(this.getModelByName(s));return r&&i});this._requestReloadModels(t)}_createChangeAttributeTriggers(e){return e.map(t=>({type:H.ChangeAttributeValue,name:t,scopeId:""}))}_runBusinessRulesForModel(e,t,s=!1,r=[]){const i=this._dataSourcesInfos.get(e.name);if(i.isCollection||!this._businessRulesProcessingEnabled||!this._businessRulesActive)return(0,o.of)(t);const a=t[0]??{},l=s?[...i.mappedViewModelAttributes]:Object.keys(a).flatMap(f=>this._getMappedAttributeNames(i,f)).filter(f=>f!=null),d=this._createChangeAttributeTriggers(l),h={type:H.DataLoaded,name:e.name,scopeId:""},p=this.models.filter(f=>f!==e).filter(f=>f.mode!==A.Init).filter(f=>f.getDataSource().scope===Ee.Page).map(f=>this._getModelBusinessRuleContext(f.name,[]));return(0,o.forkJoin)([this._getModelBusinessRuleContext(i.name,[h,...r]),...p,(0,o.of)(this._getViewModelBusinessRuleContext([...d,...r,h]))]).pipe(this._measurePerformanceService.measure$(`ViewModel.runBusinessRulesForModel.${this._injectionContext?.id}.parent.${!!this.parent}`),(0,u.switchMap)(f=>this._runBusinessRulesForContexts(f)),(0,u.map)(()=>t))}_runInitialBusinessRules(){if(!this._businessRulesProcessingEnabled||!this._businessRulesActive)return(0,o.of)(null);const e={type:H.ContextReady,name:null,scopeId:""};return this._prepareBusinessRulesContexts([e]).pipe(this._measurePerformanceService.measure$(`ViewModel.runInitialBusinessRules.${this._injectionContext?.id}.parent.${!!this.parent}`),(0,u.mergeMap)(t=>t.length===0?(0,o.of)(null):this._runBusinessRulesForContexts(t)))}_createViewModelAttributesValues(e,t){const s=Object.entries(this.dataSchemas),[,r]=s.find(([a])=>a===e),i={};for(const a of r.attributes){const l=t[a.name],d=this.getViewModelAttributePath(e,a.name);d&&(i[d]=l??null)}return i}_createModelData(e,t){const s=this._dataSourcesInfos.get(e),r=this._getDataSourceMappingAttributes(s);this._dispatchStartLoadModelAttributes(r);const i=this.getModelByName(e),a=i.disableSync,l=this._getModelAttributesToLoad(i,null);return i.disableSync=!0,i.create(t).pipe((0,u.switchMap)(d=>{const h=this._createViewModelAttributesValues(e,d),p=this._isOneToManyRootModelRelation(e)?{silent:!0}:null;return this.setValue(h,p).pipe((0,u.tap)(()=>this._forEachControl(h,f=>{f.markAsPristine(),f.markAsUntouched()})))}),(0,u.tap)(()=>{i.disableSync=a,this._modelLoaded$.next(e)}),(0,u.switchMap)(()=>this._runBusinessRulesForModel(i,[],!0)),(0,u.tap)(()=>{this._isSyncForModelAllowed(i)&&this._reloadDependentModels(i,l)}),(0,u.tap)(()=>{this._dispatchFinishLoadModelAttributes(r),i.setLoadedState()}),(0,u.map)(()=>null))}_copyModelData(e,t,s){const r=this._dataSourcesInfos.get(e),i=this._getDataSourceMappingAttributes(r);this._dispatchStartLoadModelAttributes(i);let a;const l=this.getModelByName(e),d=this._getModelAttributesToLoad(l,null),h=l.disableSync;return l.disableSync=!0,this._modelSourceRecordId[e]=t,l.copy(t,s).pipe((0,u.catchError)(p=>this._handleLoadErrorResponse(p,{})),(0,u.map)(p=>({data:[p],viewModelAttributes:r.getModelDto([p])})),(0,u.switchMap)(({data:p,viewModelAttributes:f})=>this.setValue(f).pipe((0,u.tap)(()=>this._markAsPristine(f)),(0,u.map)(()=>p))),(0,u.tap)(()=>{l.disableSync=h,this._modelLoaded$.next(e)}),(0,u.switchMap)(p=>this._runBusinessRulesForModel(l,p,!0)),(0,u.tap)(()=>{this._isSyncForModelAllowed(l)&&this._reloadDependentModels(l,d)}),(0,u.tap)(()=>{this._dispatchFinishLoadModelAttributes(i),l.setLoadedState()}),(0,u.mergeMap)(()=>(0,o.of)(a)))}_getDataSourceMappingAttributes(e,t=null){const s=t??e.attributes.map(i=>i.path),r=Object.fromEntries(s.map(i=>[this._getMappedAttributeName(e,i),!0]));return e.collectionViewModelAttributeName&&(r[e.collectionViewModelAttributeName]=!0),r}_handleLoadErrorResponse(e,t){return console.error(e),this._showNotification({message:e.message,duration:1e4}),(0,o.of)(t)}_canExecuteBusinessRulesByModelAttributeValue(e,t,s){return t&&e?this._isModelAttributeValueValid(e,t,s):!0}_canExecuteBusinessRulesByViewModelAttributeValue(e,t){const s=this._getDataSourceInfoByViewModelAttributePath(e);if(s){const r=s.getDataSourceAttributePath(e);return this._canExecuteBusinessRulesByModelAttributeValue(s,r,t)}return!0}_getContextAttributeValue(e){return e instanceof Date?mi(e):e}_getNormalizedContextAttributeValue(e,t,s){const r=e;return y.r[t]===y.r.Lookup||r?.displayValue?r?.value??e:s===!0||!t?e:[y.r.RICH_TEXT,y.r.Image].includes(y.r[t])?null:y.r[t]===y.r.MAXSIZE_TEXT&&e?e.slice(0,500):e}_getHasValueContextAttributeValue(e,t){return!!(t&&y.r[t]===y.r.Boolean||e!=null&&e!=="")}_getViewModelAttributeInfos(e,t,s){return Object.keys(t).filter(r=>!(t[r]instanceof $e)).map(r=>{if(t[r]instanceof It)return this._getViewModelAttributeInfos(e?`${e}.${r}`:r,t[r]?.attributes??{},s);const i=this._attributeConfigs[r]?.dataValueTypeName,a=this._getContextAttributeValue(t[r]),l=this._getNormalizedContextAttributeValue(a,i,s);return{name:e?`${e}.${r}`:r,value:l??null,displayValue:t[r]?.displayValue,dataValueTypeName:i,hasValue:this._getHasValueContextAttributeValue(a,i)}}).flat()}_runBusinessRulesForContexts(e){const t=`${je.RunningBusinessRules}-${O()}`;return this._onAsyncTaskStarted(t),(0,o.of)(e).pipe(this._measurePerformanceService.measure$(`ViewModel.runBusinessRules.${this._injectionContext?.id}.parent.${!!this.parent}`),(0,u.map)(s=>s?.filter(r=>!(0,v.isNil)(r))??[]),(0,u.mergeMap)(s=>{if(s.length===0)return(0,o.of)(null);const r=s.map(i=>({scopeName:i.scopeName,scopeId:i.scopeId,scopeType:i.scopeType,triggers:i.triggers}));return this._toggleControlsAffectedByBusinessRules(!1,r),this._businessRulesEngine.execute(s).pipe(this._measurePerformanceService.measure$(`ViewModel.runBusinessRules.execute.${this._injectionContext?.id}.parent.${!!this.parent}`),(0,u.tap)(i=>{i.forEach(a=>{const l=r.find(d=>d.scopeId===a.scopeId&&d.scopeName===a.scopeName&&d.scopeType===a.scopeType);a.triggers=l?.triggers??[]})}),(0,u.switchMap)(i=>i?this._businessRulesApplier.applyRules(this,i):(0,o.of)(null)),(0,u.tap)(()=>{this._toggleControlsAffectedByBusinessRules(!0,r)}))}),(0,u.tap)(()=>this._onAsyncTaskFinished(t)))}_createViewModelContext(e,t){return{scopeType:_e.ViewModel,scopeName:this._scopeName,scopeId:this._scopeName,scopeState:Qe.Unknown,parentScopeId:null,attributes:t,triggers:e}}_getViewModelBusinessRuleContext(e){const t=this._featureValues["BRules-EnableCompareLargeAttributeValues"],s=this._getViewModelAttributeInfos(null,this.attributes,t);return this._createViewModelContext(e,[...s].map(r=>({attributeName:r.name,value:r.value,displayValue:r.displayValue,dataValueTypeName:r.dataValueTypeName,hasValue:r.hasValue})))}_prepareModelBusinessRuleTrigger(e,t){return t.map(s=>{if(s.type===H.DataLoaded||s.type===H.ContextReady)return s;const r=this._getDataSourceInfoByViewModelAttributePath(s.name);return!r||r.name!==e?null:{type:H.ChangeAttributeValue,name:r.getDataSourceAttributePath(s.name),scopeId:""}}).filter(s=>s!=null)}_getModelContextScopeStateType(e){switch(e.mode){case A.Init:return Qe.Init;case A.Create:return Qe.Create;case A.Copy:return Qe.Copy;case A.Update:return Qe.Update;default:return Qe.Unknown}}_getModelBusinessRuleContext(e,t){const s=this._dataSourcesInfos.get(e),r=this.getModelByName(e),i=this.dataSchemas[e],a=this._prepareModelBusinessRuleTrigger(e,t),l=this._getModelContextScopeStateType(r);return this._getDataSourceDto(e).pipe((0,u.map)(d=>({...r._getPersistedState(),...d})),(0,u.map)(d=>({enableCompareLargeAttributeValues:this._featureValues["BRules-EnableCompareLargeAttributeValues"],modelDto:d})),(0,u.map)(({enableCompareLargeAttributeValues:d,modelDto:h})=>Object.entries(h).map(([p,f])=>{let C;const B=this._getMappedAttributeName(s,p);if(B)C=this._attributeConfigs[B]?.dataValueTypeName;else{const K=i.findAttributeByName(p);C=y.r[K.dataValueType]}const ne=this._getContextAttributeValue(f),I=this._getNormalizedContextAttributeValue(ne,C,d);return{attributeName:p,value:I,displayValue:f?.displayValue,dataValueTypeName:C,hasValue:this._getHasValueContextAttributeValue(ne,C),isSignificant:p===i.primaryAttributeName}})),(0,u.map)(d=>({scopeType:_e.Model,scopeName:r.dataSchemaName,scopeId:e,scopeState:l,parentScopeId:this._scopeName,attributes:d,triggers:a,modelType:r.getDataSource()?.type})))}_prepareDataSourceNamesForBusinessRules(){return this._modelsMap.size===0?[]:[...this._modelsMap.values()].filter(e=>!this._dataSourcesInfos.get(e.name).isCollection).map(e=>e.name)}_getModelsBusinessRuleContexts(e){return this._prepareDataSourceNamesForBusinessRules().map(s=>s?this._getModelBusinessRuleContext(s,e):(0,o.of)(null))}_prepareBusinessRulesContexts(e){const t=this._getModelsBusinessRuleContexts(e);if(!this._scopeName)return t.length===0?(0,o.of)([]):(0,o.forkJoin)([...t]);const r=[(0,o.of)(this._getViewModelBusinessRuleContext(e)),...t];return r.length===0?(0,o.of)([]):(0,o.forkJoin)(r)}_isAttributeChange(e){return!e.attributeName?.includes(":")}_businessRulesSubscribeOnChangeAttributes(){if(!this._businessRulesProcessingEnabled||this._isDesignTime)return;const e=this.events$.pipe((0,u.filter)(()=>this._businessRulesActive),(0,u.filter)(s=>s.type===J.ChangeAttributeValue),(0,u.filter)(s=>this._isAttributeChange(s.payload)),(0,u.filter)(s=>!s.payload.silent),(0,u.filter)(s=>!s.payload?.preventRunBusinessRules),(0,u.filter)(s=>{const r=s.payload;return this._canExecuteBusinessRulesByViewModelAttributeValue(r.attributeName,r.value)}),(0,u.filter)(s=>{const r=s.payload,i=this._getAttributeDataValueTypeName(r.attributeName);return i&&Ti(i)===y.r.Lookup?r.value?.value!==r.oldValue?.value:!0}),(0,u.map)(s=>s.payload.attributeName)),t=e.pipe((0,u.tap)(()=>this._onAsyncTaskStarted(je.DebouncingBusinessRules)),(0,u.buffer)(e.pipe((0,u.debounceTime)(Fp))),(0,u.map)(s=>Array.from(new Set(s))),(0,u.map)(s=>this._createChangeAttributeTriggers(s)),(0,u.mergeMap)(s=>this._prepareBusinessRulesContexts(s)),(0,u.tap)(()=>this._onAsyncTaskFinished(je.DebouncingBusinessRules)),(0,u.filter)(s=>s.length>0),(0,u.mergeMap)(s=>this._runBusinessRulesForContexts(s)));this._subscriptions.add(t.subscribe())}_subscribeOnChangeAttributes(){const e=this.events$.pipe((0,u.filter)(t=>t.type===J.ChangeAttributeValue),(0,u.map)(t=>t),(0,u.map)(t=>{const s=this.getBoundDataSourceNameByAttributePath(t.payload.attributeName),r=this._dataSourcesInfos.get(s)?.attributesMap.get(t.payload.attributeName),i=this.getBoundDataSchemaAttributeByAttributePath(t.payload.attributeName);return{changeEvent:t,model:this.getModelByName(s),modelAttributeInfo:{name:i?.name??r,isLookup:!!i?.isLookup}}}),(0,u.filter)(({model:t,modelAttributeInfo:s})=>!!(t&&s.name)),(0,u.tap)(({changeEvent:t,model:s,modelAttributeInfo:r})=>{const i=t.payload,a=r.isLookup,l=a?i.oldValue?.value:i.oldValue,d=a?i.value?.value:i.value;l!==d&&s?.attributeChanged(r.name,i?.preventStateChange??i?.silent)}));this._subscriptions.add(e.subscribe())}_getHasRelation(e,t,s){return e.map(i=>{const a=i.relationPath.split("."),l=i.trackByAttributes??[],d=a.shift(),h=a.shift();return l.push(h),{rootModelName:d,trackedAttributes:l}}).filter(({rootModelName:i})=>i===t).filter(({trackedAttributes:i})=>this._dataSourcesInfos.get(t).isCollection?!0:s.some(a=>i.includes(a))).length!==0}_getDependentModelsNames(e,t=[]){return e?Object.entries(this._modelDependencies).filter(([s])=>s!==e).filter(([,s])=>this._getHasRelation(s,e,t)).map(([s])=>s).map(s=>[s,...this._getDependentModelsNames(s)]).flat():[]}_getIsModelDataChanged(e){if(!this.getModelByName(e)?.isLoaded)return!1;const s=this._dataSourcesInfos.get(e);if(s.isCollection){const i=s.collectionViewModelAttributeName,a=this.attributes[i];return a?a.isChanged:!1}return s.getMappedAttributes().some(i=>this.getIsDirty(i))}_requestReloadModels(e){this._createRequestsForReloadingDataSources(e).forEach(s=>{this._ngZone.runOutsideAngular(()=>this.processRequest(s))})}_isModelAttributeValueValid(e,t,s){return this._getDataSourceAttributeSchema(e,t)?.dataValueType===y.r.Lookup?nh(s):!0}_canReloadModelDependentData(e,t){return e.canReloadDependentData(t)?!0:this._conflictedModels.includes(e.name)?!1:this._getDependentModelsNames(e.name,[t]).length>0}_getModelDependentAttributes(e,t){return[...t,...t.map(s=>e.getDependentAttributesNames(s)).flat()]}_getChangedModelsNames(e){return e.filter(t=>this._getIsModelDataChanged(t))}_showNotification(e){this._ngZone.runOutsideAngular(()=>this.processRequest({type:"crt.NotificationRequest",$context:this,...e}))}_isSyncForModelAllowed(e){return e.allowSync}_subscribeOnReloadDataEvents(){if(this._isDesignTime)return;const e=this.events$.pipe((0,u.filter)(()=>this._modelSynchronizationEnabled),(0,u.filter)(t=>t.type===J.ChangeAttributeValue),(0,u.filter)(t=>t.payload.silent!==!0),(0,u.map)(t=>({modelName:this.getBoundDataSourceNameByAttributePath(t.payload.attributeName),attributeName:t.payload.attributeName,attributeValue:t.payload.value})),(0,u.filter)(({modelName:t})=>t!=null),(0,u.map)(({modelName:t,attributeName:s,attributeValue:r})=>{const i=this._dataSourcesInfos.get(t),a=i?.attributesMap.get(s);return{model:this.getModelByName(t),dataSourceInfo:i,modelAttribute:a,attributeValue:r}})).pipe((0,u.filter)(({model:t})=>t!=null),(0,u.filter)(({dataSourceInfo:t})=>!t.isCollection),(0,u.filter)(({model:t})=>this._isSyncForModelAllowed(t)),(0,u.filter)(({dataSourceInfo:t,modelAttribute:s,attributeValue:r})=>this._isModelAttributeValueValid(t,s,r)),(0,u.filter)(({model:t,modelAttribute:s})=>this._canReloadModelDependentData(t,s))).pipe((0,u.tap)(({model:t,dataSourceInfo:s,modelAttribute:r,attributeValue:i})=>{const a=this._getModelDependentAttributes(t,[r]),l=Object.fromEntries(a.map(d=>[this._getMappedAttributeName(s,d),!0]));this._dispatchStartLoadModelAttributes(l),t.reloadDependentData(r,i).pipe((0,u.switchMap)(d=>{if(d.length===0)return(0,o.of)(d);const h=s.getModelDto(d);return this.setValue(h,{silent:!0}).pipe((0,u.switchMap)(()=>this._runBusinessRulesForModel(t,d)))}),(0,u.tap)(()=>this._reloadDependentModels(t,[r])),(0,u.tap)(()=>this._dispatchFinishLoadModelAttributes(l))).subscribe()}));this._subscriptions.add(e.subscribe())}_subscribeOnChangeRequests(){const e=this.events$.pipe((0,u.filter)(t=>t.type===J.ChangeAttributeValue),(0,u.mergeMap)(t=>{const s=t.payload.attributeName,r=this._attributeConfigs[s];return Array.isArray(r?.change)?r.change:[r?.change]}),(0,u.filter)(t=>t!=null),(0,u.map)(t=>({type:t.request,$context:this,scopes:this._scopeName?[this._scopeName]:[],...t.params})),(0,u.tap)(t=>this._ngZone.runOutsideAngular(()=>this.handlerChain.process(t))));this._subscriptions.add(e.subscribe())}_subscribeOnFilteringEvents(){const e=new Set;this._subscriptions.add(this._modelLoaded$.pipe((0,u.tap)(s=>{e.add(s)})).subscribe());const t=this.events$.pipe((0,u.filter)(s=>s.type===J.ChangeAttributeValue),(0,u.map)(s=>{const r=s.payload.attributeName;return this._getDataSourceNamesAffectedByFilteringAttribute(r,e)}),(0,u.map)(s=>this._createRequestsForReloadingDataSources(s)),(0,u.tap)(s=>{s.forEach(r=>{this._ngZone.runOutsideAngular(()=>this.processRequest(r))})}));this._subscriptions.add(t.subscribe())}_saveModel(e,t,s){const r="MODEL_SAVING";this.maskService.showMask(r,this);const i=this._getBoundDataSourceAttributeControls(e);return Object.keys(i).forEach(a=>this.formApiModel.controls[a].updateValueAndValidity()),this._saveModelAndGetDataSourceSaveResult(e,t).pipe((0,u.finalize)(()=>this.maskService.hideMask(r,this)),(0,u.catchError)(a=>{const l=typeof a=="string"?a:a?.message||a?.errorInfo;return s?.silent===!0?(0,o.of)({success:!1,rowsAffected:0,errorInfo:l}):(0,o.throwError)(()=>new Error(l))}))}_saveModelAndGetDataSourceSaveResult(e,t){return(0,o.from)(this.isValid(e)).pipe((0,u.switchMap)(s=>{if(!s){const a=this.injector.get(T.TranslateService);return(0,o.of)({success:!1,rowsAffected:0,errorInfo:a.instant("HomePage.DialogMessages.RequiredFieldsAreNotFilled")})}const r=this.getModelByName(e),i=r.mode;return(0,o.forkJoin)({parameters:this._modelParametersBuilder.getModelParameters(this,t),dto:this._getDataSourceDto(e)}).pipe((0,u.mergeMap)(({parameters:a,dto:l})=>(0,o.forkJoin)({result:r.insertOrUpdate(l,a),dto:(0,o.of)(l)})),(0,u.tap)(({result:a,dto:l})=>{const d=i===A.Create||i===A.Copy,h=this.dataSchemas[e],p=h.dataSourceConfig?.type===Oo.EntityDataSource;if(a.success&&d&&p){const f=h.primaryAttributeName,C=l[f];this._loadedDataSources.add(e),this._lastEventLoadParameters.set(e,[{type:P.PrimaryColumnValue,value:C}])}}),(0,u.map)(({result:a})=>a))}))}_deleteModel(e,t,s){return(0,o.from)(this._modelParametersBuilder.getModelParameters(this,t,s?.payload)).pipe((0,u.mergeMap)(r=>this.getModelByName(e).delete(r)))}_initSubscriptions(){return this._measurePerformanceService.measure(`ViewModel.initSubscriptions.${this._injectionContext?.id}.parent.${!!this.parent}`,()=>(this._subscribeOnFilteringEvents(),this._subscribeModelsEvents(),this._subscribeOnChangeAttributes(),this._subscribeOnChangeRequests(),this._subscribeOnReloadDataEvents(),this._businessRulesSubscribeOnChangeAttributes(),this._subscribeOnChangeAttributesToHandleModelDependenciesConstrains(),this._subscribeOnPrimaryDisplayAttributeChangeForOneToManyRelation(),(0,o.of)(null)))}_subscribeOnPrimaryDisplayAttributeChangeForOneToManyRelation(){if(this._featureValues.DisableMultipleDataSources)return;const e=this.events$.pipe((0,u.filter)(t=>this._primaryModelName!=null),(0,u.filter)(t=>t.type===J.ChangeAttributeValue),(0,u.map)(t=>t),(0,u.map)(({payload:t})=>{const s=t.attributeName,r=t.value;return{modelName:this.getBoundDataSourceNameByAttributePath(s),attributeName:s,attributeValue:r}}),(0,u.filter)(({modelName:t})=>this._isPrimaryModel(t)),(0,u.filter)(({attributeName:t})=>{const s=this.getBoundDataSchemaByAttributePath(t),r=this.getBoundDataSchemaAttributeByAttributePath(t);return!s||!r?!1:s.primaryDisplayAttributeName===r.name}),(0,u.map)(({modelName:t,attributeValue:s})=>{const r=this.dataSchemas[this._primaryModelName],a=this._getDependentModelsNames(t,[r.primaryAttributeName]).filter(l=>this._isOneToManyRootModelRelation(l));return{primaryDisplayValue:s,dependentModelsNames:a}}),(0,u.filter)(({dependentModelsNames:t})=>t.length>0),(0,u.tap)(({dependentModelsNames:t,primaryDisplayValue:s})=>{const r=this.dataSchemas[this._primaryModelName],i=this.getViewModelAttributePaths(this._primaryModelName,r.primaryAttributeName)[0],a=this.attributes[i],l={};t.map(d=>{const p=this._modelDependencies[d][0].attributePath;return this.getViewModelAttributePaths(d,p)}).flat().forEach(d=>{l[d]={value:a,displayValue:s}}),this.setValue(l,{silent:!0,preventAttributeChangeRequest:!0,preventRunBusinessRules:!1,preventStateChange:!0})}));this._subscriptions.add(e.subscribe())}_getDataSchemas(){if(this.models&&this.models.length!==0){const e=this.models.map(t=>t.getSchema().pipe((0,u.map)(s=>[t.name,s])));return(0,o.combineLatest)(e).pipe((0,u.take)(1),(0,u.map)(t=>Object.fromEntries(t)))}return(0,o.of)({})}_setAttributesDefaultValues(e){var t=this;return(0,o.from)((0,S.A)(function*(){let s=Object.entries(t.dataSchemas);e&&(s=s.filter(([r])=>r===e));for(const[r,i]of s){const a={};for(const l of i.attributes){const d=yield(0,o.lastValueFrom)(l.defaultValue,{defaultValue:null});if(!(0,v.isNil)(d)){const h=t.getViewModelAttributePath(r,l.name);h&&(a[h]=d)}}t.setValue(a).subscribe()}})())}_generateDataSourcesInfo(){return this._dataSourcesInfos=Ue.getFromViewModelConfig(this.viewModelConfig,this.models),(0,o.of)(this._dataSourcesInfos)}_generateAttributesToDataSourceNameMap(e){const t=Array.from(e.values()).map(s=>this._getDataSourceAttributesMap(s)).flat();return this._initializeAttributesToDataSourceNameMap(t),(0,o.of)(this._attributesToDataSourceNameMap)}_initializeAttributesToDataSourceNameMap(e){this._attributesToDataSourceNameMap=new Map(e)}_getDataSourceAttributesMap(e){const s=e.getMappedAttributes().map(r=>[r,e.name]);return e.isCollection&&s.push([e.collectionViewModelAttributeName,e.name]),s}_checkDataSourceName(e){if(!e)throw new Error("Data source name is not provided")}_getDataSourceLoadType(e){return e?e||q.Reload:null}_getLoadTypeForDataSource(e,t){if(t===q.Load)return t;const s=e.getPagingConfig();return!t&&s?q.LoadNext:t}_loadDefaultSorting(e){this._measurePerformanceService.measure(`ViewModel._loadDefaultSorting.${this._injectionContext?.id}.parent.${!!this.parent}.dsNames.${e?.toString()}`,()=>{const t=Array.from(this._dataSourcesInfos.entries()).filter(([s])=>!e?.length||e.includes(s)).map(([,s])=>s.getSortingConfig()).filter(s=>!!s?.default).reduce((s,r)=>(s[r.attributeName]=r.default,s),{});this.setValue(t,{silent:!0}).subscribe()})}_getDropdownPageSize(){var e=this;return(0,S.A)(function*(){if(!(0,v.isEmpty)(e._dropdownPageSize))return e._dropdownPageSize;const t=yield e.sysSettingsService.getByCode(e._dropdownPageSizeSettingsCode);return e._dropdownPageSize={pagingConfig:{rowCount:t?.value,rowsOffset:0}},e._dropdownPageSize})()}_mergeCollectionModels(e,t){this._measurePerformanceService.measure(`ViewModel.mergeCollectionModels.${this._injectionContext?.id}.parent.${!!this.parent}.collection.${e}`,()=>{const s=this.attributes[e];this._featureValues.DisableBaseViewModelCollectionOptimization||s.length?s.merge(t):s.push(...t)})}_getEmbeddedModels(){const e=Object.entries(this.viewModelConfig?.attributes??{}).filter(([,r])=>r&&"embeddedModel"in r&&r.embeddedModel).map(([r,i])=>({attributeName:r,embeddedModel:i.embeddedModel}));if(e.length===0)return(0,o.of)([]);const t={},s=[];if(e.forEach(({attributeName:r,embeddedModel:{name:i,config:a}})=>{i?t[i]&&s.push(`Duplicated embedded model : ${i}.`):s.push(`Embedded model name is not provided for ${r}.`),t[i]=a}),s.length>0)throw new Error(s.join(" "));return this._modelGenerator.generate({dataSources:t},this.injector)}_concatModelsWithEmbedded(e=null){return this._getEmbeddedModels().pipe((0,u.map)(t=>{const s=[...e??[],...t??[]],r=s.map(i=>i.name).filter((i,a,l)=>l.indexOf(i)!==a);if(r.length>0)throw new Error(`Duplicated model names found : ${r.join(",")}.`);return s}))}_updateModelsMap(){const e=this.models.map(t=>[t.name,t]);this._modelsMap=new Map(e)}_subscribeModelsChanges(){this._subscriptions.add(this._models$.subscribe(()=>this._updateModelsMap()))}_subscribeModelsEvents(){this._isDesignTime||this.models.forEach(e=>this._subscribeModelEvents(e))}_subscribeModelEvents(e){this._subscriptions.add(e.event$.pipe((0,u.mergeMap)(t=>this._waitDataDelay(t)),(0,u.mergeMap)(t=>this._ngZone.runOutsideAngular(()=>this.processRequest({type:"crt.HandleModelEventRequest",$context:this,scopes:this._eventScopes,modelName:e.name,modelEvent:t})),1)).subscribe())}initDependencies(){this.formBuilder=this.injector.get(ge.FormBuilder),this.resourceFinderService=this.injector.get(rs),this.validatorTypeResolver=this.injector.get(Ln),this.maskService=this.injector.get(Rp),this.sysSettingsService=this.injector.get(ae),this.crtControlStateAdapter=this.injector.get(At),this._businessRulesEngine=this.injector.get(es),this._businessRulesApplier=this.injector.get(Zt),this._featureValues=this.injector.get(W),this._modelGenerator=this.injector.get(yr),this._ngZone=this.injector.get(c.NgZone),this._translateService=this.injector.get(T.TranslateService),this._scopeName=this.injector.get(On,null),this._attributeGenerator=this.injector.get(Br),this._attributeResourceGenerator=this.injector.get(kr),this._crtZoneService=this.injector.get(ko),this._viewEventZoneName=this.injector.get(wu,tt.Root),this._modelParametersBuilder=this.injector.get(jr),this._context=this.injector.get(op,null),this._crtInjectionContextService=this.injector.get(Is),this._viewModelDataDelayerService=this.injector.get(Bp,null),this._isDesignTime=this.injector.get(Tp,null),this._measurePerformanceService=this.injector.get(te,null),this._measurePerformancePageLoadService=this.injector.get(Or),this._appInfo=this.injector.get(me,null)}processRequest(e){return this.handlerChain.process(e)}_upsertModel(e,t){const s=[...this.models],r=s.findIndex(({name:i})=>i===e);r===-1?s.push(t):s.splice(r,1,t).forEach(i=>i.destroy()),this._subscribeModelEvents(t),this._models$.next(s)}_replaceDataSourceInfo(e,t){!e||!t||(this._loadedDataSources.has(e)&&this._loadedDataSources.delete(e),this._dataSourcesInfos.set(e,t),this._replaceAttributesToDataSourceNameMap(t))}_updateModels(e){e.forEach((t,s)=>{const r=this.getModelByName(s);r&&(this._markModelAsCollection(r,t),this._updateModelDependentAttributes(r,t))})}_markModelAsCollection(e,t){t.isCollection&&(e._isCollection=!0)}_updateModelDependentAttributes(e,t){const s=t.attributes.map(r=>({path:r.path,type:r.type}));e.updateDependentAttributes(s)}_initIsChangedAttribute(){this._systemAttributes.push(Fr),this.attributes[Fr]=!1;const e=this._models$.pipe((0,u.switchMap)(t=>t?.length?(0,o.combineLatest)(t.map(s=>s._dirty$)):(0,o.of)([])),(0,u.map)(t=>t.some(s=>s)),(0,u.filter)(()=>!this._viewModelAttributeChangeEventOptions.getOptions().preventStateChange),(0,u.distinctUntilChanged)()).subscribe(t=>{this._setSystemAttributeValue(Fr,t)});this._subscriptions.add(e)}_initHasUnsavedDataAttribute(){this._systemAttributes.push(qn),this.attributes[qn]=!1;const e=this.events$.pipe((0,u.filter)(a=>a?.type===J.ChangeAttributeValue&&a.payload?.attributeName===Fr),(0,u.map)(a=>a.payload.value)),t=(0,o.merge)(this.IsChanged,e),r=this._models$.pipe((0,u.map)(a=>a.map(l=>l._modeChanges$.pipe((0,u.map)(d=>({mode:d,name:l.name})),(0,u.startWith)({mode:l.mode,name:l.name})))),(0,u.switchMap)(a=>a?.length?(0,o.combineLatest)(a):(0,o.of)([]))).pipe((0,u.map)(a=>a.some(({mode:l,name:d})=>{const h=!this._isDesignTime&&!this._featureValues.DisableMultipleDataSources&&!this._isPrimaryModel(d)&&this._isIndependentRootModel(this.getModelByName(d)),p=this._isOneToManyRootModelRelation(d);return(l===A.Create||l===A.Copy)&&!p&&!h}))),i=(0,o.combineLatest)([t,r]).pipe((0,u.map)(([a,l])=>!!(a||l)),(0,u.distinctUntilChanged)()).subscribe(a=>{this._setSystemAttributeValue(qn,a)});this._subscriptions.add(i)}_initPrimaryModelModeAttribute(){const e=this._getPrimaryModelModeChanges();if(!e)return;this._systemAttributes.push(jo),this.attributes[jo]=this.getPrimaryModelMode();const t=e.pipe((0,u.startWith)(this.getPrimaryModelMode())).subscribe(s=>this._setSystemAttributeValue(jo,s));this._subscriptions.add(t)}_initStateAttribute(){this._systemAttributes.push(Hn),this.attributes[Hn]=Uo.Active}_initBusinessRulesActivatedAttribute(){if(this._systemAttributes.push($o),this.attributes[$o]=this._businessRulesAreActivated,this._businessRulesAreActivated)return;const e=this._businessRulesActivated$.pipe((0,u.filter)(t=>t===!0)).subscribe(t=>{this._setSystemAttributeValue($o,t)});this._subscriptions.add(e)}_initSystemAttributes(){var e=this;return(0,S.A)(function*(){yield e._measurePerformanceService.measureCallback(`ViewModel.initSystemAttributes.${e._injectionContext?.id}.parent.${!!e.parent}`,()=>(e._initIsChangedAttribute(),e._initPrimaryModelModeAttribute(),e._initHasUnsavedDataAttribute(),e._featureValues.DisableDelayingModelEvents||e._initStateAttribute(),e._initBusinessRulesActivatedAttribute(),Promise.resolve()))})()}_handleCircularDependencies(){const e=xp(this._modelDependencies);if(e.hasCycles){const t=this._translateService.instant("BaseViewModel.WarningModelsWithCircularDependencies");this._showNotification({message:t,duration:1e4}),console.warn(t,e.cycledModelsNames)}this._conflictedModels=e?.cycledModelsNames}_forEachControl(e,t){Object.keys(e).forEach(r=>{if(this.attributes[r]instanceof $e){const i=this.attributes[r],a=e[r];i.forEach(l=>{const d=l.primaryAttributeName,h=l.attributes[d],p=a.find(f=>f[d]===h);p&&l._forEachControl(p,t)})}else if(this.attributes[r]instanceof It)this.attributes[r]._forEachControl(e[r],t);else{const i=this.getControl(r);t(i.formControl)}})}_getModelsErrors(e){return(e??[]).filter(t=>!t.isCollectionItemModel&&t.hasErrors).map(t=>t.getLastError())}_notifyAboutModelsErrors(e){const t=this._getModelsErrors(e);if(t.length>0){const s=t.map(r=>r.message).join(" ");this._showNotification({message:s})}}_initFeaturesStates(){this._disableViewModelWaitingForAsyncTasks=this._featureValues.DisableViewModelWaitingForAsyncTasks,this._disableViewModelLoadUnblockingThread=this._featureValues.DisableViewModelLoadUnblockingThread,this._blockFieldsAffectedByBusinessRules=this._featureValues.BlockFieldsWhileRunBusinessRules,this._modelSynchronizationEnabled=!this._featureValues.ModelSynchronizationDisabled}_handleAsyncTasksCycle(e){let t=null;const s=100,r=Array.from(e).filter(i=>i.startsWith(je.ProcessingAttributeChangeRequest));if(!(!e.size||!r.length))return r.length&&(t=setTimeout(()=>{console.warn("[ViewModel]: Clearing executing tasks by exceeded timeout",r),r.forEach(i=>e.delete(i)),this._asyncTasksExecutingSubject.next(e)},s)),t}_getAffectedViewModelAttributes(e,t){return this.models.filter(r=>r.dataSchemaName===e).map(r=>r.name).flatMap(r=>this.getViewModelAttributePaths(r,t))}_toggleControlsAffectedByBusinessRules(e,t){if(!this._blockFieldsAffectedByBusinessRules)return;this._attributesAffectedByBusinessRules?.filter(r=>kh(this._scopeName,r,t))?.forEach(r=>{r.scopeName===this._scopeName?this.getControl(r.name).toggle(e):this._getAffectedViewModelAttributes(r.scopeName,r.name).forEach(a=>{this.getControl(a).toggle(e)})})}_initAttributesAffectedByBusinessRules(){var e=this;return(0,S.A)(function*(){const s=e._prepareDataSourceNamesForBusinessRules().filter(i=>!!i).map(i=>e.getModelByName(i)).map(i=>({scopeId:i.name,scopeName:i.dataSchemaName,scopeType:_e.Model,modelType:i.getDataSource()?.type})),r={scopeName:e._scopeName,scopeType:_e.ViewModel,scopeId:e._scopeName};e._attributesAffectedByBusinessRules=yield e._businessRulesEngine.getAffectedAttributes([r,...s])})()}_initBusinessRules(){var e=this;return(0,S.A)(function*(){return e._measurePerformanceService.measureCallback(`ViewModel.initBusinessRules.${e._injectionContext?.id}.parent.${!!e.parent}`,(0,S.A)(function*(){e._businessRulesProcessingEnabled=!e._featureValues.BusinessRulesProcessingDisabled&&e.viewModelConfig.supportBusinessRules!==!1,e._businessRulesProcessingEnabled&&(yield e._initAttributesAffectedByBusinessRules()),e._businessRulesAreActivated=e._businessRulesProcessingEnabled&&e._businessRulesActive!==!1,e._businessRulesActivated$.next(e._businessRulesAreActivated)}))})()}_attributeGenerate$(e,t){return(0,o.of)(this._featureValues.UseDesignerHotSwapViewModel).pipe((0,u.switchMap)(s=>s&&this._isDesignTime?this._initDataSourceValidators().pipe((0,u.tap)(()=>{this._initSchemaValidators(e)}),(0,u.switchMap)(()=>this._attributeGenerate(e,t))):this._attributeGenerate(e,t)))}_validateByDataSourceName(e){var t=this;return(0,S.A)(function*(){const s={},r=t._getBoundDataSourceAttributeControls(e);return yield Promise.all(Object.entries(r).map(([i,a])=>(a.markAsTouched(),a.updateValueAndValidity(),(0,o.lastValueFrom)(mu(a).pipe((0,u.tap)(()=>{a.errors&&(s[i]=a.errors)})))))),s})()}_validateAll(){var e=this;return(0,S.A)(function*(){const t={};return e.formApiModel.markAllAsTouched(),e.formApiModel.updateValueAndValidity(),pu(e.formApiModel),yield(0,o.lastValueFrom)(mu(e.formApiModel).pipe((0,u.tap)(()=>{Object.entries(e.formApiModel.controls).forEach(([r,i])=>{i.errors&&(t[r]=i.errors)})}))),t})()}_getDependentModelsNamesOnRelationAttributeName(e){const t=this.getBoundDataSourceNameByAttributePath(e),r=this._dataSourcesInfos.get(t)?.attributesMap.get(e);return this._getDependentModelsNames(t,[r])}_setAttributeValue(e,t,s){this._executeWithOptions(()=>this[e]=t,s)}_subscribeOnChangeAttributesToHandleModelDependenciesConstrains(){if(this._isDesignTime)return;const e=this.events$.pipe((0,u.filter)(t=>t.type===J.ChangeAttributeValue),(0,u.filter)(t=>this._isAttributeChange(t.payload)),(0,u.tap)(t=>{const s=t;!s?.payload?.value&&s.payload?.attributeName&&this._clearValuesForManyToOne(s.payload.attributeName)}));this._subscriptions.add(e.subscribe())}_clearValuesForManyToOne(e){this._getDependentModelsNamesOnRelationAttributeName(e).forEach(s=>{this._isManyToOneRootModelRelation(s)&&this._clearModelValues(s)})}_clearModelValues(e){const t=this._dataSourcesInfos.get(e),s=t?.isCollection?[]:t.getMappedAttributes();if(s.length){const r=s.reduce((i,a)=>({...i,[a]:null}),{});this.setValue(r).subscribe(()=>{this._markAsPristine(r),this._markAsUntouched(r)})}}_markAsUntouched(e){this._forEachControl(e,t=>{t.markAsUntouched()})}runInitFlow(e=null){return this._concatModelsWithEmbedded(e).pipe(this._measurePerformanceService.measure$(`ViewModel.runInitFlow.${this._injectionContext?.id}.parent.${!!this.parent}`),(0,u.tap)(t=>this._notifyAboutModelsErrors(t)),(0,u.tap)(t=>this._models$.next(t)),(0,u.tap)(()=>this._initFeaturesStates()),(0,u.mergeMap)(()=>this._generateDataSourcesInfo()),(0,u.tap)(t=>this._updateModels(t)),(0,u.mergeMap)(t=>this._generateAttributesToDataSourceNameMap(t)),(0,u.mergeMap)(t=>this._getDataSchemas()),(0,u.tap)(t=>this.dataSchemas=t),(0,u.mergeMap)(()=>this._initDataSourceValidators()),(0,u.switchMap)(()=>this._initBusinessRules()),(0,u.tap)(()=>{this._initSchemaValidators(this.viewModelConfig.attributes)}),(0,u.mergeMap)(()=>(0,o.forkJoin)([...this._generateResourceAttribute(),this._initSystemAttributes(),this._attributeGenerate(this.viewModelConfig.attributes),(0,o.of)(this),this._initSubscriptions()])),(0,u.mergeMap)(()=>this._generatePrimaryAttributes()),(0,u.tap)(()=>this._loadDefaultSorting()),(0,u.mergeMap)(()=>this._runInitialBusinessRules()),(0,u.tap)(()=>this._viewModelAttributeChangeEventOptions.reset())).pipe((0,u.switchMap)(()=>(0,o.of)(this)))}get modelInitConfigs(){return this._modelsInitConfig}init(e,t){return this._primaryModelName=t?.primaryModelName,this._modelDependencies=t?.modelDependencies||{},this._modelsLoadingConfig=t?.modelsLoadingConfig||{},this._lastEventLoadParameters=new Map,t?.businessRulesActive||this.deactivateBusinessRules(),this._modelDependencies&&this._handleCircularDependencies(),this._ngZone.runOutsideAngular(()=>this.runInitFlow(e))}setValue(e,t){const s=[],r=[];for(const i of Object.keys(this._attributeConfigs))"viewModelConfig"in this._attributeConfigs[i]||"viewModelName"in this._attributeConfigs[i]?r.push(i):s.push(i);return this._executeWithOptions(()=>{this._measurePerformanceService.measure(`ViewModel.setValue.updateViewModelModelAttributes.${this._injectionContext?.id}.parent.${!!this.parent}.data.${Object.keys(e).toString()}`,()=>{for(const i in e)s.includes(i)&&(this[i]=e[i])})},t),gs.deferUpdatingValueAndValidity(this,()=>(0,o.forkJoin)([...r.filter(i=>e&&e[i]).map(i=>{if(this.attributes[i]instanceof It)return this.attributes[i].setValue(e[i],{silent:t?.silent,preventAttributeChangeRequest:t?.preventAttributeChangeRequest,preventStateChange:t?.preventStateChange,preventRunBusinessRules:t?.preventRunBusinessRules});{const a=this._attributeConfigs[i].viewModelConfig||this._attributeConfigs[i].viewModelName,l=!this._featureValues.DisableDataGridEditingMode,d=(e[i]||[]).map(h=>{const p=this.getBoundDataSourceName(i),C=this._getDataSourceInfoByViewModelAttributePath(i)?.isCollection&&this.getModelByName(p)?.createCollectionItemModel(A.Update);return this.viewModelGenerator.generate({viewModelConfig:a,modelConfig:l&&C?{primaryDataSourceName:C.name}:void 0,models:l&&C?[C]:void 0,parentViewModel:this,businessRulesActive:!1},c.Injector.create({providers:[{provide:On,useValue:null}],parent:this.injector})).pipe(this._measurePerformanceService.measure$(`ViewModel.setValue.generateViewModel.${this._injectionContext?.id}.parent.${!!this.parent}.modelName.${C?.name}`),(0,u.tap)(B=>{p&&(B.dataSchemas[p]=this.dataSchemas[p])}),(0,u.tap)(B=>{B.deactivateBusinessRules()}),(0,u.switchMap)(B=>B.setValue(h,{silent:t?.silent,preventAttributeChangeRequest:t?.preventAttributeChangeRequest,preventStateChange:t?.preventStateChange,preventRunBusinessRules:t?.preventRunBusinessRules}).pipe((0,u.tap)(()=>C&&C.setLoadedState()),(0,u.map)(()=>B))))});return!d.length&&t?.collectionLoadType===Es.Reload&&this.attributes[i].clear(),d.length===0?(0,o.of)(null):(0,o.forkJoin)([...d]).pipe((0,u.tap)(h=>{const p=this.getBoundDataSourceName(i);this.getModelByName(p)?.childrenChange(),this._executeWithOptions(()=>{t?.collectionLoadType===Es.Reload||!t?.collectionLoadType?this.attributes[i].reload(h):this.getBoundDataSchema(i)?this._mergeCollectionModels(i,h):this.attributes[i].push(...h)},t)}))}}),(0,o.of)(this)]),this._featureValues)}deactivateBusinessRules(){this._businessRulesActive=!1}activateBusinessRules(){const e=this._businessRulesActive;if(this._businessRulesActive=!0,e)return(0,o.of)(null);const t=this.models.filter(s=>s.isLoaded);if(t.length>0){const s={type:H.ContextReady,name:null,scopeId:""};return(0,o.forkJoin)(t.map(r=>this._runBusinessRulesForModel(r,[],!0,[s]))).pipe((0,u.tap)(()=>this._businessRulesAreActivated=this._businessRulesProcessingEnabled),(0,u.tap)(()=>this._businessRulesActivated$.next(this._businessRulesAreActivated)))}}_getDependOnModelsNames(e){const t=this._modelDependencies[e];if(!t)return[];const s=t.map(r=>r.relationPath.split(".")[0]);return[...new Set(s)]}_getModelDependencies(e){return this._modelDependencies[e]??[]}_getIsAffectedByBusinessRules(e){if(!this._businessRulesProcessingEnabled)return Promise.resolve(!1);const t=e.name,s=this._attributesAffectedByBusinessRules;if(s.length===0||!t)return Promise.resolve(!1);const r=s.some(d=>d.name===t),i=this.getBoundDataSchemaByAttributePath(t),a=this.getBoundDataSchemaAttributeByAttributePath(t);if(!a)return Promise.resolve(r);const l=s.filter(d=>d.scopeName===i.name).some(d=>d.name===a.name);return Promise.resolve(l||r)}executeRequest(e){return e.scopes=e.scopes||this._eventScopes,this._crtZoneService.runInZone(this._viewEventZoneName,()=>this.processRequest(e))}getAttributeControl(e){let t=this.formApiModel;kp(this,e).then(v.noop);for(const s of e.split("."))t=t.get(s);return t??new ge.FormControl}loadLookupList(e,t=[],s){const r=e.control,i=e.items,a=this._getDataSourceInfoByViewModelAttributePath(i);if(a){const l=this._ngZone.runOutsideAngular(()=>this.processRequest({type:"crt.LoadDataRequest",$context:this,dataSourceName:a.name,parameters:t,config:{payload:s}}));Promise.resolve(l)}else{const l=this._getDataSourceInfoByViewModelAttributePath(r);if(l){const d=l.getDataSourceAttributePath(r);(0,o.forkJoin)([this._getDropdownPageSize(),this._modelParametersBuilder.getModelParameters(this,t,s)]).pipe((0,u.mergeMap)(([h,p])=>this.getModelByName(l.name).loadLookupList(d,p,h)),(0,u.map)(h=>Ue.getLookupListDataSourceInfo(i,{value:h.primaryAttributeName,displayValue:h.primaryDisplayAttributeName}).getModelDto(h.data)),(0,u.mergeMap)(h=>this.setValue(h,{silent:!0}))).subscribe()}}}load(...e){const t=this._disableViewModelLoadUnblockingThread?(0,o.of)(null):(0,o.timer)(0,o.asyncScheduler);if(typeof e[0]=="string"){const r=e[0],i=e[1],a=e[2];this._checkDataSourceName(r);const l=this._getDataSourceLoadType(a?.loadType);return t.pipe((0,u.switchMap)(()=>this._loadStaticModel(r,i,l,a?.payload,a?.useLastLoadParameters,a?.doNotUpdateLastLoadParameters).pipe(this._measurePerformanceService.measure$(`ViewModel.loadStaticModel.${this._injectionContext?.id}.parent.${!!this.parent}.datasourceName.${r}`))))}const s=e[0];return t.pipe((0,u.switchMap)(()=>this._loadDynamicModel(s).pipe(this._measurePerformanceService.measure$(`ViewModel.loadDynamicModel.${this._injectionContext?.id}.parent.${!!this.parent}.model.${s.dataSourceName}`))))}setSorting(e,t){const r=this._dataSourcesInfos.get(e).getSortingConfig(),i=r&&r.attributeName;return i&&(this[i]=t),(0,o.of)(null)}create(e,t){return this._checkDataSourceName(e),this._createModelData(e,t)}copy(e,t,s){return this._checkDataSourceName(e),this._copyModelData(e,t,s)}loadDefaultValues(e){return this._setAttributesDefaultValues(e)}save(e,t,s){return(0,o.from)(this.waitAsyncTasksFinish()).pipe((0,u.switchMap)(()=>(this._checkDataSourceName(e),this.getModelMode(e)===A.Delete?this.delete(e,t,s):this._saveModel(e,t,s))))}delete(e,t,s){return this._checkDataSourceName(e),this._deleteModel(e,t,s)}resume(){return(0,o.of)(void 0)}pause(){return(0,o.of)(void 0)}destroy(){this._subscriptions.unsubscribe(),Array.from(this._collectionSubscription.values()).forEach(t=>t.unsubscribe()),this._collectionSubscription.clear(),this._crtControls.forEach(t=>{t.destroy()}),this.models?.forEach(t=>t.destroy()),this._crtControls.clear(),this._eventsSubject$.complete(),this._replayEvents$.complete(),this._modelLoaded$.complete();const e=[];for(const t of Object.values(this.attributes))t instanceof It&&e.push(t.destroy()),t instanceof $e&&e.push((0,o.from)(t.destroy()));return(0,o.forkJoin)(e).pipe((0,u.defaultIfEmpty)(void 0),(0,u.map)(()=>{}),(0,u.finalize)(()=>{this.parent||(this._crtInjectionContextService.removeContext(this._injectionContext?.id),Tl(this._injectionContext),this._context=null,this._viewModelDataDelayerService?.destroy(),this._viewModelDataDelayerService=null),this._asyncTasksExecutingSubject.complete(),this._dataSourcesInfos.clear(),this.__destroyed=!0,this._destroySubject.next(),this._destroySubject.complete()}))}_findAttributePathInDataSourceNameMap(e){for(const t of this._attributesToDataSourceNameMap.keys()){const s=t.indexOf(".");if(s<0)continue;const r=s+1,i=e.length;if(t.startsWith(e,r)&&(t.length===r+i||t.charAt(r+i)==="."))return t}}getBoundDataSourceName(e){const t=this.getBoundDataSourceNameByAttributePath(e);if(t!==null)return t;if(!e)return null;const s=this._findAttributePathInDataSourceNameMap(e);return this.getBoundDataSourceNameByAttributePath(s)}_getBoundDataSourceAttributeControls(e){return Object.fromEntries(Array.from(this._attributesToDataSourceNameMap.entries()).filter(([t,s])=>s===e).map(([t])=>[t,this.getAttributeControl(t)]))}getBoundDataSourceAttributeControls(e){return Object.values(this._getBoundDataSourceAttributeControls(e))}getBoundDataSourceNameByAttributePath(e){return this._attributesToDataSourceNameMap.get(e)??null}getBoundDataSchema(e){return this.dataSchemas[this.getBoundDataSourceName(e)]}getBoundDataSchemaByAttributePath(e){return this.dataSchemas[this.getBoundDataSourceNameByAttributePath(e)]??null}getBoundDataSchemaAttributeByAttributePath(e){const t=this.getBoundDataSourceNameByAttributePath(e),s=this.getBoundDataSchemaByAttributePath(e);if(!t||!s)return null;const i=this._getDataSourceInfoByViewModelAttributePath(e).getDataSourceAttributePath(e);return s.findAttributeByName(i)}getPrimaryModelName(){return Promise.resolve(this._primaryModelName)}getPrimaryDataSchema(){return this.getPrimaryModelName().then(e=>this.dataSchemas[e])}isValid(e){const t=this._waitAsyncValidation().pipe((0,u.map)(()=>e?this.getBoundDataSourceAttributeControls(e).every(s=>!s.invalid):this.formApiModel.valid));return(0,o.lastValueFrom)(t)}validate(e){return this._ngZone.run(()=>e?this._validateByDataSourceName(e):this._validateAll())}getViewModelAttributePath(e,t){const s=this._dataSourcesInfos.get(e);return this._getMappedAttributeName(s,t)}getViewModelAttributePaths(e,t){return this._dataSourcesInfos.get(e)?.getMappedAttributeNames(t)}getCollectionViewModelAttributePath(e){return this._dataSourcesInfos.get(e)?.collectionViewModelAttributeName}canDelete(e,t){var s=this;return(0,S.A)(function*(){return s.getModelByName(e).canDelete(t)})()}canSave(e,t){var s=this;return(0,S.A)(function*(){return s.getModelByName(e).canSave(t)})()}enableAttributeValidator(e,t){this.getControl(e).enableValidator(t)}disableAttributeValidator(e,t){this.getControl(e).disableValidator(t)}_hotSwap(e){return this._measurePerformanceService.measure(`ViewModel.generatePrimaryAttributes.${this._injectionContext?.id}.parent.${!!this.parent}.hotSwap`,()=>{const t=e?.attributes?.changed||[],s=(0,v.isEmpty)(e.resources?.strings);if((0,v.isEmpty)(t)&&s)return(0,o.of)(!1);s||(this.resources={strings:this._getChangedResourcesStrings(e.resources.strings)}),this.viewModelConfig=e.actualViewModelConfig;const r=Ue.getFromViewModelConfig(this.viewModelConfig),i=Object.fromEntries(t.map(f=>[f,this.viewModelConfig.attributes[f]])),a=e?.models?.changed??[],l=a.map(f=>f.name),d=this.models.filter(f=>f.isLoaded||f.isLoading).filter(f=>l.includes(f.name)).map(f=>f.name),h=a.map(f=>{const C=r.get(f.name);return this._upsertModel(f.name,f),this._replaceDataSourceInfo(f.name,C),this._addDataSchemaToDataSchemas(f)}),p=this._attributeGenerate$(i,{disableDefaultConfig:!0});return(0,o.forkJoin)([...h,p]).pipe(this._measurePerformanceService.measure$(`ViewModel.generatePrimaryAttributes.${this._injectionContext?.id}.parent.${!!this.parent}.hotSwap.forkJoin`),(0,u.switchMap)(()=>this._reGenerateResourcesAttributes()),(0,u.tap)(()=>this._loadDefaultSorting(l)),(0,u.tap)(()=>this._requestReloadModels(d)),(0,u.map)(()=>!0))})}set(e,t,s){return this._setAttributeValue(e,t,s),Promise.resolve()}_markAsPristine(e){this._forEachControl(e,t=>{t.markAsPristine()})}getAttributeNameByViewItemName(e){return Object.keys(this._attributeConfigs).find(t=>this._attributeConfigs[t].viewItemName===e)}getControl(e){return this._crtControls.has(e)?this._crtControls.get(e):Un.create({name:e,value:null,propertiesConfig:[]})}getAttributePropertyValue(...e){let t,s;if(e.length===2)t=e[0],s=e[1];else if(e.length===1){const i=e[0].split(":");t=i[0],s=i[1]}else throw new Error("ArgumentException");return this.getControl(t).getPropertyValue(s)}setAttributePropertyValue(...e){let t,s,r;if(e.length===3)t=e[0],s=e[1],r=e[2];else if(e.length===2){const a=e[0].split(":");t=a[0],s=a[1],r=e[1]}else throw new Error("ArgumentException");return this.getControl(t).setPropertyValue(s,r)}resetAttributePropertyValue(...e){let t,s;if(e.length===1)[t,s]=e[0].split(":");else if(e.length===2)t=e[0],s=e[1];else throw new Error("ArgumentException");this.getControl(t).getPropertyByName(s)?.resetValue()}getInvariabilityPropertyName(e){return this.getControl(e).getInvariabilityPropertyName()}setModelValues(e,t){return this.getModelByName(e).setValue(t)}_getBoundAttributesNames(e){const t=this.getBoundDataSourceNameByAttributePath(e);if(!t)return null;const s=this._dataSourcesInfos.get(t),r=s.attributesMap.get(e);return Array.from(s.attributesMap.entries()).filter(([i,a])=>a===r&&i!==e).map(([i])=>i)}_getAttributeDataValueTypeName(e){return this._attributeConfigs[e].dataValueTypeName}getDataSourceLoadParameters(e,t){const s=this._dataSourcesInfos.get(e);return s?this._modelParametersBuilder.getModelLoadParameters(this,s,[],q.Load,{modelLoadConfiguration:t}).then(([r,i,a])=>({parameters:r,options:{pagingConfig:i,sortingConfig:a}})):null}isDataSourceForCollection(e){return!!this._dataSourcesInfos.get(e)?.isCollection}_getDataSourceAttributeDataValueType(e){const t=this._getDataSourceInfoByViewModelAttributePath(e);let s=null;if(t){const r=t.getDataSourceAttributePath(e);r&&(s=this._getDataSourceAttributeSchema(t,r)?.dataValueType)}return s}_getModelNamesByLoadType(e){return Object.entries(this._modelsLoadingConfig).filter(([t,s])=>s.type===e).map(([t,s])=>t)}_reloadDependentModels(e,t=[],s=null){const r=this._getDependentModelsForLoad(e,t);this._requestReloadModels(r.filter(i=>{const a=Ct(this.getModelByName(i));return!s||a&&s===Ee.Page||!a&&s===Ee.ViewElement}))}_getDependentModelsForLoad(e,t=[]){const s=this._getDependentModelsNames(e.name,t),r=this._getChangedModelsNames(s).filter(i=>!Ct(this.getModelByName(i)));return r.length!==0&&this._showNotification({message:"BaseViewModel.RefreshModelDataConflict"}),s.filter(i=>!r.includes(i)).filter(i=>this._modelsRequestedToLoad.has(i)||Ct(this.getModelByName(i)))}getIsDirty(e){return this.getControl(e).isDirty}getModelByName(e){return this._modelsMap.get(e)}getModelMode(e){return this.getModelByName(e)?.mode}getPrimaryModelMode(){return this.getModelMode(this._primaryModelName)}_getModelModeChanges(e){return this.getModelByName(e)?._modeChanges$}_getPrimaryModelModeChanges(){return this._getModelModeChanges(this._primaryModelName)}markModelFor(e,t){this.getModelByName(e)?.markFor(t)}markPrimaryModelFor(e){this.markModelFor(this._primaryModelName,e)}_setStateAttribute(e){this._setSystemAttributeValue(Hn,e)}_onAsyncTaskStarted(e){if(this._disableViewModelWaitingForAsyncTasks)return;const t=this._asyncTasksExecutingSubject.value;t.add(e),this._asyncTasksExecutingSubject.next(t)}_onAsyncTaskFinished(e){if(this._disableViewModelWaitingForAsyncTasks)return;const t=this._asyncTasksExecutingSubject.value;t.delete(e),this._asyncTasksExecutingSubject.next(t)}waitAsyncTasksFinish(){let e;return(0,o.firstValueFrom)(this._asyncTasksExecutingSubject.pipe((0,u.tap)(t=>{clearTimeout(e),e=this._handleAsyncTasksCycle(t)}),(0,u.filter)(t=>t.size===0),(0,u.take)(1),(0,u.map)(()=>{})))}}class Ps{constructor(){this.viewModelConstructor=It}static useClass(e){return new class extends Ps{constructor(){super(...arguments),this.viewModelConstructor=e}}}create(e,t,s,r,i,a,l,d){return new this.viewModelConstructor(e,t,s,r,i,a,l,d)}static#e=this.\u0275fac=function(t){return new(t||Ps)};static#t=this.\u0275prov=c.\u0275\u0275defineInjectable({token:Ps,factory:Ps.\u0275fac,providedIn:"root"})}class Ds extends Et{constructor(){super(...arguments),this._lifecycleHooksRequests={init:To,resume:No,pause:Vo,destroy:xo},this.handlerChain=ie.instance}_processRequest(e,t,s){return this.ngZone.runOutsideAngular(()=>this.sendRequest({...e,scopes:s,$context:t}))}_processViewModelAttributeChanges(e,t){e.events$.pipe((0,u.filter)(s=>s.type===J.ChangeAttributeValue&&!s.payload?.preventAttributeChangeRequest)).subscribe({next:s=>{const r=`${je.ProcessingAttributeChangeRequest}-${O()}`;e._onAsyncTaskStarted(r),this._processRequest(new Do(s.payload),e,t).then(()=>e._onAsyncTaskFinished(r))}})}initDependencies(){super.initDependencies(),this.viewModelFactory=this.injector.get(Ps)}generateLifecycleHooks(e,t){Object.entries(this._lifecycleHooksRequests).forEach(([s,r])=>{e[s]=new Proxy(e[s],{apply:(i,a,l)=>{const d=i.apply(a,l);if(!(d instanceof o.Observable))throw new Error(`Method ${s} should return Observable`);return d.pipe((0,u.switchMap)(h=>(0,o.from)(this._processRequest(new r,e,t.scopes)).pipe((0,o.map)(()=>h))))}})})}_generateFromConfig(e,t){const s=t||this.injector,{viewModelConfig:r,modelConfig:i,resources:a,models:l,scopes:d,modelInitConfigs:h,modelConfig:{primaryDataSourceName:p}={},parentViewModel:f,businessRulesActive:C}=e,B=this.viewModelFactory.create(this,s,this._trimEmptyAttributes(r),a,null,d,h,f);return this.generateLifecycleHooks(B,e),this._processViewModelAttributeChanges(B,d),B.init(l,{modelDependencies:i?.dependencies,primaryModelName:p,modelsLoadingConfig:i?.loadingConfig,businessRulesActive:C})}_trimEmptyAttributes(e){const t=e?.attributes??{};return Object.keys(t).forEach(s=>{t[s]||delete t[s]}),{...e,attributes:t}}_generateFromString(e,t){return this.repository.resolveModelConfig(e.viewModelConfig).pipe((0,u.switchMap)(s=>this._generateFromConfig({...e,viewModelConfig:s},t)))}sendRequest(e){return this.handlerChain.process(e)}generate(e,t){const s=t?.get(te);return typeof e.viewModelConfig=="string"?s?this._generateFromString(e,t).pipe(s.measure$("viewModelGenerator.generateFromString")):this._generateFromString(e,t):s?this._generateFromConfig(e,t).pipe(s.measure$("viewModelGenerator.generateFromConfig")):this._generateFromConfig(e,t)}static#e=this.\u0275fac=(()=>{let e;return function(s){return(e||(e=c.\u0275\u0275getInheritedFactory(Ds)))(s||Ds)}})();static#t=this.\u0275prov=c.\u0275\u0275defineInjectable({token:Ds,factory:Ds.\u0275fac,providedIn:"root"})}Mp();let $r=class Go{static#e=this.\u0275fac=function(t){return new(t||Go)};static#t=this.\u0275mod=c.\u0275\u0275defineNgModule({type:Go});static#s=this.\u0275inj=c.\u0275\u0275defineInjector({providers:[Xe,Ut,yr,At,Mr,{provide:Et,useClass:Ds},{provide:vt,useClass:Tr},{provide:_s,useClass:ys},Me.vn,Le,rs,_p,{provide:Ln,useClass:Nr},{provide:wu,useValue:tt.Root},{provide:Zh,useValue:ga.instance},gp,ms,fs,Yh,tp],imports:[R.CommonModule,ge.ReactiveFormsModule,Vr,Rr,as,T.TranslateModule]})};$r=(0,m.__decorate)([Wc({includes:[as],requestHandlers:[Ca,Aa,va,Ia,Ra,wa,Pa,Ta,Na,Va,xa,Oa],validators:[Ba,ka,Fa,ja,$a,Bn,Ua,qa,Ha,za,Ga]})],$r),function(){(typeof ngJitMode>"u"||ngJitMode)&&c.\u0275\u0275setNgModuleScope($r,{imports:[R.CommonModule,ge.ReactiveFormsModule,Vr,Rr,as,T.TranslateModule]})}();class Ts{static#e=this.\u0275fac=function(t){return new(t||Ts)};static#t=this.\u0275mod=c.\u0275\u0275defineNgModule({type:Ts});static#s=this.\u0275inj=c.\u0275\u0275defineInjector({providers:[Ye,Me.vn,Ge],imports:[zt,$r,Ar]})}(function(){(typeof ngJitMode>"u"||ngJitMode)&&c.\u0275\u0275setNgModuleScope(Ts,{declarations:[Sr],imports:[zt,$r,Ar]})})();class Ur{_buildRequestUrl(e){return this._isAbsoluteUrl(e)?e:R.Location.joinWithSlash(this.getUrl(),e)}_isAbsoluteUrl(e){return/^https?:\/\//i.test(e)}getUrl(){return pn()}intercept(e,t){return e=e.clone({url:this._buildRequestUrl(e.url)}),t.handle(e).pipe((0,u.catchError)(s=>(console.log(s),(0,o.throwError)(s))))}static#e=this.\u0275fac=function(t){return new(t||Ur)};static#t=this.\u0275prov=c.\u0275\u0275defineInjectable({token:Ur,factory:Ur.\u0275fac})}class Ns extends Ur{getUrl(){return _t()}static#e=this.\u0275fac=(()=>{let e;return function(s){return(e||(e=c.\u0275\u0275getInheritedFactory(Ns)))(s||Ns)}})();static#t=this.\u0275prov=c.\u0275\u0275defineInjectable({token:Ns,factory:Ns.\u0275fac})}class zn{constructor(e){this._resources=e}getTranslation(e){const t=this._resources.map(({prefix:s,suffix:r})=>{const i=`${s}${e}${r}`;return fetch(i,{cache:"no-cache"}).then(a=>{if(!a.ok&&a.status!==304)throw new Error(`Loading translations failed: ${i} (${a.status})`);return a.json()})});return(0,o.from)(Promise.allSettled(t)).pipe((0,o.map)(s=>{for(const r of s.filter(i=>i.status==="rejected"))console.error(r.reason);return(0,v.merge)({},...s.filter(r=>r.status==="fulfilled").map(r=>r.value||{}))}))}static#e=this.\u0275fac=function(t){c.\u0275\u0275invalidFactory()};static#t=this.\u0275prov=c.\u0275\u0275defineInjectable({token:zn,factory:zn.\u0275fac})}const Qu=new c.InjectionToken("NestedTranslateLoader"),jp=n=>({provide:Qu,useFactory:()=>new zn(n.map(e=>({prefix:e,suffix:".json"})))});class qr extends T.TranslateLoader{constructor(e){super(),this._nestedTranslateLoader=e}_getDefaultTranslation(){return{ErrorListDialogService:{CodeErrorListDialogCaption:"Compilation errors",FileNameColumn:"File name",ErrorTextColumn:"Description",ErrorNumberColumn:"Code",LineColumn:"Line",CodeValidationErrorListDialogCaption:"Error while saving package dependencies",SourceColumn:"Source",ReferenceColumn:"Reference",PackageColumn:"Package",AcademyHelpUrlCaption:" Learn more in the Academy"},TableDialog:{Close:"Close"}}}_getRussianTranslation(){return{ErrorListDialogService:{CodeErrorListDialogCaption:"\u041E\u0442\u0447\u0435\u0442 \u043E\u0448\u0438\u0431\u043E\u043A \u043A\u043E\u043C\u043F\u0438\u043B\u044F\u0446\u0438\u0438",FileNameColumn:"\u0418\u043C\u044F \u0444\u0430\u0439\u043B\u0430",ErrorTextColumn:"\u041E\u043F\u0438\u0441\u0430\u043D\u0438\u0435",ErrorNumberColumn:"\u041A\u043E\u0434",LineColumn:"\u0421\u0442\u0440\u043E\u043A\u0430",CodeValidationErrorListDialogCaption:"\u041E\u0448\u0438\u0431\u043A\u0430: \u0446\u0438\u043A\u043B\u0438\u0447\u0435\u0441\u043A\u0430\u044F \u043F\u043E\u0441\u043B\u0435\u0434\u043E\u0432\u0430\u0442\u0435\u043B\u044C\u043D\u043E\u0441\u0442\u044C \u0437\u0430\u0432\u0438\u0441\u0438\u043C\u043E\u0441\u0442\u0438 \u043F\u0430\u043A\u0435\u0442\u043E\u0432",SourceColumn:"\u0418\u0441\u0442\u043E\u0447\u043D\u0438\u043A",ReferenceColumn:"\u0421\u0441\u044B\u043B\u043A\u0430",PackageColumn:"\u041F\u0430\u043A\u0435\u0442",AcademyHelpUrlCaption:" \u041F\u043E\u0434\u0440\u043E\u0431\u043D\u0435\u0435 \u0447\u0438\u0442\u0430\u0439\u0442\u0435 \u0432 \u0410\u043A\u0430\u0434\u0435\u043C\u0438\u0438"},TableDialog:{Close:"\u0417\u0430\u043A\u0440\u044B\u0442\u044C"}}}getTranslation(e){let t=this._getDefaultTranslation();return e==="ru-RU"&&(t=Object.assign(t,this._getRussianTranslation())),(this._nestedTranslateLoader?this._nestedTranslateLoader.getTranslation(e):(0,o.of)({})).pipe((0,o.map)(s=>Object.assign(t,s)))}static#e=this.\u0275fac=function(t){return new(t||qr)(c.\u0275\u0275inject(Qu,8))};static#t=this.\u0275prov=c.\u0275\u0275defineInjectable({token:qr,factory:qr.\u0275fac})}const $p=b.p+"assets/i18n/libs/";function Up(n,e){return()=>(0,o.lastValueFrom)(n.loadCurrentUserInfo().pipe((0,u.switchMap)(t=>e.use(t?.userInfo?.cultureInfo?.sysCultureName).pipe((0,u.catchError)(()=>(0,o.of)(null))))),{defaultValue:null})}class Hr{constructor(e,t,s){this._injector=e,this._customElementsBootstrapService=t,this._translateService=s}ngDoBootstrap(){this._translateService.use(this._translateService.defaultLang).subscribe(()=>{this._customElementsBootstrapService.defineComponent("ts-error-list-dialog-proxy",Sr,this._injector)})}static#e=this.\u0275fac=function(t){return new(t||Hr)(c.\u0275\u0275inject(c.Injector),c.\u0275\u0275inject(Os),c.\u0275\u0275inject(T.TranslateService))};static#t=this.\u0275mod=c.\u0275\u0275defineNgModule({type:Hr});static#s=this.\u0275inj=c.\u0275\u0275defineInjector({providers:[hl,{provide:c.APP_INITIALIZER,useFactory:Up,deps:[Me.fv,T.TranslateService],multi:!0},Ol,Pt,Me.vn,{provide:R.APP_BASE_HREF,useValue:"/"},{provide:D.HTTP_INTERCEPTORS,useClass:Ns,multi:!0},Fl,Bl,jp([$p])],imports:[_.BrowserModule,w.BrowserAnimationsModule,T.TranslateModule.forRoot({defaultLanguage:"en-US",useDefaultLang:!0,loader:{provide:T.TranslateLoader,useClass:qr}}),D.HttpClientModule,D.HttpClientXsrfModule.withOptions({cookieName:"BPMCSRF",headerName:"BPMCSRF"}),F.RouterModule.forRoot([],{}),Ts]})}(function(){(typeof ngJitMode>"u"||ngJitMode)&&c.\u0275\u0275setNgModuleScope(Hr,{imports:[_.BrowserModule,w.BrowserAnimationsModule,T.TranslateModule,D.HttpClientModule,D.HttpClientXsrfModule,F.RouterModule,Ts]})})(),_.platformBrowser().bootstrapModule(Hr).catch(n=>console.error(n))},86464:(E,Y,b)=>{b.d(Y,{r:()=>_});var _;(function(g){g[g.Guid=0]="Guid",g[g.Text=1]="Text",g[g.Integer=4]="Integer",g[g.Float=5]="Float",g[g.Money=6]="Money",g[g.DateTime=7]="DateTime",g[g.Date=8]="Date",g[g.Time=9]="Time",g[g.Lookup=10]="Lookup",g[g.Enum=11]="Enum",g[g.Boolean=12]="Boolean",g[g.Blob=13]="Blob",g[g.Image=14]="Image",g[g.CUSTOM_OBJECT=15]="CUSTOM_OBJECT",g[g.IMAGELOOKUP=16]="IMAGELOOKUP",g[g.COLLECTION=17]="COLLECTION",g[g.Color=18]="Color",g[g.LOCALIZABLE_STRING=19]="LOCALIZABLE_STRING",g[g.ENTITY=20]="ENTITY",g[g.ENTITY_COLLECTION=21]="ENTITY_COLLECTION",g[g.ENTITY_COLUMN_MAPPING_COLLECTION=22]="ENTITY_COLUMN_MAPPING_COLLECTION",g[g.HASH_TEXT=23]="HASH_TEXT",g[g.SECURE_TEXT=24]="SECURE_TEXT",g[g.FILE=25]="FILE",g[g.MAPPING=26]="MAPPING",g[g.SHORT_TEXT=27]="SHORT_TEXT",g[g.MEDIUM_TEXT=28]="MEDIUM_TEXT",g[g.MAXSIZE_TEXT=29]="MAXSIZE_TEXT",g[g.LONG_TEXT=30]="LONG_TEXT",g[g.FLOAT1=31]="FLOAT1",g[g.FLOAT2=32]="FLOAT2",g[g.FLOAT3=33]="FLOAT3",g[g.FLOAT4=34]="FLOAT4",g[g.LOCALIZABLE_PARAMETER_VALUES_LIST=35]="LOCALIZABLE_PARAMETER_VALUES_LIST",g[g.METADATA_TEXT=36]="METADATA_TEXT",g[g.STAGE_INDICATOR=37]="STAGE_INDICATOR",g[g.OBJECT_LIST=38]="OBJECT_LIST",g[g.COMPOSITE_OBJECT_LIST=39]="COMPOSITE_OBJECT_LIST",g[g.FLOAT8=40]="FLOAT8",g[g.FILE_LOCATOR=41]="FILE_LOCATOR",g[g.PHONE_TEXT=42]="PHONE_TEXT",g[g.RICH_TEXT=43]="RICH_TEXT",g[g.WEB_TEXT=44]="WEB_TEXT",g[g.EMAIL_TEXT=45]="EMAIL_TEXT",g[g.COMPOSITE_OBJECT=46]="COMPOSITE_OBJECT"})(_||(_={}))},91592:(E,Y,b)=>{b.d(Y,{X:()=>R});var _=b(59131),g=b.n(_);class R{constructor(){this.getRegisteredEvents=()=>[]}set eventHandlers(c){this._eventHandlers=c,this._validateEventHandlers()}get eventHandlers(){return this._eventHandlers}_stringify(c){const w=[()=>JSON.stringify(c),()=>c.toString()];for(let F=0;F<w.length;F++){const T=w[F];try{return T()}catch{}}return""}_checkEventCanBeHandled(c){const w=this.getRegisteredEvents();if(!w||w.some(o=>o.name===c))return;const F=w.map(o=>o.name).join(", ");let T=`Handler for event "${c}" can not be specified because the event was not registered in table cell class. Registered table column events to subscribe: ${F}.`;throw this.columnDataSchema&&(T+=` Column name: "${this.columnDataSchema.name}".`),new Error(T)}_checkHandlerIsFunction(c,w){if(typeof w!="function")throw new TypeError(`Handler for event with name "${c}" must be a function, but actual is"${this._stringify(w)}".`)}_validateEventHandlers(){if(!this.eventHandlers)return;Object.keys(this.eventHandlers).forEach(w=>{this._checkEventCanBeHandled(w),this._checkHandlerIsFunction(w,this.eventHandlers[w])})}_checkEventDataType(c,w){return c instanceof w||c.constructor===w}_validateFiringEvent(c,w){const F=this._registeredEvents.find(o=>o.name===c);if(!F)throw new Error(`Event with name "${c}" is not registered in the cell class and can not be fired.`);const T=F.dataType;if(w&&(!T||!this._checkEventDataType(w,T)))throw new TypeError(`Type of the data in the event "${c}" must be "${T}", but actual data is "${this._stringify(w)}".`)}_getValidEventHandler(c){const w=this.eventHandlers&&this.eventHandlers[c];if(w)return this._checkHandlerIsFunction(c,w),w}isEmpty(){return!(this.columnDataSchema&&this.record)}fireEvent(c,w){this._validateFiringEvent(c,w);const F=this._getValidEventHandler(c);return F&&F(this.record,w)}ngOnInit(){this._registeredEvents=this.getRegisteredEvents()}getValue(){const c=this.record[this.columnDataSchema.name],w=this.columnDataSchema.formatter;return w?w(c,this.record):c}static#e=this.\u0275fac=function(w){return new(w||R)};static#t=this.\u0275dir=_.\u0275\u0275defineDirective({type:R,inputs:{columnDataSchema:"columnDataSchema",record:"record",eventHandlers:"eventHandlers"}})}},61843:(E,Y,b)=>{b.d(Y,{dJ:()=>g,fX:()=>R});const _="A5420246-0A8E-E111-84A3-00155D054C03",g="en-US";class R{constructor(c){Object.assign(this,c)}static getDefaultCulture(){return new R({sysCultureId:_,sysCultureName:g,decimalSeparator:".",thousandSeparator:","})}}},47149:(E,Y,b)=>{b.d(Y,{P:()=>D,Q:()=>R});var _=b(86464);const g="DataValueType",R={[_.r.Date]:{type:_.r.Date,id:"603d4960-a1a2-45e9-b232-206a54421b01",name:"Date",icon:"data-type-date-icon.svg",designerIcon:b(26861),translateKey:`${g}.DateCaption`},[_.r.Time]:{type:_.r.Time,id:"04cc757b-8f06-482c-8a1a-0c0e171d2410",name:"Time",icon:"data-type-time-icon.svg",designerIcon:b(8510),translateKey:`${g}.TimeCaption`},[_.r.DateTime]:{type:_.r.DateTime,id:"d21e9ef4-c064-4012-b286-fa1a8171da44",name:"DateTime",icon:"data-type-datetime-icon.svg",designerIcon:b(55146),translateKey:`${g}.DateTimeCaption`},[_.r.Text]:{type:_.r.Text,id:"8b3f29bb-ea14-4ce5-a5c5-293a929b6ba2",name:"Text",icon:"data-type-text-icon.svg",autonumberIcon:"data-type-autonumber-icon.svg",designerIcon:b(97180),designerAutonumberIcon:b(78683),translateKey:`${g}.TextCaption`},[_.r.SHORT_TEXT]:{type:_.r.SHORT_TEXT,id:"325a73b8-0f47-44a0-8412-7606f78003ac",name:"ShortText",icon:"data-type-text-icon.svg",autonumberIcon:"data-type-autonumber-icon.svg",designerIcon:b(97180),designerAutonumberIcon:b(78683),translateKey:`${g}.ShortTextCaption`},[_.r.PHONE_TEXT]:{type:_.r.PHONE_TEXT,id:"26cba63c-daf1-4f36-b2ea-73c0d675d90c",name:"PhoneText",icon:"data-type-phone-icon.svg",designerIcon:b(59155),translateKey:`${g}.PhoneTextCaption`},[_.r.WEB_TEXT]:{type:_.r.WEB_TEXT,id:"26cba64c-daf1-4f36-b2ea-73c0d695d90c",name:"WebText",icon:"data-type-text-icon.svg",designerIcon:b(64337),translateKey:`${g}.WebTextCaption`},[_.r.EMAIL_TEXT]:{type:_.r.EMAIL_TEXT,id:"66cba64c-daf1-4f36-b8ea-73c0d695d90c",name:"EmailText",icon:"data-type-text-icon.svg",designerIcon:b(71011),translateKey:`${g}.EmailTextCaption`},[_.r.MEDIUM_TEXT]:{type:_.r.MEDIUM_TEXT,id:"ddb3a1ee-07e8-4d62-b7a9-d0e618b00fbd",name:"MediumText",icon:"data-type-text-icon.svg",autonumberIcon:"data-type-autonumber-icon.svg",designerIcon:b(97180),designerAutonumberIcon:b(78683),translateKey:`${g}.MediumTextCaption`},[_.r.LONG_TEXT]:{type:_.r.LONG_TEXT,id:"5ca35f10-a101-4c67-a96a-383da6afacfc",name:"LongText",icon:"data-type-text-icon.svg",autonumberIcon:"data-type-autonumber-icon.svg",designerIcon:b(97180),designerAutonumberIcon:b(78683),translateKey:`${g}.LongTextCaption`},[_.r.MAXSIZE_TEXT]:{type:_.r.MAXSIZE_TEXT,id:"c0f04627-4620-4bc0-84e5-9419dc8516b1",name:"MaxSizeText",icon:"data-type-unlimited-text-icon.svg",autonumberIcon:"data-type-autonumber-icon.svg",designerIcon:b(97180),designerAutonumberIcon:b(78683),translateKey:`${g}.MaxSizeTextCaption`},[_.r.Integer]:{type:_.r.Integer,id:"6b6b74e2-820d-490e-a017-2b73d4ccf2b0",name:"Integer",icon:"data-type-integer-icon.svg",designerIcon:b(60521),translateKey:`${g}.IntegerCaption`},[_.r.FLOAT1]:{type:_.r.FLOAT1,id:"07ba84ce-0bf7-44b4-9f2c-7b15032eb98c",name:"Float1",icon:"data-type-float1-icon.svg",designerIcon:b(68877),translateKey:`${g}.FLOAT1Caption`},[_.r.FLOAT2]:{type:_.r.FLOAT2,id:"5cc8060d-6d10-4773-89fc-8c12d6f659a6",name:"Float2",icon:"data-type-float2-icon.svg",designerIcon:b(68877),translateKey:`${g}.FLOAT2Caption`},[_.r.FLOAT3]:{type:_.r.FLOAT3,id:"3f62414e-6c25-4182-bcef-a73c9e396f31",name:"Float3",icon:"data-type-float3-icon.svg",designerIcon:b(68877),translateKey:`${g}.FLOAT3Caption`},[_.r.FLOAT4]:{type:_.r.FLOAT4,id:"ff22e049-4d16-46ee-a529-92d8808932dc",name:"Float4",icon:"data-type-float4-icon.svg",designerIcon:b(68877),translateKey:`${g}.FLOAT4Caption`},[_.r.FLOAT8]:{type:_.r.FLOAT8,id:"a4aaf398-3531-4a0d-9d75-a587f5b5b59e",name:"Float8",icon:"data-type-float8-icon.svg",designerIcon:b(68877),translateKey:`${g}.FLOAT8Caption`},[_.r.Guid]:{type:_.r.Guid,id:"23018567-a13c-4320-8687-fd6f9e3699bd",name:"Guid",icon:"data-type-guid-icon.svg",designerIcon:b(92458),translateKey:`${g}.GuidCaption`},[_.r.Lookup]:{type:_.r.Lookup,id:"b295071f-7ea9-4e62-8d1a-919bf3732ff2",name:"Lookup",icon:"data-type-lookup-icon.svg",designerIcon:b(61631),translateKey:`${g}.LookupCaption`},[_.r.Boolean]:{type:_.r.Boolean,id:"90b65bf8-0ffc-4141-8779-2420877af907",name:"Boolean",icon:"data-type-boolean-icon.svg",designerIcon:b(36659),translateKey:`${g}.BooleanCaption`},[_.r.HASH_TEXT]:{type:_.r.HASH_TEXT,id:"ecbcce18-2a17-4ead-829a-9d02fa9578a4",name:"HashText",icon:"data-type-crs-text-icon.svg",designerIcon:b(97180),translateKey:`${g}.HashTextCaption`},[_.r.SECURE_TEXT]:{type:_.r.SECURE_TEXT,id:"3509b9dd-2c90-4540-b82e-8f6ae85d8248",name:"SecureText",icon:"data-type-encrypted-text-icon.svg",designerIcon:b(28010),translateKey:`${g}.SecureTextCaption`},[_.r.IMAGELOOKUP]:{type:_.r.IMAGELOOKUP,id:"b039feb0-ee7c-4884-8aa6-d6d45d84316f",name:"ImageLookup",icon:"data-type-image-link-icon.svg",designerIcon:b(65689),translateKey:`${g}.ImageLookupCaption`},[_.r.Money]:{type:_.r.Money,id:"969093e2-2b4e-463b-883a-3d3b8c61f0cd",name:"Money",icon:"data-type-float2-icon.svg",designerIcon:b(32643),translateKey:`${g}.MoneyCaption`},[_.r.Float]:{type:_.r.Float,id:"57ee4c31-5ec4-45fa-b95d-3a2868aa89a8",name:"Float",icon:"data-type-float1-icon.svg",designerIcon:b(68877),translateKey:`${g}.FloatCaption`},[_.r.FILE]:{type:_.r.FILE,id:"a33c9252-d401-453e-949d-169157067ed9",name:"File",icon:"data-type-file-icon.svg",designerIcon:b(55039),translateKey:`${g}.FileCaption`},[_.r.Image]:{type:_.r.Image,id:"fa6e6e49-b996-475e-a77e-73904e4c5a88",name:"Image",icon:"data-type-image-icon.svg",designerIcon:b(55039),translateKey:`${g}.ImageCaption`},[_.r.Blob]:{type:_.r.Blob,id:"b7342b7a-5dde-40de-aa7c-24d2a57b3202",name:"Blob",icon:"data-type-blob-icon.svg",designerIcon:b(55039),translateKey:`${g}.BlobCaption`},[_.r.Color]:{type:_.r.Color,id:"dafb71f9-ee9f-4e0b-a4d7-37aa15987155",name:"Color",icon:"data-type-color-icon.svg",designerIcon:b(39078),translateKey:`${g}.ColorCaption`},[_.r.RICH_TEXT]:{type:_.r.RICH_TEXT,id:"79bccffa-8c8b-4863-b376-a69d2244182b",name:"RichText",icon:"data-type-rich-text-icon.svg",designerIcon:b(67021),translateKey:`${g}.RichCaption`},[_.r.ENTITY]:{type:_.r.ENTITY,id:"ebd85d37-0abf-4bbf-bb32-97dc3dffcc8c",name:"Entity",icon:"data-type-other-icon.svg",designerIcon:b(97180),translateKey:`${g}.Entity`},[_.r.ENTITY_COLLECTION]:{type:_.r.ENTITY_COLLECTION,id:"51fb23ba-3eb2-11e2-b7d5-b0c76188709b",name:"EntityCollection",icon:"data-type-other-icon.svg",designerIcon:b(97180),translateKey:`${g}.EntityCollection`},[_.r.ENTITY_COLUMN_MAPPING_COLLECTION]:{type:_.r.ENTITY_COLUMN_MAPPING_COLLECTION,id:"b53eaa2a-4bb7-4a6b-9f4f-58ccab293e31",name:"EntityColumnMappingCollection",icon:"data-type-other-icon.svg",designerIcon:b(97180),translateKey:`${g}.EntityColumnMappingCollection`},[_.r.CUSTOM_OBJECT]:{type:_.r.CUSTOM_OBJECT,id:"84ed6865-9692-4c98-aaed-4d15b96a95c2",name:"CustomObject",icon:"data-type-other-icon.svg",designerIcon:b(97180),translateKey:`${g}.CustomObject`},[_.r.OBJECT_LIST]:{type:_.r.OBJECT_LIST,id:"4b51a8b5-1ee9-4437-9d58-f35e083cbcdf",name:"ObjectList",icon:"data-type-other-icon.svg",designerIcon:b(97180),translateKey:`${g}.ObjectList`},[_.r.COMPOSITE_OBJECT_LIST]:{type:_.r.COMPOSITE_OBJECT_LIST,id:"651ec16f-d140-46db-b9e2-825c985a8ac2",name:"CompositeObjectList",icon:"data-type-other-icon.svg",designerIcon:b(97180),translateKey:`${g}.CompositeObjectList`},[_.r.COMPOSITE_OBJECT]:{type:_.r.COMPOSITE_OBJECT,id:"632e4371-0a7f-46cd-a284-a623b3933027",name:"CompositeObject",icon:"data-type-composite-object-icon.svg",designerIcon:b(97180),translateKey:`${g}.CompositeObject`},[_.r.COLLECTION]:{type:_.r.COLLECTION,name:"Collection",icon:"data-type-other-icon.svg",designerIcon:b(97180),translateKey:`${g}.Collection`},[_.r.LOCALIZABLE_STRING]:{type:_.r.LOCALIZABLE_STRING,id:"95c6e6c4-2cc8-46be-a1cb-96f942655f86",name:"LocalizableString",icon:"data-type-text-icon.svg",designerIcon:b(97180),translateKey:`${g}.LocalizableString`},[_.r.METADATA_TEXT]:{type:_.r.METADATA_TEXT,id:"394e160f-c8e0-46fa-9c0d-75d97e9e9169",name:"MetaDataText",icon:"data-type-text-icon.svg",designerIcon:b(97180),translateKey:`${g}.MetaDataText`}},D={DateTime:[_.r.Date,_.r.Time,_.r.DateTime],Text:[_.r.Text,_.r.SHORT_TEXT,_.r.MEDIUM_TEXT,_.r.LONG_TEXT,_.r.PHONE_TEXT,_.r.WEB_TEXT,_.r.EMAIL_TEXT,_.r.MAXSIZE_TEXT,_.r.LOCALIZABLE_STRING,_.r.RICH_TEXT],Number:[_.r.FLOAT1,_.r.FLOAT2,_.r.FLOAT3,_.r.FLOAT4,_.r.FLOAT8,_.r.Integer,_.r.Money,_.r.Float],Lookup:[_.r.Lookup,_.r.IMAGELOOKUP]}},74975:(E,Y,b)=>{b.d(Y,{S:()=>R});var _=b(59131),g=b.n(_);class R{constructor(){const c=this.constructor;if((0,_.inject)(c,_.InjectFlags.Optional|_.InjectFlags.SkipSelf))throw Error(`[${c.name}]: trying to create multiple instances,
			but this service should be a singleton.`)}}},23092:(E,Y,b)=>{b.d(Y,{fv:()=>De,oq:()=>o,vn:()=>Yn});var _=b(63721),g=b.n(_),R=b(59131),D=b.n(R),c=b(62278),w=b.n(c),F=b(61843),T=b(74975);class o{constructor(){this.cultureInfo=new F.fX,this.defCultureInfo=new F.fX}}const u="Information about the current user is not initialized yet. Use UserInfoService to load current user information.";function Se(){return{get id(){throw new ReferenceError(u)},get contactId(){throw new ReferenceError(u)},get contactName(){throw new ReferenceError(u)},get accountId(){throw new ReferenceError(u)},get accountName(){throw new ReferenceError(u)},get isSSP(){throw new ReferenceError(u)},get timeZoneId(){throw new ReferenceError(u)},get cultureInfo(){throw new ReferenceError(u)},get defCultureInfo(){throw new ReferenceError(u)},get timeZoneOffsetHours(){throw new ReferenceError(u)},get photoId(){throw new ReferenceError(u)},get accessType(){throw new ReferenceError(u)},get sessionId(){throw new ReferenceError(u)}}}const U=Se(),nt={get id(){return U.id},get contactId(){return U.contactId},get contactName(){return U.contactName},get accountId(){return U.accountId},get accountName(){return U.accountName},get isSSP(){return U.isSSP},get timeZoneId(){return U.timeZoneId},get cultureInfo(){return U.cultureInfo},get defCultureInfo(){return U.defCultureInfo},get timeZoneOffsetHours(){return U.timeZoneOffsetHours},get photoId(){return U.photoId},get accessType(){return U.accessType},get sessionId(){return U.sessionId}};Object.freeze(nt);const Yn={provide:o,useFactory:()=>nt};class De extends T.S{constructor(qe){super(),this._httpClient=qe,this._serviceEndpoint="/ServiceModel/UserInfoService.svc"}_applyUserInfo(qe){Object.keys(U).forEach(it=>{delete U[it]}),Object.assign(U,qe)}loadCurrentUserInfo(){if(!this._userInfo$){const qe=`${this._serviceEndpoint}/GetCurrentUserInfo`;this._userInfo$=this._httpClient.post(qe,null).pipe((0,c.tap)(it=>{this._applyUserInfo(it?.userInfo)}),(0,c.shareReplay)({bufferSize:1,refCount:!1}))}return this._userInfo$}static#e=this.\u0275fac=function(it){return new(it||De)(R.\u0275\u0275inject(_.HttpClient))};static#t=this.\u0275prov=R.\u0275\u0275defineInjectable({token:De,factory:De.\u0275fac,providedIn:"root"})}},77017:E=>{E.exports='<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><defs><style>.error-icon-a{fill:#df1f26;}.error-icon-b,.error-icon-c{fill:none;}.error-icon-b{stroke:#fff;stroke-miterlimit:10;stroke-width:1.5px;}</style></defs><circle class="error-icon-a" cx="7" cy="7" r="7" transform="translate(1 1)"/><line class="error-icon-b" x2="6" y2="6" transform="translate(5 5)"/><line class="error-icon-b" y1="6" x2="6" transform="translate(5 5)"/><rect class="error-icon-c" width="16" height="16"/></svg>'},64207:E=>{E.exports='<svg xmlns="http://www.w3.org/2000/svg" width="16.001" height="16" viewBox="0 0 16.001 16"><defs><style>.warning-icon-a{fill:#ff9800;}.warning-icon-b,.warning-icon-d{fill:none;}.warning-icon-b{stroke:#fff;stroke-linecap:round;stroke-miterlimit:10;stroke-width:2px;}.warning-icon-c{fill:#fff;}</style></defs><g transform="translate(-1330.138 361.759)"><path class="warning-icon-a" d="M1345.172-346.541H1331.1a.964.964,0,0,1-.84-1.438l7.033-12.505a.965.965,0,0,1,1.682,0l7.034,12.505A.965.965,0,0,1,1345.172-346.541Z"/><line class="warning-icon-b" y2="3" transform="translate(1338.139 -355.279)"/><circle class="warning-icon-c" cx="1.25" cy="1.25" r="1.25" transform="translate(1336.889 -350.529)"/></g><rect class="warning-icon-d" width="16" height="16" transform="translate(0.001)"/></svg>'},78683:E=>{E.exports=`<svg width="14" height="14" viewBox="0 0 14 14" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M0 1.49845H0.783829V4.00128H2.48383V0.000488281H0V1.49845Z" fill="#FF4013"/>
<path fill-rule="evenodd" clip-rule="evenodd" d="M14 1.00089H5.08699V3.00089H14V1.00089ZM14 6.00052H5.08699V8.00052H14V6.00052ZM0 12.7274V13.9998H3.19044V9.99979H0V11.1761H1.5V11.5073H0.75V12.3962H1.5V12.7274H0ZM14 10.9998H5.08699V12.9998H14V10.9998Z" fill="#FF4013"/>
<path d="M2.14577e-05 7.56383V8.99972L3.15902 8.99977V7.56383L2.26167 7.56378L3.15902 6.86625L3.15902 5.00135L2.14577e-05 5.00128L0 6.43327H1.5L2.14577e-05 7.56383Z" fill="#FF4013"/>
</svg>
`},36659:E=>{E.exports=`<svg id="Boolean_icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><rect id="Rectangle_23177" width="16" height="16" fill="none"/><g id="Rectangle_12" transform="translate(1 1)" fill="none" stroke="#ff4013" stroke-width="2"><rect width="14" height="14" stroke="none"/><rect x="1" y="1" width="12" height="12" fill="none"/></g><path id="Path_30" d="M10.5,4.5,5.912,9,4,7.162" transform="translate(1 0.5)" fill="rgba(0,0,0,0)" stroke="#ff4013" stroke-width="2"/></svg>
`},39078:E=>{E.exports=`<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16"><path d="M8.183.779c2.084.007 2.813.35 4.468 1.861l-1.875 2.424-2.95-1.229Z" fill="#ff1c06"/><path d="M7.643 14.846c-2.083-.006-2.813-.35-4.467-1.861l1.875-2.424L8 11.79Z" fill="#ffc6b8"/><path d="M15.024 8.156c-.064 2.22-.431 3.006-2 4.809l-2.4-1.931 1.322-3.175Z" fill="#ff4013"/><path d="M13.074 3.143c1.5 1.443 1.8 2.195 1.949 4.431l-3.03.46-1.286-2.925Z" fill="#ff320e"/><path d="M3.224 12.86c-1.5-1.443-1.795-2.195-1.948-4.43l3.029-.46 1.287 2.925Z" fill="#ffe8e3"/><path d="M12.999 12.98c-1.578 1.562-2.386 1.878-4.769 2.1l-.4-3.055 3.149-1.384Z" fill="#ff795a"/><g transform="translate(-798.326 92.909)" fill="none"><path d="M798.326-92.909h16v16h-16z"/><circle cx="7" cy="7" r="7" transform="translate(799.326 -91.909)" stroke="#ff4013" stroke-width="2"/><circle cx="3" cy="3" r="3" transform="translate(803.326 -87.909)" stroke="#ff4013" stroke-width="2"/><g stroke="#ff4013" stroke-width="2"><path d="M806.326-81.454v3.686"/><path d="M806.326-88.519v-3.386"/><path d="M803.211-84.909h-3.685"/><path d="M812.826-84.909h-3.387"/><path d="M804.126-87.162c-.8-.8-2.306-2.252-3.1-3.05"/><path d="M811.628-79.605c-.729-.73-2.31-2.2-3.04-2.926"/><path d="m804.02-82.6-3 3"/><path d="m811.629-90.213-3.088 2.978"/></g></g></svg>
`},26861:E=>{E.exports=`<svg id="Date_icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><rect id="Rectangle_23177" width="16" height="16" fill="none"/><g id="Rectangle_6448" transform="translate(1 3)" fill="none" stroke="#ff4013" stroke-miterlimit="10" stroke-width="2"><rect width="14" height="12" stroke="none"/><rect x="1" y="1" width="12" height="10" fill="none"/></g><line id="Line_764" x2="12" transform="translate(2 7)" fill="none" stroke="#ff4013" stroke-miterlimit="10" stroke-width="2"/><path id="Path_11729" d="M176.171,1073.754v3" transform="translate(-171.171 -1072.754)" fill="none" stroke="#ff4013" stroke-width="2"/><path id="Path_11730" d="M176.171,1073.754v3" transform="translate(-165.171 -1072.754)" fill="none" stroke="#ff4013" stroke-width="2"/></svg>
`},55146:E=>{E.exports=`<svg id="Datetime_icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><g id="Icon_left_panel_date_time_16x16_heavy" transform="translate(0)"><rect id="Rectangle_6448" width="16" height="16" fill="none"/><path id="Path_6271" d="M1895.033,260.278h-4.149v-9h12v2" transform="translate(-1889.884 -248.278)" fill="none" stroke="#ff4013" stroke-miterlimit="10" stroke-width="2"/><path id="Path_7772" d="M0,0H4.5" transform="translate(1 6)" fill="none" stroke="#ff4013" stroke-width="2"/><line id="Line_771" y2="4" transform="translate(4)" fill="none" stroke="#ff4013" stroke-miterlimit="10" stroke-width="2"/><line id="Line_772" y2="4" transform="translate(10)" fill="none" stroke="#ff4013" stroke-miterlimit="10" stroke-width="2"/><g id="Path_6272" transform="translate(-1889.764 -248.582)" fill="none" stroke-miterlimit="10"><path d="M1905.764,258.584a5,5,0,1,1-5-5A5,5,0,0,1,1905.764,258.584Z" stroke="none"/><path d="M 1900.7626953125 261.5840454101562 C 1902.417602539062 261.5840454101562 1903.763916015625 260.23828125 1903.763916015625 258.5840759277344 C 1903.763916015625 256.9292602539062 1902.417602539062 255.5829772949219 1900.7626953125 255.5829772949219 C 1899.109130859375 255.5829772949219 1897.763916015625 256.9292602539062 1897.763916015625 258.5840759277344 C 1897.763916015625 260.23828125 1899.109130859375 261.5840454101562 1900.7626953125 261.5840454101562 M 1900.7626953125 263.5840454101562 C 1898.000244140625 263.5840454101562 1895.763916015625 261.3454284667969 1895.763916015625 258.5840759277344 C 1895.763916015625 255.8215942382812 1898.000244140625 253.5829772949219 1900.7626953125 253.5829772949219 C 1903.524169921875 253.5829772949219 1905.763916015625 255.8215942382812 1905.763916015625 258.5840759277344 C 1905.763916015625 261.3454284667969 1903.524169921875 263.5840454101562 1900.7626953125 263.5840454101562 Z" stroke="none" fill="#ff4013"/></g><path id="Path_6273" d="M1900.1,255.194v4h2.5" transform="translate(-1889.098 -249.194)" fill="none" stroke="#ff4013" stroke-miterlimit="10" stroke-width="2"/></g></svg>
`},71011:E=>{E.exports=`<svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M2 3.5H14V12C14 12.1326 13.9473 12.2598 13.8536 12.3536C13.7598 12.4473 13.6326 12.5 13.5 12.5H2.5C2.36739 12.5 2.24021 12.4473 2.14645 12.3536C2.05268 12.2598 2 12.1326 2 12V3.5Z" stroke="#FF4013" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
<path d="M14 3.5L8 9L2 3.5" stroke="#FF4013" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
</svg>
`},55039:E=>{E.exports=`<svg id="File_icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><rect id="Rectangle_23177" width="16" height="16" fill="none"/><g id="Group_7055" transform="translate(-733.278 92.545)"><g id="Rectangle_6454" transform="translate(735.278 -91.545)" fill="none" stroke="#ff4013" stroke-miterlimit="10" stroke-width="2"><rect width="12" height="14" stroke="none"/><rect x="1" y="1" width="10" height="12" fill="none"/></g><line id="Line_774" x2="6" transform="translate(738.278 -87.545)" fill="none" stroke="#ff4013" stroke-miterlimit="10" stroke-width="2"/><line id="Line_775" x2="6" transform="translate(738.278 -84.545)" fill="none" stroke="#ff4013" stroke-miterlimit="10" stroke-width="2"/><line id="Line_777" x2="4" transform="translate(738.278 -81.545)" fill="none" stroke="#ff4013" stroke-miterlimit="10" stroke-width="2"/></g></svg>
`},68877:E=>{E.exports=`<svg id="Float_icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><g id="Group_14515" transform="translate(-144 -422)"><rect id="Rectangle_39433" width="16" height="16" transform="translate(144 422)" fill="none"/></g><path id="Path_11302" d="M6.957-4.64a6.469,6.469,0,0,1-.8,3.6A2.764,2.764,0,0,1,3.707.127,2.732,2.732,0,0,1,1.285-1.079,6.377,6.377,0,0,1,.47-4.64a6.53,6.53,0,0,1,.793-3.621A2.752,2.752,0,0,1,3.707-9.426,2.739,2.739,0,0,1,6.135-8.208,6.39,6.39,0,0,1,6.957-4.64Zm-4.539,0a7.22,7.22,0,0,0,.3,2.447,1.022,1.022,0,0,0,.993.74A1.033,1.033,0,0,0,4.7-2.2,7.02,7.02,0,0,0,5-4.64a7,7,0,0,0-.308-2.453,1.034,1.034,0,0,0-.987-.746,1.025,1.025,0,0,0-.99.746A7.208,7.208,0,0,0,2.418-4.64ZM7.759-.908a1.064,1.064,0,0,1,.286-.806,1.158,1.158,0,0,1,.832-.273,1.125,1.125,0,0,1,.816.279,1.061,1.061,0,0,1,.289.8,1.061,1.061,0,0,1-.292.79,1.105,1.105,0,0,1-.812.289,1.138,1.138,0,0,1-.825-.282A1.057,1.057,0,0,1,7.759-.908ZM13.69,0H11.728V-5.37l.019-.882.032-.965q-.489.489-.679.641l-1.066.857L9.088-6.9l2.99-2.38H13.69Z" transform="translate(0.53 12.426)" fill="#ff4013"/></svg>
`},92458:E=>{E.exports=`<svg id="Guid_icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><rect id="Rectangle_42308" width="16" height="16" fill="none"/><path id="Path_11737" d="M1.162,0H3.43V-9.8H1.162Zm9.926-10.388v3.654a2.894,2.894,0,0,0-2.254-.91A3.661,3.661,0,0,0,5.068-3.766,3.661,3.661,0,0,0,8.834.112a2.9,2.9,0,0,0,2.352-.98V0h2.086V-10.388ZM9.212-1.68A1.911,1.911,0,0,1,7.28-3.766,1.911,1.911,0,0,1,9.212-5.852,1.908,1.908,0,0,1,11.13-3.766,1.908,1.908,0,0,1,9.212-1.68Z" transform="translate(0.838 13)" fill="#ff4013" stroke="rgba(0,0,0,0)" stroke-width="1"/></svg>
`},65689:E=>{E.exports=`<svg width="17" height="17" viewBox="0 0 17 17" fill="none" xmlns="http://www.w3.org/2000/svg">
<g clip-path="url(#clip0_1742_819)">
<path d="M10.913 8.99277L7.40833 13.0074H13.0074V11.2395L10.913 8.99277ZM10.8641 6.00745L15.0074 10.4519V15.0074H3.00745L10.8641 6.00745Z" fill="#ff4013"/>
<path d="M3.43597 9.72806C2.87697 10.2871 2.20496 9.92807 1.64496 9.37007C1.08596 8.81107 0.726988 8.13807 1.28699 7.57907L3.07794 5.78806C3.63694 5.22906 4.30898 5.58806 4.86798 6.14606C5.42798 6.70506 5.78595 7.37706 5.22595 7.93706L3.43597 9.72806Z" stroke="#ff4013" stroke-width="2" stroke-miterlimit="10"/>
<path d="M7.93689 5.22705C7.37689 5.78605 6.70591 5.42704 6.14691 4.86804C5.58691 4.30904 5.22894 3.63704 5.78894 3.07804L7.57892 1.28704C8.13892 0.728043 8.80993 1.08704 9.36993 1.64604C9.92993 2.20504 10.2879 2.87704 9.72888 3.43704L7.93689 5.22705Z" stroke="#ff4013" stroke-width="2" stroke-miterlimit="10"/>
<path d="M4.70691 6.51907L6.51791 4.70807" stroke="#ff4013" stroke-width="2"/>
<path d="M11.301 2.00702H14.0079V14.007H2.00793V11.581" stroke="#ff4013" stroke-width="2"/>
</g>
<defs>
<clipPath id="clip0_1742_819">
<rect width="16.007" height="16.007" fill="#ff4013"/>
</clipPath>
</defs>
</svg>
`},60521:E=>{E.exports=`<svg id="Integer_icon" width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
<path fill-rule="evenodd" clip-rule="evenodd" d="M8.99433 4.65198C9.48732 5.09802 9.74027 5.69781 9.74027 6.39946C9.74027 7.11039 9.46186 7.74386 8.95863 8.29085L8.95331 8.29664C8.68048 8.58037 8.17318 8.98047 7.44252 9.47417L7.44143 9.4749C7.00788 9.76552 6.67964 10.0338 6.4484 10.2773C6.39755 10.3308 6.35224 10.3822 6.31202 10.4316H9.03463C9.42976 10.4316 9.75009 10.7519 9.75009 11.1471C9.75009 11.5422 9.42976 11.8625 9.03463 11.8625H4.36201V11.5055C4.36201 10.774 4.62396 10.1113 5.14954 9.53003C5.45393 9.18287 5.98212 8.74216 6.73359 8.22779C7.28336 7.835 7.61754 7.57002 7.77738 7.40238C8.08169 7.07198 8.22096 6.73348 8.22096 6.38964C8.22096 6.03409 8.11952 5.81409 7.95289 5.66027C7.78277 5.50324 7.51683 5.40148 7.12478 5.40148C6.72877 5.40148 6.47218 5.52561 6.29884 5.75228L6.29169 5.76164L6.28392 5.77051C6.13055 5.94579 6.0142 6.20942 5.96505 6.5873C5.91679 6.95826 5.61042 7.29659 5.18377 7.29659C4.7751 7.29659 4.39395 6.95656 4.44447 6.49553C4.51728 5.83108 4.75991 5.26428 5.17392 4.82141C5.68203 4.26788 6.36125 4 7.15424 4C7.87626 4 8.49451 4.21025 8.99122 4.6492L8.99433 4.65198ZM14.8743 4.5961C15.3635 5.01371 15.6083 5.57814 15.6083 6.262C15.6083 6.71398 15.4974 7.12093 15.2526 7.45671C15.1531 7.59318 15.0352 7.71289 14.9008 7.81669C15.0605 7.92572 15.2015 8.0545 15.3211 8.20545C15.6165 8.55303 15.7556 8.98069 15.7556 9.46307C15.7556 10.1963 15.4914 10.8144 14.9713 11.2883C14.4419 11.7715 13.7612 12 12.9634 12C12.2299 12 11.6078 11.8045 11.1119 11.4124L11.1064 11.408C10.628 11.014 10.3332 10.4794 10.2052 9.83055C10.1107 9.35139 10.5042 8.97835 10.9288 8.97835C11.3492 8.97835 11.6378 9.30727 11.7079 9.64478C11.7693 9.94025 11.9002 10.158 12.0891 10.3154C12.3147 10.495 12.5969 10.5985 12.9634 10.5985C13.3872 10.5985 13.6961 10.4769 13.9229 10.2668C14.1282 10.0596 14.2363 9.80805 14.2363 9.49253C14.2363 9.15687 14.1319 8.93882 13.9486 8.7817C13.7609 8.62082 13.483 8.52399 13.0419 8.52399H12.7866C12.4159 8.52399 12.1154 8.22345 12.1154 7.85271C12.1154 7.48197 12.4159 7.18143 12.7866 7.18143H13.0125C13.4306 7.18143 13.6903 7.08609 13.85 6.9535C14.0037 6.81675 14.0989 6.61783 14.0989 6.31109C14.0989 6.00164 14.0017 5.79895 13.8513 5.66111L13.8504 5.66027C13.6842 5.50686 13.4217 5.4113 13.0223 5.4113C12.6106 5.4113 12.3484 5.51295 12.1702 5.68456L12.1656 5.68906C12.0215 5.82278 11.914 6.00455 11.8495 6.25293C11.766 6.57474 11.481 6.87436 11.0816 6.87436C10.6572 6.87436 10.2506 6.49494 10.3668 6.00508C10.4953 5.4634 10.7597 5.01133 11.1524 4.66211C11.6438 4.20736 12.2763 4 13.0125 4C13.739 4 14.3777 4.18225 14.8711 4.59337L14.8743 4.5961ZM3.41307 4.92822V11.1029C3.41307 11.5224 3.07297 11.8625 2.65342 11.8625C2.23388 11.8625 1.89377 11.5224 1.89377 11.1029V6.23307C1.68552 6.37174 1.46266 6.49124 1.22573 6.59268C0.723506 6.80771 0.244141 6.40276 0.244141 5.92406C0.244141 5.5872 0.467589 5.3135 0.755873 5.2089C0.963927 5.13341 1.17934 5.03405 1.39555 4.90741C1.64533 4.74519 1.85627 4.57307 2.04007 4.3863C2.18718 4.23681 2.39336 4.13748 2.62233 4.13748C3.05905 4.13748 3.41307 4.4915 3.41307 4.92822Z" fill="#ff4013"/>
</svg>
`},61631:E=>{E.exports=`<svg id="Lookup_icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><g id="Group_6916" transform="translate(2.277 2)"><g id="Group_6915" transform="translate(-0.277)"><circle id="Ellipse_237" cx="4.5" cy="4.5" r="4.5" fill="none" stroke="#ff4013" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path id="Path_6243" d="M.344.344,4.123,4.123" transform="translate(7.877 7.876)" fill="none" stroke="#ff4013" stroke-width="2"/></g></g><rect id="Rectangle_24756" width="16" height="16" fill="none"/></svg>
`},32643:E=>{E.exports=`<svg id="Money_icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><rect id="Rectangle_23177" width="16" height="16" fill="none"/><path id="Path_7070" d="M-318.645,863.293h-6v-8h14v4" transform="translate(325.645 -852.293)" fill="none" stroke="#ff4013" stroke-miterlimit="10" stroke-width="2"/><path id="Path_7071" d="M-322.646,855.292a2,2,0,0,1-2,2" transform="translate(326.646 -851.292)" fill="none" stroke="#ff4013" stroke-miterlimit="10" stroke-width="2"/><path id="Path_7072" d="M-312.246,857.292a2,2,0,0,1-2-2" transform="translate(326.246 -851.292)" fill="none" stroke="#ff4013" stroke-miterlimit="10" stroke-width="2"/><path id="Path_7073" d="M-324.646,861.692a2,2,0,0,1,2,2" transform="translate(326.646 -853.692)" fill="none" stroke="#ff4013" stroke-miterlimit="10" stroke-width="2"/><g id="Ellipse_1363" transform="translate(6 5)" fill="none" stroke="#ff4013" stroke-miterlimit="10" stroke-width="2"><circle cx="2" cy="2" r="2" stroke="none"/><circle cx="2" cy="2" r="1" fill="none"/></g><path id="Path_7074" d="M-310.846,861.425c0,.737-1.12,1.333-2.5,1.333s-2.5-.6-2.5-1.333,1.12-1.333,2.5-1.333S-310.846,860.69-310.846,861.425Z" transform="translate(325.846 -851.092)" fill="none" stroke="#ff4013" stroke-miterlimit="10" stroke-width="2"/><path id="Path_7075" d="M-310.846,863.292c0,.589-1.12,1.333-2.5,1.333s-2.5-.744-2.5-1.333" transform="translate(325.846 -850.292)" fill="none" stroke="#ff4013" stroke-miterlimit="10" stroke-width="2"/></svg>
`},59155:E=>{E.exports=`<svg width="14" height="14" viewBox="0 0 14 14" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M5.3353 1.83815L6.26378 1.46676L6.26378 1.46676L5.3353 1.83815ZM6.03813 3.59524L5.10965 3.96663L5.10965 3.96663L6.03813 3.59524ZM5.82454 4.94398L5.05632 4.3038L5.0563 4.30383L5.82454 4.94398ZM5.44629 5.39792L6.21451 6.03811L6.21453 6.03808L5.44629 5.39792ZM5.52758 7.19434L4.82047 7.90144L4.8205 7.90147L5.52758 7.19434ZM6.8057 8.47236L7.5128 7.76526L7.51278 7.76523L6.8057 8.47236ZM8.60205 8.55382L7.96198 7.7855L7.96187 7.78559L8.60205 8.55382ZM9.05613 8.17554L9.69619 8.94386L9.69631 8.94376L9.05613 8.17554ZM10.4048 7.96192L10.7762 7.03345L10.7761 7.03344L10.4048 7.96192ZM12.1617 8.66476L11.7903 9.59322L11.7903 9.59323L12.1617 8.66476ZM12.9999 9.90268H11.9999V9.90272L12.9999 9.90268ZM13 11.7369H14V11.7368L13 11.7369ZM4.09733 2C4.23363 2 4.3562 2.08298 4.40682 2.20954L6.26378 1.46676C5.90943 0.580885 5.05144 0 4.09733 0V2ZM4.40682 2.20953L5.10965 3.96663L6.96661 3.22386L6.26378 1.46676L4.40682 2.20953ZM5.10965 3.96663C5.15517 4.08044 5.13462 4.20985 5.05632 4.3038L6.59277 5.58417C7.14152 4.92566 7.28485 4.01947 6.96661 3.22385L5.10965 3.96663ZM5.0563 4.30383L4.67804 4.75777L6.21453 6.03808L6.59279 5.58414L5.0563 4.30383ZM4.67807 4.75774C3.90567 5.68462 3.96693 7.0479 4.82047 7.90144L6.23468 6.48723C6.11298 6.36552 6.10396 6.17076 6.21451 6.03811L4.67807 4.75774ZM4.8205 7.90147L6.09862 9.17949L7.51278 7.76523L6.23466 6.4872L4.8205 7.90147ZM6.09859 9.17947C6.95196 10.0328 8.31517 10.0946 9.24224 9.32204L7.96187 7.78559C7.82939 7.89599 7.63468 7.88713 7.5128 7.76526L6.09859 9.17947ZM9.24212 9.32213L9.69619 8.94386L8.41606 7.40722L7.96198 7.7855L9.24212 9.32213ZM9.69631 8.94376C9.79033 8.86541 9.91963 8.8449 10.0334 8.8904L10.7761 7.03344C9.98045 6.71516 9.07438 6.85861 8.41594 7.40732L9.69631 8.94376ZM10.0333 8.89039L11.7903 9.59322L12.5331 7.73629L10.7762 7.03345L10.0333 8.89039ZM11.7903 9.59323C11.917 9.64389 11.9999 9.76649 11.9999 9.90268H13.9999C13.9999 8.94847 13.4189 8.09059 12.5331 7.73628L11.7903 9.59323ZM11.9999 9.90272L12 11.7369L14 11.7368L13.9999 9.90264L11.9999 9.90272ZM12 11.7369C12 11.8823 11.8822 12 11.737 12V14C12.987 14 14 12.9867 14 11.7369H12ZM11.737 12C6.35945 12 2 7.64067 2 2.26318H0C0 8.74528 5.25492 14 11.737 14V12ZM2 2.26318C2 2.11782 2.11785 2 2.26316 2V0C1.01322 0 0 1.0133 0 2.26318H2ZM2.26316 2H4.09733V0H2.26316V2Z" fill="#FF4013"/>
</svg>
`},67021:E=>{E.exports=`<svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M13 1H3C1.89543 1 1 1.89543 1 3V13C1 14.1046 1.89543 15 3 15H13C14.1046 15 15 14.1046 15 13V3C15 1.89543 14.1046 1 13 1Z" stroke="#FF4013" stroke-width="2" stroke-miterlimit="10"/>
<path d="M9 12H7V6H4V4H12V6H9V12Z" fill="#FF4013"/>
</svg>
`},28010:E=>{E.exports=`<svg width="16" height="17" viewBox="0 0 16 17" fill="none" xmlns="http://www.w3.org/2000/svg">
<path fill-rule="evenodd" clip-rule="evenodd" d="M5.14 6.90901C5.13775 7.50618 5.25259 8.098 5.478 8.65101L1.5 12.629V15.229H4.1V13.669H5.66V12.109H7.22L8.078 11.251C8.631 11.4764 9.22282 11.5912 9.82 11.589C10.7456 11.589 11.6504 11.3145 12.4201 10.8003C13.1897 10.286 13.7895 9.55512 14.1438 8.69996C14.498 7.84481 14.5907 6.90381 14.4101 5.99598C14.2295 5.08815 13.7838 4.25426 13.1293 3.59975C12.4747 2.94524 11.6409 2.49951 10.733 2.31893C9.82519 2.13835 8.8842 2.23103 8.02904 2.58525C7.17388 2.93947 6.44297 3.53932 5.92872 4.30894C5.41448 5.07856 5.14 5.98339 5.14 6.90901ZM12.4832 5.95178C12.4832 6.84671 11.7577 7.57221 10.8628 7.57221C9.96785 7.57221 9.24236 6.84671 9.24236 5.95178C9.24236 5.05684 9.96785 4.33135 10.8628 4.33135C11.7577 4.33135 12.4832 5.05684 12.4832 5.95178Z" fill="#FF4013"/>
</svg>
`},97180:E=>{E.exports=`<svg id="Text_icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><rect id="Rectangle_39432" width="16" height="16" fill="none"/><path id="Path_11304" d="M5.113,0H2.994V-8.23H.28V-9.994H7.827V-8.23H5.113Z" transform="translate(4 13)" fill="#ff4013"/></svg>
`},8510:E=>{E.exports=`<svg id="Time_icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><rect id="Rectangle_23177" width="16" height="16" fill="none"/><g id="Ellipse_1346" transform="translate(1 1)" fill="none" stroke="#ff4013" stroke-miterlimit="10" stroke-width="2"><circle cx="7" cy="7" r="7" stroke="none"/><circle cx="7" cy="7" r="6" fill="none"/></g><path id="Path_6908" d="M1824.814,31.345v6h3" transform="translate(-1816.814 -29.345)" fill="none" stroke="#ff4013" stroke-miterlimit="10" stroke-width="2"/></svg>
`},64337:E=>{E.exports=`<svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M8 14C11.3137 14 14 11.3137 14 8C14 4.68629 11.3137 2 8 2C4.68629 2 2 4.68629 2 8C2 11.3137 4.68629 14 8 14Z" stroke="#FF4013" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
<path d="M2 8H14" stroke="#FF4013" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
<path d="M8 13.8375C9.38071 13.8375 10.5 11.2239 10.5 7.99998C10.5 4.77601 9.38071 2.16248 8 2.16248C6.61929 2.16248 5.5 4.77601 5.5 7.99998C5.5 11.2239 6.61929 13.8375 8 13.8375Z" stroke="#FF4013" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
</svg>
`},73308:(E,Y,b)=>{b.d(Y,{A:()=>g});function _(R,D,c,w,F,T,o){try{var u=R[T](o),Se=u.value}catch(U){c(U);return}u.done?D(Se):Promise.resolve(Se).then(w,F)}function g(R){return function(){var D=this,c=arguments;return new Promise(function(w,F){var T=R.apply(D,c);function o(Se){_(T,w,F,o,u,"next",Se)}function u(Se){_(T,w,F,o,u,"throw",Se)}o(void 0)})}}}}]);
